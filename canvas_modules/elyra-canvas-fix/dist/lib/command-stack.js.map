{"version":3,"file":"command-stack.js","sources":["../../src/command-stack/internal-stack.js","../../src/command-stack/command-stack.js"],"sourcesContent":["/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { List, Record, Stack } from \"immutable\";\n\nconst MAX_UNDO_COMMANDS = 100;\n\nexport default class InternalStack {\n\n\tconstructor() {\n\t\tconst recFac = new Record({\n\t\t\tundoCmnds: new List(),\n\t\t\tredoCmnds: new Stack()\n\t\t});\n\n\t\tthis.rec = recFac();\n\t}\n\n\tdo(command) {\n\t\tthis.rec = this.rec.merge({\n\t\t\tundoCmnds: this.rec.undoCmnds.push(command),\n\t\t\tredoCmnds: new Stack()\n\t\t});\n\n\t\tif (this.rec.undoCmnds.size > MAX_UNDO_COMMANDS) {\n\t\t\tthis.rec = this.rec.set(\"undoCmnds\", this.rec.undoCmnds.shift());\n\t\t}\n\t\tcommand.do();\n\t}\n\n\tundo() {\n\t\tif (this.canUndo()) {\n\t\t\tconst prev = this.getPrevious();\n\t\t\tthis.rec = this.rec.merge({\n\t\t\t\tundoCmnds: this.rec.undoCmnds.pop(),\n\t\t\t\tredoCmnds: this.rec.redoCmnds.push(prev)\n\t\t\t});\n\t\t\tprev.undo();\n\t\t}\n\t}\n\n\tredo() {\n\t\tif (this.canRedo()) {\n\t\t\tconst next = this.getNext();\n\t\t\tthis.rec = this.rec.merge({\n\t\t\t\tundoCmnds: this.rec.undoCmnds.push(next),\n\t\t\t\tredoCmnds: this.rec.redoCmnds.pop()\n\t\t\t});\n\t\t\tnext.redo();\n\t\t}\n\t}\n\n\tcanUndo() {\n\t\treturn !this.rec.undoCmnds.isEmpty();\n\t}\n\n\tcanRedo() {\n\t\treturn !this.rec.redoCmnds.isEmpty();\n\t}\n\n\tgetPrevious() {\n\t\treturn this.rec.undoCmnds.last();\n\t}\n\n\tgetNext() {\n\t\treturn this.rec.redoCmnds.first();\n\t}\n\n\tgetUndoCommands() {\n\t\treturn this.rec.undoCmnds;\n\t}\n\n\tgetRedoCommands() {\n\t\treturn this.rec.redoCmnds;\n\t}\n}\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport InternalStack from \"./internal-stack.js\";\n\nexport default class CommandStack {\n\n\tconstructor() {\n\t\tthis.commands = new InternalStack();\n\t}\n\n\tdo(action) {\n\t\tthis.commands.do(action);\n\t}\n\n\tundo() {\n\t\tthis.commands.undo();\n\t}\n\n\tredo() {\n\t\tthis.commands.redo();\n\t}\n\n\tgetUndoCommand() {\n\t\tif (this.commands.canUndo()) {\n\t\t\treturn this.commands.getPrevious();\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetRedoCommand() {\n\t\tif (this.commands.canRedo()) {\n\t\t\treturn this.commands.getNext();\n\t\t}\n\t\treturn null;\n\t}\n\n\t// need this for validation on unit tests\n\tgetStack() {\n\t\treturn {\n\t\t\t\"undos\": this.commands.getUndoCommands(),\n\t\t\t\"redos\": this.commands.getRedoCommands()\n\t\t};\n\t}\n\n\tcanUndo() {\n\t\treturn this.commands.canUndo();\n\t}\n\n\tcanRedo() {\n\t\treturn this.commands.canRedo();\n\t}\n\n\tclearCommandStack() {\n\t\tthis.commands = new InternalStack();\n\t}\n}\n"],"names":["InternalStack","_classCallCheck","recFac","Record","undoCmnds","List","redoCmnds","Stack","this","rec","_createClass","key","value","command","merge","push","size","set","shift","canUndo","prev","getPrevious","pop","undo","canRedo","next","getNext","redo","isEmpty","last","first","CommandStack","commands","action","undos","getUndoCommands","redos","getRedoCommands"],"mappings":"gFAoBqBA,aAEpB,SAAAA,IAAcC,uBAAAD,GACb,IAAME,EAAS,IAAIC,SAAO,CACzBC,UAAW,IAAIC,OACfC,UAAW,IAAIC,UAGhBC,KAAKC,IAAMP,IA2DX,OA1DAQ,eAAAV,IAAAW,SAAAC,MAED,SAAGC,GACFL,KAAKC,IAAMD,KAAKC,IAAIK,MAAM,CACzBV,UAAWI,KAAKC,IAAIL,UAAUW,KAAKF,GACnCP,UAAW,IAAIC,UAGZC,KAAKC,IAAIL,UAAUY,KAnBC,MAoBvBR,KAAKC,IAAMD,KAAKC,IAAIQ,IAAI,YAAaT,KAAKC,IAAIL,UAAUc,UAEzDL,UACAF,WAAAC,MAED,WACC,GAAIJ,KAAKW,UAAW,CACnB,IAAMC,EAAOZ,KAAKa,cAClBb,KAAKC,IAAMD,KAAKC,IAAIK,MAAM,CACzBV,UAAWI,KAAKC,IAAIL,UAAUkB,MAC9BhB,UAAWE,KAAKC,IAAIH,UAAUS,KAAKK,KAEpCA,EAAKG,WAENZ,WAAAC,MAED,WACC,GAAIJ,KAAKgB,UAAW,CACnB,IAAMC,EAAOjB,KAAKkB,UAClBlB,KAAKC,IAAMD,KAAKC,IAAIK,MAAM,CACzBV,UAAWI,KAAKC,IAAIL,UAAUW,KAAKU,GACnCnB,UAAWE,KAAKC,IAAIH,UAAUgB,QAE/BG,EAAKE,WAENhB,cAAAC,MAED,WACC,OAAQJ,KAAKC,IAAIL,UAAUwB,aAC3BjB,cAAAC,MAED,WACC,OAAQJ,KAAKC,IAAIH,UAAUsB,aAC3BjB,kBAAAC,MAED,WACC,OAAOJ,KAAKC,IAAIL,UAAUyB,UAC1BlB,cAAAC,MAED,WACC,OAAOJ,KAAKC,IAAIH,UAAUwB,WAC1BnB,sBAAAC,MAED,WACC,OAAOJ,KAAKC,IAAIL,aAChBO,sBAAAC,MAED,WACC,OAAOJ,KAAKC,IAAIH,cAChBN,CAAA,ICtEmB+B,aAEpB,SAAAA,IAAc9B,uBAAA8B,GACbvB,KAAKwB,SAAW,IAAIhC,EA+CpB,OA9CAU,eAAAqB,IAAApB,SAAAC,MAED,SAAGqB,GACFzB,KAAKwB,YAAYC,MACjBtB,WAAAC,MAED,WACCJ,KAAKwB,SAAST,UACdZ,WAAAC,MAED,WACCJ,KAAKwB,SAASL,UACdhB,qBAAAC,MAED,WACC,OAAIJ,KAAKwB,SAASb,UACVX,KAAKwB,SAASX,cAEf,QACPV,qBAAAC,MAED,WACC,OAAIJ,KAAKwB,SAASR,UACVhB,KAAKwB,SAASN,UAEf,QAGRf,eAAAC,MACA,WACC,MAAO,CACNsB,MAAS1B,KAAKwB,SAASG,kBACvBC,MAAS5B,KAAKwB,SAASK,sBAExB1B,cAAAC,MAED,WACC,OAAOJ,KAAKwB,SAASb,aACrBR,cAAAC,MAED,WACC,OAAOJ,KAAKwB,SAASR,aACrBb,wBAAAC,MAED,WACCJ,KAAKwB,SAAW,IAAIhC,MACpB+B,CAAA"}