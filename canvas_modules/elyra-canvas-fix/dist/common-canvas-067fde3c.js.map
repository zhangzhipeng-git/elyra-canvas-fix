{"version":3,"file":"common-canvas-067fde3c.js","sources":["../src/palette/palette-dialog-topbar-three-way-icon.jsx","../src/palette/palette-dialog-topbar.jsx","../assets/images/palette/palette_grid_selected.svg","../assets/images/palette/palette_grid_hover.svg","../assets/images/palette/palette_grid_deselected.svg","../assets/images/palette/palette_list_selected.svg","../assets/images/palette/palette_list_hover.svg","../assets/images/palette/palette_list_deselected.svg","../assets/images/palette/close_32.svg","../src/palette/palette-dialog-content-category.jsx","../src/palette/palette-dialog-content-categories.jsx","../assets/images/supernode.svg","../assets/images/supernode_ext.svg","../src/palette/palette-dialog-content-grid-node.jsx","../src/palette/palette-dialog-content-grid.jsx","../src/palette/palette-content-list-item.jsx","../src/palette/palette-content-list.jsx","../src/palette/palette-dialog-content.jsx","../src/palette/palette-dialog.jsx","../node_modules/lodash/now.js","../node_modules/lodash/debounce.js","../src/palette/palette-flyout-utils.js","../src/palette/palette-flyout-content-category.jsx","../src/palette/palette-flyout-content-search.jsx","../src/palette/palette-flyout-content-filtered-list.jsx","../src/palette/palette-flyout-content.jsx","../src/palette/palette-flyout.jsx","../src/palette/palette.jsx","../src/common-canvas/cc-tooltip.jsx","../src/common-canvas/cc-context-menu.jsx","../src/common-canvas/cc-text-toolbar.jsx","../src/common-canvas/cc-state-tag.jsx","../node_modules/d3-selection/src/namespaces.js","../node_modules/d3-selection/src/namespace.js","../node_modules/d3-selection/src/creator.js","../node_modules/d3-selection/src/selector.js","../node_modules/d3-selection/src/array.js","../node_modules/d3-selection/src/selectorAll.js","../node_modules/d3-selection/src/matcher.js","../node_modules/d3-selection/src/selection/selectChild.js","../node_modules/d3-selection/src/selection/selectChildren.js","../node_modules/d3-selection/src/selection/sparse.js","../node_modules/d3-selection/src/selection/enter.js","../node_modules/d3-selection/src/selection/data.js","../node_modules/d3-selection/src/selection/sort.js","../node_modules/d3-selection/src/selection/attr.js","../node_modules/d3-selection/src/window.js","../node_modules/d3-selection/src/selection/style.js","../node_modules/d3-selection/src/selection/property.js","../node_modules/d3-selection/src/selection/classed.js","../node_modules/d3-selection/src/selection/text.js","../node_modules/d3-selection/src/selection/html.js","../node_modules/d3-selection/src/selection/raise.js","../node_modules/d3-selection/src/selection/lower.js","../node_modules/d3-selection/src/selection/insert.js","../node_modules/d3-selection/src/selection/remove.js","../node_modules/d3-selection/src/selection/clone.js","../node_modules/d3-selection/src/selection/on.js","../node_modules/d3-selection/src/selection/dispatch.js","../node_modules/d3-selection/src/selection/index.js","../node_modules/d3-selection/src/select.js","../node_modules/d3-selection/src/selection/select.js","../node_modules/d3-selection/src/selection/selectAll.js","../node_modules/d3-selection/src/selection/filter.js","../node_modules/d3-selection/src/constant.js","../node_modules/d3-selection/src/selection/exit.js","../node_modules/d3-selection/src/selection/join.js","../node_modules/d3-selection/src/selection/merge.js","../node_modules/d3-selection/src/selection/order.js","../node_modules/d3-selection/src/selection/call.js","../node_modules/d3-selection/src/selection/nodes.js","../node_modules/d3-selection/src/selection/node.js","../node_modules/d3-selection/src/selection/size.js","../node_modules/d3-selection/src/selection/empty.js","../node_modules/d3-selection/src/selection/each.js","../node_modules/d3-selection/src/selection/append.js","../node_modules/d3-selection/src/selection/datum.js","../node_modules/d3-selection/src/selection/iterator.js","../node_modules/d3-selection/src/local.js","../node_modules/d3-selection/src/sourceEvent.js","../node_modules/d3-selection/src/pointer.js","../node_modules/d3-selection/src/create.js","../node_modules/d3-selection/src/pointers.js","../node_modules/d3-selection/src/selectAll.js","../node_modules/lodash/forOwn.js","../node_modules/lodash/_basePropertyOf.js","../node_modules/lodash/escape.js","../node_modules/lodash/_escapeHtmlChar.js","../node_modules/d3-dispatch/src/dispatch.js","../node_modules/d3-drag/src/noevent.js","../node_modules/d3-drag/src/nodrag.js","../node_modules/d3-drag/src/constant.js","../node_modules/d3-drag/src/event.js","../node_modules/d3-drag/src/drag.js","../node_modules/d3-ease/src/quad.js","../node_modules/d3-ease/src/cubic.js","../node_modules/d3-ease/src/poly.js","../node_modules/d3-ease/src/sin.js","../node_modules/d3-ease/src/math.js","../node_modules/d3-ease/src/exp.js","../node_modules/d3-ease/src/circle.js","../node_modules/d3-ease/src/bounce.js","../node_modules/d3-ease/src/back.js","../node_modules/d3-ease/src/elastic.js","../node_modules/d3-ease/src/linear.js","../node_modules/d3-fetch/src/blob.js","../node_modules/d3-fetch/src/buffer.js","../node_modules/d3-dsv/src/dsv.js","../node_modules/d3-dsv/src/csv.js","../node_modules/d3-dsv/src/tsv.js","../node_modules/d3-fetch/src/text.js","../node_modules/d3-fetch/src/dsv.js","../node_modules/d3-fetch/src/json.js","../node_modules/d3-fetch/src/xml.js","../node_modules/d3-fetch/src/image.js","../node_modules/d3-color/src/define.js","../node_modules/d3-color/src/color.js","../node_modules/d3-interpolate/src/constant.js","../node_modules/d3-interpolate/src/color.js","../node_modules/d3-interpolate/src/rgb.js","../node_modules/d3-interpolate/src/number.js","../node_modules/d3-interpolate/src/string.js","../node_modules/d3-interpolate/src/transform/decompose.js","../node_modules/d3-interpolate/src/transform/parse.js","../node_modules/d3-interpolate/src/transform/index.js","../node_modules/d3-interpolate/src/zoom.js","../node_modules/d3-timer/src/timer.js","../node_modules/d3-timer/src/timeout.js","../node_modules/d3-transition/src/transition/schedule.js","../node_modules/d3-transition/src/interrupt.js","../node_modules/d3-transition/src/transition/tween.js","../node_modules/d3-transition/src/transition/interpolate.js","../node_modules/d3-transition/src/transition/attr.js","../node_modules/d3-transition/src/transition/attrTween.js","../node_modules/d3-transition/src/transition/delay.js","../node_modules/d3-transition/src/transition/duration.js","../node_modules/d3-transition/src/transition/selection.js","../node_modules/d3-transition/src/transition/style.js","../node_modules/d3-transition/src/transition/index.js","../node_modules/d3-transition/src/transition/select.js","../node_modules/d3-transition/src/transition/selectAll.js","../node_modules/d3-transition/src/transition/filter.js","../node_modules/d3-transition/src/transition/merge.js","../node_modules/d3-transition/src/transition/transition.js","../node_modules/d3-transition/src/transition/on.js","../node_modules/d3-transition/src/transition/styleTween.js","../node_modules/d3-transition/src/transition/text.js","../node_modules/d3-transition/src/transition/textTween.js","../node_modules/d3-transition/src/transition/remove.js","../node_modules/d3-transition/src/transition/ease.js","../node_modules/d3-transition/src/transition/easeVarying.js","../node_modules/d3-transition/src/transition/end.js","../node_modules/d3-transition/src/selection/transition.js","../node_modules/d3-transition/src/selection/index.js","../node_modules/d3-transition/src/selection/interrupt.js","../src/common-canvas/d3-zoom-extension/src/constant.js","../src/common-canvas/d3-zoom-extension/src/event.js","../src/common-canvas/d3-zoom-extension/src/transform.js","../src/common-canvas/d3-zoom-extension/src/noevent.js","../src/common-canvas/d3-zoom-extension/src/zoom.js","../src/common-canvas/svg-canvas-utils-display.js","../src/common-canvas/svg-canvas-utils-nodes.js","../src/common-canvas/svg-canvas-utils-comments.js","../src/common-canvas/svg-canvas-utils-links.js","../src/common-canvas/svg-canvas-utils-decs.js","../node_modules/lodash/_unescapeHtmlChar.js","../node_modules/lodash/unescape.js","../src/common-canvas/svg-canvas-utils-markdown.js","../src/common-canvas/svg-canvas-utils-textarea.js","../src/common-canvas/svg-canvas-pipeline.js","../src/common-canvas/svg-canvas-renderer.js","../src/common-canvas/svg-canvas-d3.js","../src/common-canvas/cc-contents.jsx","../src/common-canvas/cc-toolbar.jsx","../src/common-canvas/cc-right-flyout.jsx","../src/common-canvas/cc-bottom-panel.jsx","../src/notification-panel/notification-panel.jsx","../src/common-canvas/cc-central-items.jsx","../src/common-canvas/common-canvas.jsx"],"sourcesContent":["/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\n\nclass PaletteDialogTopbarThreeWayIcon extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\thover: false\n\t\t};\n\n\t\tthis.iconClicked = this.iconClicked.bind(this);\n\t\tthis.mouseEnter = this.mouseEnter.bind(this);\n\t\tthis.mouseLeave = this.mouseLeave.bind(this);\n\t\tthis.mouseDown = this.mouseDown.bind(this);\n\t}\n\n\ticonClicked() {\n\t\tthis.props.iconClickedMethod();\n\t}\n\n\tmouseEnter() {\n\t\tthis.setState({ hover: true });\n\t}\n\n\tmouseLeave() {\n\t\tthis.setState({ hover: false });\n\t}\n\n\tmouseDown(mouseDownEvent) {\n\t\tmouseDownEvent.stopPropagation();\n\t}\n\n\trender() {\n\t\tlet icon = this.props.selectedIconName;\n\n\t\tif (!this.props.isSelected) {\n\t\t\tif (this.state.hover) {\n\t\t\t\ticon = this.props.hoverIconName;\n\t\t\t} else {\n\t\t\t\ticon = this.props.deselectedIconName;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t<div draggable= \"false\" className=\"palette-three-way-icon-div\">\n\t\t\t\t<img src={icon} draggable=\"false\"\n\t\t\t\t\tonClick={this.iconClicked}\n\t\t\t\t\tonMouseEnter={this.mouseEnter}\n\t\t\t\t\tonMouseLeave={this.mouseLeave}\n\t\t\t\t\tonMouseDown={this.mouseDown}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteDialogTopbarThreeWayIcon.propTypes = {\n\ticonClickedMethod: PropTypes.func.isRequired,\n\tisSelected: PropTypes.bool.isRequired,\n\tselectedIconName: PropTypes.string.isRequired,\n\thoverIconName: PropTypes.string.isRequired,\n\tdeselectedIconName: PropTypes.string.isRequired\n};\n\nexport default PaletteDialogTopbarThreeWayIcon;\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport PaletteDialogTopbarThreeWayIcon from \"./palette-dialog-topbar-three-way-icon.jsx\";\nimport Close32Icon from \"../../assets/images/palette/close_32.svg\";\nimport PaletteGridSelectedIcon from \"../../assets/images/palette/palette_grid_selected.svg\";\nimport PaletteGridHoverIcon from \"../../assets/images/palette/palette_grid_hover.svg\";\nimport PaletteGridDeSelectedIcon from \"../../assets/images/palette/palette_grid_deselected.svg\";\nimport PaletteListSelectedIcon from \"../../assets/images/palette/palette_list_selected.svg\";\nimport PaletteListHoverIcon from \"../../assets/images/palette/palette_list_hover.svg\";\nimport PaletteListDeSelectedIcon from \"../../assets/images/palette/palette_list_deselected.svg\";\n\nclass PaletteDialogTopbar extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t};\n\n\t\tthis.mouseDown = this.mouseDown.bind(this);\n\t\tthis.doubleClick = this.doubleClick.bind(this);\n\t\tthis.close = this.close.bind(this);\n\t\tthis.gridViewSelected = this.gridViewSelected.bind(this);\n\t\tthis.listViewSelected = this.listViewSelected.bind(this);\n\t}\n\n\tmouseDown(mouseDownEvent) {\n\t\tthis.props.mouseDownMethod(mouseDownEvent);\n\t}\n\n\tdoubleClick(doubleClickEvent) {\n\t\tthis.props.windowMaximizeMethod(doubleClickEvent);\n\t}\n\n\tclose(closeEvent) {\n\t\tthis.props.canvasController.closePalette(closeEvent);\n\t}\n\n\tgridViewSelected() {\n\t\tthis.props.showGridMethod(true);\n\t}\n\n\tlistViewSelected() {\n\t\tthis.props.showGridMethod(false);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"palette-dialog-topbar\" onMouseDown={this.mouseDown} onDoubleClick={this.doubleClick}>\n\t\t\t\t<span className=\"left-navbar\">\n\t\t\t\t\t<PaletteDialogTopbarThreeWayIcon iconClickedMethod={this.gridViewSelected}\n\t\t\t\t\t\tisSelected={this.props.showGrid}\n\t\t\t\t\t\tselectedIconName={PaletteGridSelectedIcon}\n\t\t\t\t\t\thoverIconName={PaletteGridHoverIcon}\n\t\t\t\t\t\tdeselectedIconName={PaletteGridDeSelectedIcon}\n\t\t\t\t\t/>\n\t\t\t\t\t<PaletteDialogTopbarThreeWayIcon iconClickedMethod={this.listViewSelected}\n\t\t\t\t\t\tisSelected={!this.props.showGrid}\n\t\t\t\t\t\tselectedIconName={PaletteListSelectedIcon}\n\t\t\t\t\t\thoverIconName={PaletteListHoverIcon}\n\t\t\t\t\t\tdeselectedIconName={PaletteListDeSelectedIcon}\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t\t<span className=\"right-navbar\">\n\t\t\t\t\t<a className=\"secondary-action\" onClick={this.close}>\n\t\t\t\t\t\t<img src={Close32Icon} draggable=\"false\" className=\"close-icon\" />\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteDialogTopbar.propTypes = {\n\tshowGridMethod: PropTypes.func.isRequired,\n\twindowMaximizeMethod: PropTypes.func.isRequired,\n\tshowGrid: PropTypes.bool.isRequired,\n\tmouseDownMethod: PropTypes.func.isRequired,\n\tcanvasController: PropTypes.object.isRequired\n};\n\nexport default PaletteDialogTopbar;\n","export default \"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2016%2016%22%20enable-background%3D%22new%200%200%2016%2016%22%3E%3Cg%20fill%3D%22%233D70B2%22%3E%3Cpath%20d%3D%22m9.8%200h6.2v6.2h-6.2z%22%2F%3E%3Cpath%20d%3D%22M8.6%2C0H7.4H0v7.4v1.2V16h7.4h1.2H16V8.6V7.4H8.6V0z%20M7.4%2C14.8H1.2V8.6h6.2V14.8z%20M14.8%2C8.6v6.2H8.6V8.6%20%20H14.8z%20M1.2%2C7.4V1.2h6.2v6.2H1.2z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\"","export default \"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2016%2016%22%20enable-background%3D%22new%200%200%2016%2016%22%3E%3Cg%20fill%3D%22%235596e6%22%3E%3Cpath%20d%3D%22m9.8%200h6.2v6.2h-6.2z%22%2F%3E%3Cpath%20d%3D%22M8.6%2C0H7.4H0v7.4v1.2V16h7.4h1.2H16V8.6V7.4H8.6V0z%20M7.4%2C14.8H1.2V8.6h6.2V14.8z%20M14.8%2C8.6v6.2H8.6V8.6%20%20H14.8z%20M1.2%2C7.4V1.2h6.2v6.2H1.2z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\"","export default \"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2016%2016%22%20enable-background%3D%22new%200%200%2016%2016%22%3E%3Cg%20fill%3D%22%23C7C7C7%22%3E%3Cpath%20d%3D%22m9.8%200h6.2v6.2h-6.2z%22%2F%3E%3Cpath%20d%3D%22M8.6%2C0H7.4H0v7.4v1.2V16h7.4h1.2H16V8.6V7.4H8.6V0z%20M7.4%2C14.8H1.2V8.6h6.2V14.8z%20M14.8%2C8.6v6.2H8.6V8.6%20%20H14.8z%20M1.2%2C7.4V1.2h6.2v6.2H1.2z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\"","export default \"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2016%2016%22%20enable-background%3D%22new%200%200%2016%2016%22%3E%3Cg%20fill%3D%22%233D70B2%22%3E%3Cpath%20d%3D%22m0%2014.5h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%2014.5h12.7v1.5h-12.7z%22%2F%3E%3Cpath%20d%3D%22m0%209.7h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%209.7h12.7v1.5h-12.7z%22%2F%3E%3Cpath%20d%3D%22m0%204.8h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%204.8h12.7v1.5h-12.7z%22%2F%3E%3Cpath%20d%3D%22m0%200h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%200h12.7v1.5h-12.7z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\"","export default \"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2016%2016%22%20enable-background%3D%22new%200%200%2016%2016%22%3E%3Cg%20fill%3D%22%235596e6%22%3E%3Cpath%20d%3D%22m0%2014.5h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%2014.5h12.7v1.5h-12.7z%22%2F%3E%3Cpath%20d%3D%22m0%209.7h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%209.7h12.7v1.5h-12.7z%22%2F%3E%3Cpath%20d%3D%22m0%204.8h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%204.8h12.7v1.5h-12.7z%22%2F%3E%3Cpath%20d%3D%22m0%200h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%200h12.7v1.5h-12.7z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\"","export default \"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2016%2016%22%20enable-background%3D%22new%200%200%2016%2016%22%3E%3Cg%20fill%3D%22%23C7C7C7%22%3E%3Cpath%20d%3D%22m0%2014.5h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%2014.5h12.7v1.5h-12.7z%22%2F%3E%3Cpath%20d%3D%22m0%209.7h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%209.7h12.7v1.5h-12.7z%22%2F%3E%3Cpath%20d%3D%22m0%204.8h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%204.8h12.7v1.5h-12.7z%22%2F%3E%3Cpath%20d%3D%22m0%200h1.5v1.5h-1.5z%22%2F%3E%3Cpath%20d%3D%22m3.3%200h12.7v1.5h-12.7z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\"","export default \"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2032%2032%22%3E%3Cpath%20style%3D%22fill%3A%233D70B2%22%20d%3D%22M20.293%2010.293L16%2014.586l-4.293-4.293-1.414%201.414L14.586%2016l-4.293%204.293%201.414%201.414L16%2017.414l4.293%204.293%201.414-1.414L17.414%2016l4.293-4.293z%22%2F%3E%3Cpath%20style%3D%22fill%3A%233D70B2%22%20d%3D%22M16%202C8.269%202%202%208.269%202%2016s6.269%2014%2014%2014%2014-6.269%2014-14S23.731%202%2016%202zm0%2026C9.383%2028%204%2022.617%204%2016S9.383%204%2016%204s12%205.383%2012%2012-5.383%2012-12%2012z%22%2F%3E%3C%2Fsvg%3E\"","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\n\nclass PaletteDialogContentCategory extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t};\n\n\t\tthis.categorySelected = this.categorySelected.bind(this);\n\t}\n\n\n\tcategorySelected(catSelEvent) {\n\t\tthis.props.categorySelectedMethod(catSelEvent);\n\t}\n\n\trender() {\n\t\tvar style = \"palette-dialog-category\";\n\n\t\tif (this.props.selectedCategory === this.props.category.label) {\n\t\t\tstyle = \"palette-dialog-category-selected\";\n\t\t}\n\n\t\treturn (\n\t\t\t<div data-id={this.props.category.id} className={style} onClick={this.categorySelected}>\n\t\t\t\t{this.props.category.label}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteDialogContentCategory.propTypes = {\n\tcategory: PropTypes.object.isRequired,\n\tselectedCategory: PropTypes.string.isRequired,\n\tcategorySelectedMethod: PropTypes.func.isRequired\n};\n\nexport default PaletteDialogContentCategory;\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport PaletteDialogContentCategory from \"./palette-dialog-content-category.jsx\";\n\nclass PaletteDialogContentCategories extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t};\n\t}\n\n\trender() {\n\t\tvar catDivs = [];\n\n\t\tfor (var idx = 0; idx < this.props.categories.length; idx++) {\n\t\t\tcatDivs.push(\n\t\t\t\t<PaletteDialogContentCategory\n\t\t\t\t\tkey={this.props.categories[idx].label}\n\t\t\t\t\tcategory={this.props.categories[idx]}\n\t\t\t\t\tselectedCategory={this.props.selectedCategory}\n\t\t\t\t\tcategorySelectedMethod={this.props.categorySelectedMethod}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<div className=\"palette-dialog-categories palette-scroll\">\n\t\t\t\t{catDivs}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteDialogContentCategories.propTypes = {\n\tcategories: PropTypes.array.isRequired,\n\tselectedCategory: PropTypes.string.isRequired,\n\tcategorySelectedMethod: PropTypes.func.isRequired\n};\n\nexport default PaletteDialogContentCategories;\n","export default \"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2064%2060%22%3E%20%3Cpath%20d%3D%22M32%2C42a1.61%2C1.61%2C0%2C0%2C1-.8-.2L9.28%2C30.15l1.6-2.94L32%2C38.47%2C53.12%2C27.21l1.6%2C2.94L32.8%2C41.84A1.71%2C1.71%2C0%2C0%2C1%2C32%2C42Z%22%2F%3E%20%3Cpath%20d%3D%22M32%2C52.05a1.72%2C1.72%2C0%2C0%2C1-.8-.2L9.28%2C40.17l1.6-2.94L32%2C48.48%2C53.12%2C37.23l1.6%2C2.94L32.8%2C51.85A1.72%2C1.72%2C0%2C0%2C1%2C32%2C52.05Z%22%2F%3E%20%3Cpath%20d%3D%22M32%2C32a1.72%2C1.72%2C0%2C0%2C1-.8-.2L9.28%2C20.14a1.66%2C1.66%2C0%2C0%2C1%2C0-2.94L31.2%2C5.52a1.68%2C1.68%2C0%2C0%2C1%2C1.6%2C0L54.72%2C17.2a1.66%2C1.66%2C0%2C0%2C1%2C.69%2C2.26%2C1.74%2C1.74%2C0%2C0%2C1-.69.68L32.8%2C31.82A1.72%2C1.72%2C0%2C0%2C1%2C32%2C32ZM13.64%2C18.67%2C32%2C28.46l18.36-9.79L32%2C8.88Z%22%2F%3E%20%3Crect%20x%3D%225.02%22%20y%3D%221.98%22%20width%3D%2253.96%22%20height%3D%2253.41%22%20fill%3D%22none%22%2F%3E%3C%2Fsvg%3E\"","export default \"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2064%2060%22%3E%20%3Cpolygon%20points%3D%2217.28%204.63%2026.88%2014.07%2024.74%2015.87%2018.94%2010.35%2018.94%2026.29%2015.78%2026.29%2015.78%2010.35%209.97%2016.12%207.91%2014.04%2017.28%204.63%22%2F%3E%20%3Cpath%20d%3D%22M32.39%2C6.36l.2.1%2C20.35%2C11a2.7%2C2.7%2C0%2C0%2C1%2C1.11%2C1.11%2C2.74%2C2.74%2C0%2C0%2C1-.89%2C3.59l-.22.13L33%2C33a2.66%2C2.66%2C0%2C0%2C1-2.51%2C0l-6-3.13a1.83%2C1.83%2C0%2C1%2C1%2C1.69-3.25l5.57%2C2.89%2C18-9.69L30.85%2C9.68A1.83%2C1.83%2C0%2C0%2C1%2C30%2C7.39l.09-.19A1.83%2C1.83%2C0%2C0%2C1%2C32.39%2C6.36Z%22%2F%3E%20%3Cpath%20d%3D%22M53%2C28.53l1.62%2C3L32.52%2C43.43a1.59%2C1.59%2C0%2C0%2C1-.8.21%2C1.66%2C1.66%2C0%2C0%2C1-.81-.21L8.8%2C31.53l1.61-3L31.72%2C40Z%22%2F%3E%20%3Cpath%20d%3D%22M53%2C38.74l1.62%2C3L32.52%2C53.64a1.69%2C1.69%2C0%2C0%2C1-.8.2%2C1.76%2C1.76%2C0%2C0%2C1-.81-.2L8.8%2C41.73l1.61-3L31.72%2C50.21Z%22%2F%3E%3C%2Fsvg%3E\"","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { has } from \"lodash\";\nimport Icon from \"../icons/icon.jsx\";\nimport SVG from \"react-inlinesvg\";\nimport { CANVAS_CARBON_ICONS, DND_DATA_TEXT, TIP_TYPE_PALETTE_ITEM,\n\tUSE_DEFAULT_ICON, USE_DEFAULT_EXT_ICON }\n\tfrom \"../common-canvas/constants/canvas-constants.js\";\n\nimport SUPERNODE_ICON from \"../../assets/images/supernode.svg\";\nimport SUPERNODE_EXT_ICON from \"../../assets/images/supernode_ext.svg\";\n\nclass PaletteDialogContentGridNode extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t};\n\n\t\tthis.ghostData = null;\n\n\t\tthis.onDragStart = this.onDragStart.bind(this);\n\t\tthis.onDragEnd = this.onDragEnd.bind(this);\n\t\tthis.onDoubleClick = this.onDoubleClick.bind(this);\n\t\tthis.onMouseOver = this.onMouseOver.bind(this);\n\t\tthis.onMouseLeave = this.onMouseLeave.bind(this);\n\t\tthis.onMouseDown = this.onMouseDown.bind(this);\n\t}\n\n\tonMouseDown() {\n\t\t// Make sure the tip doesn't appear when starting to drag a node.\n\t\tthis.props.canvasController.closeTip();\n\n\t\t// Prepare the ghost image on mouse down because asynchronous loading of\n\t\t// SVG files will be too slow if this is done in onDragStart.\n\t\tthis.ghostData = this.props.canvasController.getGhostNode(this.props.nodeTemplate);\n\t}\n\n\tonDragStart(ev) {\n\t\t// We cannot use the dataTransfer object for the nodeTemplate because\n\t\t// the dataTransfer data is not available during dragOver events so we set\n\t\t// the nodeTemplate into the canvas controller.\n\t\tthis.props.canvasController.nodeTemplateDragStart(this.props.nodeTemplate);\n\n\t\t// On firefox, the drag will not start unless something is written to\n\t\t// the dataTransfer object so just write an empty string\n\t\tev.dataTransfer.setData(DND_DATA_TEXT, \"\");\n\n\t\tif (this.ghostData) {\n\t\t\tev.dataTransfer.setDragImage(this.ghostData.element, this.ghostData.centerX, this.ghostData.centerY);\n\t\t}\n\t}\n\n\t// This is needed in-case the drag ends somewhere other than the canvas area.\n\tonDragEnd() {\n\t\tthis.props.canvasController.nodeTemplateDragEnd();\n\t}\n\n\tonDoubleClick() {\n\t\tif (this.props.canvasController.createAutoNode) {\n\t\t\tthis.props.canvasController.createAutoNode(this.props.nodeTemplate);\n\t\t}\n\t}\n\n\tonMouseOver(ev) {\n\t\tif (ev.buttons === 0) {\n\t\t\tconst nodeTemplate = this.props.category.empty_text\n\t\t\t\t? { app_data: { ui_data: { label: this.props.category.empty_text } } }\n\t\t\t\t: this.props.nodeTemplate;\n\n\t\t\tthis.props.canvasController.openTip({\n\t\t\t\tid: \"paletteTip_\" + this.props.nodeTemplate.op,\n\t\t\t\ttype: TIP_TYPE_PALETTE_ITEM,\n\t\t\t\ttargetObj: ev.currentTarget,\n\t\t\t\tnodeTemplate: nodeTemplate,\n\t\t\t\tcategory: this.props.category\n\t\t\t});\n\t\t}\n\t}\n\n\tonMouseLeave() {\n\t\tthis.props.canvasController.closeTip();\n\t}\n\n\trender() {\n\t\tlet label = \"\";\n\t\tif (has(this.props.nodeTemplate, \"app_data.ui_data.label\")) {\n\t\t\tlabel = this.props.nodeTemplate.app_data.ui_data.label;\n\t\t}\n\n\t\tlet icon = <div className=\"node-icon\" />;\n\n\t\tif (has(this.props.nodeTemplate, \"app_data.ui_data.image\")) {\n\t\t\tlet image = this.props.nodeTemplate.app_data.ui_data.image;\n\n\t\t\tif (image === USE_DEFAULT_ICON) {\n\t\t\t\timage = SUPERNODE_ICON;\n\t\t\t} else if (image === USE_DEFAULT_EXT_ICON) {\n\t\t\t\timage = SUPERNODE_EXT_ICON;\n\t\t\t}\n\n\t\t\ticon = image.endsWith(\".svg\")\n\t\t\t\t? <SVG src={image} className=\"node-icon\" alt={label} />\n\t\t\t\t: <img src={image} className=\"node-icon\" alt={label} />;\n\t\t}\n\n\t\tlet draggable = this.props.isEditingEnabled ? \"true\" : \"false\";\n\t\tlet txtClassName = \"palette-dialog-grid-node-text\";\n\n\t\t// Special case for when there are no nodes in the category so we show\n\t\t// a dummy node to include the empty text from the category.\n\t\tif (this.props.category && this.props.category.node_types.length === 0 && this.props.category.empty_text) {\n\t\t\tlabel = this.props.category.empty_text;\n\t\t\tdraggable = \"false\";\n\t\t\ttxtClassName = \"palette-dialog-grid-node-text-warning\";\n\t\t\ticon = (<Icon type={CANVAS_CARBON_ICONS.WARNING_UNFILLED} className=\"palette-dialog-grid-node-icon-warning\" draggable=\"false\" />);\n\t\t}\n\n\t\treturn (\n\t\t\t<div id={this.props.nodeTemplate.id}\n\t\t\t\tdata-id={this.props.nodeTemplate.op}\n\t\t\t\tdraggable={draggable}\n\t\t\t\tonMouseOver={this.onMouseOver}\n\t\t\t\tonMouseLeave={this.onMouseLeave}\n\t\t\t\tonMouseDown={this.props.isEditingEnabled ? this.onMouseDown : null}\n\t\t\t\tonDragStart={this.props.isEditingEnabled ? this.onDragStart : null}\n\t\t\t\tonDragEnd={this.props.isEditingEnabled ? this.onDragEnd : null}\n\t\t\t\tonDoubleClick={this.props.isEditingEnabled ? this.onDoubleClick : null}\n\t\t\t\tclassName=\"palette-dialog-grid-node-outer\"\n\t\t\t>\n\t\t\t\t<div className=\"palette-dialog-grid-node-inner\">\n\t\t\t\t\t<div className=\"palette-dialog-grid-node-icon\">\n\t\t\t\t\t\t{icon}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className={ txtClassName }>\n\t\t\t\t\t\t{label}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteDialogContentGridNode.propTypes = {\n\tcategory: PropTypes.object.isRequired,\n\tnodeTemplate: PropTypes.object.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired\n};\n\nexport default PaletteDialogContentGridNode;\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport PaletteDialogContentGridNode from \"./palette-dialog-content-grid-node.jsx\";\n\n\nclass PaletteDialogContentGrid extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t};\n\t}\n\n\trender() {\n\t\tvar gridNodes = [];\n\n\t\tif (this.props.category && this.props.category.node_types &&\n\t\t\t\tthis.props.category.node_types.length === 0 && this.props.category.empty_text) {\n\t\t\tgridNodes.push(\n\t\t\t\t<PaletteDialogContentGridNode key={\"pal_grid_node_empty\"}\n\t\t\t\t\tcategory={this.props.category}\n\t\t\t\t\tnodeTemplate={ {} }\n\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else {\n\t\t\tfor (var idx = 0; idx < this.props.nodeTypes.length; idx++) {\n\t\t\t\tgridNodes.push(\n\t\t\t\t\t<PaletteDialogContentGridNode key={\"pal_grid_node_\" + idx}\n\t\t\t\t\t\tcategory={this.props.category}\n\t\t\t\t\t\tnodeTemplate={this.props.nodeTypes[idx]}\n\t\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t<div width=\"100%\" className=\"palette-scroll\">\n\t\t\t\t{gridNodes}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteDialogContentGrid.propTypes = {\n\tcategory: PropTypes.object.isRequired,\n\tnodeTypes: PropTypes.array.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired,\n\tcanvasController: PropTypes.object.isRequired\n};\n\nexport default PaletteDialogContentGrid;\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { get, has } from \"lodash\";\nimport { injectIntl } from \"react-intl\";\nimport defaultMessages from \"../../locales/palette/locales/en.json\";\nimport Icon from \"../icons/icon.jsx\";\nimport SVG from \"react-inlinesvg\";\nimport { CANVAS_CARBON_ICONS, DND_DATA_TEXT, TIP_TYPE_PALETTE_ITEM,\n\tUSE_DEFAULT_ICON, USE_DEFAULT_EXT_ICON }\n\tfrom \"../common-canvas/constants/canvas-constants.js\";\n\nimport SUPERNODE_ICON from \"../../assets/images/supernode.svg\";\nimport SUPERNODE_EXT_ICON from \"../../assets/images/supernode_ext.svg\";\n\nclass PaletteContentListItem extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tshowFullDescription: false\n\t\t};\n\n\t\tthis.ghostData = null;\n\n\t\tthis.showFullDescription = this.showFullDescription.bind(this);\n\t\tthis.showShortDescription = this.showShortDescription.bind(this);\n\n\t\tthis.onDragStart = this.onDragStart.bind(this);\n\t\tthis.onDragEnd = this.onDragEnd.bind(this);\n\t\tthis.onDoubleClick = this.onDoubleClick.bind(this);\n\t\tthis.onMouseOver = this.onMouseOver.bind(this);\n\t\tthis.onMouseLeave = this.onMouseLeave.bind(this);\n\t\tthis.onMouseDown = this.onMouseDown.bind(this);\n\t\tthis.onKeyPress = this.onKeyPress.bind(this);\n\t}\n\n\tonMouseDown() {\n\t\t// Make sure the tip doesn't appear when starting to drag a node.\n\t\tthis.props.canvasController.closeTip();\n\n\t\t// Prepare the ghost image on mouse down because asynchronous loading of\n\t\t// SVG files will be too slow if this is done in onDragStart.\n\t\tthis.ghostData = this.props.canvasController.getGhostNode(this.props.nodeTypeInfo.nodeType);\n\t}\n\n\tonDragStart(ev) {\n\t\t// We cannot use the dataTransfer object for the nodeTemplate because\n\t\t// the dataTransfer data is not available during dragOver events so we set\n\t\t// the nodeTemplate into the canvas controller.\n\t\tthis.props.canvasController.nodeTemplateDragStart(this.props.nodeTypeInfo.nodeType);\n\n\t\t// On firefox, the drag will not start unless something is written to\n\t\t// the dataTransfer object so just write an empty string\n\t\tev.dataTransfer.setData(DND_DATA_TEXT, \"\");\n\n\t\tif (this.ghostData) {\n\t\t\tev.dataTransfer.setDragImage(this.ghostData.element, this.ghostData.centerX, this.ghostData.centerY);\n\t\t}\n\t}\n\n\tonKeyPress(e) {\n\t\t// e.key === \" \" is needed to allow Cypress test in palette.js to run on the build machine!\n\t\tif (e.key === \" \" || e.code === \"Space\" || e.keyCode === 32) {\n\t\t\tthis.onDoubleClick();\n\t\t}\n\t}\n\n\t// This is needed in-case the drag ends somewhere other than the canvas area.\n\tonDragEnd() {\n\t\tthis.props.canvasController.nodeTemplateDragEnd();\n\t}\n\n\tonDoubleClick() {\n\t\tif (this.props.canvasController.createAutoNode) {\n\t\t\tthis.props.canvasController.createAutoNode(this.props.nodeTypeInfo.nodeType);\n\t\t}\n\t}\n\n\tonMouseOver(ev) {\n\t\tif (!this.props.isDisplaySearchResult && ev.buttons === 0) {\n\t\t\tconst nodeTemplate = this.props.nodeTypeInfo.category.empty_text\n\t\t\t\t? { app_data: { ui_data: { label: this.props.nodeTypeInfo.category.empty_text } } }\n\t\t\t\t: this.props.nodeTypeInfo.nodeType;\n\n\t\t\tthis.props.canvasController.openTip({\n\t\t\t\tid: \"paletteTip_\" + this.props.nodeTypeInfo.nodeType.op,\n\t\t\t\ttype: TIP_TYPE_PALETTE_ITEM,\n\t\t\t\ttargetObj: ev.currentTarget,\n\t\t\t\tnodeTemplate: nodeTemplate,\n\t\t\t\tcategory: this.props.nodeTypeInfo.category\n\t\t\t});\n\t\t}\n\t}\n\n\tonMouseLeave() {\n\t\tthis.props.canvasController.closeTip();\n\t}\n\n\tgetHighlightedCategoryLabel() {\n\t\treturn this.getHighlightedText(\n\t\t\tthis.props.nodeTypeInfo.category.label,\n\t\t\tthis.props.nodeTypeInfo.occurrenceInfo.catLabelOccurrences);\n\t}\n\n\tgetHighlightedLabel(labelText) {\n\t\treturn this.getHighlightedText(\n\t\t\tlabelText,\n\t\t\tthis.props.nodeTypeInfo.occurrenceInfo.nodeLabelOccurrences);\n\t}\n\n\tgetHighlightedDesc() {\n\t\tconst DISPLAY_LEN = 150; // Max number of characters for a description.\n\t\tlet desc = this.props.nodeTypeInfo.nodeType.app_data.ui_data.description;\n\t\tlet nodeDescOccurrences = this.props.nodeTypeInfo.occurrenceInfo.nodeDescOccurrences;\n\t\tlet isLongDescription = false;\n\n\t\tif (desc.length > DISPLAY_LEN) {\n\t\t\tisLongDescription = true;\n\t\t\tif (!this.state.showFullDescription) {\n\t\t\t\tconst { abbrDesc, occurrences } = this.getAbbreviatedDescription(desc, nodeDescOccurrences, DISPLAY_LEN);\n\t\t\t\tdesc = abbrDesc;\n\t\t\t\tnodeDescOccurrences = occurrences;\n\t\t\t}\n\t\t}\n\n\t\tconst elements = this.getHighlightedText(desc, nodeDescOccurrences);\n\n\t\t// If it's a long description, we need to add either the 'Show more' or\n\t\t// 'Show less' button depending on whether the full description is shown or not.\n\t\tif (isLongDescription) {\n\t\t\tif (this.state.showFullDescription) {\n\t\t\t\tconst less =\n\t\t\t\t\tthis.props.intl.formatMessage({ id: \"palette.flyout.search.less\", defaultMessage: defaultMessages[\"palette.flyout.search.less\"] });\n\t\t\t\telements.push(<div key=\"l_btn\" className = \"palette-list-item-desc-button\" onClick={this.showShortDescription}>{less}</div>);\n\t\t\t} else {\n\t\t\t\tconst more =\n\t\t\t\t\tthis.props.intl.formatMessage({ id: \"palette.flyout.search.more\", defaultMessage: defaultMessages[\"palette.flyout.search.more\"] });\n\t\t\t\telements.push(<div key=\"m_btn\" className = \"palette-list-item-desc-button\" onClick={this.showFullDescription}>{more}</div>);\n\t\t\t}\n\t\t}\n\t\treturn elements;\n\t}\n\n\t// Returns an abbeviated description, constrained to the displayLen passed in,\n\t// based on the full description passed in. The function makes sure the first\n\t// occurrence of text to be highlighted is displayed with the abbreviated\n\t// text. There are three possibilities:\n\t// 1. The first occurrence is within the first displayLen number of characters\n\t//    meaning we end the abbreviated text with \" ...\"\n\t// 2. The first occurrence is somewhere in the middle of the text in which\n\t//    the abbreviated dscription is prefixed with \"... \" and suffixed with \" ...\"\n\t// 3. The first occurrence is within displayLen number of characters of the end\n\t//    of the description in which case we prefix the descriptin with \"... \"\n\t// This function also adjusts the occurencs of highlighted text in the\n\t// description to account for any text that has been removed from the\n\t// beginning of the description.\n\tgetAbbreviatedDescription(desc, nodeDescOccurrences, displayLen) {\n\t\t// Not all descriptions will have occurencs. If not, just abbreviate and return.\n\t\tif (nodeDescOccurrences.length === 0) {\n\t\t\tconst abbr = desc.substring(0, displayLen) + \" ...\";\n\t\t\treturn { abbrDesc: abbr, occurrences: nodeDescOccurrences };\n\t\t}\n\n\t\tconst firstOccurrenceStart = nodeDescOccurrences[0].start;\n\t\tconst remainder = desc.length - firstOccurrenceStart;\n\t\tlet abbrDesc = \"\";\n\t\tlet offset = 0;\n\n\t\tif (firstOccurrenceStart < displayLen) {\n\t\t\toffset = 0;\n\t\t\tabbrDesc = desc.substring(offset, displayLen) + \" ...\";\n\n\t\t} else if (remainder > displayLen) {\n\t\t\toffset = firstOccurrenceStart;\n\t\t\tabbrDesc = \"... \" + desc.substring(offset, firstOccurrenceStart + displayLen) + \" ...\";\n\t\t\toffset -= 4; // Subtract 4 for the \"... \" string\n\n\t\t} else {\n\t\t\toffset = desc.length - displayLen;\n\t\t\tabbrDesc = \"... \" + desc.substring(offset, desc.length);\n\t\t\toffset -= 4; // Subtract 4 for the \"... \" string\n\t\t}\n\n\t\tconst occurrences = nodeDescOccurrences.map((occ) => ({ start: occ.start - offset, end: occ.end - offset }));\n\n\t\treturn { abbrDesc, occurrences };\n\t}\n\n\t// Returns an array of highlighted and non-highlighted text based on the\n\t// textToHighlight passed in and the occurrences array which contains elements\n\t// that indicate where text should be highlighted.\n\tgetHighlightedText(textToHighlight, occurrences) {\n\t\tif (!occurrences || occurrences.length === 0) {\n\t\t\treturn [<span key=\"o\">{textToHighlight}</span>];\n\t\t}\n\n\t\tconst highlightedElements = [];\n\t\tlet index = 0;\n\t\tlet text = \"\";\n\t\toccurrences.forEach((occ, i) => {\n\t\t\ttext = textToHighlight.substring(index, occ.start);\n\t\t\thighlightedElements.push(<span key={\"s\" + i}>{text}</span>);\n\n\t\t\ttext = textToHighlight.substring(occ.start, occ.end);\n\t\t\thighlightedElements.push(<mark key={\"m\" + i}>{text}</mark>);\n\n\t\t\tindex = occ.end;\n\n\t\t\tif (i === occurrences.length - 1 &&\n\t\t\t\t\tocc.end < textToHighlight.length) {\n\t\t\t\ttext = textToHighlight.substring(occ.end);\n\t\t\t\thighlightedElements.push(<span key={\"f\" + i}>{text}</span>);\n\t\t\t}\n\t\t});\n\n\t\treturn highlightedElements;\n\t}\n\n\tshowFullDescription() {\n\t\tthis.setState({ showFullDescription: true });\n\t}\n\n\tshowShortDescription() {\n\t\tthis.setState({ showFullDescription: false });\n\t}\n\n\timageDrag() {\n\t\treturn false;\n\t}\n\n\trender() {\n\t\tlet itemText = null;\n\t\tlet labelText = get(this.props, \"nodeTypeInfo.nodeType.app_data.ui_data.label\", \"\");\n\t\tlet draggable = this.props.isEditingEnabled ? \"true\" : \"false\";\n\t\tlet icon = null;\n\n\t\tif (has(this.props.nodeTypeInfo.nodeType, \"app_data.ui_data.image\")) {\n\t\t\tlet image = this.props.nodeTypeInfo.nodeType.app_data.ui_data.palette_image\n\t\t\t\t? this.props.nodeTypeInfo.nodeType.app_data.ui_data.palette_image\n\t\t\t\t: this.props.nodeTypeInfo.nodeType.app_data.ui_data.image;\n\n\t\t\tif (image === USE_DEFAULT_ICON) {\n\t\t\t\timage = SUPERNODE_ICON;\n\t\t\t} else if (image === USE_DEFAULT_EXT_ICON) {\n\t\t\t\timage = SUPERNODE_EXT_ICON;\n\t\t\t}\n\t\t\ticon = image.endsWith(\".svg\")\n\t\t\t\t? <SVG src={image} className=\"palette-list-item-icon\" draggable=\"false\" />\n\t\t\t\t: <img src={image} className=\"palette-list-item-icon\" draggable=\"false\" alt={\"\"} />;\n\t\t}\n\n\t\tif (labelText && (this.props.isPaletteOpen || !icon)) {\n\t\t\titemText = this.props.isDisplaySearchResult\n\t\t\t\t? this.getHighlightedLabel(labelText)\n\t\t\t\t: (<span>{labelText}</span>);\n\t\t}\n\n\t\tconst ranking = this.props.isShowRanking && this.props.isDisplaySearchResult && has(this.props.nodeTypeInfo, \"occurrenceInfo.ranking\")\n\t\t\t? (<span>{this.props.nodeTypeInfo.occurrenceInfo.ranking}</span>)\n\t\t\t: null;\n\n\t\t// Special case for when there are no nodes in the category so we show\n\t\t// a dummy node to include the empty text from the category.\n\t\tif (this.props.nodeTypeInfo.category.node_types.length === 0 && this.props.nodeTypeInfo.category.empty_text) {\n\t\t\tlabelText = this.props.nodeTypeInfo.category.empty_text;\n\t\t\tif (this.props.isPaletteOpen) {\n\t\t\t\titemText = (<span>{labelText}</span>);\n\t\t\t}\n\t\t\tdraggable = \"false\";\n\t\t\ticon = (<Icon type={CANVAS_CARBON_ICONS.WARNING_UNFILLED} className=\"palette-list-item-icon-warning\" draggable=\"false\" />);\n\t\t}\n\n\t\tconst mainDivClass = this.props.isDisplaySearchResult\n\t\t\t? \"palette-list-item search-result\"\n\t\t\t: \"palette-list-item\";\n\n\t\tconst categoryLabel = this.props.isDisplaySearchResult\n\t\t\t? (<div className={\"palette-list-item-category-label\"}>{this.getHighlightedCategoryLabel()}</div>)\n\t\t\t: null;\n\n\t\tconst description = this.props.isDisplaySearchResult && has(this.props.nodeTypeInfo.nodeType, \"app_data.ui_data.description\") &&\n\t\t\t\t\t\t\t\t\t\t\t\tthis.props.nodeTypeInfo.nodeType.app_data.ui_data.description\n\t\t\t? (<div className={\"palette-list-item-description\"}>{this.getHighlightedDesc()}</div>)\n\t\t\t: null;\n\n\t\tconst nodeLabel = itemText\n\t\t\t? <div className=\"palette-list-item-text-div\" tabIndex=\"-1\">{itemText}</div>\n\t\t\t: null;\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tdata-id={this.props.nodeTypeInfo.nodeType.op}\n\t\t\t\ttabIndex={0}\n\t\t\t\trole={\"button\"}\n\t\t\t\taria-label={labelText}\n\t\t\t\tdraggable={draggable}\n\t\t\t\tclassName={mainDivClass}\n\t\t\t\tonMouseOver={this.onMouseOver}\n\t\t\t\tonMouseLeave={this.onMouseLeave}\n\t\t\t\tonKeyPress={this.props.isEditingEnabled ? this.onKeyPress : null}\n\t\t\t\tonMouseDown={this.props.isEditingEnabled ? this.onMouseDown : null}\n\t\t\t\tonDragStart={this.props.isEditingEnabled ? this.onDragStart : null}\n\t\t\t\tonDragEnd={this.props.isEditingEnabled ? this.onDragEnd : null}\n\t\t\t\tonDoubleClick={this.props.isEditingEnabled ? this.onDoubleClick : null}\n\t\t\t>\n\t\t\t\t{categoryLabel}\n\t\t\t\t<div className=\"palette-list-item-icon-and-text\" tabIndex=\"-1\">\n\t\t\t\t\t{icon}\n\t\t\t\t\t{nodeLabel}\n\t\t\t\t\t{ranking}\n\t\t\t\t</div>\n\t\t\t\t{description}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteContentListItem.propTypes = {\n\tintl: PropTypes.object.isRequired,\n\tnodeTypeInfo: PropTypes.object.isRequired,\n\tisDisplaySearchResult: PropTypes.bool.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired,\n\tisPaletteOpen: PropTypes.bool.isRequired,\n\tisShowRanking: PropTypes.bool\n};\n\nexport default injectIntl(PaletteContentListItem);\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport PaletteContentListItem from \"./palette-content-list-item.jsx\";\n\nclass PaletteContentList extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t};\n\t}\n\n\trender() {\n\t\tvar contentItems = [];\n\n\t\tif (this.props.category && this.props.category.node_types &&\n\t\t\t\tthis.props.category.node_types.length === 0 && this.props.category.empty_text) {\n\t\t\tcontentItems.push(\n\t\t\t\t<div key={\"item_empty\"}>\n\t\t\t\t\t<PaletteContentListItem\n\t\t\t\t\t\tnodeTypeInfo={{ nodeType: {}, category: this.props.category }}\n\t\t\t\t\t\tisDisplaySearchResult={false}\n\t\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\t\tisPaletteOpen={this.props.isPaletteOpen}\n\t\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\tfor (var idx = 0; idx < this.props.nodeTypeInfos.length; idx++) {\n\t\t\t\tvar itemKey = \"item_\" + idx;\n\n\t\t\t\tcontentItems.push(\n\t\t\t\t\t<PaletteContentListItem\n\t\t\t\t\t\tkey={itemKey}\n\t\t\t\t\t\tnodeTypeInfo={this.props.nodeTypeInfos[idx]}\n\t\t\t\t\t\tisDisplaySearchResult={false}\n\t\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\t\tisPaletteOpen={this.props.isPaletteOpen}\n\t\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t<div width=\"100%\" draggable=\"false\" className=\"palette-content-list palette-scroll\">\n\t\t\t\t{contentItems}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteContentList.propTypes = {\n\tcategory: PropTypes.object.isRequired,\n\tnodeTypeInfos: PropTypes.array.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tisPaletteOpen: PropTypes.bool.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired,\n};\n\nexport default PaletteContentList;\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport PaletteDialogContentCategories from \"./palette-dialog-content-categories.jsx\";\nimport PaletteDialogContentGrid from \"./palette-dialog-content-grid.jsx\";\nimport PaletteContentList from \"./palette-content-list.jsx\";\n\nclass PaletteDialogContent extends React.Component {\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\n\t\t// We get the paletteJSON after the initial render so set the\n\t\t// default selected category when it is recieved.\n\t\tif (nextProps.paletteJSON &&\n\t\t\t\tnextProps.paletteJSON.categories &&\n\t\t\t\tnextProps.paletteJSON.categories.length > 0 &&\n\t\t\t\tprevState.selectedCategory === \"\") {\n\t\t\treturn ({ selectedCategory: nextProps.paletteJSON.categories[0].label });\n\t\t}\n\t\treturn ({});\n\t}\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tselectedCategory: \"\"\n\t\t};\n\n\t\tthis.categorySelected = this.categorySelected.bind(this);\n\t\tthis.getUniqueCategories = this.getUniqueCategories.bind(this);\n\t\tthis.getSelectedCategory = this.getSelectedCategory.bind(this);\n\t}\n\n\tgetUniqueCategories(categories) {\n\t\tvar out = [];\n\n\t\tif (categories) {\n\t\t\tfor (var idx = 0; idx < categories.length; idx++) {\n\t\t\t\tif (out.indexOf(categories[idx].label) === -1) {\n\t\t\t\t\tout.push(categories[idx]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn out;\n\t}\n\n\tgetSelectedCategory(categories) {\n\t\tvar out = {};\n\n\t\tif (categories) {\n\t\t\tfor (var idx = 0; idx < categories.length; idx++) {\n\t\t\t\tif (categories[idx].label === this.state.selectedCategory) {\n\t\t\t\t\tout = categories[idx];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn out;\n\t}\n\n\tcategorySelected(catSelEvent) {\n\t\tthis.setState({ selectedCategory: catSelEvent.target.firstChild.data });\n\t}\n\n\trender() {\n\t\tconst cats = this.getUniqueCategories(this.props.paletteJSON.categories);\n\t\tconst category = this.getSelectedCategory(this.props.paletteJSON.categories);\n\t\tconst nodeTypes = category && category.node_types ? category.node_types : [];\n\t\tconst nodeTypeInfos = nodeTypes.map((nt) =>\t({ nodeType: nt, category: category }));\n\t\tconst content = this.props.showGrid\n\t\t\t? (\n\t\t\t\t<PaletteDialogContentGrid\n\t\t\t\t\tcategory={category}\n\t\t\t\t\tnodeTypes={nodeTypes}\n\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t/>)\n\t\t\t: (\n\t\t\t\t<PaletteContentList\n\t\t\t\t\tcategory={category}\n\t\t\t\t\tnodeTypeInfos={nodeTypeInfos}\n\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\tisPaletteOpen\n\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t/>);\n\t\treturn (\n\t\t\t<div className=\"palette-dialog-content\" ref=\"palettecontent\">\n\t\t\t\t<PaletteDialogContentCategories categories={cats}\n\t\t\t\t\tselectedCategory={this.state.selectedCategory}\n\t\t\t\t\tcategorySelectedMethod={this.categorySelected}\n\t\t\t\t/>\n\t\t\t\t{content}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteDialogContent.propTypes = {\n\tpaletteJSON: PropTypes.object.isRequired,\n\tshowGrid: PropTypes.bool.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired\n};\n\nexport default PaletteDialogContent;\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport PropTypes from \"prop-types\";\nimport defaultMessages from \"../../locales/palette/locales/en.json\";\nimport PaletteDialogTopbar from \"./palette-dialog-topbar.jsx\";\nimport PaletteDialogContent from \"./palette-dialog-content.jsx\";\n\nclass PaletteDialog extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\txPos: 100,\n\t\t\tyPos: 100,\n\t\t\tshowGrid: true\n\t\t};\n\n\t\tthis.showGrid = this.showGrid.bind(this);\n\t\tthis.mouseDownOnTopBar = this.mouseDownOnTopBar.bind(this);\n\t\tthis.mouseDownOnPalette = this.mouseDownOnPalette.bind(this);\n\t\tthis.mouseMove = this.mouseMove.bind(this);\n\t\tthis.mouseUp = this.mouseUp.bind(this);\n\t\tthis.windowResize = this.windowResize.bind(this);\n\t\tthis.windowMaximize = this.windowMaximize.bind(this);\n\t\tthis.getPaletteDiv = this.getPaletteDiv.bind(this);\n\t\tthis.resizePalette = this.resizePalette.bind(this);\n\t\tthis.movePalette = this.movePalette.bind(this);\n\t\tthis.setResizingCursors = this.setResizingCursors.bind(this);\n\t\tthis.setSizingHoverEdge = this.setSizingHoverEdge.bind(this);\n\t\tthis.snapToWidth = this.snapToWidth.bind(this);\n\t\tthis.snapToHeight = this.snapToHeight.bind(this);\n\t\tthis.removePx = this.removePx.bind(this);\n\n\t\t// These variables are used when dragging the palette.\n\t\tthis.dragging = false;\n\t\tthis.dragOffsetY = 0;\n\t\tthis.dragOffsetX = 0;\n\n\t\t// verticalSizingAction and verticalSizingHover can be set to top or bottom\n\t\tthis.verticalSizingAction = \"\";\n\t\tthis.verticalSizingHover = \"\";\n\n\t\t// horizontalSizingAction and horizontalSizingHover can be set to left or right\n\t\tthis.horizontalSizingAction = \"\";\n\t\tthis.hoizontalSizingHover = \"\";\n\n\t\t// These variables store the palette dimensions\n\t\tthis.savedWidth = 0;\n\t\tthis.savedLeft = 0;\n\t\tthis.savedHeight = 0;\n\t\tthis.savedTop = 0;\n\n\t\t// hoverZoneSize is the number of pixels around the palette where the\n\t\t// sizing cursor will appear (which allows the user to size the window).\n\t\tthis.hoverZoneSize = 3;\n\t\tthis.totalHoverZoneSize = this.hoverZoneSize * 2;\n\n\t\t// Need to control resizing of palette with snap to grid.\n\t\tthis.adjustedWidth = 137; // default width - (default content node grid width)\n\t\tthis.adjustedHeight = 51; // default heigth - (default content node grid height) + padding to avoid scroll bar\n\t\tthis.adjustedScrollBarWidth = 15;\n\n\t\t// Boolean to remember whether we are maximized or not. This gets set to\n\t\t// false when doing a manual resize of the palette.\n\t\tthis.isMaximized = false;\n\n\t\tthis.paletteNodes = [];\n\n\t\t// Correction for palette cursor position\n\t\t// Used in both hoverzone detection and mouseMove vertical resize at bottom of paletteDiv\n\t\tthis.hackPaletteOffset = 46;\n\t\tthis.hackPaletteTopOffset = this.hackPaletteOffset + 4;\n\n\t\twindow.addEventListener(\"mousemove\", this.mouseMove, false);\n\t\twindow.addEventListener(\"mouseup\", this.mouseUp, false);\n\t\twindow.addEventListener(\"resize\", this.windowResize, false);\n\t}\n\n\tcomponentDidUpdate() {\n\t\t// After the palette has rendered ensure the palette is visible in\n\t\t// whatever size the canvas happens to be. This can be done by doing\n\t\t// the same activity as we perform when the browser window is sized.\n\t\tthis.windowResize();\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"mousemove\", this.mouseMove);\n\t\twindow.removeEventListener(\"mouseup\", this.mouseUp);\n\t\twindow.removeEventListener(\"resize\", this.windowResize);\n\t}\n\n\t// Adjusts the mouse position from the event so it is NOT outside the\n\t// canvas when doing a bottom sizing operation.\n\tgetAdjustedMousePositionBottom(ev, canvasDiv) {\n\t\tlet eventClientY = ev.clientY;\n\n\t\tif (eventClientY > canvasDiv.offsetTop + canvasDiv.offsetHeight - this.hoverZoneSize) {\n\t\t\teventClientY = canvasDiv.offsetTop + canvasDiv.offsetHeight - this.hoverZoneSize;\n\t\t}\n\t\treturn eventClientY;\n\t}\n\n\t// Adjusts the mouse position from the event so it is NOT outside the\n\t// canvas when doing a left sizing operation.\n\tgetAdjustedMousePositionLeft(ev, canvasDiv) {\n\t\tlet eventClientX = ev.clientX;\n\n\t\tif (eventClientX < canvasDiv.offsetLeft + this.hoverZoneSize) {\n\t\t\teventClientX = canvasDiv.offsetLeft + this.hoverZoneSize;\n\t\t}\n\t\treturn eventClientX;\n\t}\n\n\t// Adjusts the mouse position from the event so it is NOT outside the\n\t// canvas when doing a right sizing operation.\n\tgetAdjustedMousePositionRight(ev, canvasDiv) {\n\t\tlet eventClientX = ev.clientX;\n\n\t\tif (eventClientX > canvasDiv.offsetLeft + canvasDiv.offsetWidth - this.hoverZoneSize) {\n\t\t\teventClientX = canvasDiv.offsetLeft + canvasDiv.offsetWidth - this.hoverZoneSize;\n\t\t}\n\t\treturn eventClientX;\n\t}\n\n\t// Adjusts the mouse position from the event so it is NOT outside the\n\t// canvas when doing a top sizing operation.\n\tgetAdjustedMousePositionTop(ev, canvasDiv) {\n\t\tlet eventClientY = ev.clientY;\n\n\t\tif (eventClientY < canvasDiv.offsetTop + this.hoverZoneSize) {\n\t\t\teventClientY = canvasDiv.offsetTop + this.hoverZoneSize;\n\t\t}\n\t\treturn eventClientY;\n\t}\n\n\tgetPaletteDiv() {\n\t\treturn this.refs.palette;\n\t}\n\n\tgetStyleProperty(classOrId, property) {\n\t\tconst firstChar = classOrId.charAt(0);\n\t\tconst remaining = classOrId.substring(1);\n\t\tconst elem = (firstChar === \"#\") ? document.getElementById(remaining) : document.getElementsByClassName(remaining)[0];\n\t\treturn window.getComputedStyle(elem, null).getPropertyValue(property);\n\t}\n\n\tsetResizingCursors(ev) {\n\t\tconst paletteDiv = this.getPaletteDiv();\n\n\t\tthis.setSizingHoverEdge(ev, paletteDiv);\n\n\t\tif (this.verticalSizingHover === \"top\") {\n\t\t\tif (this.horizontalSizingHover === \"left\") {\n\t\t\t\tpaletteDiv.style.cursor = \"nwse-resize\";\n\t\t\t} else if (this.horizontalSizingHover === \"right\") {\n\t\t\t\tpaletteDiv.style.cursor = \"nesw-resize\";\n\t\t\t} else {\n\t\t\t\tpaletteDiv.style.cursor = \"ns-resize\";\n\t\t\t}\n\t\t} else if (this.verticalSizingHover === \"bottom\") {\n\t\t\tif (this.horizontalSizingHover === \"left\") {\n\t\t\t\tpaletteDiv.style.cursor = \"nesw-resize\";\n\t\t\t} else if (this.horizontalSizingHover === \"right\") {\n\t\t\t\tpaletteDiv.style.cursor = \"nwse-resize\";\n\t\t\t} else {\n\t\t\t\tpaletteDiv.style.cursor = \"ns-resize\";\n\t\t\t}\n\t\t} else if (this.horizontalSizingHover === \"left\" ||\n\t\t\t\t\t\t\tthis.horizontalSizingHover === \"right\") {\n\t\t\tpaletteDiv.style.cursor = \"ew-resize\";\n\n\t\t} else {\n\t\t\tpaletteDiv.style.cursor = \"default\";\n\t\t}\n\t}\n\n\t// Sets the size of the content div, and the divs inside content div, so\n\t// they adopt the same height as the palette.\n\tsetContentDivHeight(paletteDiv, newHeight) {\n\t\tconst topbarHeight = this.removePx(this.getStyleProperty(\".palette-dialog-topbar\", \"height\"));\n\t\tconst newContentHeight = (newHeight - topbarHeight - this.totalHoverZoneSize) + \"px\";\n\t\tconst contentDiv = paletteDiv.childNodes[1];\n\t\tcontentDiv.style.height = newContentHeight;\n\t\tcontentDiv.childNodes[0].style.height = newContentHeight;\n\t\tcontentDiv.childNodes[1].style.height = newContentHeight;\n\t\tcontentDiv.childNodes[2].style.height = newContentHeight;\n\t}\n\n\tsetSizingHoverEdge(ev, paletteDiv) {\n\t\tif (ev.clientX > paletteDiv.offsetLeft &&\n\t\t\t\tev.clientX < paletteDiv.offsetLeft + (this.totalHoverZoneSize)) {\n\t\t\tthis.horizontalSizingHover = \"left\";\n\n\t\t} else if (ev.clientX < paletteDiv.offsetLeft + paletteDiv.offsetWidth &&\n\t\t\t\t\tev.clientX > paletteDiv.offsetLeft + paletteDiv.offsetWidth - this.totalHoverZoneSize) {\n\t\t\tthis.horizontalSizingHover = \"right\";\n\n\t\t} else {\n\t\t\tthis.horizontalSizingHover = \"\";\n\t\t\tthis.horizontalSizingAction = \"\";\n\t\t}\n\n\t\tif (ev.clientY > paletteDiv.offsetTop + this.hackPaletteTopOffset &&\n\t\t\t\tev.clientY < paletteDiv.offsetTop + this.hackPaletteTopOffset + this.totalHoverZoneSize) {\n\t\t\tthis.verticalSizingHover = \"top\";\n\n\t\t} else if (ev.clientY < paletteDiv.offsetTop + paletteDiv.offsetHeight + this.hackPaletteOffset &&\n\t\t\t\tev.clientY > paletteDiv.offsetTop + paletteDiv.offsetHeight +\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.hackPaletteOffset - this.totalHoverZoneSize) {\n\t\t\tthis.verticalSizingHover = \"bottom\";\n\n\t\t} else {\n\t\t\tthis.verticalSizingHover = \"\";\n\t\t\tthis.verticalSizingAction = \"\";\n\t\t}\n\t}\n\n\tmouseDownOnTopBar(ev) {\n\t\tthis.dragging = true;\n\t\tconst paletteDiv = this.getPaletteDiv();\n\t\tthis.dragOffsetX = ev.clientX - paletteDiv.offsetLeft;\n\t\tthis.dragOffsetY = ev.clientY - paletteDiv.offsetTop;\n\t}\n\n\tmouseDownOnPalette(ev) {\n\t\tconst paletteDiv = this.getPaletteDiv();\n\n\t\tif (this.verticalSizingHover !== \"\" ||\n\t\t\t\tthis.horizontalSizingHover !== \"\") {\n\t\t\tthis.verticalSizingAction = this.verticalSizingHover;\n\t\t\tthis.horizontalSizingAction = this.horizontalSizingHover;\n\t\t\tthis.savedWidth = paletteDiv.offsetWidth;\n\t\t\tthis.savedLeft = paletteDiv.offsetLeft;\n\t\t\tthis.savedHeight = paletteDiv.offsetHeight;\n\t\t\tthis.savedTop = paletteDiv.offsetTop;\n\t\t}\n\t}\n\n\tmouseMove(ev) {\n\t\t// First, see if we are doing a sizing action (i.e. the user has\n\t\t// done mouse down when in sizing hover zone) and take appropriate\n\t\t// sizing action.\n\t\tif (this.verticalSizingAction !== \"\" ||\n\t\t\t\tthis.horizontalSizingAction !== \"\") {\n\t\t\tthis.resizePalette(ev);\n\n\t\t\t// Now, if no sizing behavior is going on we handle topbar drag\n\t\t\t// behavior (after the sizing behaviors) so sizing takes\n\t\t\t// precedence over dragging the window.\n\t\t} else if (this.dragging === true) {\n\t\t\tthis.movePalette(ev);\n\n\t\t\t// Finally, if no sizing or dragging is going on, we look to see if\n\t\t\t// the user is hovering the pointer near the palette edges so we can\n\t\t\t// display an appropriate sizing cursor.\n\t\t} else {\n\t\t\tthis.setResizingCursors(ev);\n\t\t}\n\t}\n\n\tmouseUp() {\n\t\tconst paletteDiv = this.getPaletteDiv();\n\n\t\t// snap to grid adjustment to width\n\t\tif (this.state.showGrid && this.horizontalSizingAction !== \"\") {\n\t\t\tlet newWidth = this.removePx(paletteDiv.style.width);\n\t\t\tif (newWidth !== \"\") {\n\t\t\t\tnewWidth = this.snapToWidth(newWidth);\n\t\t\t}\n\t\t\tpaletteDiv.style.width = newWidth + \"px\";\n\n\t\t\t// adjust the width if the content enters a scrolling situation\n\t\t\tconst scrollDiv = paletteDiv.childNodes[1].childNodes[1];\n\t\t\tif (scrollDiv.clientHeight < scrollDiv.scrollHeight) {\n\t\t\t\tpaletteDiv.style.width = (newWidth + this.adjustedScrollBarWidth) + \"px\";\n\t\t\t}\n\t\t}\n\n\t\t// snap to grid adjustment to height\n\t\tif (this.verticalSizingAction !== \"\") {\n\t\t\tconst oldHeight = this.removePx(paletteDiv.style.height);\n\t\t\tif (oldHeight !== \"\") {\n\t\t\t\tconst newHeight = this.snapToHeight(oldHeight);\n\t\t\t\tpaletteDiv.style.height = newHeight + \"px\";\n\t\t\t\tthis.setContentDivHeight(paletteDiv, newHeight);\n\t\t\t}\n\t\t}\n\n\t\tthis.dragging = false;\n\t\tthis.verticalSizingAction = \"\";\n\t\tthis.horizontalSizingAction = \"\";\n\t\tthis.verticalSizingHover = \"\";\n\t\tthis.horizontalSizingHover = \"\";\n\t}\n\n\tmovePalette(ev) {\n\t\tconst paletteDiv = this.getPaletteDiv();\n\t\tconst canvasDiv = document.getElementById(this.props.parentDivId);\n\n\t\tlet newLeft = ev.clientX - this.dragOffsetX;\n\t\tlet newTop = ev.clientY - this.dragOffsetY;\n\n\t\tif (newLeft < canvasDiv.offsetLeft + this.hoverZoneSize) {\n\t\t\tnewLeft = canvasDiv.offsetLeft + this.hoverZoneSize;\n\t\t}\n\t\tif (newTop < canvasDiv.offsetTop + this.hoverZoneSize) {\n\t\t\tnewTop = canvasDiv.offsetTop + this.hoverZoneSize;\n\t\t}\n\t\tif (newLeft + paletteDiv.offsetWidth > canvasDiv.offsetLeft + canvasDiv.offsetWidth) {\n\t\t\tnewLeft = canvasDiv.offsetLeft + canvasDiv.offsetWidth - paletteDiv.offsetWidth - this.hoverZoneSize;\n\t\t}\n\t\tif (newTop + paletteDiv.offsetHeight > canvasDiv.offsetTop + canvasDiv.offsetHeight) {\n\t\t\tnewTop = canvasDiv.offsetTop + canvasDiv.offsetHeight - paletteDiv.offsetHeight - this.hoverZoneSize;\n\t\t}\n\n\t\tpaletteDiv.style.left = newLeft + \"px\";\n\t\tpaletteDiv.style.top = newTop + \"px\";\n\t}\n\n\tremovePx(styleDimension) {\n\t\treturn parseInt(styleDimension.substring(0, styleDimension.indexOf(\"px\")), 10);\n\t}\n\n\tresizePalette(ev) {\n\t\tconst paletteDiv = this.getPaletteDiv();\n\t\tconst canvasDiv = document.getElementById(this.props.parentDivId);\n\n\t\t// When manually resizing, set isMaximized to false in case the user\n\t\t// is resizing a maximized window.\n\t\tthis.isMaximized = false;\n\n\t\tconst minWidth = this.removePx(this.getStyleProperty(\".palette-dialog-grid-node-outer\", \"width\")) +\n\t\t\t\t\t\t\t\t\t\t\tthis.removePx(this.getStyleProperty(\".palette-dialog-categories\", \"min-width\")) +\n\t\t\t\t\t\t\t\t\t\t\t(2 * this.hoverZoneSize);\n\t\tconst minHeight = this.removePx(this.getStyleProperty(\".palette-dialog-grid-node-outer\", \"height\")) +\n\t\t\t\t\t\t\t\t\t\t\tthis.removePx(this.getStyleProperty(\".palette-dialog-topbar\", \"height\")) +\n\t\t\t\t\t\t\t\t\t\t\t(2 * this.hoverZoneSize);\n\n\t\tif (this.horizontalSizingAction === \"left\") {\n\t\t\tconst eventClientX = this.getAdjustedMousePositionLeft(ev, canvasDiv);\n\t\t\tconst newWidth = this.savedWidth - (eventClientX - this.savedLeft);\n\n\t\t\tif (newWidth <= minWidth) {\n\t\t\t\tpaletteDiv.style.width = minWidth + \"px\";\n\t\t\t} else {\n\t\t\t\tpaletteDiv.style.width = newWidth + \"px\";\n\t\t\t\tpaletteDiv.style.left = eventClientX + \"px\";\n\t\t\t}\n\t\t}\n\n\t\tif (this.horizontalSizingAction === \"right\") {\n\t\t\tconst eventClientX = this.getAdjustedMousePositionRight(ev, canvasDiv);\n\t\t\tlet newWidth = (eventClientX - this.savedLeft);\n\n\t\t\tif (newWidth <= minWidth) {\n\t\t\t\tnewWidth = minWidth;\n\t\t\t}\n\t\t\tpaletteDiv.style.width = newWidth + \"px\";\n\t\t}\n\n\t\tif (this.verticalSizingAction === \"top\") {\n\t\t\tconst eventClientY = this.getAdjustedMousePositionTop(ev, canvasDiv);\n\t\t\tconst newHeight = this.savedHeight - (eventClientY - this.savedTop);\n\n\t\t\tif (newHeight <= minHeight) {\n\t\t\t\tpaletteDiv.style.height = minHeight + \"px\";\n\t\t\t\tthis.setContentDivHeight(paletteDiv, this.minHeight);\n\t\t\t} else {\n\t\t\t\tpaletteDiv.style.height = newHeight + \"px\";\n\t\t\t\tpaletteDiv.style.top = (eventClientY - this.dragOffsetY) + \"px\";\n\t\t\t\tthis.setContentDivHeight(paletteDiv, newHeight);\n\t\t\t}\n\t\t}\n\n\t\tif (this.verticalSizingAction === \"bottom\") {\n\t\t\tconst eventClientY = this.getAdjustedMousePositionBottom(ev, canvasDiv);\n\t\t\tlet newHeight = eventClientY - this.savedTop - this.hackPaletteOffset;\n\n\t\t\tif (newHeight <= minHeight) {\n\t\t\t\tnewHeight = minHeight;\n\t\t\t}\n\t\t\tpaletteDiv.style.height = newHeight + \"px\";\n\t\t\tthis.setContentDivHeight(paletteDiv, newHeight);\n\t\t}\n\t}\n\n\t// Calculate snap to grid width\n\tsnapToWidth(newWidth) {\n\t\tconst gridNodeWidth = this.removePx(this.getStyleProperty(\".palette-dialog-grid-node-outer\", \"width\"));\n\t\tconst snapWidth = Math.round((newWidth - this.adjustedWidth) / gridNodeWidth) * gridNodeWidth;\n\t\treturn (snapWidth + this.adjustedWidth);\n\t}\n\n\t// Calculate snap to grid height\n\tsnapToHeight(newHeight) {\n\t\tconst gridHeight = this.state.showGrid ? this.removePx(this.getStyleProperty(\".palette-dialog-grid-node-outer\", \"height\"))\n\t\t\t: this.removePx(this.getStyleProperty(\".palette-list-item\", \"height\"));\n\t\tconst snapHeight = Math.round((newHeight - this.adjustedHeight) / gridHeight) * gridHeight;\n\t\treturn (snapHeight + this.adjustedHeight);\n\t}\n\n\t// Called when the browser window is resized.We need to make sure the\n\t// palette stays inside the canvas and is a size that allows it to fit\n\t// into the canvas.\n\twindowResize() {\n\t\tconst paletteDiv = this.getPaletteDiv();\n\t\tconst canvasDiv = document.getElementById(this.props.parentDivId);\n\n\t\tif (canvasDiv) {\n\t\t\tif (this.isMaximized) {\n\t\t\t\t// Handle horizontal page sizing\n\t\t\t\tconst newLeft = canvasDiv.offsetLeft + this.hoverZoneSize;\n\t\t\t\tpaletteDiv.style.left = newLeft + \"px\";\n\n\t\t\t\tconst newWidth = canvasDiv.offsetWidth - this.totalHoverZoneSize;\n\t\t\t\tpaletteDiv.style.width = newWidth + \"px\";\n\n\t\t\t\t// Handle vertical page sizing\n\t\t\t\tconst newTop = canvasDiv.offsetTop + this.hoverZoneSize;\n\t\t\t\tpaletteDiv.style.top = newTop + \"px\";\n\n\t\t\t\tconst newHeight = canvasDiv.offsetHeight - this.totalHoverZoneSize;\n\t\t\t\tpaletteDiv.style.height = newHeight + \"px\";\n\t\t\t\tthis.setContentDivHeight(paletteDiv, newHeight);\n\n\t\t\t} else {\n\t\t\t\t// Handle horizontal page sizing\n\t\t\t\tif (paletteDiv.offsetLeft + paletteDiv.offsetWidth + this.hoverZoneSize >\n\t\t\t\t\t\t\t\t\t\tcanvasDiv.offsetLeft + canvasDiv.offsetWidth) {\n\t\t\t\t\tconst newLeft = canvasDiv.offsetLeft + canvasDiv.offsetWidth -\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpaletteDiv.offsetWidth - this.hoverZoneSize;\n\t\t\t\t\tpaletteDiv.style.left = newLeft + \"px\";\n\t\t\t\t}\n\n\t\t\t\tconst newWidth = canvasDiv.offsetWidth - this.totalHoverZoneSize;\n\t\t\t\tif (newWidth < paletteDiv.offsetWidth) {\n\t\t\t\t\tpaletteDiv.style.width = newWidth + \"px\";\n\t\t\t\t\tpaletteDiv.style.left = (canvasDiv.offsetLeft + canvasDiv.offsetWidth -\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpaletteDiv.offsetWidth - this.hoverZoneSize) + \"px\";\n\t\t\t\t}\n\n\t\t\t\t// Handle vertical page sizing\n\t\t\t\tif (paletteDiv.offsetTop + paletteDiv.offsetHeight + this.hoverZoneSize >\n\t\t\t\t\t\t\t\t\t\tcanvasDiv.offsetTop + canvasDiv.offsetHeight) {\n\t\t\t\t\tconst newTop = canvasDiv.offsetTop + canvasDiv.offsetHeight -\n\t\t\t\t\t\t\t\t\t\t\t\tpaletteDiv.offsetHeight - this.hoverZoneSize;\n\t\t\t\t\tpaletteDiv.style.top = newTop + \"px\";\n\t\t\t\t}\n\n\t\t\t\tconst newHeight = canvasDiv.offsetHeight - this.totalHoverZoneSize;\n\t\t\t\tif (newHeight < paletteDiv.offsetHeight) {\n\t\t\t\t\tpaletteDiv.style.height = newHeight + \"px\";\n\t\t\t\t\tpaletteDiv.style.top = (canvasDiv.offsetTop + canvasDiv.offsetHeight -\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpaletteDiv.offsetHeight - this.hoverZoneSize) + \"px\";\n\t\t\t\t\tthis.setContentDivHeight(paletteDiv, newHeight);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Called when the user double clicks the title bar.\n\twindowMaximize() {\n\t\tconst paletteDiv = this.getPaletteDiv();\n\t\tconst canvasDiv = document.getElementById(this.props.parentDivId);\n\n\t\tif (canvasDiv) {\n\t\t\tif (this.isMaximized) {\n\t\t\t\t// Restore the previous window size and position\n\t\t\t\tpaletteDiv.style.width = this.savedWidth + \"px\";\n\t\t\t\tpaletteDiv.style.left = this.savedLeft + \"px\";\n\t\t\t\tpaletteDiv.style.height = this.savedHeight + \"px\";\n\t\t\t\tpaletteDiv.style.top = this.savedTop + \"px\";\n\t\t\t\tthis.setContentDivHeight(paletteDiv, this.savedHeight);\n\n\t\t\t\tthis.isMaximized = false;\n\n\t\t\t\t// After the palette has restored, ensure it is visible in\n\t\t\t\t// whatever size the canvas happens to be. This can be done by doing\n\t\t\t\t// the same activity as we perform when the browser window is sized.\n\t\t\t\t// Make sure to call this after setting the isMaximized flag because\n\t\t\t\t// windowResize() looks at that flag for its resize behavior.\n\t\t\t\tthis.windowResize();\n\n\t\t\t} else {\n\t\t\t\t// Save the existing size and position and maximize the palette.\n\t\t\t\tthis.savedWidth = paletteDiv.offsetWidth;\n\t\t\t\tthis.savedLeft = paletteDiv.offsetLeft;\n\t\t\t\tthis.savedHeight = paletteDiv.offsetHeight;\n\t\t\t\tthis.savedTop = paletteDiv.offsetTop;\n\n\t\t\t\t// Handle horizontal palette sizing\n\t\t\t\t// A padding of 1 is needed to make it look better (I think) because of rounding errors\n\t\t\t\tconst newWidth = canvasDiv.offsetWidth - this.totalHoverZoneSize + 1;\n\t\t\t\tpaletteDiv.style.width = newWidth + \"px\";\n\t\t\t\tpaletteDiv.style.left = (canvasDiv.offsetLeft + this.hoverZoneSize) + \"px\";\n\n\t\t\t\t// Handle vertical palette sizing\n\t\t\t\t// A padding of 1 is needed to make it look better (I think) because of rounding errors\n\t\t\t\tconst newHeight = canvasDiv.offsetHeight - this.totalHoverZoneSize + 1;\n\t\t\t\tpaletteDiv.style.height = newHeight + \"px\";\n\t\t\t\tpaletteDiv.style.top = (canvasDiv.offsetTop + this.hoverZoneSize) + \"px\";\n\t\t\t\tthis.setContentDivHeight(paletteDiv, newHeight);\n\n\t\t\t\tthis.isMaximized = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tshowGrid(state) {\n\t\tthis.setState({ showGrid: state });\n\t}\n\n\trender() {\n\t\tconst displayValue = this.props.showPalette ? \"block\" : \"none\";\n\n\t\treturn (\n\t\t\t<nav aria-label={this.props.intl.formatMessage({ id: \"palette.dialog.label\", defaultMessage: defaultMessages[\"palette.dialog.label\"] })} role=\"navigation\">\n\t\t\t\t<div className=\"palette-dialog-div\"\n\t\t\t\t\tref=\"palette\"\n\t\t\t\t\tonMouseDown={this.mouseDownOnPalette}\n\t\t\t\t\tstyle={{ display: displayValue }}\n\t\t\t\t>\n\t\t\t\t\t<PaletteDialogTopbar mouseDownMethod={this.mouseDownOnTopBar}\n\t\t\t\t\t\tshowGridMethod={this.showGrid}\n\t\t\t\t\t\twindowMaximizeMethod={this.windowMaximize}\n\t\t\t\t\t\tshowGrid={this.state.showGrid}\n\t\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\t/>\n\t\t\t\t\t<PaletteDialogContent paletteJSON={this.props.paletteJSON}\n\t\t\t\t\t\tshowGrid={this.state.showGrid}\n\t\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</nav>\n\t\t);\n\t}\n}\n\nPaletteDialog.propTypes = {\n\tintl: PropTypes.object.isRequired,\n\tpaletteJSON: PropTypes.object.isRequired,\n\tshowPalette: PropTypes.bool.isRequired,\n\tparentDivId: PropTypes.string.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired\n};\n\nexport default injectIntl(PaletteDialog);\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { has } from \"lodash\";\n\n// The entry point to this utils file.\n// Returns a filtered, ranked array of nodeTypeInfo objects for the nodeTypes\n// in the categories passed in and the searchString passed in.\nexport function getFilteredNodeTypeInfos(categories, searchString) {\n\tconst filteredNodeTypeInfos = [];\n\tconst lowercaseFilteredKeyword = searchString.toLowerCase();\n\tconst filterStrings = lowercaseFilteredKeyword.split(\" \").filter((kw) => kw !== \"\");\n\tfor (let idx = 0; idx < categories.length; idx++) {\n\t\tfilteredNodeTypeInfos.push(...getFilteredNodeTypeInfosByCategory(categories[idx], filterStrings));\n\t}\n\tconst rankedFilteredNodeTypeInfos =\n\t\tfilteredNodeTypeInfos.sort((e1, e2) => ((e1.occurrenceInfo.ranking <= e2.occurrenceInfo.ranking) ? 1 : -1));\n\n\treturn rankedFilteredNodeTypeInfos;\n}\n\n// Returns a filtered, ranked array of nodeTypeInfo objects for the nodeTypes\n// in the category passed in and the searchString passed in.\nfunction getFilteredNodeTypeInfosByCategory(category, filterStrings) {\n\tvar filteredNodeTypeInfos = [];\n\tif (category.node_types) {\n\t\tfor (const nodeType of category.node_types) {\n\t\t\tconst occurrenceInfo = getOccurrences(nodeType, category, filterStrings);\n\t\t\tif (occurrenceInfo) {\n\t\t\t\tfilteredNodeTypeInfos.push({ nodeType, category, occurrenceInfo });\n\t\t\t}\n\t\t}\n\t}\n\treturn filteredNodeTypeInfos;\n}\n\n// Returns an object containing the label and description occurrences of the\n// stings in the filterString array passed in based on the nodeType and category\n// passed in. The returned object also contains a ranking which can be used\n// to rank the object returned against other objects returned from this method.\nfunction getOccurrences(nodeType, category, filterStrings) {\n\tif (filterStrings.length > 0) {\n\n\t\tconst { catLabelOccurrences, catLabelHitCounts } = getCategoryLabelInfo(category, filterStrings);\n\t\tconst { nodeLabelOccurrences, nodeLabelHitCounts } = getNodeLabelInfo(nodeType, filterStrings);\n\t\tconst { nodeDescOccurrences, nodeDescHitCounts } = getNodeDescInfo(nodeType, filterStrings);\n\n\t\tif (catLabelOccurrences.length > 0 || nodeLabelOccurrences.length > 0 || nodeDescOccurrences.length > 0) {\n\t\t\tconst ranking = calcRanking(catLabelHitCounts, nodeLabelHitCounts, nodeDescHitCounts, filterStrings.length);\n\t\t\treturn { catLabelOccurrences, nodeLabelOccurrences, nodeDescOccurrences, ranking };\n\t\t}\n\t}\n\treturn null;\n}\n\n// Returns the occurences and hit counts info for the label of the category\n// passed in based on the filterStrings.\nfunction getCategoryLabelInfo(category, filterStrings) {\n\tconst catLabel = has(category, \"label\") && category.label\n\t\t? category.label.toLowerCase()\n\t\t: \"\";\n\tconst { occurrences, hitCounts } = wordOccurrences(catLabel, filterStrings);\n\treturn { catLabelOccurrences: occurrences, catLabelHitCounts: hitCounts };\n}\n\n// Returns the occurences and hit counts info for the label of the node\n// passed in based on the filterStrings.\nfunction getNodeLabelInfo(nodeType, filterStrings) {\n\tconst nodeLabel = has(nodeType, \"app_data.ui_data.label\") && nodeType.app_data.ui_data.label\n\t\t? nodeType.app_data.ui_data.label.toLowerCase()\n\t\t: \"\";\n\tconst { occurrences, hitCounts } = wordOccurrences(nodeLabel, filterStrings);\n\treturn { nodeLabelOccurrences: occurrences, nodeLabelHitCounts: hitCounts };\n}\n\n// Returns the occurences and hit counts info for the description of the node\n// passed in based on the filterStrings.\nfunction getNodeDescInfo(nodeType, filterStrings) {\n\tconst desc = has(nodeType, \"app_data.ui_data.description\") && nodeType.app_data.ui_data.description\n\t\t? nodeType.app_data.ui_data.description.toLowerCase()\n\t\t: \"\";\n\tconst { occurrences, hitCounts } = wordOccurrences(desc, filterStrings);\n\treturn { nodeDescOccurrences: occurrences, nodeDescHitCounts: hitCounts };\n}\n\n// Calculates a ranking value for the node type info object being processed,\n// based on the various hit count arrays passed in. Each hit count array has\n// one element for each filter string entered by the user. Each element\n// contains either a 1 or 0 to indicate a hit on that filter string or not.\n// Ranking is based on:\n// * The number of hits across the 3 areas (category label, node label, description)\n// * Whether or not multiple filter strings (if more than one is provided)\n//   appear in any of the areas.\nfunction calcRanking(catLabelHitCounts, nodeLabelHitCounts, descHitCounts, filterStringsLength) {\n\tlet ranking = 0;\n\tlet multiStringHits = 0;\n\n\tfor (let i = 0; i < filterStringsLength; i++) {\n\t\tranking += catLabelHitCounts[i] + (10 * nodeLabelHitCounts[i]) + descHitCounts[i]; // Give extra weight to node label hit\n\n\t\tif (catLabelHitCounts[i] + nodeLabelHitCounts[i] + descHitCounts[i] > 0) {\n\t\t\tmultiStringHits++;\n\t\t}\n\t}\n\n\treturn ranking + (multiStringHits * 50);\n}\n\n// Returns an object containing an array of occurrences and hit counts for the\n// main string passed in after being searched by the strings in the\n// filterStrings array passed in.\nfunction wordOccurrences(mainString, filterStrings) {\n\tlet occurrences = [];\n\tconst hitCounts = [];\n\tfilterStrings.forEach((s) => {\n\t\tif (s) {\n\t\t\tconst newOccurrences = wordOccurrencesByString(mainString, s);\n\t\t\toccurrences = joinOccurrences(occurrences, newOccurrences, mainString);\n\t\t\thitCounts.push(newOccurrences.length > 0 ? 1 : 0);\n\t\t}\n\t});\n\treturn { occurrences, hitCounts };\n}\n\n// Returns an array of occurrences where the occurrences from the two arrays\n// passed in are joined together where they overlap so that the returned\n// array has no overlapping occurrences.\nfunction joinOccurrences(occurrences, newOccurrences) {\n\tif (occurrences.length === 0) {\n\t\treturn newOccurrences;\n\t}\n\tif (newOccurrences.length === 0) {\n\t\treturn occurrences;\n\t}\n\n\tconst addOccurrences = [];\n\tnewOccurrences.forEach((newOcc) => {\n\t\tlet handled = false;\n\t\toccurrences.forEach((occ) => {\n\t\t\t//   String         abdefghijklmno\n\t\t\t//   Occurrence         <-->\n\t\t\t//   New occurrence   <------->\n\t\t\t//   Result           <------->\n\t\t\t// and also:\n\t\t\t//   Occurrence         <-->\n\t\t\t//   New occurrence     <-->\n\t\t\t//   Result             <-->\n\t\t\tif (newOcc.start <= occ.start && newOcc.end >= occ.end) {\n\t\t\t\tocc.start = newOcc.start;\n\t\t\t\tocc.end = newOcc.end;\n\t\t\t\thandled = true;\n\n\t\t\t//   String         abdefghijklmno\n\t\t\t//   Occurrence         <-->\n\t\t\t//   New occurrence       <--->\n\t\t\t//   Result             <----->\n\t\t\t} else if (newOcc.start >= occ.start && newOcc.start < occ.end) {\n\t\t\t\tif (newOcc.end >= occ.end) {\n\t\t\t\t\tocc.end = newOcc.end;\n\t\t\t\t}\n\t\t\t\thandled = true;\n\n\t\t\t//   String         abdefghijklmno\n\t\t\t//   Occurrence         <-->\n\t\t\t//   New occurrence  <--->\n\t\t\t//   Result          <----->\n\t\t\t} else if (newOcc.end > occ.start && newOcc.end <= occ.end) {\n\t\t\t\tif (newOcc.start < occ.start) {\n\t\t\t\t\tocc.start = newOcc.start;\n\t\t\t\t}\n\t\t\t\thandled = true;\n\t\t\t}\n\t\t});\n\t\t//   Occurrence         <-->\n\t\t//   New occurrence          <-->\n\t\t//   Result            <--> <-->\n\t\tif (!handled) {\n\t\t\taddOccurrences.push(newOcc);\n\t\t}\n\t});\n\n\tlet outOccurrences = occurrences.concat(addOccurrences);\n\toutOccurrences = outOccurrences.sort((occ1, occ2) => ((occ1.start < occ2.start) ? -1 : 1));\n\treturn outOccurrences;\n}\n\n// Returns up to a maximum of 20 occurrences of the searchString in the mainString.\n// 20 is an arbitrary number chosen to improve search performance since it is\n// considerd unlikely a user will care about anythig more than 20 hits on a\n// string (which would most likely be in a description string).\nfunction wordOccurrencesByString(mainString, searchString) {\n\tconst occurrences = [];\n\tlet start = 0;\n\tlet index = 0;\n\tlet count = 0;\n\n\twhile (index > -1 && count < 20) {\n\t\tindex = mainString.indexOf(searchString, start);\n\t\tif (index > -1) {\n\t\t\toccurrences.push({ start: index, end: index + searchString.length });\n\t\t\tstart = index + searchString.length;\n\t\t\tcount++;\n\t\t}\n\t}\n\treturn occurrences;\n}\n\n// If we need to support a locale specific search we can uncomment the code\n// below and use localeIndexOf inplace of <string>.indexOf() in the code above.\n\n// function localeIndexOf(mainString, searchString, fromIndex) {\n// \tlet index = -1;\n// \tif (searchString.length <= mainString.length - fromIndex) {\n// \t\tfor (let i = fromIndex; i < mainString.length; i++) {\n// \t\t\tif (localStartsWith(mainString.substring(i), searchString)) {\n// \t\t\t\tindex = i;\n// \t\t\t\tbreak;\n// \t\t\t}\n// \t\t}\n// \t}\n// \treturn index;\n// }\n//\n// function localStartsWith(mainString, compString) {\n// \tif (compString.length > mainString.length) {\n// \t\treturn false;\n// \t}\n//\n// \tlet state = true;\n// \tfor (let i = 0; i < compString.length && state === true; i++) {\n// \t\tif (!localeEquals(mainString[i], compString[i])) {\n// \t\t\tstate = false;\n// \t\t}\n// \t}\n// \treturn state;\n// }\n//\n// function localeEquals(c1, c2) {\n// \treturn c1.localeCompare(c2) === 0;\n// }\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { InlineLoading } from \"carbon-components-react\";\nimport SVG from \"react-inlinesvg\";\nimport { TIP_TYPE_PALETTE_CATEGORY } from \"../common-canvas/constants/canvas-constants.js\";\nimport { get } from \"lodash\";\nimport { AccordionItem } from \"carbon-components-react\";\nimport PaletteContentList from \"./palette-content-list.jsx\";\n\n\nclass PaletteFlyoutContentCategory extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tisOpen: false\n\t\t};\n\n\t\tthis.onMouseOver = this.onMouseOver.bind(this);\n\t\tthis.onMouseLeave = this.onMouseLeave.bind(this);\n\t\tthis.categorySelected = this.categorySelected.bind(this);\n\t}\n\n\tonMouseOver(ev) {\n\t\tthis.props.canvasController.openTip({\n\t\t\tid: \"paletteTip_\" + this.props.category.id,\n\t\t\ttype: TIP_TYPE_PALETTE_CATEGORY,\n\t\t\ttargetObj: ev.currentTarget,\n\t\t\tcategory: this.props.category\n\t\t});\n\t}\n\n\tonMouseLeave() {\n\t\tthis.props.canvasController.closeTip();\n\t}\n\n\tgetDisplayLabel() {\n\t\tif (this.props.isPaletteOpen === true) {\n\t\t\treturn this.props.category.label;\n\n\t\t// With narrow palette, if there's no image just display first 3 letters\n\t\t} else if (!this.props.category.image &&\n\t\t\t\t\t\t\t\tthis.props.category.label &&\n\t\t\t\t\t\t\t\tthis.props.category.label.length > 0) {\n\t\t\treturn this.props.category.label.substr(0, 3);\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetInlineLoadingRenderCategory() {\n\n\t\t// TODO - This loading functionality should be replaced with a skeleton\n\t\t// graphic to indicate the category is loading instead of using the\n\t\t// InlineLoading component.\n\n\t\tlet description = \"\";\n\t\tif (this.props.isPaletteOpen) {\n\t\t\tdescription = this.props.category.loading_text;\n\t\t}\n\n\t\t// We do not specify an iconDescription below because doing so overrides\n\t\t// the icon label which causes a problem with the accessibility checker.\n\t\tconst titleLoadingObj = (\n\t\t\t<div className=\"palette-flyout-category\">\n\t\t\t\t<div className=\"palette-flyout-category-item-loading\">\n\t\t\t\t\t<InlineLoading\n\t\t\t\t\t\tdescription={ description }\n\t\t\t\t\t\tonSuccess={function noRefCheck() {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tstatus=\"active\"\n\t\t\t\t\t\tsuccessDelay={1500}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\n\t\tconst content = (\n\t\t\t<AccordionItem className=\"palette-loading-category\" title={titleLoadingObj} />\n\t\t);\n\t\treturn content;\n\t}\n\n\t// Returns the category object for a regular category.\n\tgetRenderCategory() {\n\t\tconst titleObj = this.getTitleObj();\n\t\tconst content = this.getContent();\n\t\treturn (\n\t\t\t<AccordionItem title={titleObj} onHeadingClick={({ isOpen }) => this.setState({ isOpen })}>\n\t\t\t\t{content}\n\t\t\t</AccordionItem>\n\t\t);\n\t}\n\n\t// Returns the title object for the category consisting of the image and text.\n\tgetTitleObj() {\n\t\tconst itemImage = this.getItemImage();\n\t\tconst itemText = this.getItemText();\n\t\treturn (\n\t\t\t<div className=\"palette-flyout-category\"\n\t\t\t\tdata-id={get(this.props.category, \"id\", \"\")}\n\t\t\t\tonClick={this.categorySelected}\n\t\t\t\tvalue={this.props.category.label}\n\t\t\t\tonMouseOver={this.onMouseOver}\n\t\t\t\tonMouseLeave={this.onMouseLeave}\n\t\t\t>\n\t\t\t\t<div className=\"palette-flyout-category-item\">\n\t\t\t\t\t{itemImage}\n\t\t\t\t\t{itemText}\n\t\t\t\t</div></div>\n\t\t);\n\t}\n\n\t// Returns the text for the category\n\tgetItemText() {\n\t\tlet itemText = null;\n\t\tconst label = this.getDisplayLabel();\n\t\tif (this.props.isPaletteOpen === true) {\n\t\t\tconst className = this.props.category.image ? \"palette-flyout-category-text\" : \"palette-flyout-category-text-no-image\";\n\t\t\titemText = (\n\t\t\t\t<span className={className}>\n\t\t\t\t\t{label}\n\t\t\t\t</span>\n\t\t\t);\n\n\t\t// With narrow palette, if there's no image just display first 3 letters\n\t\t} else if (!this.props.category.image &&\n\t\t\t\t\t\t\t\tthis.props.category.label &&\n\t\t\t\t\t\t\t\tthis.props.category.label.length > 0) {\n\t\t\titemText = (\n\t\t\t\t<span className=\"palette-flyout-category-text-abbr\">\n\t\t\t\t\t{label}\n\t\t\t\t</span>\n\t\t\t);\n\t\t}\n\t\treturn itemText;\n\t}\n\n\t// Returns the image for the category\n\tgetItemImage() {\n\t\tlet itemImage = null;\n\t\tif (this.props.category.image && this.props.category.image !== \"\") {\n\t\t\tif (this.props.category.image.endsWith(\".svg\")) {\n\t\t\t\titemImage = (\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<SVG src={this.props.category.image} className=\"palette-flyout-category-item-icon\" draggable=\"false\" />\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\titemImage = (\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<img src={this.props.category.image} className=\"palette-flyout-category-item-icon\" draggable=\"false\" alt={this.props.category.label} />\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn itemImage;\n\t}\n\n\t// Returns the content object for the AccordionItem. This is only set to\n\t// something if the category is open (that is: isOpen is true). It is useful\n\t// to remove the nodes from the DOM when the category is closed because this\n\t// can help inline SVG icons on the canvas, that reference elements in the\n\t// <defs> element, to appear correclty.\n\tgetContent() {\n\t\tif (this.state.isOpen) {\n\t\t\tconst nodeTypeInfos = this.props.category.node_types.map((nt) => ({ nodeType: nt, category: this.props.category }));\n\t\t\treturn (\n\t\t\t\t<PaletteContentList\n\t\t\t\t\tkey={this.props.category.id + \"-nodes\"}\n\t\t\t\t\tcategory={this.props.category}\n\t\t\t\t\tnodeTypeInfos={nodeTypeInfos}\n\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\tisPaletteOpen={this.props.isPaletteOpen}\n\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t\treturn null;\n\t}\n\n\tcategorySelected() {\n\t\tthis.props.categorySelectedMethod(this.props.category.id);\n\t}\n\n\trender() {\n\t\treturn this.props.category.loading_text\n\t\t\t? this.getInlineLoadingRenderCategory()\n\t\t\t: this.getRenderCategory();\n\t}\n}\n\nPaletteFlyoutContentCategory.propTypes = {\n\tcategory: PropTypes.object.isRequired,\n\tcategorySelectedMethod: PropTypes.func.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tisPaletteOpen: PropTypes.bool.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired,\n};\n\nexport default PaletteFlyoutContentCategory;\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport PropTypes from \"prop-types\";\nimport defaultMessages from \"../../locales/palette/locales/en.json\";\nimport { Search } from \"carbon-components-react\";\n\nclass PaletteFlyoutContentSearch extends React.Component {\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = {\n\t\t\tsearchString: \"\"\n\t\t};\n\t\tthis.searchOnClick = this.searchOnClick.bind(this);\n\t\tthis.handleSearchStringChange = this.handleSearchStringChange.bind(this);\n\t}\n\n\thandleSearchStringChange(evt) {\n\t\tconst value = evt.target.value || \"\";\n\t\tthis.setState({ searchString: value },\n\t\t\t() => this.props.handleSearchStringChange(value)\n\t\t);\n\t}\n\n\tsearchOnClick() {\n\t\tif (!this.props.isPaletteOpen) {\n\t\t\tthis.props.canvasController.openPalette();\n\t\t}\n\t}\n\n\trender() {\n\t\tconst placeHolder = this.props.intl.formatMessage({ id: \"palette.flyout.search.placeholder\", defaultMessage: defaultMessages[\"palette.flyout.search.placeholder\"] });\n\n\t\treturn (\n\t\t\t// palette-flyout-search id added for hopscotch tours\n\t\t\t<div className=\"palette-flyout-search-container\" id=\"palette-flyout-search\">\n\t\t\t\t<Search\n\t\t\t\t\tkey=\"palette-flyout-search\"\n\t\t\t\t\tclassName=\"palette-flyout-search\"\n\t\t\t\t\tplaceholder={placeHolder}\n\t\t\t\t\tonChange={this.handleSearchStringChange}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvalue={this.state.searchString}\n\t\t\t\t\tlabelText={placeHolder}\n\t\t\t\t\tonClick={this.searchOnClick}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteFlyoutContentSearch.propTypes = {\n\tintl: PropTypes.object.isRequired,\n\thandleSearchStringChange: PropTypes.func.isRequired,\n\tisPaletteOpen: PropTypes.bool.isRequired,\n\tcanvasController: PropTypes.object.isRequired\n};\n\nexport default injectIntl(PaletteFlyoutContentSearch);\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { injectIntl } from \"react-intl\";\nimport defaultMessages from \"../../locales/palette/locales/en.json\";\nimport PaletteContentListItem from \"./palette-content-list-item.jsx\";\n\nclass PaletteFlyoutContentFilteredList extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t};\n\t}\n\n\tgetNoResultsDiv() {\n\t\tconst noResultsFound = this.props.intl.formatMessage({ id: \"palette.flyout.search.noresults\", defaultMessage: defaultMessages[\"palette.flyout.search.noresults\"] });\n\t\tconst adjustSearch = this.props.intl.formatMessage({ id: \"palette.flyout.search.adjustsearch\", defaultMessage: defaultMessages[\"palette.flyout.search.adjustsearch\"] });\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<div className=\"palette-no-results-title\">{noResultsFound}</div>\n\t\t\t\t<br />\n\t\t\t\t<div className=\"palette-no-results-desc\">{adjustSearch}</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tgetContentListDiv() {\n\t\tconst contentItems = [];\n\n\t\tfor (var idx = 0; idx < this.props.nodeTypeInfos.length; idx++) {\n\t\t\tvar itemKey = \"item_\" + idx;\n\n\t\t\tcontentItems.push(\n\t\t\t\t<div key={itemKey}>\n\t\t\t\t\t<PaletteContentListItem\n\t\t\t\t\t\tnodeTypeInfo={this.props.nodeTypeInfos[idx]}\n\t\t\t\t\t\tisDisplaySearchResult\n\t\t\t\t\t\tisShowRanking={this.props.isShowRanking}\n\t\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\t\tisPaletteOpen={this.props.isPaletteOpen}\n\t\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tif (this.props.isNodeTypeInfosArrayTruncated) {\n\t\t\tconst resultsRestricted =\n\t\t\t\tthis.props.intl.formatMessage({ id: \"palette.flyout.search.resultsrestricted\", defaultMessage: defaultMessages[\"palette.flyout.search.resultsrestricted\"] });\n\t\t\tcontentItems.push(\n\t\t\t\t<div key=\"restrict-item\" className=\"palette-flyout-restrict-item\">{resultsRestricted}</div>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<div width=\"100%\" draggable=\"false\" className=\"palette-scroll\">\n\t\t\t\t{contentItems}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trender() {\n\t\treturn this.props.nodeTypeInfos.length === 0\n\t\t\t? this.getNoResultsDiv()\n\t\t\t: this.getContentListDiv();\n\t}\n}\n\nPaletteFlyoutContentFilteredList.propTypes = {\n\tintl: PropTypes.object.isRequired,\n\tnodeTypeInfos: PropTypes.array.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tisPaletteOpen: PropTypes.bool.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired,\n\tisNodeTypeInfosArrayTruncated: PropTypes.bool,\n\tisShowRanking: PropTypes.bool\n};\n\nexport default injectIntl(PaletteFlyoutContentFilteredList);\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { debounce } from \"lodash\";\nimport { getFilteredNodeTypeInfos } from \"./palette-flyout-utils.js\";\nimport PaletteFlyoutContentCategory from \"./palette-flyout-content-category.jsx\";\nimport PaletteFlyoutContentSearch from \"./palette-flyout-content-search.jsx\";\nimport PaletteFlyoutContentFilteredList from \"./palette-flyout-content-filtered-list.jsx\";\nimport Logger from \"../logging/canvas-logger.js\";\nimport { Accordion } from \"carbon-components-react\";\n\n\nconst logger = new Logger(\"PaletteFlyoutContent\");\n\nclass PaletteFlyoutContent extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\t// Note: searchString below is a copy of searchString in\n\t\t// palette-flyout-content-search this duplication is necessaery to allow\n\t\t// the debounce function to work. When a key is pressed, the searchString in\n\t\t// palette-flyout-content-search is updated causing its text to be rendered.\n\t\t// The handleSearchStringChange() in this class is then called that handles\n\t\t// debounce and after the debounce unwinds it sets searchString in this\n\t\t// class which causes the filtered result set to be calculated and displayed.\n\t\tthis.state = {\n\t\t\tselectedCategoryIds: [],\n\t\t\tsearchString: \"\"\n\t\t};\n\n\t\tthis.categories = [];\n\n\t\tthis.categorySelected = this.categorySelected.bind(this);\n\t\tthis.getUniqueCategories = this.getUniqueCategories.bind(this);\n\t\tthis.setSearchString = this.setSearchString.bind(this);\n\t\tthis.handleSearchStringChange = this.handleSearchStringChange.bind(this);\n\t\tthis.setSearchStringThrottled = debounce(this.setSearchString, 200);\n\t}\n\n\t/*\n\t* Returns a unique set of categories in case category labels\n\t* are duplicated in the categories list.\n\t*/\n\tgetUniqueCategories(categories) {\n\t\tvar out = [];\n\t\tif (categories) {\n\t\t\tfor (const category of categories) {\n\t\t\t\tif (out.indexOf(category.label) === -1) {\n\t\t\t\t\tout.push(category);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn out;\n\t}\n\n\tgetContentDivs(categories) {\n\t\tconst contentDivs = [];\n\t\tfor (let idx = 0; idx < categories.length; idx++) {\n\t\t\tconst category = categories[idx];\n\t\t\tcontentDivs.push(\n\t\t\t\t<div key={category.label + \"-container\"}>\n\t\t\t\t\t<PaletteFlyoutContentCategory\n\t\t\t\t\t\tkey={category.id}\n\t\t\t\t\t\tcategory={category}\n\t\t\t\t\t\tcategorySelectedMethod={this.categorySelected}\n\t\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\t\tisPaletteOpen={this.props.isPaletteOpen}\n\t\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t\treturn <Accordion>{contentDivs}</Accordion>;\n\t}\n\n\tgetFilteredContentDivs(categories) {\n\t\tlogger.logStartTimer(\"getFilteredNodeTypeInfos\");\n\t\tlet filteredNodeTypeInfos = getFilteredNodeTypeInfos(this.categories, this.state.searchString);\n\t\tlogger.logEndTimer(\"getFilteredNodeTypeInfos\");\n\n\t\tlet isNodeTypeInfosArrayTruncated = false;\n\n\t\tif (filteredNodeTypeInfos.length > 10) {\n\t\t\tfilteredNodeTypeInfos = filteredNodeTypeInfos.slice(0, 10);\n\t\t\tisNodeTypeInfosArrayTruncated = true;\n\t\t}\n\n\t\tconst content = (\n\t\t\t<PaletteFlyoutContentFilteredList\n\t\t\t\tkey={\"filtered-nodes\"}\n\t\t\t\tnodeTypeInfos={filteredNodeTypeInfos}\n\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\tisPaletteOpen={this.props.isPaletteOpen}\n\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t// isShowRanking // Uncomment this to show ranking for debuggig ranking algorithm\n\t\t\t\tisNodeTypeInfosArrayTruncated={isNodeTypeInfosArrayTruncated}\n\t\t\t/>);\n\n\t\treturn [content];\n\t}\n\n\tsetSearchString() {\n\t\tthis.setState({ searchString: this.ss });\n\t}\n\n\thandleSearchStringChange(s) {\n\t\tthis.ss = s;\n\t\tthis.setSearchStringThrottled();\n\t}\n\n\tcategorySelected(catSelId) {\n\t\tconst selCatIds = this.isCategorySelected(catSelId)\n\t\t\t? this.state.selectedCategoryIds.filter((catId) => catId !== catSelId)\n\t\t\t: this.state.selectedCategoryIds.concat(catSelId);\n\n\t\tthis.setState({ selectedCategoryIds: selCatIds });\n\t}\n\n\tisCategorySelected(categoryId) {\n\t\treturn this.state.selectedCategoryIds.some((cId) => cId === categoryId);\n\t}\n\n\trender() {\n\t\tthis.categories = this.getUniqueCategories(this.props.paletteJSON.categories);\n\t\tconst contentDivs = this.props.isPaletteOpen && this.state.searchString\n\t\t\t? this.getFilteredContentDivs(this.categories)\n\t\t\t: this.getContentDivs(this.categories);\n\n\t\tconst contentCategories = (\n\t\t\t<div className=\"palette-flyout-categories\">\n\t\t\t\t{contentDivs}\n\t\t\t</div>\n\t\t);\n\n\t\tconst contentSearch = (\n\t\t\t<PaletteFlyoutContentSearch\n\t\t\t\thandleSearchStringChange={this.handleSearchStringChange}\n\t\t\t\tisPaletteOpen={this.props.isPaletteOpen}\n\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t/>\n\t\t);\n\n\t\treturn (\n\t\t\t<div className=\"palette-flyout-content\">\n\t\t\t\t{contentSearch}\n\t\t\t\t{contentCategories}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nPaletteFlyoutContent.propTypes = {\n\tpaletteJSON: PropTypes.object.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tisPaletteOpen: PropTypes.bool.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired\n};\n\nexport default PaletteFlyoutContent;\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport PropTypes from \"prop-types\";\nimport defaultMessages from \"../../locales/palette/locales/en.json\";\nimport PaletteFlyoutContent from \"./palette-flyout-content.jsx\";\n\nclass PaletteFlyout extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.paletteNodes = [];\n\t}\n\n\trender() {\n\t\tlet className = \"palette-flyout-div\";\n\n\t\tif (this.props.showPalette) {\n\t\t\tclassName += \" palette-flyout-div-open\";\n\t\t} else {\n\t\t\tclassName += \" palette-flyout-div-closed\";\n\t\t\tif (this.props.enableNarrowPalette) {\n\t\t\t\tclassName += \" palette-flyout-div-narrow\";\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t<nav aria-label={this.props.intl.formatMessage({ id: \"palette.flyout.label\", defaultMessage: defaultMessages[\"palette.flyout.label\"] })} role=\"navigation\">\n\t\t\t\t<div className={className}>\n\t\t\t\t\t<PaletteFlyoutContent\n\t\t\t\t\t\tpaletteJSON={this.props.paletteJSON}\n\t\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t\t\tisPaletteOpen={this.props.showPalette}\n\t\t\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</nav>\n\t\t);\n\t}\n}\n\nPaletteFlyout.propTypes = {\n\tintl: PropTypes.object.isRequired,\n\tpaletteJSON: PropTypes.object.isRequired,\n\tshowPalette: PropTypes.bool.isRequired,\n\tenableNarrowPalette: PropTypes.bool.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tisEditingEnabled: PropTypes.bool.isRequired\n};\n\nexport default injectIntl(PaletteFlyout);\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { connect } from \"react-redux\";\n\nimport PaletteDialog from \"../palette/palette-dialog.jsx\";\nimport PaletteFlyout from \"../palette/palette-flyout.jsx\";\nimport Logger from \"../logging/canvas-logger.js\";\n\nimport { PALETTE_LAYOUT_FLYOUT, PALETTE_LAYOUT_MODAL }\n\tfrom \"../common-canvas/constants/canvas-constants\";\n\nclass Palette extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.logger = new Logger(\"Palette\");\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tlet palette = null;\n\n\t\tif (this.props.enablePaletteLayout === PALETTE_LAYOUT_FLYOUT) {\n\t\t\tpalette = (<PaletteFlyout\n\t\t\t\tenableNarrowPalette={this.props.enableNarrowPalette}\n\t\t\t\tpaletteJSON={this.props.paletteJSON}\n\t\t\t\tshowPalette={this.props.showPalette}\n\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t/>);\n\t\t} else if (this.props.enablePaletteLayout === PALETTE_LAYOUT_MODAL) {\n\t\t\tpalette = (<PaletteDialog\n\t\t\t\tpaletteJSON={this.props.paletteJSON}\n\t\t\t\tshowPalette={this.props.showPalette}\n\t\t\t\tparentDivId={this.props.containingDivId}\n\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\tisEditingEnabled={this.props.isEditingEnabled}\n\t\t\t/>);\n\t\t}\n\n\t\treturn palette;\n\t}\n}\n\nPalette.propTypes = {\n\t// Provided by common-canvas\n\tcanvasController: PropTypes.object.isRequired,\n\tcontainingDivId: PropTypes.string.isRequired,\n\n\t// Provided by redux\n\tenablePaletteLayout: PropTypes.string,\n\tenableNarrowPalette: PropTypes.bool,\n\tpaletteJSON: PropTypes.object,\n\tshowPalette: PropTypes.bool,\n\tisEditingEnabled: PropTypes.bool\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tenablePaletteLayout: state.canvasconfig.enablePaletteLayout,\n\tenableNarrowPalette: state.canvasconfig.enableNarrowPalette,\n\tisEditingEnabled: state.canvasconfig.enableEditingActions,\n\tpaletteJSON: state.palette.content,\n\t// TODO - No need to do this when paletteInitialState is removed\n\tshowPalette: typeof state.palette.isOpen === \"undefined\" ? false : state.palette.isOpen\n});\n\nexport default connect(mapStateToProps)(Palette);\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport Tooltip from \"../tooltip/tooltip.jsx\";\nimport Icon from \"../icons/icon.jsx\";\nimport { isEmpty } from \"lodash\";\nimport { TIP_TYPE_PALETTE_ITEM, TIP_TYPE_PALETTE_CATEGORY, TIP_TYPE_DEC,\n\tTIP_TYPE_NODE, TIP_TYPE_PORT, TIP_TYPE_LINK, TIP_TYPE_STATE_TAG,\n\tERROR, WARNING } from \"../common-canvas/constants/canvas-constants.js\";\n\nclass CommonCanvasTooltip extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {};\n\n\t\tthis.handleClick = this.handleClick.bind(this);\n\t}\n\n\tcomponentDidMount() {\n\t\tdocument.addEventListener(\"mousedown\", this.handleClick, true);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tdocument.removeEventListener(\"mousedown\", this.handleClick, true);\n\t}\n\n\thandleClick(e) {\n\t\tthis.props.canvasController.closeTip();\n\t}\n\n\trender() {\n\t\tlet content = null;\n\t\tlet direction = null;\n\t\tswitch (this.props.type) {\n\t\tcase TIP_TYPE_PALETTE_ITEM:\n\t\tcase TIP_TYPE_PALETTE_CATEGORY:\n\t\t\tdirection = \"right\";\n\t\t\tbreak;\n\t\tcase TIP_TYPE_NODE:\n\t\tcase TIP_TYPE_PORT:\n\t\tcase TIP_TYPE_DEC:\n\t\tcase TIP_TYPE_LINK:\n\t\tcase TIP_TYPE_STATE_TAG:\n\t\tdefault:\n\t\t\tdirection = \"bottom\";\n\t\t}\n\n\t\tif (this.props.customContent) {\n\t\t\tcontent = this.props.customContent;\n\t\t} else {\n\t\t\tswitch (this.props.type) {\n\t\t\tcase TIP_TYPE_PALETTE_ITEM:\n\t\t\t\tcontent = (\n\t\t\t\t\t<div className=\"tip-palette-item\">\n\t\t\t\t\t\t<div className=\"tip-palette-category\">{this.props.category.label}</div>\n\t\t\t\t\t\t<div className=\"tip-palette-label\">{this.props.nodeTemplate.app_data.ui_data.label}</div>\n\t\t\t\t\t\t{this.props.nodeTemplate.app_data.ui_data.description\n\t\t\t\t\t\t\t? (<div className=\"tip-palette-desc\">{this.props.nodeTemplate.app_data.ui_data.description}</div>)\n\t\t\t\t\t\t\t: (\"\")\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase TIP_TYPE_PALETTE_CATEGORY:\n\t\t\t\tcontent = (\n\t\t\t\t\t<div className=\"tip-palette-item\">\n\t\t\t\t\t\t<div className=\"tip-palette-label\">{this.props.category.label}</div>\n\t\t\t\t\t\t{this.props.category.description\n\t\t\t\t\t\t\t? (<div className=\"tip-palette-desc\">{this.props.category.description}</div>)\n\t\t\t\t\t\t\t: (\"\")\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase TIP_TYPE_NODE:\n\t\t\t\t{\n\t\t\t\t\tlet icon = null;\n\t\t\t\t\tif (this.props.canvasController.getObjectModel().hasErrorMessage(this.props.node)) {\n\t\t\t\t\t\ticon = (<Icon type={ERROR} className=\"tip-node-status error\" />);\n\t\t\t\t\t} else if (this.props.canvasController.getObjectModel().hasWarningMessage(this.props.node)) {\n\t\t\t\t\t\ticon = (<Icon type={WARNING} className=\"tip-node-status warning\" />);\n\t\t\t\t\t}\n\t\t\t\t\tconst nodeType = this.props.canvasController.getObjectModel().getPaletteNode(this.props.node.op);\n\t\t\t\t\tlet nodeLabel = this.props.node.label;\n\t\t\t\t\tconst nodeTypeLabel = nodeType && nodeType.app_data && nodeType.app_data.ui_data ? nodeType.app_data.ui_data.label : nodeLabel;\n\t\t\t\t\tif (nodeLabel !== nodeTypeLabel) {\n\t\t\t\t\t\tnodeLabel += ` (${nodeTypeLabel})`;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If there's nothing to display just give up. This will prevent us\n\t\t\t\t\t// displaying an empty tooltip.\n\t\t\t\t\tif (!icon && !nodeLabel && !nodeTypeLabel && !this.props.node.description) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontent = (\n\t\t\t\t\t\t<div className=\"tip-node\">\n\t\t\t\t\t\t\t{icon}\n\t\t\t\t\t\t\t<div className=\"tip-node-label\">{nodeLabel}</div>\n\t\t\t\t\t\t\t{this.props.node.description\n\t\t\t\t\t\t\t\t? (<div className=\"tip-node-desc\">{this.props.node.description}</div>)\n\t\t\t\t\t\t\t\t: (\"\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase TIP_TYPE_PORT:\n\t\t\t\tcontent = isEmpty(this.props.port.label) ? null : (\n\t\t\t\t\t<div className=\"tip-port\">{this.props.port.label}</div>\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase TIP_TYPE_DEC:\n\t\t\t\tcontent = isEmpty(this.props.decoration.tooltip) ? null : (\n\t\t\t\t\t<div className=\"tip-decoration\">{this.props.decoration.tooltip}</div>\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase TIP_TYPE_LINK:\n\t\t\t\tbreak;\n\n\t\t\tcase TIP_TYPE_STATE_TAG:\n\t\t\t\tcontent = isEmpty(this.props.stateTagText) ? null : (\n\t\t\t\t\t<div className=\"tip-state-tag\">{this.props.stateTagText}</div>\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tcontent = null;\n\t\t\t}\n\t\t}\n\n\t\treturn (content !== null) ? (<Tooltip\n\t\t\ttip={content}\n\t\t\tdirection={direction}\n\t\t\tid={this.props.id}\n\t\t\ttargetObj={this.props.targetObj}\n\t\t\tmousePos={this.props.mousePos}\n\t\t\tclassName={[TIP_TYPE_NODE, TIP_TYPE_PORT, TIP_TYPE_DEC, TIP_TYPE_LINK].includes(this.props.type) ? \"definition-tooltip\" : null}\n\t\t/>) : null;\n\t}\n}\n\nCommonCanvasTooltip.propTypes = {\n\t// canvasController provided by common-canvas.jsx\n\tcanvasController: PropTypes.object.isRequired,\n\t// The rest provided by redux\n\tid: PropTypes.string,\n\ttype: PropTypes.oneOf([TIP_TYPE_PALETTE_CATEGORY, TIP_TYPE_PALETTE_ITEM, TIP_TYPE_NODE, TIP_TYPE_PORT, TIP_TYPE_DEC, TIP_TYPE_LINK, TIP_TYPE_STATE_TAG]),\n\ttargetObj: PropTypes.object,\n\tmousePos: PropTypes.object,\n\tcustomContent: PropTypes.oneOfType([PropTypes.string, PropTypes.element]),\n\tnode: PropTypes.object,\n\tport: PropTypes.object,\n\tdecoration: PropTypes.object,\n\tnodeTemplate: PropTypes.object,\n\tcategory: PropTypes.object,\n\tstateTagText: PropTypes.string\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tid: state.tooltip.id,\n\ttype: state.tooltip.type,\n\ttargetObj: state.tooltip.targetObj,\n\tmousePos: state.tooltip.mousePos,\n\tcustomContent: state.tooltip.customContent,\n\tnode: state.tooltip.node,\n\tport: state.tooltip.port,\n\tdecoration: state.tooltip.decoration,\n\tnodeTemplate: state.tooltip.nodeTemplate,\n\tcategory: state.tooltip.category,\n\tstateTagText: state.tooltip.stateTagText\n});\n\nexport default connect(mapStateToProps)(CommonCanvasTooltip);\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { connect } from \"react-redux\";\nimport { isEmpty } from \"lodash\";\nimport ContextMenuWrapper from \"../context-menu/context-menu-wrapper.jsx\";\nimport Logger from \"../logging/canvas-logger.js\";\n\nclass CommonCanvasContextMenu extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.logger = new Logger(\"CC-ContextMenu\");\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tlet contextMenu = null;\n\t\tif (!isEmpty(this.props.contextMenuDef)) {\n\t\t\tcontextMenu = (\n\t\t\t\t<ContextMenuWrapper\n\t\t\t\t\tcontainingDivId={this.props.containingDivId}\n\t\t\t\t\tcontextMenuDef={this.props.contextMenuDef}\n\t\t\t\t\tcontextMenuActionHandler={this.props.canvasController.contextMenuActionHandler}\n\t\t\t\t\tcontextMenuPos={this.props.canvasController.getContextMenuPos()}\n\t\t\t\t\tcloseContextMenu={this.props.canvasController.closeContextMenu}\n\t\t\t\t\tstopPropagation\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t\treturn contextMenu;\n\t}\n}\n\nCommonCanvasContextMenu.propTypes = {\n\t// Provided by CommonCanvas\n\tcanvasController: PropTypes.object.isRequired,\n\tcontainingDivId: PropTypes.string.isRequired,\n\n\t// Provided by redux\n\tcontextMenuDef: PropTypes.array.isRequired\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tcontextMenuDef: state.contextmenu.menuDef\n});\n\nexport default connect(mapStateToProps)(CommonCanvasContextMenu);\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport defaultMessages from \"../../locales/common-canvas/locales/en.json\";\nimport defaultToolbarMessages from \"../../locales/toolbar/locales/en.json\";\nimport Toolbar from \"../toolbar/toolbar.jsx\";\nimport CanvasUtils from \"../common-canvas/common-canvas-utils.js\";\nimport Logger from \"../logging/canvas-logger.js\";\nimport { OverflowMenu, OverflowMenuItem } from \"carbon-components-react\";\nimport { Code32, Link32, ListBulleted32, ListNumbered32, TextIndentMore32,\n\tTextBold32, TextItalic32, TextScale32, TextStrikethrough32 } from \"@carbon/icons-react\";\n\nclass CommonCanvasTextToolbar extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.getLabel = this.getLabel.bind(this);\n\t\tthis.logger = new Logger(\"CC-Toolbar\");\n\t}\n\n\tgetLabel(labelId, substituteObj) {\n\t\tconst defaultMessage = defaultMessages[labelId] ? defaultMessages[labelId] : defaultToolbarMessages[labelId];\n\t\treturn this.props.intl.formatMessage({ id: labelId, defaultMessage: defaultMessage }, substituteObj);\n\t}\n\n\tgetJsxLabel(key, shortcutSuffix, shortcutSuffix2) {\n\t\tconst osKey = CanvasUtils.isMacintosh() ? \"⌘\" : \"Ctrl\";\n\t\tconst shortCut = shortcutSuffix ? (osKey + \" + \" + shortcutSuffix) : null;\n\t\tconst shortCut2 = shortcutSuffix2 ? (osKey + \" + \" + shortcutSuffix2) : null;\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t{this.getLabel(key)}<br />{shortCut}<br />{shortCut2}\n\t\t\t</div>\n\t\t);\n\t}\n\n\tgetTextToolbar() {\n\t\tconst headerLabel = this.getJsxLabel(\"texttoolbar.headerAction\", \">\", \"<\");\n\t\tconst boldLabel = this.getJsxLabel(\"texttoolbar.boldAction\", \"b\");\n\t\tconst italicsLabel = this.getJsxLabel(\"texttoolbar.italicsAction\", \"i\");\n\t\tconst strikethroughLabel = this.getJsxLabel(\"texttoolbar.strikethroughAction\", \"shift + x\");\n\t\tconst codeLabel = this.getJsxLabel(\"texttoolbar.codeAction\", \"e\");\n\t\tconst linkLabel = this.getJsxLabel(\"texttoolbar.linkAction\", \"k\");\n\t\tconst quoteLabel = this.getJsxLabel(\"texttoolbar.quoteAction\", \"shift + >\");\n\t\tconst numberedListLabel = this.getJsxLabel(\"texttoolbar.numberedListAction\", \"shift + 7\");\n\t\tconst bulletedListLabel = this.getJsxLabel(\"texttoolbar.bulletedListAction\", \"shift + 8\");\n\t\tconst headerOptions = (\n\t\t\t<div>\n\t\t\t\t<OverflowMenu id={\"headerMenu\"} iconDescription={\"\"} renderIcon={TextScale32} >\n\t\t\t\t\t<OverflowMenuItem itemText={this.getLabel(\"texttoolbar.titleAction\")} onClick={(evt) => this.props.actionHandler(\"title\", evt)} />\n\t\t\t\t\t<OverflowMenuItem itemText={this.getLabel(\"texttoolbar.headerAction\")} onClick={(evt) => this.props.actionHandler(\"header\", evt)} />\n\t\t\t\t\t<OverflowMenuItem itemText={this.getLabel(\"texttoolbar.subheaderAction\")} onClick={(evt) => this.props.actionHandler(\"subheader\", evt)} />\n\t\t\t\t\t<OverflowMenuItem itemText={this.getLabel(\"texttoolbar.bodyAction\")} onClick={(evt) => this.props.actionHandler(\"body\", evt)} />\n\t\t\t\t</OverflowMenu>\n\t\t\t\t<svg className=\"text-toolbar-tick-svg\">\n\t\t\t\t\t<path d=\"M 39 39 L 39 33 33 39 Z\" className=\"text-toolbar-tick-mark\" />\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t);\n\n\t\treturn {\n\t\t\tleftBar: [\n\t\t\t\t{ action: \"header\", tooltip: headerLabel, jsx: headerOptions },\n\t\t\t\t{ divider: true },\n\t\t\t\t{ action: \"bold\", label: boldLabel, enable: true, iconEnabled: (<TextBold32 />) },\n\t\t\t\t{ action: \"italics\", label: italicsLabel, enable: true, iconEnabled: (<TextItalic32 />) },\n\t\t\t\t{ action: \"strikethrough\", label: strikethroughLabel, enable: true, iconEnabled: (<TextStrikethrough32 />) },\n\t\t\t\t{ divider: true },\n\t\t\t\t{ action: \"code\", label: codeLabel, enable: true, iconEnabled: (<Code32 />) },\n\t\t\t\t{ divider: true },\n\t\t\t\t{ action: \"link\", label: linkLabel, enable: true, iconEnabled: (<Link32 />) },\n\t\t\t\t{ divider: true },\n\t\t\t\t{ action: \"quote\", label: quoteLabel, enable: true, iconEnabled: (<TextIndentMore32 />) },\n\t\t\t\t{ divider: true },\n\t\t\t\t{ action: \"numberedList\", label: numberedListLabel, enable: true, iconEnabled: (<ListNumbered32 />) },\n\t\t\t\t{ action: \"bulletedList\", label: bulletedListLabel, enable: true, iconEnabled: (<ListBulleted32 />) }\n\t\t\t]\n\t\t};\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tlet textToolbar = null;\n\n\t\tif (this.props.isOpen) {\n\t\t\ttextToolbar = (\n\t\t\t\t<div className={\"text-toolbar\"} style={{ left: this.props.pos_x, top: this.props.pos_y }} onBlur={this.props.blurHandler}>\n\t\t\t\t\t<Toolbar\n\t\t\t\t\t\tconfig={this.getTextToolbar()}\n\t\t\t\t\t\tinstanceId={this.props.canvasController.getInstanceId()}\n\t\t\t\t\t\ttoolbarActionHandler={this.props.actionHandler}\n\t\t\t\t\t\ttooltipDirection={\"top\"}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\treturn textToolbar;\n\t}\n}\n\nCommonCanvasTextToolbar.propTypes = {\n\t// Provided by CommonCanvas\n\tintl: PropTypes.object.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\n\t// Provided by redux\n\tisOpen: PropTypes.bool.isRequired,\n\tpos_x: PropTypes.number,\n\tpos_y: PropTypes.number,\n\tactionHandler: PropTypes.func,\n\tblurHandler: PropTypes.func\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tisOpen: state.texttoolbar.isOpen,\n\tpos_x: state.texttoolbar.pos_x,\n\tpos_y: state.texttoolbar.pos_y,\n\tactionHandler: state.texttoolbar.actionHandler,\n\tblurHandler: state.texttoolbar.blurHandler\n});\n\nexport default connect(mapStateToProps)(injectIntl(CommonCanvasTextToolbar));\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport Logger from \"../logging/canvas-logger.js\";\nimport defaultMessages from \"../../locales/common-canvas/locales/en.json\";\nimport { injectIntl } from \"react-intl\";\nimport { Locked16, EditOff16 } from \"@carbon/icons-react\";\nimport { STATE_TAG_LOCKED, STATE_TAG_READ_ONLY, TIP_TYPE_STATE_TAG }\n\tfrom \"../common-canvas/constants/canvas-constants.js\";\n\nclass CommonCanvasStateTag extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.logger = new Logger(\"CC-StateTag\");\n\n\t\tthis.onMouseOver = this.onMouseOver.bind(this);\n\t\tthis.onMouseLeave = this.onMouseLeave.bind(this);\n\t}\n\n\tonMouseOver(ev) {\n\t\tlet tipText;\n\n\t\tif (this.props.stateTagType === STATE_TAG_LOCKED) {\n\t\t\ttipText = this.getLabel(\"canvas.stateTagTipLocked\");\n\n\t\t} else if (this.props.stateTagType === STATE_TAG_READ_ONLY) {\n\t\t\ttipText = this.getLabel(\"canvas.stateTagTipReadOnly\");\n\t\t}\n\n\t\tthis.props.canvasController.openTip({\n\t\t\tid: \"stateTagTip\",\n\t\t\ttype: TIP_TYPE_STATE_TAG,\n\t\t\tstateTagType: this.props.stateTagType,\n\t\t\tstateTagText: tipText,\n\t\t\ttargetObj: ev.currentTarget\n\t\t});\n\t}\n\n\tonMouseLeave() {\n\t\tthis.props.canvasController.closeTip();\n\t}\n\n\tgetLabel(labelId) {\n\t\treturn this.props.intl.formatMessage({ id: labelId, defaultMessage: defaultMessages[labelId] });\n\t}\n\n\tgetStateTag(label, icon) {\n\t\treturn (\n\t\t\t<div className={\"state-tag\"}\n\t\t\t\tonMouseOver={this.onMouseOver}\n\t\t\t\tonMouseLeave={this.onMouseLeave}\n\t\t\t>\n\t\t\t\t{icon}\n\t\t\t\t<span>{label}</span>\n\t\t\t</div>\n\t\t);\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tlet stateTag = null;\n\n\t\tif (this.props.stateTagType === STATE_TAG_LOCKED) {\n\t\t\tconst label = this.getLabel(\"canvas.stateTagLocked\");\n\t\t\tstateTag = this.getStateTag(label, (<Locked16 />));\n\n\t\t} else if (this.props.stateTagType === STATE_TAG_READ_ONLY) {\n\t\t\tconst label = this.getLabel(\"canvas.stateTagReadOnly\");\n\t\t\tstateTag = this.getStateTag(label, (<EditOff16 />));\n\t\t}\n\n\t\treturn stateTag;\n\t}\n}\n\nCommonCanvasStateTag.propTypes = {\n\t// Provided by CommonCanvas\n\tintl: PropTypes.object.isRequired,\n\tstateTagType: PropTypes.string,\n\tcanvasController: PropTypes.object\n};\n\nexport default injectIntl(CommonCanvasStateTag);\n","export var xhtml = \"http://www.w3.org/1999/xhtml\";\n\nexport default {\n  svg: \"http://www.w3.org/2000/svg\",\n  xhtml: xhtml,\n  xlink: \"http://www.w3.org/1999/xlink\",\n  xml: \"http://www.w3.org/XML/1998/namespace\",\n  xmlns: \"http://www.w3.org/2000/xmlns/\"\n};\n","import namespaces from \"./namespaces.js\";\n\nexport default function(name) {\n  var prefix = name += \"\", i = prefix.indexOf(\":\");\n  if (i >= 0 && (prefix = name.slice(0, i)) !== \"xmlns\") name = name.slice(i + 1);\n  return namespaces.hasOwnProperty(prefix) ? {space: namespaces[prefix], local: name} : name; // eslint-disable-line no-prototype-builtins\n}\n","import namespace from \"./namespace.js\";\nimport {xhtml} from \"./namespaces.js\";\n\nfunction creatorInherit(name) {\n  return function() {\n    var document = this.ownerDocument,\n        uri = this.namespaceURI;\n    return uri === xhtml && document.documentElement.namespaceURI === xhtml\n        ? document.createElement(name)\n        : document.createElementNS(uri, name);\n  };\n}\n\nfunction creatorFixed(fullname) {\n  return function() {\n    return this.ownerDocument.createElementNS(fullname.space, fullname.local);\n  };\n}\n\nexport default function(name) {\n  var fullname = namespace(name);\n  return (fullname.local\n      ? creatorFixed\n      : creatorInherit)(fullname);\n}\n","function none() {}\n\nexport default function(selector) {\n  return selector == null ? none : function() {\n    return this.querySelector(selector);\n  };\n}\n","// Given something array like (or null), returns something that is strictly an\n// array. This is used to ensure that array-like objects passed to d3.selectAll\n// or selection.selectAll are converted into proper arrays when creating a\n// selection; we don’t ever want to create a selection backed by a live\n// HTMLCollection or NodeList. However, note that selection.selectAll will use a\n// static NodeList as a group, since it safely derived from querySelectorAll.\nexport default function array(x) {\n  return x == null ? [] : Array.isArray(x) ? x : Array.from(x);\n}\n","function empty() {\n  return [];\n}\n\nexport default function(selector) {\n  return selector == null ? empty : function() {\n    return this.querySelectorAll(selector);\n  };\n}\n","export default function(selector) {\n  return function() {\n    return this.matches(selector);\n  };\n}\n\nexport function childMatcher(selector) {\n  return function(node) {\n    return node.matches(selector);\n  };\n}\n\n","import {childMatcher} from \"../matcher.js\";\n\nvar find = Array.prototype.find;\n\nfunction childFind(match) {\n  return function() {\n    return find.call(this.children, match);\n  };\n}\n\nfunction childFirst() {\n  return this.firstElementChild;\n}\n\nexport default function(match) {\n  return this.select(match == null ? childFirst\n      : childFind(typeof match === \"function\" ? match : childMatcher(match)));\n}\n","import {childMatcher} from \"../matcher.js\";\n\nvar filter = Array.prototype.filter;\n\nfunction children() {\n  return Array.from(this.children);\n}\n\nfunction childrenFilter(match) {\n  return function() {\n    return filter.call(this.children, match);\n  };\n}\n\nexport default function(match) {\n  return this.selectAll(match == null ? children\n      : childrenFilter(typeof match === \"function\" ? match : childMatcher(match)));\n}\n","export default function(update) {\n  return new Array(update.length);\n}\n","import sparse from \"./sparse.js\";\nimport {Selection} from \"./index.js\";\n\nexport default function() {\n  return new Selection(this._enter || this._groups.map(sparse), this._parents);\n}\n\nexport function EnterNode(parent, datum) {\n  this.ownerDocument = parent.ownerDocument;\n  this.namespaceURI = parent.namespaceURI;\n  this._next = null;\n  this._parent = parent;\n  this.__data__ = datum;\n}\n\nEnterNode.prototype = {\n  constructor: EnterNode,\n  appendChild: function(child) { return this._parent.insertBefore(child, this._next); },\n  insertBefore: function(child, next) { return this._parent.insertBefore(child, next); },\n  querySelector: function(selector) { return this._parent.querySelector(selector); },\n  querySelectorAll: function(selector) { return this._parent.querySelectorAll(selector); }\n};\n","import {Selection} from \"./index.js\";\nimport {EnterNode} from \"./enter.js\";\nimport constant from \"../constant.js\";\n\nfunction bindIndex(parent, group, enter, update, exit, data) {\n  var i = 0,\n      node,\n      groupLength = group.length,\n      dataLength = data.length;\n\n  // Put any non-null nodes that fit into update.\n  // Put any null nodes into enter.\n  // Put any remaining data into enter.\n  for (; i < dataLength; ++i) {\n    if (node = group[i]) {\n      node.__data__ = data[i];\n      update[i] = node;\n    } else {\n      enter[i] = new EnterNode(parent, data[i]);\n    }\n  }\n\n  // Put any non-null nodes that don’t fit into exit.\n  for (; i < groupLength; ++i) {\n    if (node = group[i]) {\n      exit[i] = node;\n    }\n  }\n}\n\nfunction bindKey(parent, group, enter, update, exit, data, key) {\n  var i,\n      node,\n      nodeByKeyValue = new Map,\n      groupLength = group.length,\n      dataLength = data.length,\n      keyValues = new Array(groupLength),\n      keyValue;\n\n  // Compute the key for each node.\n  // If multiple nodes have the same key, the duplicates are added to exit.\n  for (i = 0; i < groupLength; ++i) {\n    if (node = group[i]) {\n      keyValues[i] = keyValue = key.call(node, node.__data__, i, group) + \"\";\n      if (nodeByKeyValue.has(keyValue)) {\n        exit[i] = node;\n      } else {\n        nodeByKeyValue.set(keyValue, node);\n      }\n    }\n  }\n\n  // Compute the key for each datum.\n  // If there a node associated with this key, join and add it to update.\n  // If there is not (or the key is a duplicate), add it to enter.\n  for (i = 0; i < dataLength; ++i) {\n    keyValue = key.call(parent, data[i], i, data) + \"\";\n    if (node = nodeByKeyValue.get(keyValue)) {\n      update[i] = node;\n      node.__data__ = data[i];\n      nodeByKeyValue.delete(keyValue);\n    } else {\n      enter[i] = new EnterNode(parent, data[i]);\n    }\n  }\n\n  // Add any remaining nodes that were not bound to data to exit.\n  for (i = 0; i < groupLength; ++i) {\n    if ((node = group[i]) && (nodeByKeyValue.get(keyValues[i]) === node)) {\n      exit[i] = node;\n    }\n  }\n}\n\nfunction datum(node) {\n  return node.__data__;\n}\n\nexport default function(value, key) {\n  if (!arguments.length) return Array.from(this, datum);\n\n  var bind = key ? bindKey : bindIndex,\n      parents = this._parents,\n      groups = this._groups;\n\n  if (typeof value !== \"function\") value = constant(value);\n\n  for (var m = groups.length, update = new Array(m), enter = new Array(m), exit = new Array(m), j = 0; j < m; ++j) {\n    var parent = parents[j],\n        group = groups[j],\n        groupLength = group.length,\n        data = arraylike(value.call(parent, parent && parent.__data__, j, parents)),\n        dataLength = data.length,\n        enterGroup = enter[j] = new Array(dataLength),\n        updateGroup = update[j] = new Array(dataLength),\n        exitGroup = exit[j] = new Array(groupLength);\n\n    bind(parent, group, enterGroup, updateGroup, exitGroup, data, key);\n\n    // Now connect the enter nodes to their following update node, such that\n    // appendChild can insert the materialized enter node before this node,\n    // rather than at the end of the parent node.\n    for (var i0 = 0, i1 = 0, previous, next; i0 < dataLength; ++i0) {\n      if (previous = enterGroup[i0]) {\n        if (i0 >= i1) i1 = i0 + 1;\n        while (!(next = updateGroup[i1]) && ++i1 < dataLength);\n        previous._next = next || null;\n      }\n    }\n  }\n\n  update = new Selection(update, parents);\n  update._enter = enter;\n  update._exit = exit;\n  return update;\n}\n\n// Given some data, this returns an array-like view of it: an object that\n// exposes a length property and allows numeric indexing. Note that unlike\n// selectAll, this isn’t worried about “live” collections because the resulting\n// array will only be used briefly while data is being bound. (It is possible to\n// cause the data to change while iterating by using a key function, but please\n// don’t; we’d rather avoid a gratuitous copy.)\nfunction arraylike(data) {\n  return typeof data === \"object\" && \"length\" in data\n    ? data // Array, TypedArray, NodeList, array-like\n    : Array.from(data); // Map, Set, iterable, string, or anything else\n}\n","import {Selection} from \"./index.js\";\n\nexport default function(compare) {\n  if (!compare) compare = ascending;\n\n  function compareNode(a, b) {\n    return a && b ? compare(a.__data__, b.__data__) : !a - !b;\n  }\n\n  for (var groups = this._groups, m = groups.length, sortgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, sortgroup = sortgroups[j] = new Array(n), node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        sortgroup[i] = node;\n      }\n    }\n    sortgroup.sort(compareNode);\n  }\n\n  return new Selection(sortgroups, this._parents).order();\n}\n\nfunction ascending(a, b) {\n  return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\n}\n","import namespace from \"../namespace.js\";\n\nfunction attrRemove(name) {\n  return function() {\n    this.removeAttribute(name);\n  };\n}\n\nfunction attrRemoveNS(fullname) {\n  return function() {\n    this.removeAttributeNS(fullname.space, fullname.local);\n  };\n}\n\nfunction attrConstant(name, value) {\n  return function() {\n    this.setAttribute(name, value);\n  };\n}\n\nfunction attrConstantNS(fullname, value) {\n  return function() {\n    this.setAttributeNS(fullname.space, fullname.local, value);\n  };\n}\n\nfunction attrFunction(name, value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (v == null) this.removeAttribute(name);\n    else this.setAttribute(name, v);\n  };\n}\n\nfunction attrFunctionNS(fullname, value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (v == null) this.removeAttributeNS(fullname.space, fullname.local);\n    else this.setAttributeNS(fullname.space, fullname.local, v);\n  };\n}\n\nexport default function(name, value) {\n  var fullname = namespace(name);\n\n  if (arguments.length < 2) {\n    var node = this.node();\n    return fullname.local\n        ? node.getAttributeNS(fullname.space, fullname.local)\n        : node.getAttribute(fullname);\n  }\n\n  return this.each((value == null\n      ? (fullname.local ? attrRemoveNS : attrRemove) : (typeof value === \"function\"\n      ? (fullname.local ? attrFunctionNS : attrFunction)\n      : (fullname.local ? attrConstantNS : attrConstant)))(fullname, value));\n}\n","export default function(node) {\n  return (node.ownerDocument && node.ownerDocument.defaultView) // node is a Node\n      || (node.document && node) // node is a Window\n      || node.defaultView; // node is a Document\n}\n","import defaultView from \"../window.js\";\n\nfunction styleRemove(name) {\n  return function() {\n    this.style.removeProperty(name);\n  };\n}\n\nfunction styleConstant(name, value, priority) {\n  return function() {\n    this.style.setProperty(name, value, priority);\n  };\n}\n\nfunction styleFunction(name, value, priority) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (v == null) this.style.removeProperty(name);\n    else this.style.setProperty(name, v, priority);\n  };\n}\n\nexport default function(name, value, priority) {\n  return arguments.length > 1\n      ? this.each((value == null\n            ? styleRemove : typeof value === \"function\"\n            ? styleFunction\n            : styleConstant)(name, value, priority == null ? \"\" : priority))\n      : styleValue(this.node(), name);\n}\n\nexport function styleValue(node, name) {\n  return node.style.getPropertyValue(name)\n      || defaultView(node).getComputedStyle(node, null).getPropertyValue(name);\n}\n","function propertyRemove(name) {\n  return function() {\n    delete this[name];\n  };\n}\n\nfunction propertyConstant(name, value) {\n  return function() {\n    this[name] = value;\n  };\n}\n\nfunction propertyFunction(name, value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (v == null) delete this[name];\n    else this[name] = v;\n  };\n}\n\nexport default function(name, value) {\n  return arguments.length > 1\n      ? this.each((value == null\n          ? propertyRemove : typeof value === \"function\"\n          ? propertyFunction\n          : propertyConstant)(name, value))\n      : this.node()[name];\n}\n","function classArray(string) {\n  return string.trim().split(/^|\\s+/);\n}\n\nfunction classList(node) {\n  return node.classList || new ClassList(node);\n}\n\nfunction ClassList(node) {\n  this._node = node;\n  this._names = classArray(node.getAttribute(\"class\") || \"\");\n}\n\nClassList.prototype = {\n  add: function(name) {\n    var i = this._names.indexOf(name);\n    if (i < 0) {\n      this._names.push(name);\n      this._node.setAttribute(\"class\", this._names.join(\" \"));\n    }\n  },\n  remove: function(name) {\n    var i = this._names.indexOf(name);\n    if (i >= 0) {\n      this._names.splice(i, 1);\n      this._node.setAttribute(\"class\", this._names.join(\" \"));\n    }\n  },\n  contains: function(name) {\n    return this._names.indexOf(name) >= 0;\n  }\n};\n\nfunction classedAdd(node, names) {\n  var list = classList(node), i = -1, n = names.length;\n  while (++i < n) list.add(names[i]);\n}\n\nfunction classedRemove(node, names) {\n  var list = classList(node), i = -1, n = names.length;\n  while (++i < n) list.remove(names[i]);\n}\n\nfunction classedTrue(names) {\n  return function() {\n    classedAdd(this, names);\n  };\n}\n\nfunction classedFalse(names) {\n  return function() {\n    classedRemove(this, names);\n  };\n}\n\nfunction classedFunction(names, value) {\n  return function() {\n    (value.apply(this, arguments) ? classedAdd : classedRemove)(this, names);\n  };\n}\n\nexport default function(name, value) {\n  var names = classArray(name + \"\");\n\n  if (arguments.length < 2) {\n    var list = classList(this.node()), i = -1, n = names.length;\n    while (++i < n) if (!list.contains(names[i])) return false;\n    return true;\n  }\n\n  return this.each((typeof value === \"function\"\n      ? classedFunction : value\n      ? classedTrue\n      : classedFalse)(names, value));\n}\n","function textRemove() {\n  this.textContent = \"\";\n}\n\nfunction textConstant(value) {\n  return function() {\n    this.textContent = value;\n  };\n}\n\nfunction textFunction(value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    this.textContent = v == null ? \"\" : v;\n  };\n}\n\nexport default function(value) {\n  return arguments.length\n      ? this.each(value == null\n          ? textRemove : (typeof value === \"function\"\n          ? textFunction\n          : textConstant)(value))\n      : this.node().textContent;\n}\n","function htmlRemove() {\n  this.innerHTML = \"\";\n}\n\nfunction htmlConstant(value) {\n  return function() {\n    this.innerHTML = value;\n  };\n}\n\nfunction htmlFunction(value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    this.innerHTML = v == null ? \"\" : v;\n  };\n}\n\nexport default function(value) {\n  return arguments.length\n      ? this.each(value == null\n          ? htmlRemove : (typeof value === \"function\"\n          ? htmlFunction\n          : htmlConstant)(value))\n      : this.node().innerHTML;\n}\n","function raise() {\n  if (this.nextSibling) this.parentNode.appendChild(this);\n}\n\nexport default function() {\n  return this.each(raise);\n}\n","function lower() {\n  if (this.previousSibling) this.parentNode.insertBefore(this, this.parentNode.firstChild);\n}\n\nexport default function() {\n  return this.each(lower);\n}\n","import creator from \"../creator.js\";\nimport selector from \"../selector.js\";\n\nfunction constantNull() {\n  return null;\n}\n\nexport default function(name, before) {\n  var create = typeof name === \"function\" ? name : creator(name),\n      select = before == null ? constantNull : typeof before === \"function\" ? before : selector(before);\n  return this.select(function() {\n    return this.insertBefore(create.apply(this, arguments), select.apply(this, arguments) || null);\n  });\n}\n","function remove() {\n  var parent = this.parentNode;\n  if (parent) parent.removeChild(this);\n}\n\nexport default function() {\n  return this.each(remove);\n}\n","function selection_cloneShallow() {\n  var clone = this.cloneNode(false), parent = this.parentNode;\n  return parent ? parent.insertBefore(clone, this.nextSibling) : clone;\n}\n\nfunction selection_cloneDeep() {\n  var clone = this.cloneNode(true), parent = this.parentNode;\n  return parent ? parent.insertBefore(clone, this.nextSibling) : clone;\n}\n\nexport default function(deep) {\n  return this.select(deep ? selection_cloneDeep : selection_cloneShallow);\n}\n","function contextListener(listener) {\n  return function(event) {\n    listener.call(this, event, this.__data__);\n  };\n}\n\nfunction parseTypenames(typenames) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    return {type: t, name: name};\n  });\n}\n\nfunction onRemove(typename) {\n  return function() {\n    var on = this.__on;\n    if (!on) return;\n    for (var j = 0, i = -1, m = on.length, o; j < m; ++j) {\n      if (o = on[j], (!typename.type || o.type === typename.type) && o.name === typename.name) {\n        this.removeEventListener(o.type, o.listener, o.options);\n      } else {\n        on[++i] = o;\n      }\n    }\n    if (++i) on.length = i;\n    else delete this.__on;\n  };\n}\n\nfunction onAdd(typename, value, options) {\n  return function() {\n    var on = this.__on, o, listener = contextListener(value);\n    if (on) for (var j = 0, m = on.length; j < m; ++j) {\n      if ((o = on[j]).type === typename.type && o.name === typename.name) {\n        this.removeEventListener(o.type, o.listener, o.options);\n        this.addEventListener(o.type, o.listener = listener, o.options = options);\n        o.value = value;\n        return;\n      }\n    }\n    this.addEventListener(typename.type, listener, options);\n    o = {type: typename.type, name: typename.name, value: value, listener: listener, options: options};\n    if (!on) this.__on = [o];\n    else on.push(o);\n  };\n}\n\nexport default function(typename, value, options) {\n  var typenames = parseTypenames(typename + \"\"), i, n = typenames.length, t;\n\n  if (arguments.length < 2) {\n    var on = this.node().__on;\n    if (on) for (var j = 0, m = on.length, o; j < m; ++j) {\n      for (i = 0, o = on[j]; i < n; ++i) {\n        if ((t = typenames[i]).type === o.type && t.name === o.name) {\n          return o.value;\n        }\n      }\n    }\n    return;\n  }\n\n  on = value ? onAdd : onRemove;\n  for (i = 0; i < n; ++i) this.each(on(typenames[i], value, options));\n  return this;\n}\n","import defaultView from \"../window.js\";\n\nfunction dispatchEvent(node, type, params) {\n  var window = defaultView(node),\n      event = window.CustomEvent;\n\n  if (typeof event === \"function\") {\n    event = new event(type, params);\n  } else {\n    event = window.document.createEvent(\"Event\");\n    if (params) event.initEvent(type, params.bubbles, params.cancelable), event.detail = params.detail;\n    else event.initEvent(type, false, false);\n  }\n\n  node.dispatchEvent(event);\n}\n\nfunction dispatchConstant(type, params) {\n  return function() {\n    return dispatchEvent(this, type, params);\n  };\n}\n\nfunction dispatchFunction(type, params) {\n  return function() {\n    return dispatchEvent(this, type, params.apply(this, arguments));\n  };\n}\n\nexport default function(type, params) {\n  return this.each((typeof params === \"function\"\n      ? dispatchFunction\n      : dispatchConstant)(type, params));\n}\n","import selection_select from \"./select.js\";\nimport selection_selectAll from \"./selectAll.js\";\nimport selection_selectChild from \"./selectChild.js\";\nimport selection_selectChildren from \"./selectChildren.js\";\nimport selection_filter from \"./filter.js\";\nimport selection_data from \"./data.js\";\nimport selection_enter from \"./enter.js\";\nimport selection_exit from \"./exit.js\";\nimport selection_join from \"./join.js\";\nimport selection_merge from \"./merge.js\";\nimport selection_order from \"./order.js\";\nimport selection_sort from \"./sort.js\";\nimport selection_call from \"./call.js\";\nimport selection_nodes from \"./nodes.js\";\nimport selection_node from \"./node.js\";\nimport selection_size from \"./size.js\";\nimport selection_empty from \"./empty.js\";\nimport selection_each from \"./each.js\";\nimport selection_attr from \"./attr.js\";\nimport selection_style from \"./style.js\";\nimport selection_property from \"./property.js\";\nimport selection_classed from \"./classed.js\";\nimport selection_text from \"./text.js\";\nimport selection_html from \"./html.js\";\nimport selection_raise from \"./raise.js\";\nimport selection_lower from \"./lower.js\";\nimport selection_append from \"./append.js\";\nimport selection_insert from \"./insert.js\";\nimport selection_remove from \"./remove.js\";\nimport selection_clone from \"./clone.js\";\nimport selection_datum from \"./datum.js\";\nimport selection_on from \"./on.js\";\nimport selection_dispatch from \"./dispatch.js\";\nimport selection_iterator from \"./iterator.js\";\n\nexport var root = [null];\n\nexport function Selection(groups, parents) {\n  this._groups = groups;\n  this._parents = parents;\n}\n\nfunction selection() {\n  return new Selection([[document.documentElement]], root);\n}\n\nfunction selection_selection() {\n  return this;\n}\n\nSelection.prototype = selection.prototype = {\n  constructor: Selection,\n  select: selection_select,\n  selectAll: selection_selectAll,\n  selectChild: selection_selectChild,\n  selectChildren: selection_selectChildren,\n  filter: selection_filter,\n  data: selection_data,\n  enter: selection_enter,\n  exit: selection_exit,\n  join: selection_join,\n  merge: selection_merge,\n  selection: selection_selection,\n  order: selection_order,\n  sort: selection_sort,\n  call: selection_call,\n  nodes: selection_nodes,\n  node: selection_node,\n  size: selection_size,\n  empty: selection_empty,\n  each: selection_each,\n  attr: selection_attr,\n  style: selection_style,\n  property: selection_property,\n  classed: selection_classed,\n  text: selection_text,\n  html: selection_html,\n  raise: selection_raise,\n  lower: selection_lower,\n  append: selection_append,\n  insert: selection_insert,\n  remove: selection_remove,\n  clone: selection_clone,\n  datum: selection_datum,\n  on: selection_on,\n  dispatch: selection_dispatch,\n  [Symbol.iterator]: selection_iterator\n};\n\nexport default selection;\n","import {Selection, root} from \"./selection/index.js\";\n\nexport default function(selector) {\n  return typeof selector === \"string\"\n      ? new Selection([[document.querySelector(selector)]], [document.documentElement])\n      : new Selection([[selector]], root);\n}\n","import {Selection} from \"./index.js\";\nimport selector from \"../selector.js\";\n\nexport default function(select) {\n  if (typeof select !== \"function\") select = selector(select);\n\n  for (var groups = this._groups, m = groups.length, subgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, subgroup = subgroups[j] = new Array(n), node, subnode, i = 0; i < n; ++i) {\n      if ((node = group[i]) && (subnode = select.call(node, node.__data__, i, group))) {\n        if (\"__data__\" in node) subnode.__data__ = node.__data__;\n        subgroup[i] = subnode;\n      }\n    }\n  }\n\n  return new Selection(subgroups, this._parents);\n}\n","import {Selection} from \"./index.js\";\nimport array from \"../array.js\";\nimport selectorAll from \"../selectorAll.js\";\n\nfunction arrayAll(select) {\n  return function() {\n    return array(select.apply(this, arguments));\n  };\n}\n\nexport default function(select) {\n  if (typeof select === \"function\") select = arrayAll(select);\n  else select = selectorAll(select);\n\n  for (var groups = this._groups, m = groups.length, subgroups = [], parents = [], j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        subgroups.push(select.call(node, node.__data__, i, group));\n        parents.push(node);\n      }\n    }\n  }\n\n  return new Selection(subgroups, parents);\n}\n","import {Selection} from \"./index.js\";\nimport matcher from \"../matcher.js\";\n\nexport default function(match) {\n  if (typeof match !== \"function\") match = matcher(match);\n\n  for (var groups = this._groups, m = groups.length, subgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, subgroup = subgroups[j] = [], node, i = 0; i < n; ++i) {\n      if ((node = group[i]) && match.call(node, node.__data__, i, group)) {\n        subgroup.push(node);\n      }\n    }\n  }\n\n  return new Selection(subgroups, this._parents);\n}\n","export default function(x) {\n  return function() {\n    return x;\n  };\n}\n","import sparse from \"./sparse.js\";\nimport {Selection} from \"./index.js\";\n\nexport default function() {\n  return new Selection(this._exit || this._groups.map(sparse), this._parents);\n}\n","export default function(onenter, onupdate, onexit) {\n  var enter = this.enter(), update = this, exit = this.exit();\n  if (typeof onenter === \"function\") {\n    enter = onenter(enter);\n    if (enter) enter = enter.selection();\n  } else {\n    enter = enter.append(onenter + \"\");\n  }\n  if (onupdate != null) {\n    update = onupdate(update);\n    if (update) update = update.selection();\n  }\n  if (onexit == null) exit.remove(); else onexit(exit);\n  return enter && update ? enter.merge(update).order() : update;\n}\n","import {Selection} from \"./index.js\";\n\nexport default function(context) {\n  var selection = context.selection ? context.selection() : context;\n\n  for (var groups0 = this._groups, groups1 = selection._groups, m0 = groups0.length, m1 = groups1.length, m = Math.min(m0, m1), merges = new Array(m0), j = 0; j < m; ++j) {\n    for (var group0 = groups0[j], group1 = groups1[j], n = group0.length, merge = merges[j] = new Array(n), node, i = 0; i < n; ++i) {\n      if (node = group0[i] || group1[i]) {\n        merge[i] = node;\n      }\n    }\n  }\n\n  for (; j < m0; ++j) {\n    merges[j] = groups0[j];\n  }\n\n  return new Selection(merges, this._parents);\n}\n","export default function() {\n\n  for (var groups = this._groups, j = -1, m = groups.length; ++j < m;) {\n    for (var group = groups[j], i = group.length - 1, next = group[i], node; --i >= 0;) {\n      if (node = group[i]) {\n        if (next && node.compareDocumentPosition(next) ^ 4) next.parentNode.insertBefore(node, next);\n        next = node;\n      }\n    }\n  }\n\n  return this;\n}\n","export default function() {\n  var callback = arguments[0];\n  arguments[0] = this;\n  callback.apply(null, arguments);\n  return this;\n}\n","export default function() {\n  return Array.from(this);\n}\n","export default function() {\n\n  for (var groups = this._groups, j = 0, m = groups.length; j < m; ++j) {\n    for (var group = groups[j], i = 0, n = group.length; i < n; ++i) {\n      var node = group[i];\n      if (node) return node;\n    }\n  }\n\n  return null;\n}\n","export default function() {\n  let size = 0;\n  for (const node of this) ++size; // eslint-disable-line no-unused-vars\n  return size;\n}\n","export default function() {\n  return !this.node();\n}\n","export default function(callback) {\n\n  for (var groups = this._groups, j = 0, m = groups.length; j < m; ++j) {\n    for (var group = groups[j], i = 0, n = group.length, node; i < n; ++i) {\n      if (node = group[i]) callback.call(node, node.__data__, i, group);\n    }\n  }\n\n  return this;\n}\n","import creator from \"../creator.js\";\n\nexport default function(name) {\n  var create = typeof name === \"function\" ? name : creator(name);\n  return this.select(function() {\n    return this.appendChild(create.apply(this, arguments));\n  });\n}\n","export default function(value) {\n  return arguments.length\n      ? this.property(\"__data__\", value)\n      : this.node().__data__;\n}\n","export default function*() {\n  for (var groups = this._groups, j = 0, m = groups.length; j < m; ++j) {\n    for (var group = groups[j], i = 0, n = group.length, node; i < n; ++i) {\n      if (node = group[i]) yield node;\n    }\n  }\n}\n","var nextId = 0;\n\nexport default function local() {\n  return new Local;\n}\n\nfunction Local() {\n  this._ = \"@\" + (++nextId).toString(36);\n}\n\nLocal.prototype = local.prototype = {\n  constructor: Local,\n  get: function(node) {\n    var id = this._;\n    while (!(id in node)) if (!(node = node.parentNode)) return;\n    return node[id];\n  },\n  set: function(node, value) {\n    return node[this._] = value;\n  },\n  remove: function(node) {\n    return this._ in node && delete node[this._];\n  },\n  toString: function() {\n    return this._;\n  }\n};\n","export default function(event) {\n  let sourceEvent;\n  while (sourceEvent = event.sourceEvent) event = sourceEvent;\n  return event;\n}\n","import sourceEvent from \"./sourceEvent.js\";\n\nexport default function(event, node) {\n  event = sourceEvent(event);\n  if (node === undefined) node = event.currentTarget;\n  if (node) {\n    var svg = node.ownerSVGElement || node;\n    if (svg.createSVGPoint) {\n      var point = svg.createSVGPoint();\n      point.x = event.clientX, point.y = event.clientY;\n      point = point.matrixTransform(node.getScreenCTM().inverse());\n      return [point.x, point.y];\n    }\n    if (node.getBoundingClientRect) {\n      var rect = node.getBoundingClientRect();\n      return [event.clientX - rect.left - node.clientLeft, event.clientY - rect.top - node.clientTop];\n    }\n  }\n  return [event.pageX, event.pageY];\n}\n","import creator from \"./creator.js\";\nimport select from \"./select.js\";\n\nexport default function(name) {\n  return select(creator(name).call(document.documentElement));\n}\n","import pointer from \"./pointer.js\";\nimport sourceEvent from \"./sourceEvent.js\";\n\nexport default function(events, node) {\n  if (events.target) { // i.e., instanceof Event, not TouchList or iterable\n    events = sourceEvent(events);\n    if (node === undefined) node = events.currentTarget;\n    events = events.touches || [events];\n  }\n  return Array.from(events, event => pointer(event, node));\n}\n","import array from \"./array.js\";\nimport {Selection, root} from \"./selection/index.js\";\n\nexport default function(selector) {\n  return typeof selector === \"string\"\n      ? new Selection([document.querySelectorAll(selector)], [document.documentElement])\n      : new Selection([array(selector)], root);\n}\n","var baseForOwn = require('./_baseForOwn'),\n    castFunction = require('./_castFunction');\n\n/**\n * Iterates over own enumerable string keyed properties of an object and\n * invokes `iteratee` for each property. The iteratee is invoked with three\n * arguments: (value, key, object). Iteratee functions may exit iteration\n * early by explicitly returning `false`.\n *\n * @static\n * @memberOf _\n * @since 0.3.0\n * @category Object\n * @param {Object} object The object to iterate over.\n * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n * @returns {Object} Returns `object`.\n * @see _.forOwnRight\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.forOwn(new Foo, function(value, key) {\n *   console.log(key);\n * });\n * // => Logs 'a' then 'b' (iteration order is not guaranteed).\n */\nfunction forOwn(object, iteratee) {\n  return object && baseForOwn(object, castFunction(iteratee));\n}\n\nmodule.exports = forOwn;\n","/**\n * The base implementation of `_.propertyOf` without support for deep paths.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Function} Returns the new accessor function.\n */\nfunction basePropertyOf(object) {\n  return function(key) {\n    return object == null ? undefined : object[key];\n  };\n}\n\nmodule.exports = basePropertyOf;\n","var escapeHtmlChar = require('./_escapeHtmlChar'),\n    toString = require('./toString');\n\n/** Used to match HTML entities and HTML characters. */\nvar reUnescapedHtml = /[&<>\"']/g,\n    reHasUnescapedHtml = RegExp(reUnescapedHtml.source);\n\n/**\n * Converts the characters \"&\", \"<\", \">\", '\"', and \"'\" in `string` to their\n * corresponding HTML entities.\n *\n * **Note:** No other characters are escaped. To escape additional\n * characters use a third-party library like [_he_](https://mths.be/he).\n *\n * Though the \">\" character is escaped for symmetry, characters like\n * \">\" and \"/\" don't need escaping in HTML and have no special meaning\n * unless they're part of a tag or unquoted attribute value. See\n * [Mathias Bynens's article](https://mathiasbynens.be/notes/ambiguous-ampersands)\n * (under \"semi-related fun fact\") for more details.\n *\n * When working with HTML you should always\n * [quote attribute values](http://wonko.com/post/html-escaping) to reduce\n * XSS vectors.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category String\n * @param {string} [string=''] The string to escape.\n * @returns {string} Returns the escaped string.\n * @example\n *\n * _.escape('fred, barney, & pebbles');\n * // => 'fred, barney, &amp; pebbles'\n */\nfunction escape(string) {\n  string = toString(string);\n  return (string && reHasUnescapedHtml.test(string))\n    ? string.replace(reUnescapedHtml, escapeHtmlChar)\n    : string;\n}\n\nmodule.exports = escape;\n","var basePropertyOf = require('./_basePropertyOf');\n\n/** Used to map characters to HTML entities. */\nvar htmlEscapes = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;'\n};\n\n/**\n * Used by `_.escape` to convert characters to HTML entities.\n *\n * @private\n * @param {string} chr The matched character to escape.\n * @returns {string} Returns the escaped character.\n */\nvar escapeHtmlChar = basePropertyOf(htmlEscapes);\n\nmodule.exports = escapeHtmlChar;\n","var noop = {value: () => {}};\n\nfunction dispatch() {\n  for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {\n    if (!(t = arguments[i] + \"\") || (t in _) || /[\\s.]/.test(t)) throw new Error(\"illegal type: \" + t);\n    _[t] = [];\n  }\n  return new Dispatch(_);\n}\n\nfunction Dispatch(_) {\n  this._ = _;\n}\n\nfunction parseTypenames(typenames, types) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    if (t && !types.hasOwnProperty(t)) throw new Error(\"unknown type: \" + t);\n    return {type: t, name: name};\n  });\n}\n\nDispatch.prototype = dispatch.prototype = {\n  constructor: Dispatch,\n  on: function(typename, callback) {\n    var _ = this._,\n        T = parseTypenames(typename + \"\", _),\n        t,\n        i = -1,\n        n = T.length;\n\n    // If no callback was specified, return the callback of the given type and name.\n    if (arguments.length < 2) {\n      while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;\n      return;\n    }\n\n    // If a type was specified, set the callback for the given type and name.\n    // Otherwise, if a null callback was specified, remove callbacks of the given name.\n    if (callback != null && typeof callback !== \"function\") throw new Error(\"invalid callback: \" + callback);\n    while (++i < n) {\n      if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);\n      else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);\n    }\n\n    return this;\n  },\n  copy: function() {\n    var copy = {}, _ = this._;\n    for (var t in _) copy[t] = _[t].slice();\n    return new Dispatch(copy);\n  },\n  call: function(type, that) {\n    if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n, t; i < n; ++i) args[i] = arguments[i + 2];\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  },\n  apply: function(type, that, args) {\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (var t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  }\n};\n\nfunction get(type, name) {\n  for (var i = 0, n = type.length, c; i < n; ++i) {\n    if ((c = type[i]).name === name) {\n      return c.value;\n    }\n  }\n}\n\nfunction set(type, name, callback) {\n  for (var i = 0, n = type.length; i < n; ++i) {\n    if (type[i].name === name) {\n      type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));\n      break;\n    }\n  }\n  if (callback != null) type.push({name: name, value: callback});\n  return type;\n}\n\nexport default dispatch;\n","// These are typically used in conjunction with noevent to ensure that we can\n// preventDefault on the event.\nexport const nonpassive = {passive: false};\nexport const nonpassivecapture = {capture: true, passive: false};\n\nexport function nopropagation(event) {\n  event.stopImmediatePropagation();\n}\n\nexport default function(event) {\n  event.preventDefault();\n  event.stopImmediatePropagation();\n}\n","import {select} from \"d3-selection\";\nimport noevent, {nonpassivecapture} from \"./noevent.js\";\n\nexport default function(view) {\n  var root = view.document.documentElement,\n      selection = select(view).on(\"dragstart.drag\", noevent, nonpassivecapture);\n  if (\"onselectstart\" in root) {\n    selection.on(\"selectstart.drag\", noevent, nonpassivecapture);\n  } else {\n    root.__noselect = root.style.MozUserSelect;\n    root.style.MozUserSelect = \"none\";\n  }\n}\n\nexport function yesdrag(view, noclick) {\n  var root = view.document.documentElement,\n      selection = select(view).on(\"dragstart.drag\", null);\n  if (noclick) {\n    selection.on(\"click.drag\", noevent, nonpassivecapture);\n    setTimeout(function() { selection.on(\"click.drag\", null); }, 0);\n  }\n  if (\"onselectstart\" in root) {\n    selection.on(\"selectstart.drag\", null);\n  } else {\n    root.style.MozUserSelect = root.__noselect;\n    delete root.__noselect;\n  }\n}\n","export default x => () => x;\n","export default function DragEvent(type, {\n  sourceEvent,\n  subject,\n  target,\n  identifier,\n  active,\n  x, y, dx, dy,\n  dispatch\n}) {\n  Object.defineProperties(this, {\n    type: {value: type, enumerable: true, configurable: true},\n    sourceEvent: {value: sourceEvent, enumerable: true, configurable: true},\n    subject: {value: subject, enumerable: true, configurable: true},\n    target: {value: target, enumerable: true, configurable: true},\n    identifier: {value: identifier, enumerable: true, configurable: true},\n    active: {value: active, enumerable: true, configurable: true},\n    x: {value: x, enumerable: true, configurable: true},\n    y: {value: y, enumerable: true, configurable: true},\n    dx: {value: dx, enumerable: true, configurable: true},\n    dy: {value: dy, enumerable: true, configurable: true},\n    _: {value: dispatch}\n  });\n}\n\nDragEvent.prototype.on = function() {\n  var value = this._.on.apply(this._, arguments);\n  return value === this._ ? this : value;\n};\n","import {dispatch} from \"d3-dispatch\";\nimport {select, pointer} from \"d3-selection\";\nimport nodrag, {yesdrag} from \"./nodrag.js\";\nimport noevent, {nonpassive, nonpassivecapture, nopropagation} from \"./noevent.js\";\nimport constant from \"./constant.js\";\nimport DragEvent from \"./event.js\";\n\n// Ignore right-click, since that should open the context menu.\nfunction defaultFilter(event) {\n  return !event.ctrlKey && !event.button;\n}\n\nfunction defaultContainer() {\n  return this.parentNode;\n}\n\nfunction defaultSubject(event, d) {\n  return d == null ? {x: event.x, y: event.y} : d;\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || (\"ontouchstart\" in this);\n}\n\nexport default function() {\n  var filter = defaultFilter,\n      container = defaultContainer,\n      subject = defaultSubject,\n      touchable = defaultTouchable,\n      gestures = {},\n      listeners = dispatch(\"start\", \"drag\", \"end\"),\n      active = 0,\n      mousedownx,\n      mousedowny,\n      mousemoving,\n      touchending,\n      clickDistance2 = 0;\n\n  function drag(selection) {\n    selection\n        .on(\"mousedown.drag\", mousedowned)\n      .filter(touchable)\n        .on(\"touchstart.drag\", touchstarted)\n        .on(\"touchmove.drag\", touchmoved, nonpassive)\n        .on(\"touchend.drag touchcancel.drag\", touchended)\n        .style(\"touch-action\", \"none\")\n        .style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  function mousedowned(event, d) {\n    if (touchending || !filter.call(this, event, d)) return;\n    var gesture = beforestart(this, container.call(this, event, d), event, d, \"mouse\");\n    if (!gesture) return;\n    select(event.view)\n      .on(\"mousemove.drag\", mousemoved, nonpassivecapture)\n      .on(\"mouseup.drag\", mouseupped, nonpassivecapture);\n    nodrag(event.view);\n    nopropagation(event);\n    mousemoving = false;\n    mousedownx = event.clientX;\n    mousedowny = event.clientY;\n    gesture(\"start\", event);\n  }\n\n  function mousemoved(event) {\n    noevent(event);\n    if (!mousemoving) {\n      var dx = event.clientX - mousedownx, dy = event.clientY - mousedowny;\n      mousemoving = dx * dx + dy * dy > clickDistance2;\n    }\n    gestures.mouse(\"drag\", event);\n  }\n\n  function mouseupped(event) {\n    select(event.view).on(\"mousemove.drag mouseup.drag\", null);\n    yesdrag(event.view, mousemoving);\n    noevent(event);\n    gestures.mouse(\"end\", event);\n  }\n\n  function touchstarted(event, d) {\n    if (!filter.call(this, event, d)) return;\n    var touches = event.changedTouches,\n        c = container.call(this, event, d),\n        n = touches.length, i, gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = beforestart(this, c, event, d, touches[i].identifier, touches[i])) {\n        nopropagation(event);\n        gesture(\"start\", event, touches[i]);\n      }\n    }\n  }\n\n  function touchmoved(event) {\n    var touches = event.changedTouches,\n        n = touches.length, i, gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        noevent(event);\n        gesture(\"drag\", event, touches[i]);\n      }\n    }\n  }\n\n  function touchended(event) {\n    var touches = event.changedTouches,\n        n = touches.length, i, gesture;\n\n    if (touchending) clearTimeout(touchending);\n    touchending = setTimeout(function() { touchending = null; }, 500); // Ghost clicks are delayed!\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        nopropagation(event);\n        gesture(\"end\", event, touches[i]);\n      }\n    }\n  }\n\n  function beforestart(that, container, event, d, identifier, touch) {\n    var dispatch = listeners.copy(),\n        p = pointer(touch || event, container), dx, dy,\n        s;\n\n    if ((s = subject.call(that, new DragEvent(\"beforestart\", {\n        sourceEvent: event,\n        target: drag,\n        identifier,\n        active,\n        x: p[0],\n        y: p[1],\n        dx: 0,\n        dy: 0,\n        dispatch\n      }), d)) == null) return;\n\n    dx = s.x - p[0] || 0;\n    dy = s.y - p[1] || 0;\n\n    return function gesture(type, event, touch) {\n      var p0 = p, n;\n      switch (type) {\n        case \"start\": gestures[identifier] = gesture, n = active++; break;\n        case \"end\": delete gestures[identifier], --active; // falls through\n        case \"drag\": p = pointer(touch || event, container), n = active; break;\n      }\n      dispatch.call(\n        type,\n        that,\n        new DragEvent(type, {\n          sourceEvent: event,\n          subject: s,\n          target: drag,\n          identifier,\n          active: n,\n          x: p[0] + dx,\n          y: p[1] + dy,\n          dx: p[0] - p0[0],\n          dy: p[1] - p0[1],\n          dispatch\n        }),\n        d\n      );\n    };\n  }\n\n  drag.filter = function(_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), drag) : filter;\n  };\n\n  drag.container = function(_) {\n    return arguments.length ? (container = typeof _ === \"function\" ? _ : constant(_), drag) : container;\n  };\n\n  drag.subject = function(_) {\n    return arguments.length ? (subject = typeof _ === \"function\" ? _ : constant(_), drag) : subject;\n  };\n\n  drag.touchable = function(_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), drag) : touchable;\n  };\n\n  drag.on = function() {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? drag : value;\n  };\n\n  drag.clickDistance = function(_) {\n    return arguments.length ? (clickDistance2 = (_ = +_) * _, drag) : Math.sqrt(clickDistance2);\n  };\n\n  return drag;\n}\n","export function quadIn(t) {\n  return t * t;\n}\n\nexport function quadOut(t) {\n  return t * (2 - t);\n}\n\nexport function quadInOut(t) {\n  return ((t *= 2) <= 1 ? t * t : --t * (2 - t) + 1) / 2;\n}\n","export function cubicIn(t) {\n  return t * t * t;\n}\n\nexport function cubicOut(t) {\n  return --t * t * t + 1;\n}\n\nexport function cubicInOut(t) {\n  return ((t *= 2) <= 1 ? t * t * t : (t -= 2) * t * t + 2) / 2;\n}\n","var exponent = 3;\n\nexport var polyIn = (function custom(e) {\n  e = +e;\n\n  function polyIn(t) {\n    return Math.pow(t, e);\n  }\n\n  polyIn.exponent = custom;\n\n  return polyIn;\n})(exponent);\n\nexport var polyOut = (function custom(e) {\n  e = +e;\n\n  function polyOut(t) {\n    return 1 - Math.pow(1 - t, e);\n  }\n\n  polyOut.exponent = custom;\n\n  return polyOut;\n})(exponent);\n\nexport var polyInOut = (function custom(e) {\n  e = +e;\n\n  function polyInOut(t) {\n    return ((t *= 2) <= 1 ? Math.pow(t, e) : 2 - Math.pow(2 - t, e)) / 2;\n  }\n\n  polyInOut.exponent = custom;\n\n  return polyInOut;\n})(exponent);\n","var pi = Math.PI,\n    halfPi = pi / 2;\n\nexport function sinIn(t) {\n  return (+t === 1) ? 1 : 1 - Math.cos(t * halfPi);\n}\n\nexport function sinOut(t) {\n  return Math.sin(t * halfPi);\n}\n\nexport function sinInOut(t) {\n  return (1 - Math.cos(pi * t)) / 2;\n}\n","// tpmt is two power minus ten times t scaled to [0,1]\nexport function tpmt(x) {\n  return (Math.pow(2, -10 * x) - 0.0009765625) * 1.0009775171065494;\n}\n","import {tpmt} from \"./math.js\";\n\nexport function expIn(t) {\n  return tpmt(1 - +t);\n}\n\nexport function expOut(t) {\n  return 1 - tpmt(t);\n}\n\nexport function expInOut(t) {\n  return ((t *= 2) <= 1 ? tpmt(1 - t) : 2 - tpmt(t - 1)) / 2;\n}\n","export function circleIn(t) {\n  return 1 - Math.sqrt(1 - t * t);\n}\n\nexport function circleOut(t) {\n  return Math.sqrt(1 - --t * t);\n}\n\nexport function circleInOut(t) {\n  return ((t *= 2) <= 1 ? 1 - Math.sqrt(1 - t * t) : Math.sqrt(1 - (t -= 2) * t) + 1) / 2;\n}\n","var b1 = 4 / 11,\n    b2 = 6 / 11,\n    b3 = 8 / 11,\n    b4 = 3 / 4,\n    b5 = 9 / 11,\n    b6 = 10 / 11,\n    b7 = 15 / 16,\n    b8 = 21 / 22,\n    b9 = 63 / 64,\n    b0 = 1 / b1 / b1;\n\nexport function bounceIn(t) {\n  return 1 - bounceOut(1 - t);\n}\n\nexport function bounceOut(t) {\n  return (t = +t) < b1 ? b0 * t * t : t < b3 ? b0 * (t -= b2) * t + b4 : t < b6 ? b0 * (t -= b5) * t + b7 : b0 * (t -= b8) * t + b9;\n}\n\nexport function bounceInOut(t) {\n  return ((t *= 2) <= 1 ? 1 - bounceOut(1 - t) : bounceOut(t - 1) + 1) / 2;\n}\n","var overshoot = 1.70158;\n\nexport var backIn = (function custom(s) {\n  s = +s;\n\n  function backIn(t) {\n    return (t = +t) * t * (s * (t - 1) + t);\n  }\n\n  backIn.overshoot = custom;\n\n  return backIn;\n})(overshoot);\n\nexport var backOut = (function custom(s) {\n  s = +s;\n\n  function backOut(t) {\n    return --t * t * ((t + 1) * s + t) + 1;\n  }\n\n  backOut.overshoot = custom;\n\n  return backOut;\n})(overshoot);\n\nexport var backInOut = (function custom(s) {\n  s = +s;\n\n  function backInOut(t) {\n    return ((t *= 2) < 1 ? t * t * ((s + 1) * t - s) : (t -= 2) * t * ((s + 1) * t + s) + 2) / 2;\n  }\n\n  backInOut.overshoot = custom;\n\n  return backInOut;\n})(overshoot);\n","import {tpmt} from \"./math.js\";\n\nvar tau = 2 * Math.PI,\n    amplitude = 1,\n    period = 0.3;\n\nexport var elasticIn = (function custom(a, p) {\n  var s = Math.asin(1 / (a = Math.max(1, a))) * (p /= tau);\n\n  function elasticIn(t) {\n    return a * tpmt(-(--t)) * Math.sin((s - t) / p);\n  }\n\n  elasticIn.amplitude = function(a) { return custom(a, p * tau); };\n  elasticIn.period = function(p) { return custom(a, p); };\n\n  return elasticIn;\n})(amplitude, period);\n\nexport var elasticOut = (function custom(a, p) {\n  var s = Math.asin(1 / (a = Math.max(1, a))) * (p /= tau);\n\n  function elasticOut(t) {\n    return 1 - a * tpmt(t = +t) * Math.sin((t + s) / p);\n  }\n\n  elasticOut.amplitude = function(a) { return custom(a, p * tau); };\n  elasticOut.period = function(p) { return custom(a, p); };\n\n  return elasticOut;\n})(amplitude, period);\n\nexport var elasticInOut = (function custom(a, p) {\n  var s = Math.asin(1 / (a = Math.max(1, a))) * (p /= tau);\n\n  function elasticInOut(t) {\n    return ((t = t * 2 - 1) < 0\n        ? a * tpmt(-t) * Math.sin((s - t) / p)\n        : 2 - a * tpmt(t) * Math.sin((s + t) / p)) / 2;\n  }\n\n  elasticInOut.amplitude = function(a) { return custom(a, p * tau); };\n  elasticInOut.period = function(p) { return custom(a, p); };\n\n  return elasticInOut;\n})(amplitude, period);\n","export const linear = t => +t;\n","function responseBlob(response) {\n  if (!response.ok) throw new Error(response.status + \" \" + response.statusText);\n  return response.blob();\n}\n\nexport default function(input, init) {\n  return fetch(input, init).then(responseBlob);\n}\n","function responseArrayBuffer(response) {\n  if (!response.ok) throw new Error(response.status + \" \" + response.statusText);\n  return response.arrayBuffer();\n}\n\nexport default function(input, init) {\n  return fetch(input, init).then(responseArrayBuffer);\n}\n","var EOL = {},\n    EOF = {},\n    QUOTE = 34,\n    NEWLINE = 10,\n    RETURN = 13;\n\nfunction objectConverter(columns) {\n  return new Function(\"d\", \"return {\" + columns.map(function(name, i) {\n    return JSON.stringify(name) + \": d[\" + i + \"] || \\\"\\\"\";\n  }).join(\",\") + \"}\");\n}\n\nfunction customConverter(columns, f) {\n  var object = objectConverter(columns);\n  return function(row, i) {\n    return f(object(row), i, columns);\n  };\n}\n\n// Compute unique columns in order of discovery.\nfunction inferColumns(rows) {\n  var columnSet = Object.create(null),\n      columns = [];\n\n  rows.forEach(function(row) {\n    for (var column in row) {\n      if (!(column in columnSet)) {\n        columns.push(columnSet[column] = column);\n      }\n    }\n  });\n\n  return columns;\n}\n\nfunction pad(value, width) {\n  var s = value + \"\", length = s.length;\n  return length < width ? new Array(width - length + 1).join(0) + s : s;\n}\n\nfunction formatYear(year) {\n  return year < 0 ? \"-\" + pad(-year, 6)\n    : year > 9999 ? \"+\" + pad(year, 6)\n    : pad(year, 4);\n}\n\nfunction formatDate(date) {\n  var hours = date.getUTCHours(),\n      minutes = date.getUTCMinutes(),\n      seconds = date.getUTCSeconds(),\n      milliseconds = date.getUTCMilliseconds();\n  return isNaN(date) ? \"Invalid Date\"\n      : formatYear(date.getUTCFullYear(), 4) + \"-\" + pad(date.getUTCMonth() + 1, 2) + \"-\" + pad(date.getUTCDate(), 2)\n      + (milliseconds ? \"T\" + pad(hours, 2) + \":\" + pad(minutes, 2) + \":\" + pad(seconds, 2) + \".\" + pad(milliseconds, 3) + \"Z\"\n      : seconds ? \"T\" + pad(hours, 2) + \":\" + pad(minutes, 2) + \":\" + pad(seconds, 2) + \"Z\"\n      : minutes || hours ? \"T\" + pad(hours, 2) + \":\" + pad(minutes, 2) + \"Z\"\n      : \"\");\n}\n\nexport default function(delimiter) {\n  var reFormat = new RegExp(\"[\\\"\" + delimiter + \"\\n\\r]\"),\n      DELIMITER = delimiter.charCodeAt(0);\n\n  function parse(text, f) {\n    var convert, columns, rows = parseRows(text, function(row, i) {\n      if (convert) return convert(row, i - 1);\n      columns = row, convert = f ? customConverter(row, f) : objectConverter(row);\n    });\n    rows.columns = columns || [];\n    return rows;\n  }\n\n  function parseRows(text, f) {\n    var rows = [], // output rows\n        N = text.length,\n        I = 0, // current character index\n        n = 0, // current line number\n        t, // current token\n        eof = N <= 0, // current token followed by EOF?\n        eol = false; // current token followed by EOL?\n\n    // Strip the trailing newline.\n    if (text.charCodeAt(N - 1) === NEWLINE) --N;\n    if (text.charCodeAt(N - 1) === RETURN) --N;\n\n    function token() {\n      if (eof) return EOF;\n      if (eol) return eol = false, EOL;\n\n      // Unescape quotes.\n      var i, j = I, c;\n      if (text.charCodeAt(j) === QUOTE) {\n        while (I++ < N && text.charCodeAt(I) !== QUOTE || text.charCodeAt(++I) === QUOTE);\n        if ((i = I) >= N) eof = true;\n        else if ((c = text.charCodeAt(I++)) === NEWLINE) eol = true;\n        else if (c === RETURN) { eol = true; if (text.charCodeAt(I) === NEWLINE) ++I; }\n        return text.slice(j + 1, i - 1).replace(/\"\"/g, \"\\\"\");\n      }\n\n      // Find next delimiter or newline.\n      while (I < N) {\n        if ((c = text.charCodeAt(i = I++)) === NEWLINE) eol = true;\n        else if (c === RETURN) { eol = true; if (text.charCodeAt(I) === NEWLINE) ++I; }\n        else if (c !== DELIMITER) continue;\n        return text.slice(j, i);\n      }\n\n      // Return last token before EOF.\n      return eof = true, text.slice(j, N);\n    }\n\n    while ((t = token()) !== EOF) {\n      var row = [];\n      while (t !== EOL && t !== EOF) row.push(t), t = token();\n      if (f && (row = f(row, n++)) == null) continue;\n      rows.push(row);\n    }\n\n    return rows;\n  }\n\n  function preformatBody(rows, columns) {\n    return rows.map(function(row) {\n      return columns.map(function(column) {\n        return formatValue(row[column]);\n      }).join(delimiter);\n    });\n  }\n\n  function format(rows, columns) {\n    if (columns == null) columns = inferColumns(rows);\n    return [columns.map(formatValue).join(delimiter)].concat(preformatBody(rows, columns)).join(\"\\n\");\n  }\n\n  function formatBody(rows, columns) {\n    if (columns == null) columns = inferColumns(rows);\n    return preformatBody(rows, columns).join(\"\\n\");\n  }\n\n  function formatRows(rows) {\n    return rows.map(formatRow).join(\"\\n\");\n  }\n\n  function formatRow(row) {\n    return row.map(formatValue).join(delimiter);\n  }\n\n  function formatValue(value) {\n    return value == null ? \"\"\n        : value instanceof Date ? formatDate(value)\n        : reFormat.test(value += \"\") ? \"\\\"\" + value.replace(/\"/g, \"\\\"\\\"\") + \"\\\"\"\n        : value;\n  }\n\n  return {\n    parse: parse,\n    parseRows: parseRows,\n    format: format,\n    formatBody: formatBody,\n    formatRows: formatRows,\n    formatRow: formatRow,\n    formatValue: formatValue\n  };\n}\n","import dsv from \"./dsv.js\";\n\nvar csv = dsv(\",\");\n\nexport var csvParse = csv.parse;\nexport var csvParseRows = csv.parseRows;\nexport var csvFormat = csv.format;\nexport var csvFormatBody = csv.formatBody;\nexport var csvFormatRows = csv.formatRows;\nexport var csvFormatRow = csv.formatRow;\nexport var csvFormatValue = csv.formatValue;\n","import dsv from \"./dsv.js\";\n\nvar tsv = dsv(\"\\t\");\n\nexport var tsvParse = tsv.parse;\nexport var tsvParseRows = tsv.parseRows;\nexport var tsvFormat = tsv.format;\nexport var tsvFormatBody = tsv.formatBody;\nexport var tsvFormatRows = tsv.formatRows;\nexport var tsvFormatRow = tsv.formatRow;\nexport var tsvFormatValue = tsv.formatValue;\n","function responseText(response) {\n  if (!response.ok) throw new Error(response.status + \" \" + response.statusText);\n  return response.text();\n}\n\nexport default function(input, init) {\n  return fetch(input, init).then(responseText);\n}\n","import {csvParse, dsvFormat, tsvParse} from \"d3-dsv\";\nimport text from \"./text.js\";\n\nfunction dsvParse(parse) {\n  return function(input, init, row) {\n    if (arguments.length === 2 && typeof init === \"function\") row = init, init = undefined;\n    return text(input, init).then(function(response) {\n      return parse(response, row);\n    });\n  };\n}\n\nexport default function dsv(delimiter, input, init, row) {\n  if (arguments.length === 3 && typeof init === \"function\") row = init, init = undefined;\n  var format = dsvFormat(delimiter);\n  return text(input, init).then(function(response) {\n    return format.parse(response, row);\n  });\n}\n\nexport var csv = dsvParse(csvParse);\nexport var tsv = dsvParse(tsvParse);\n","function responseJson(response) {\n  if (!response.ok) throw new Error(response.status + \" \" + response.statusText);\n  if (response.status === 204 || response.status === 205) return;\n  return response.json();\n}\n\nexport default function(input, init) {\n  return fetch(input, init).then(responseJson);\n}\n","import text from \"./text.js\";\n\nfunction parser(type) {\n  return (input, init) => text(input, init)\n    .then(text => (new DOMParser).parseFromString(text, type));\n}\n\nexport default parser(\"application/xml\");\n\nexport var html = parser(\"text/html\");\n\nexport var svg = parser(\"image/svg+xml\");\n","export default function(input, init) {\n  return new Promise(function(resolve, reject) {\n    var image = new Image;\n    for (var key in init) image[key] = init[key];\n    image.onerror = reject;\n    image.onload = function() { resolve(image); };\n    image.src = input;\n  });\n}\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(`^rgb\\\\(${reI},${reI},${reI}\\\\)$`),\n    reRgbPercent = new RegExp(`^rgb\\\\(${reP},${reP},${reP}\\\\)$`),\n    reRgbaInteger = new RegExp(`^rgba\\\\(${reI},${reI},${reI},${reN}\\\\)$`),\n    reRgbaPercent = new RegExp(`^rgba\\\\(${reP},${reP},${reP},${reN}\\\\)$`),\n    reHslPercent = new RegExp(`^hsl\\\\(${reN},${reP},${reP}\\\\)$`),\n    reHslaPercent = new RegExp(`^hsla\\\\(${reN},${reP},${reP},${reN}\\\\)$`);\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHex8: color_formatHex8,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHex8() {\n  return this.rgb().formatHex8();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb() {\n    return this;\n  },\n  clamp() {\n    return new Rgb(clampi(this.r), clampi(this.g), clampi(this.b), clampa(this.opacity));\n  },\n  displayable() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatHex8: rgb_formatHex8,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}`;\n}\n\nfunction rgb_formatHex8() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity) ? 1 : this.opacity) * 255)}`;\n}\n\nfunction rgb_formatRgb() {\n  const a = clampa(this.opacity);\n  return `${a === 1 ? \"rgb(\" : \"rgba(\"}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${a === 1 ? \")\" : `, ${a})`}`;\n}\n\nfunction clampa(opacity) {\n  return isNaN(opacity) ? 1 : Math.max(0, Math.min(1, opacity));\n}\n\nfunction clampi(value) {\n  return Math.max(0, Math.min(255, Math.round(value) || 0));\n}\n\nfunction hex(value) {\n  value = clampi(value);\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  clamp() {\n    return new Hsl(clamph(this.h), clampt(this.s), clampt(this.l), clampa(this.opacity));\n  },\n  displayable() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl() {\n    const a = clampa(this.opacity);\n    return `${a === 1 ? \"hsl(\" : \"hsla(\"}${clamph(this.h)}, ${clampt(this.s) * 100}%, ${clampt(this.l) * 100}%${a === 1 ? \")\" : `, ${a})`}`;\n  }\n}));\n\nfunction clamph(value) {\n  value = (value || 0) % 360;\n  return value < 0 ? value + 360 : value;\n}\n\nfunction clampt(value) {\n  return Math.max(0, Math.min(1, value || 0));\n}\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export default x => () => x;\n","import constant from \"./constant.js\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis.js\";\nimport basisClosed from \"./basisClosed.js\";\nimport nogamma, {gamma} from \"./color.js\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","import number from \"./number.js\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","var degrees = 180 / Math.PI;\n\nexport var identity = {\n  translateX: 0,\n  translateY: 0,\n  rotate: 0,\n  skewX: 0,\n  scaleX: 1,\n  scaleY: 1\n};\n\nexport default function(a, b, c, d, e, f) {\n  var scaleX, scaleY, skewX;\n  if (scaleX = Math.sqrt(a * a + b * b)) a /= scaleX, b /= scaleX;\n  if (skewX = a * c + b * d) c -= a * skewX, d -= b * skewX;\n  if (scaleY = Math.sqrt(c * c + d * d)) c /= scaleY, d /= scaleY, skewX /= scaleY;\n  if (a * d < b * c) a = -a, b = -b, skewX = -skewX, scaleX = -scaleX;\n  return {\n    translateX: e,\n    translateY: f,\n    rotate: Math.atan2(b, a) * degrees,\n    skewX: Math.atan(skewX) * degrees,\n    scaleX: scaleX,\n    scaleY: scaleY\n  };\n}\n","import decompose, {identity} from \"./decompose.js\";\n\nvar svgNode;\n\n/* eslint-disable no-undef */\nexport function parseCss(value) {\n  const m = new (typeof DOMMatrix === \"function\" ? DOMMatrix : WebKitCSSMatrix)(value + \"\");\n  return m.isIdentity ? identity : decompose(m.a, m.b, m.c, m.d, m.e, m.f);\n}\n\nexport function parseSvg(value) {\n  if (value == null) return identity;\n  if (!svgNode) svgNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n  svgNode.setAttribute(\"transform\", value);\n  if (!(value = svgNode.transform.baseVal.consolidate())) return identity;\n  value = value.matrix;\n  return decompose(value.a, value.b, value.c, value.d, value.e, value.f);\n}\n","import number from \"../number.js\";\nimport {parseCss, parseSvg} from \"./parse.js\";\n\nfunction interpolateTransform(parse, pxComma, pxParen, degParen) {\n\n  function pop(s) {\n    return s.length ? s.pop() + \" \" : \"\";\n  }\n\n  function translate(xa, ya, xb, yb, s, q) {\n    if (xa !== xb || ya !== yb) {\n      var i = s.push(\"translate(\", null, pxComma, null, pxParen);\n      q.push({i: i - 4, x: number(xa, xb)}, {i: i - 2, x: number(ya, yb)});\n    } else if (xb || yb) {\n      s.push(\"translate(\" + xb + pxComma + yb + pxParen);\n    }\n  }\n\n  function rotate(a, b, s, q) {\n    if (a !== b) {\n      if (a - b > 180) b += 360; else if (b - a > 180) a += 360; // shortest path\n      q.push({i: s.push(pop(s) + \"rotate(\", null, degParen) - 2, x: number(a, b)});\n    } else if (b) {\n      s.push(pop(s) + \"rotate(\" + b + degParen);\n    }\n  }\n\n  function skewX(a, b, s, q) {\n    if (a !== b) {\n      q.push({i: s.push(pop(s) + \"skewX(\", null, degParen) - 2, x: number(a, b)});\n    } else if (b) {\n      s.push(pop(s) + \"skewX(\" + b + degParen);\n    }\n  }\n\n  function scale(xa, ya, xb, yb, s, q) {\n    if (xa !== xb || ya !== yb) {\n      var i = s.push(pop(s) + \"scale(\", null, \",\", null, \")\");\n      q.push({i: i - 4, x: number(xa, xb)}, {i: i - 2, x: number(ya, yb)});\n    } else if (xb !== 1 || yb !== 1) {\n      s.push(pop(s) + \"scale(\" + xb + \",\" + yb + \")\");\n    }\n  }\n\n  return function(a, b) {\n    var s = [], // string constants and placeholders\n        q = []; // number interpolators\n    a = parse(a), b = parse(b);\n    translate(a.translateX, a.translateY, b.translateX, b.translateY, s, q);\n    rotate(a.rotate, b.rotate, s, q);\n    skewX(a.skewX, b.skewX, s, q);\n    scale(a.scaleX, a.scaleY, b.scaleX, b.scaleY, s, q);\n    a = b = null; // gc\n    return function(t) {\n      var i = -1, n = q.length, o;\n      while (++i < n) s[(o = q[i]).i] = o.x(t);\n      return s.join(\"\");\n    };\n  };\n}\n\nexport var interpolateTransformCss = interpolateTransform(parseCss, \"px, \", \"px)\", \"deg)\");\nexport var interpolateTransformSvg = interpolateTransform(parseSvg, \", \", \")\", \")\");\n","var epsilon2 = 1e-12;\n\nfunction cosh(x) {\n  return ((x = Math.exp(x)) + 1 / x) / 2;\n}\n\nfunction sinh(x) {\n  return ((x = Math.exp(x)) - 1 / x) / 2;\n}\n\nfunction tanh(x) {\n  return ((x = Math.exp(2 * x)) - 1) / (x + 1);\n}\n\nexport default (function zoomRho(rho, rho2, rho4) {\n\n  // p0 = [ux0, uy0, w0]\n  // p1 = [ux1, uy1, w1]\n  function zoom(p0, p1) {\n    var ux0 = p0[0], uy0 = p0[1], w0 = p0[2],\n        ux1 = p1[0], uy1 = p1[1], w1 = p1[2],\n        dx = ux1 - ux0,\n        dy = uy1 - uy0,\n        d2 = dx * dx + dy * dy,\n        i,\n        S;\n\n    // Special case for u0 ≅ u1.\n    if (d2 < epsilon2) {\n      S = Math.log(w1 / w0) / rho;\n      i = function(t) {\n        return [\n          ux0 + t * dx,\n          uy0 + t * dy,\n          w0 * Math.exp(rho * t * S)\n        ];\n      }\n    }\n\n    // General case.\n    else {\n      var d1 = Math.sqrt(d2),\n          b0 = (w1 * w1 - w0 * w0 + rho4 * d2) / (2 * w0 * rho2 * d1),\n          b1 = (w1 * w1 - w0 * w0 - rho4 * d2) / (2 * w1 * rho2 * d1),\n          r0 = Math.log(Math.sqrt(b0 * b0 + 1) - b0),\n          r1 = Math.log(Math.sqrt(b1 * b1 + 1) - b1);\n      S = (r1 - r0) / rho;\n      i = function(t) {\n        var s = t * S,\n            coshr0 = cosh(r0),\n            u = w0 / (rho2 * d1) * (coshr0 * tanh(rho * s + r0) - sinh(r0));\n        return [\n          ux0 + u * dx,\n          uy0 + u * dy,\n          w0 * coshr0 / cosh(rho * s + r0)\n        ];\n      }\n    }\n\n    i.duration = S * 1000 * rho / Math.SQRT2;\n\n    return i;\n  }\n\n  zoom.rho = function(_) {\n    var _1 = Math.max(1e-3, +_), _2 = _1 * _1, _4 = _2 * _2;\n    return zoomRho(_1, _2, _4);\n  };\n\n  return zoom;\n})(Math.SQRT2, 2, 4);\n","var frame = 0, // is an animation frame pending?\n    timeout = 0, // is a timeout pending?\n    interval = 0, // are any timers active?\n    pokeDelay = 1000, // how frequently we check for clock skew\n    taskHead,\n    taskTail,\n    clockLast = 0,\n    clockNow = 0,\n    clockSkew = 0,\n    clock = typeof performance === \"object\" && performance.now ? performance : Date,\n    setFrame = typeof window === \"object\" && window.requestAnimationFrame ? window.requestAnimationFrame.bind(window) : function(f) { setTimeout(f, 17); };\n\nexport function now() {\n  return clockNow || (setFrame(clearNow), clockNow = clock.now() + clockSkew);\n}\n\nfunction clearNow() {\n  clockNow = 0;\n}\n\nexport function Timer() {\n  this._call =\n  this._time =\n  this._next = null;\n}\n\nTimer.prototype = timer.prototype = {\n  constructor: Timer,\n  restart: function(callback, delay, time) {\n    if (typeof callback !== \"function\") throw new TypeError(\"callback is not a function\");\n    time = (time == null ? now() : +time) + (delay == null ? 0 : +delay);\n    if (!this._next && taskTail !== this) {\n      if (taskTail) taskTail._next = this;\n      else taskHead = this;\n      taskTail = this;\n    }\n    this._call = callback;\n    this._time = time;\n    sleep();\n  },\n  stop: function() {\n    if (this._call) {\n      this._call = null;\n      this._time = Infinity;\n      sleep();\n    }\n  }\n};\n\nexport function timer(callback, delay, time) {\n  var t = new Timer;\n  t.restart(callback, delay, time);\n  return t;\n}\n\nexport function timerFlush() {\n  now(); // Get the current time, if not already set.\n  ++frame; // Pretend we’ve set an alarm, if we haven’t already.\n  var t = taskHead, e;\n  while (t) {\n    if ((e = clockNow - t._time) >= 0) t._call.call(undefined, e);\n    t = t._next;\n  }\n  --frame;\n}\n\nfunction wake() {\n  clockNow = (clockLast = clock.now()) + clockSkew;\n  frame = timeout = 0;\n  try {\n    timerFlush();\n  } finally {\n    frame = 0;\n    nap();\n    clockNow = 0;\n  }\n}\n\nfunction poke() {\n  var now = clock.now(), delay = now - clockLast;\n  if (delay > pokeDelay) clockSkew -= delay, clockLast = now;\n}\n\nfunction nap() {\n  var t0, t1 = taskHead, t2, time = Infinity;\n  while (t1) {\n    if (t1._call) {\n      if (time > t1._time) time = t1._time;\n      t0 = t1, t1 = t1._next;\n    } else {\n      t2 = t1._next, t1._next = null;\n      t1 = t0 ? t0._next = t2 : taskHead = t2;\n    }\n  }\n  taskTail = t0;\n  sleep(time);\n}\n\nfunction sleep(time) {\n  if (frame) return; // Soonest alarm already set, or will be.\n  if (timeout) timeout = clearTimeout(timeout);\n  var delay = time - clockNow; // Strictly less than if we recomputed clockNow.\n  if (delay > 24) {\n    if (time < Infinity) timeout = setTimeout(wake, time - clock.now() - clockSkew);\n    if (interval) interval = clearInterval(interval);\n  } else {\n    if (!interval) clockLast = clock.now(), interval = setInterval(poke, pokeDelay);\n    frame = 1, setFrame(wake);\n  }\n}\n","import {Timer} from \"./timer.js\";\n\nexport default function(callback, delay, time) {\n  var t = new Timer;\n  delay = delay == null ? 0 : +delay;\n  t.restart(elapsed => {\n    t.stop();\n    callback(elapsed + delay);\n  }, delay, time);\n  return t;\n}\n","import {dispatch} from \"d3-dispatch\";\nimport {timer, timeout} from \"d3-timer\";\n\nvar emptyOn = dispatch(\"start\", \"end\", \"cancel\", \"interrupt\");\nvar emptyTween = [];\n\nexport var CREATED = 0;\nexport var SCHEDULED = 1;\nexport var STARTING = 2;\nexport var STARTED = 3;\nexport var RUNNING = 4;\nexport var ENDING = 5;\nexport var ENDED = 6;\n\nexport default function(node, name, id, index, group, timing) {\n  var schedules = node.__transition;\n  if (!schedules) node.__transition = {};\n  else if (id in schedules) return;\n  create(node, id, {\n    name: name,\n    index: index, // For context during callback.\n    group: group, // For context during callback.\n    on: emptyOn,\n    tween: emptyTween,\n    time: timing.time,\n    delay: timing.delay,\n    duration: timing.duration,\n    ease: timing.ease,\n    timer: null,\n    state: CREATED\n  });\n}\n\nexport function init(node, id) {\n  var schedule = get(node, id);\n  if (schedule.state > CREATED) throw new Error(\"too late; already scheduled\");\n  return schedule;\n}\n\nexport function set(node, id) {\n  var schedule = get(node, id);\n  if (schedule.state > STARTED) throw new Error(\"too late; already running\");\n  return schedule;\n}\n\nexport function get(node, id) {\n  var schedule = node.__transition;\n  if (!schedule || !(schedule = schedule[id])) throw new Error(\"transition not found\");\n  return schedule;\n}\n\nfunction create(node, id, self) {\n  var schedules = node.__transition,\n      tween;\n\n  // Initialize the self timer when the transition is created.\n  // Note the actual delay is not known until the first callback!\n  schedules[id] = self;\n  self.timer = timer(schedule, 0, self.time);\n\n  function schedule(elapsed) {\n    self.state = SCHEDULED;\n    self.timer.restart(start, self.delay, self.time);\n\n    // If the elapsed delay is less than our first sleep, start immediately.\n    if (self.delay <= elapsed) start(elapsed - self.delay);\n  }\n\n  function start(elapsed) {\n    var i, j, n, o;\n\n    // If the state is not SCHEDULED, then we previously errored on start.\n    if (self.state !== SCHEDULED) return stop();\n\n    for (i in schedules) {\n      o = schedules[i];\n      if (o.name !== self.name) continue;\n\n      // While this element already has a starting transition during this frame,\n      // defer starting an interrupting transition until that transition has a\n      // chance to tick (and possibly end); see d3/d3-transition#54!\n      if (o.state === STARTED) return timeout(start);\n\n      // Interrupt the active transition, if any.\n      if (o.state === RUNNING) {\n        o.state = ENDED;\n        o.timer.stop();\n        o.on.call(\"interrupt\", node, node.__data__, o.index, o.group);\n        delete schedules[i];\n      }\n\n      // Cancel any pre-empted transitions.\n      else if (+i < id) {\n        o.state = ENDED;\n        o.timer.stop();\n        o.on.call(\"cancel\", node, node.__data__, o.index, o.group);\n        delete schedules[i];\n      }\n    }\n\n    // Defer the first tick to end of the current frame; see d3/d3#1576.\n    // Note the transition may be canceled after start and before the first tick!\n    // Note this must be scheduled before the start event; see d3/d3-transition#16!\n    // Assuming this is successful, subsequent callbacks go straight to tick.\n    timeout(function() {\n      if (self.state === STARTED) {\n        self.state = RUNNING;\n        self.timer.restart(tick, self.delay, self.time);\n        tick(elapsed);\n      }\n    });\n\n    // Dispatch the start event.\n    // Note this must be done before the tween are initialized.\n    self.state = STARTING;\n    self.on.call(\"start\", node, node.__data__, self.index, self.group);\n    if (self.state !== STARTING) return; // interrupted\n    self.state = STARTED;\n\n    // Initialize the tween, deleting null tween.\n    tween = new Array(n = self.tween.length);\n    for (i = 0, j = -1; i < n; ++i) {\n      if (o = self.tween[i].value.call(node, node.__data__, self.index, self.group)) {\n        tween[++j] = o;\n      }\n    }\n    tween.length = j + 1;\n  }\n\n  function tick(elapsed) {\n    var t = elapsed < self.duration ? self.ease.call(null, elapsed / self.duration) : (self.timer.restart(stop), self.state = ENDING, 1),\n        i = -1,\n        n = tween.length;\n\n    while (++i < n) {\n      tween[i].call(node, t);\n    }\n\n    // Dispatch the end event.\n    if (self.state === ENDING) {\n      self.on.call(\"end\", node, node.__data__, self.index, self.group);\n      stop();\n    }\n  }\n\n  function stop() {\n    self.state = ENDED;\n    self.timer.stop();\n    delete schedules[id];\n    for (var i in schedules) return; // eslint-disable-line no-unused-vars\n    delete node.__transition;\n  }\n}\n","import {STARTING, ENDING, ENDED} from \"./transition/schedule.js\";\n\nexport default function(node, name) {\n  var schedules = node.__transition,\n      schedule,\n      active,\n      empty = true,\n      i;\n\n  if (!schedules) return;\n\n  name = name == null ? null : name + \"\";\n\n  for (i in schedules) {\n    if ((schedule = schedules[i]).name !== name) { empty = false; continue; }\n    active = schedule.state > STARTING && schedule.state < ENDING;\n    schedule.state = ENDED;\n    schedule.timer.stop();\n    schedule.on.call(active ? \"interrupt\" : \"cancel\", node, node.__data__, schedule.index, schedule.group);\n    delete schedules[i];\n  }\n\n  if (empty) delete node.__transition;\n}\n","import {get, set} from \"./schedule.js\";\n\nfunction tweenRemove(id, name) {\n  var tween0, tween1;\n  return function() {\n    var schedule = set(this, id),\n        tween = schedule.tween;\n\n    // If this node shared tween with the previous node,\n    // just assign the updated shared tween and we’re done!\n    // Otherwise, copy-on-write.\n    if (tween !== tween0) {\n      tween1 = tween0 = tween;\n      for (var i = 0, n = tween1.length; i < n; ++i) {\n        if (tween1[i].name === name) {\n          tween1 = tween1.slice();\n          tween1.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    schedule.tween = tween1;\n  };\n}\n\nfunction tweenFunction(id, name, value) {\n  var tween0, tween1;\n  if (typeof value !== \"function\") throw new Error;\n  return function() {\n    var schedule = set(this, id),\n        tween = schedule.tween;\n\n    // If this node shared tween with the previous node,\n    // just assign the updated shared tween and we’re done!\n    // Otherwise, copy-on-write.\n    if (tween !== tween0) {\n      tween1 = (tween0 = tween).slice();\n      for (var t = {name: name, value: value}, i = 0, n = tween1.length; i < n; ++i) {\n        if (tween1[i].name === name) {\n          tween1[i] = t;\n          break;\n        }\n      }\n      if (i === n) tween1.push(t);\n    }\n\n    schedule.tween = tween1;\n  };\n}\n\nexport default function(name, value) {\n  var id = this._id;\n\n  name += \"\";\n\n  if (arguments.length < 2) {\n    var tween = get(this.node(), id).tween;\n    for (var i = 0, n = tween.length, t; i < n; ++i) {\n      if ((t = tween[i]).name === name) {\n        return t.value;\n      }\n    }\n    return null;\n  }\n\n  return this.each((value == null ? tweenRemove : tweenFunction)(id, name, value));\n}\n\nexport function tweenValue(transition, name, value) {\n  var id = transition._id;\n\n  transition.each(function() {\n    var schedule = set(this, id);\n    (schedule.value || (schedule.value = {}))[name] = value.apply(this, arguments);\n  });\n\n  return function(node) {\n    return get(node, id).value[name];\n  };\n}\n","import {color} from \"d3-color\";\nimport {interpolateNumber, interpolateRgb, interpolateString} from \"d3-interpolate\";\n\nexport default function(a, b) {\n  var c;\n  return (typeof b === \"number\" ? interpolateNumber\n      : b instanceof color ? interpolateRgb\n      : (c = color(b)) ? (b = c, interpolateRgb)\n      : interpolateString)(a, b);\n}\n","import {interpolateTransformSvg as interpolateTransform} from \"d3-interpolate\";\nimport {namespace} from \"d3-selection\";\nimport {tweenValue} from \"./tween.js\";\nimport interpolate from \"./interpolate.js\";\n\nfunction attrRemove(name) {\n  return function() {\n    this.removeAttribute(name);\n  };\n}\n\nfunction attrRemoveNS(fullname) {\n  return function() {\n    this.removeAttributeNS(fullname.space, fullname.local);\n  };\n}\n\nfunction attrConstant(name, interpolate, value1) {\n  var string00,\n      string1 = value1 + \"\",\n      interpolate0;\n  return function() {\n    var string0 = this.getAttribute(name);\n    return string0 === string1 ? null\n        : string0 === string00 ? interpolate0\n        : interpolate0 = interpolate(string00 = string0, value1);\n  };\n}\n\nfunction attrConstantNS(fullname, interpolate, value1) {\n  var string00,\n      string1 = value1 + \"\",\n      interpolate0;\n  return function() {\n    var string0 = this.getAttributeNS(fullname.space, fullname.local);\n    return string0 === string1 ? null\n        : string0 === string00 ? interpolate0\n        : interpolate0 = interpolate(string00 = string0, value1);\n  };\n}\n\nfunction attrFunction(name, interpolate, value) {\n  var string00,\n      string10,\n      interpolate0;\n  return function() {\n    var string0, value1 = value(this), string1;\n    if (value1 == null) return void this.removeAttribute(name);\n    string0 = this.getAttribute(name);\n    string1 = value1 + \"\";\n    return string0 === string1 ? null\n        : string0 === string00 && string1 === string10 ? interpolate0\n        : (string10 = string1, interpolate0 = interpolate(string00 = string0, value1));\n  };\n}\n\nfunction attrFunctionNS(fullname, interpolate, value) {\n  var string00,\n      string10,\n      interpolate0;\n  return function() {\n    var string0, value1 = value(this), string1;\n    if (value1 == null) return void this.removeAttributeNS(fullname.space, fullname.local);\n    string0 = this.getAttributeNS(fullname.space, fullname.local);\n    string1 = value1 + \"\";\n    return string0 === string1 ? null\n        : string0 === string00 && string1 === string10 ? interpolate0\n        : (string10 = string1, interpolate0 = interpolate(string00 = string0, value1));\n  };\n}\n\nexport default function(name, value) {\n  var fullname = namespace(name), i = fullname === \"transform\" ? interpolateTransform : interpolate;\n  return this.attrTween(name, typeof value === \"function\"\n      ? (fullname.local ? attrFunctionNS : attrFunction)(fullname, i, tweenValue(this, \"attr.\" + name, value))\n      : value == null ? (fullname.local ? attrRemoveNS : attrRemove)(fullname)\n      : (fullname.local ? attrConstantNS : attrConstant)(fullname, i, value));\n}\n","import {namespace} from \"d3-selection\";\n\nfunction attrInterpolate(name, i) {\n  return function(t) {\n    this.setAttribute(name, i.call(this, t));\n  };\n}\n\nfunction attrInterpolateNS(fullname, i) {\n  return function(t) {\n    this.setAttributeNS(fullname.space, fullname.local, i.call(this, t));\n  };\n}\n\nfunction attrTweenNS(fullname, value) {\n  var t0, i0;\n  function tween() {\n    var i = value.apply(this, arguments);\n    if (i !== i0) t0 = (i0 = i) && attrInterpolateNS(fullname, i);\n    return t0;\n  }\n  tween._value = value;\n  return tween;\n}\n\nfunction attrTween(name, value) {\n  var t0, i0;\n  function tween() {\n    var i = value.apply(this, arguments);\n    if (i !== i0) t0 = (i0 = i) && attrInterpolate(name, i);\n    return t0;\n  }\n  tween._value = value;\n  return tween;\n}\n\nexport default function(name, value) {\n  var key = \"attr.\" + name;\n  if (arguments.length < 2) return (key = this.tween(key)) && key._value;\n  if (value == null) return this.tween(key, null);\n  if (typeof value !== \"function\") throw new Error;\n  var fullname = namespace(name);\n  return this.tween(key, (fullname.local ? attrTweenNS : attrTween)(fullname, value));\n}\n","import {get, init} from \"./schedule.js\";\n\nfunction delayFunction(id, value) {\n  return function() {\n    init(this, id).delay = +value.apply(this, arguments);\n  };\n}\n\nfunction delayConstant(id, value) {\n  return value = +value, function() {\n    init(this, id).delay = value;\n  };\n}\n\nexport default function(value) {\n  var id = this._id;\n\n  return arguments.length\n      ? this.each((typeof value === \"function\"\n          ? delayFunction\n          : delayConstant)(id, value))\n      : get(this.node(), id).delay;\n}\n","import {get, set} from \"./schedule.js\";\n\nfunction durationFunction(id, value) {\n  return function() {\n    set(this, id).duration = +value.apply(this, arguments);\n  };\n}\n\nfunction durationConstant(id, value) {\n  return value = +value, function() {\n    set(this, id).duration = value;\n  };\n}\n\nexport default function(value) {\n  var id = this._id;\n\n  return arguments.length\n      ? this.each((typeof value === \"function\"\n          ? durationFunction\n          : durationConstant)(id, value))\n      : get(this.node(), id).duration;\n}\n","import {selection} from \"d3-selection\";\n\nvar Selection = selection.prototype.constructor;\n\nexport default function() {\n  return new Selection(this._groups, this._parents);\n}\n","import {interpolateTransformCss as interpolateTransform} from \"d3-interpolate\";\nimport {style} from \"d3-selection\";\nimport {set} from \"./schedule.js\";\nimport {tweenValue} from \"./tween.js\";\nimport interpolate from \"./interpolate.js\";\n\nfunction styleNull(name, interpolate) {\n  var string00,\n      string10,\n      interpolate0;\n  return function() {\n    var string0 = style(this, name),\n        string1 = (this.style.removeProperty(name), style(this, name));\n    return string0 === string1 ? null\n        : string0 === string00 && string1 === string10 ? interpolate0\n        : interpolate0 = interpolate(string00 = string0, string10 = string1);\n  };\n}\n\nfunction styleRemove(name) {\n  return function() {\n    this.style.removeProperty(name);\n  };\n}\n\nfunction styleConstant(name, interpolate, value1) {\n  var string00,\n      string1 = value1 + \"\",\n      interpolate0;\n  return function() {\n    var string0 = style(this, name);\n    return string0 === string1 ? null\n        : string0 === string00 ? interpolate0\n        : interpolate0 = interpolate(string00 = string0, value1);\n  };\n}\n\nfunction styleFunction(name, interpolate, value) {\n  var string00,\n      string10,\n      interpolate0;\n  return function() {\n    var string0 = style(this, name),\n        value1 = value(this),\n        string1 = value1 + \"\";\n    if (value1 == null) string1 = value1 = (this.style.removeProperty(name), style(this, name));\n    return string0 === string1 ? null\n        : string0 === string00 && string1 === string10 ? interpolate0\n        : (string10 = string1, interpolate0 = interpolate(string00 = string0, value1));\n  };\n}\n\nfunction styleMaybeRemove(id, name) {\n  var on0, on1, listener0, key = \"style.\" + name, event = \"end.\" + key, remove;\n  return function() {\n    var schedule = set(this, id),\n        on = schedule.on,\n        listener = schedule.value[key] == null ? remove || (remove = styleRemove(name)) : undefined;\n\n    // If this node shared a dispatch with the previous node,\n    // just assign the updated shared dispatch and we’re done!\n    // Otherwise, copy-on-write.\n    if (on !== on0 || listener0 !== listener) (on1 = (on0 = on).copy()).on(event, listener0 = listener);\n\n    schedule.on = on1;\n  };\n}\n\nexport default function(name, value, priority) {\n  var i = (name += \"\") === \"transform\" ? interpolateTransform : interpolate;\n  return value == null ? this\n      .styleTween(name, styleNull(name, i))\n      .on(\"end.style.\" + name, styleRemove(name))\n    : typeof value === \"function\" ? this\n      .styleTween(name, styleFunction(name, i, tweenValue(this, \"style.\" + name, value)))\n      .each(styleMaybeRemove(this._id, name))\n    : this\n      .styleTween(name, styleConstant(name, i, value), priority)\n      .on(\"end.style.\" + name, null);\n}\n","import {selection} from \"d3-selection\";\nimport transition_attr from \"./attr.js\";\nimport transition_attrTween from \"./attrTween.js\";\nimport transition_delay from \"./delay.js\";\nimport transition_duration from \"./duration.js\";\nimport transition_ease from \"./ease.js\";\nimport transition_easeVarying from \"./easeVarying.js\";\nimport transition_filter from \"./filter.js\";\nimport transition_merge from \"./merge.js\";\nimport transition_on from \"./on.js\";\nimport transition_remove from \"./remove.js\";\nimport transition_select from \"./select.js\";\nimport transition_selectAll from \"./selectAll.js\";\nimport transition_selection from \"./selection.js\";\nimport transition_style from \"./style.js\";\nimport transition_styleTween from \"./styleTween.js\";\nimport transition_text from \"./text.js\";\nimport transition_textTween from \"./textTween.js\";\nimport transition_transition from \"./transition.js\";\nimport transition_tween from \"./tween.js\";\nimport transition_end from \"./end.js\";\n\nvar id = 0;\n\nexport function Transition(groups, parents, name, id) {\n  this._groups = groups;\n  this._parents = parents;\n  this._name = name;\n  this._id = id;\n}\n\nexport default function transition(name) {\n  return selection().transition(name);\n}\n\nexport function newId() {\n  return ++id;\n}\n\nvar selection_prototype = selection.prototype;\n\nTransition.prototype = transition.prototype = {\n  constructor: Transition,\n  select: transition_select,\n  selectAll: transition_selectAll,\n  selectChild: selection_prototype.selectChild,\n  selectChildren: selection_prototype.selectChildren,\n  filter: transition_filter,\n  merge: transition_merge,\n  selection: transition_selection,\n  transition: transition_transition,\n  call: selection_prototype.call,\n  nodes: selection_prototype.nodes,\n  node: selection_prototype.node,\n  size: selection_prototype.size,\n  empty: selection_prototype.empty,\n  each: selection_prototype.each,\n  on: transition_on,\n  attr: transition_attr,\n  attrTween: transition_attrTween,\n  style: transition_style,\n  styleTween: transition_styleTween,\n  text: transition_text,\n  textTween: transition_textTween,\n  remove: transition_remove,\n  tween: transition_tween,\n  delay: transition_delay,\n  duration: transition_duration,\n  ease: transition_ease,\n  easeVarying: transition_easeVarying,\n  end: transition_end,\n  [Symbol.iterator]: selection_prototype[Symbol.iterator]\n};\n","import {selector} from \"d3-selection\";\nimport {Transition} from \"./index.js\";\nimport schedule, {get} from \"./schedule.js\";\n\nexport default function(select) {\n  var name = this._name,\n      id = this._id;\n\n  if (typeof select !== \"function\") select = selector(select);\n\n  for (var groups = this._groups, m = groups.length, subgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, subgroup = subgroups[j] = new Array(n), node, subnode, i = 0; i < n; ++i) {\n      if ((node = group[i]) && (subnode = select.call(node, node.__data__, i, group))) {\n        if (\"__data__\" in node) subnode.__data__ = node.__data__;\n        subgroup[i] = subnode;\n        schedule(subgroup[i], name, id, i, subgroup, get(node, id));\n      }\n    }\n  }\n\n  return new Transition(subgroups, this._parents, name, id);\n}\n","import {selectorAll} from \"d3-selection\";\nimport {Transition} from \"./index.js\";\nimport schedule, {get} from \"./schedule.js\";\n\nexport default function(select) {\n  var name = this._name,\n      id = this._id;\n\n  if (typeof select !== \"function\") select = selectorAll(select);\n\n  for (var groups = this._groups, m = groups.length, subgroups = [], parents = [], j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        for (var children = select.call(node, node.__data__, i, group), child, inherit = get(node, id), k = 0, l = children.length; k < l; ++k) {\n          if (child = children[k]) {\n            schedule(child, name, id, k, children, inherit);\n          }\n        }\n        subgroups.push(children);\n        parents.push(node);\n      }\n    }\n  }\n\n  return new Transition(subgroups, parents, name, id);\n}\n","import {matcher} from \"d3-selection\";\nimport {Transition} from \"./index.js\";\n\nexport default function(match) {\n  if (typeof match !== \"function\") match = matcher(match);\n\n  for (var groups = this._groups, m = groups.length, subgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, subgroup = subgroups[j] = [], node, i = 0; i < n; ++i) {\n      if ((node = group[i]) && match.call(node, node.__data__, i, group)) {\n        subgroup.push(node);\n      }\n    }\n  }\n\n  return new Transition(subgroups, this._parents, this._name, this._id);\n}\n","import {Transition} from \"./index.js\";\n\nexport default function(transition) {\n  if (transition._id !== this._id) throw new Error;\n\n  for (var groups0 = this._groups, groups1 = transition._groups, m0 = groups0.length, m1 = groups1.length, m = Math.min(m0, m1), merges = new Array(m0), j = 0; j < m; ++j) {\n    for (var group0 = groups0[j], group1 = groups1[j], n = group0.length, merge = merges[j] = new Array(n), node, i = 0; i < n; ++i) {\n      if (node = group0[i] || group1[i]) {\n        merge[i] = node;\n      }\n    }\n  }\n\n  for (; j < m0; ++j) {\n    merges[j] = groups0[j];\n  }\n\n  return new Transition(merges, this._parents, this._name, this._id);\n}\n","import {Transition, newId} from \"./index.js\";\nimport schedule, {get} from \"./schedule.js\";\n\nexport default function() {\n  var name = this._name,\n      id0 = this._id,\n      id1 = newId();\n\n  for (var groups = this._groups, m = groups.length, j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        var inherit = get(node, id0);\n        schedule(node, name, id1, i, group, {\n          time: inherit.time + inherit.delay + inherit.duration,\n          delay: 0,\n          duration: inherit.duration,\n          ease: inherit.ease\n        });\n      }\n    }\n  }\n\n  return new Transition(groups, this._parents, name, id1);\n}\n","import {get, set, init} from \"./schedule.js\";\n\nfunction start(name) {\n  return (name + \"\").trim().split(/^|\\s+/).every(function(t) {\n    var i = t.indexOf(\".\");\n    if (i >= 0) t = t.slice(0, i);\n    return !t || t === \"start\";\n  });\n}\n\nfunction onFunction(id, name, listener) {\n  var on0, on1, sit = start(name) ? init : set;\n  return function() {\n    var schedule = sit(this, id),\n        on = schedule.on;\n\n    // If this node shared a dispatch with the previous node,\n    // just assign the updated shared dispatch and we’re done!\n    // Otherwise, copy-on-write.\n    if (on !== on0) (on1 = (on0 = on).copy()).on(name, listener);\n\n    schedule.on = on1;\n  };\n}\n\nexport default function(name, listener) {\n  var id = this._id;\n\n  return arguments.length < 2\n      ? get(this.node(), id).on.on(name)\n      : this.each(onFunction(id, name, listener));\n}\n","function styleInterpolate(name, i, priority) {\n  return function(t) {\n    this.style.setProperty(name, i.call(this, t), priority);\n  };\n}\n\nfunction styleTween(name, value, priority) {\n  var t, i0;\n  function tween() {\n    var i = value.apply(this, arguments);\n    if (i !== i0) t = (i0 = i) && styleInterpolate(name, i, priority);\n    return t;\n  }\n  tween._value = value;\n  return tween;\n}\n\nexport default function(name, value, priority) {\n  var key = \"style.\" + (name += \"\");\n  if (arguments.length < 2) return (key = this.tween(key)) && key._value;\n  if (value == null) return this.tween(key, null);\n  if (typeof value !== \"function\") throw new Error;\n  return this.tween(key, styleTween(name, value, priority == null ? \"\" : priority));\n}\n","import {tweenValue} from \"./tween.js\";\n\nfunction textConstant(value) {\n  return function() {\n    this.textContent = value;\n  };\n}\n\nfunction textFunction(value) {\n  return function() {\n    var value1 = value(this);\n    this.textContent = value1 == null ? \"\" : value1;\n  };\n}\n\nexport default function(value) {\n  return this.tween(\"text\", typeof value === \"function\"\n      ? textFunction(tweenValue(this, \"text\", value))\n      : textConstant(value == null ? \"\" : value + \"\"));\n}\n","function textInterpolate(i) {\n  return function(t) {\n    this.textContent = i.call(this, t);\n  };\n}\n\nfunction textTween(value) {\n  var t0, i0;\n  function tween() {\n    var i = value.apply(this, arguments);\n    if (i !== i0) t0 = (i0 = i) && textInterpolate(i);\n    return t0;\n  }\n  tween._value = value;\n  return tween;\n}\n\nexport default function(value) {\n  var key = \"text\";\n  if (arguments.length < 1) return (key = this.tween(key)) && key._value;\n  if (value == null) return this.tween(key, null);\n  if (typeof value !== \"function\") throw new Error;\n  return this.tween(key, textTween(value));\n}\n","function removeFunction(id) {\n  return function() {\n    var parent = this.parentNode;\n    for (var i in this.__transition) if (+i !== id) return;\n    if (parent) parent.removeChild(this);\n  };\n}\n\nexport default function() {\n  return this.on(\"end.remove\", removeFunction(this._id));\n}\n","import {get, set} from \"./schedule.js\";\n\nfunction easeConstant(id, value) {\n  if (typeof value !== \"function\") throw new Error;\n  return function() {\n    set(this, id).ease = value;\n  };\n}\n\nexport default function(value) {\n  var id = this._id;\n\n  return arguments.length\n      ? this.each(easeConstant(id, value))\n      : get(this.node(), id).ease;\n}\n","import {set} from \"./schedule.js\";\n\nfunction easeVarying(id, value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (typeof v !== \"function\") throw new Error;\n    set(this, id).ease = v;\n  };\n}\n\nexport default function(value) {\n  if (typeof value !== \"function\") throw new Error;\n  return this.each(easeVarying(this._id, value));\n}\n","import {set} from \"./schedule.js\";\n\nexport default function() {\n  var on0, on1, that = this, id = that._id, size = that.size();\n  return new Promise(function(resolve, reject) {\n    var cancel = {value: reject},\n        end = {value: function() { if (--size === 0) resolve(); }};\n\n    that.each(function() {\n      var schedule = set(this, id),\n          on = schedule.on;\n\n      // If this node shared a dispatch with the previous node,\n      // just assign the updated shared dispatch and we’re done!\n      // Otherwise, copy-on-write.\n      if (on !== on0) {\n        on1 = (on0 = on).copy();\n        on1._.cancel.push(cancel);\n        on1._.interrupt.push(cancel);\n        on1._.end.push(end);\n      }\n\n      schedule.on = on1;\n    });\n\n    // The selection was empty, resolve end immediately\n    if (size === 0) resolve();\n  });\n}\n","import {Transition, newId} from \"../transition/index.js\";\nimport schedule from \"../transition/schedule.js\";\nimport {easeCubicInOut} from \"d3-ease\";\nimport {now} from \"d3-timer\";\n\nvar defaultTiming = {\n  time: null, // Set on use.\n  delay: 0,\n  duration: 250,\n  ease: easeCubicInOut\n};\n\nfunction inherit(node, id) {\n  var timing;\n  while (!(timing = node.__transition) || !(timing = timing[id])) {\n    if (!(node = node.parentNode)) {\n      throw new Error(`transition ${id} not found`);\n    }\n  }\n  return timing;\n}\n\nexport default function(name) {\n  var id,\n      timing;\n\n  if (name instanceof Transition) {\n    id = name._id, name = name._name;\n  } else {\n    id = newId(), (timing = defaultTiming).time = now(), name = name == null ? null : name + \"\";\n  }\n\n  for (var groups = this._groups, m = groups.length, j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        schedule(node, name, id, i, group, timing || inherit(node, id));\n      }\n    }\n  }\n\n  return new Transition(groups, this._parents, name, id);\n}\n","import {selection} from \"d3-selection\";\nimport selection_interrupt from \"./interrupt.js\";\nimport selection_transition from \"./transition.js\";\n\nselection.prototype.interrupt = selection_interrupt;\nselection.prototype.transition = selection_transition;\n","import interrupt from \"../interrupt.js\";\n\nexport default function(name) {\n  return this.each(function() {\n    interrupt(this, name);\n  });\n}\n","export default x => () => x;\n","export default function ZoomEvent(type, {\n  sourceEvent,\n  target,\n  transform,\n  dispatch\n}) {\n  Object.defineProperties(this, {\n    type: {value: type, enumerable: true, configurable: true},\n    sourceEvent: {value: sourceEvent, enumerable: true, configurable: true},\n    target: {value: target, enumerable: true, configurable: true},\n    transform: {value: transform, enumerable: true, configurable: true},\n    _: {value: dispatch}\n  });\n}\n","export function Transform(k, x, y) {\n  this.k = k;\n  this.x = x;\n  this.y = y;\n}\n\nTransform.prototype = {\n  constructor: Transform,\n  scale: function(k) {\n    return k === 1 ? this : new Transform(this.k * k, this.x, this.y);\n  },\n  translate: function(x, y) {\n    return x === 0 & y === 0 ? this : new Transform(this.k, this.x + this.k * x, this.y + this.k * y);\n  },\n  apply: function(point) {\n    return [point[0] * this.k + this.x, point[1] * this.k + this.y];\n  },\n  applyX: function(x) {\n    return x * this.k + this.x;\n  },\n  applyY: function(y) {\n    return y * this.k + this.y;\n  },\n  invert: function(location) {\n    return [(location[0] - this.x) / this.k, (location[1] - this.y) / this.k];\n  },\n  invertX: function(x) {\n    return (x - this.x) / this.k;\n  },\n  invertY: function(y) {\n    return (y - this.y) / this.k;\n  },\n  rescaleX: function(x) {\n    return x.copy().domain(x.range().map(this.invertX, this).map(x.invert, x));\n  },\n  rescaleY: function(y) {\n    return y.copy().domain(y.range().map(this.invertY, this).map(y.invert, y));\n  },\n  toString: function() {\n    return \"translate(\" + this.x + \",\" + this.y + \") scale(\" + this.k + \")\";\n  }\n};\n\nexport var identity = new Transform(1, 0, 0);\n\ntransform.prototype = Transform.prototype;\n\nexport default function transform(node) {\n  while (!node.__zoom) if (!(node = node.parentNode)) return identity;\n  return node.__zoom;\n}\n","export function nopropagation(event) {\n  event.stopImmediatePropagation();\n}\n\nexport default function(event) {\n  event.preventDefault();\n  event.stopImmediatePropagation();\n}\n","import {dispatch} from \"d3-dispatch\";\nimport {dragDisable, dragEnable} from \"d3-drag\";\nimport {interpolateZoom} from \"d3-interpolate\";\nimport {select, pointer} from \"d3-selection\";\nimport {interrupt} from \"d3-transition\";\nimport constant from \"./constant.js\";\nimport ZoomEvent from \"./event.js\";\nimport {Transform, identity} from \"./transform.js\";\nimport noevent, {nopropagation} from \"./noevent.js\";\n\n// Ignore right-click, since that should open the context menu.\n// except for pinch-to-zoom, which is sent as a wheel+ctrlKey event\nfunction defaultFilter(event) {\n  return (!event.ctrlKey || event.type === 'wheel') && !event.button;\n}\n\nfunction defaultExtent() {\n  var e = this;\n  if (e instanceof SVGElement) {\n    e = e.ownerSVGElement || e;\n    if (e.hasAttribute(\"viewBox\")) {\n      e = e.viewBox.baseVal;\n      return [[e.x, e.y], [e.x + e.width, e.y + e.height]];\n    }\n    return [[0, 0], [e.width.baseVal.value, e.height.baseVal.value]];\n  }\n  return [[0, 0], [e.clientWidth, e.clientHeight]];\n}\n\nfunction defaultTransform() {\n  return this.__zoom || identity;\n}\n\nfunction defaultWheelDelta(event) {\n  return -event.deltaY * (event.deltaMode === 1 ? 0.05 : event.deltaMode ? 1 : 0.002) * (event.ctrlKey ? 10 : 1);\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || (\"ontouchstart\" in this);\n}\n\nfunction defaultConstrain(transform, extent, translateExtent) {\n  var dx0 = transform.invertX(extent[0][0]) - translateExtent[0][0],\n      dx1 = transform.invertX(extent[1][0]) - translateExtent[1][0],\n      dy0 = transform.invertY(extent[0][1]) - translateExtent[0][1],\n      dy1 = transform.invertY(extent[1][1]) - translateExtent[1][1];\n  return transform.translate(\n    dx1 > dx0 ? (dx0 + dx1) / 2 : Math.min(0, dx0) || Math.max(0, dx1),\n    dy1 > dy0 ? (dy0 + dy1) / 2 : Math.min(0, dy0) || Math.max(0, dy1)\n  );\n}\n\nexport default function() {\n  var filter = defaultFilter,\n      extent = defaultExtent,\n      constrain = defaultConstrain,\n      wheelDelta = defaultWheelDelta,\n      touchable = defaultTouchable,\n      scaleExtent = [0, Infinity],\n      translateExtent = [[-Infinity, -Infinity], [Infinity, Infinity]],\n      duration = 250,\n      interpolate = interpolateZoom,\n      listeners = dispatch(\"start\", \"zoom\", \"end\"),\n      touchstarting,\n      touchfirst,\n      touchending,\n      touchDelay = 500,\n      wheelDelay = 150,\n      clickDistance2 = 0,\n      tapDistance = 10,\n      // Elyra Extension - the trackpad variable is used to determine if\n      // trackpad behavior is required. That is, when the user does two finger\n      // scroll it pans the canvas up, down, left and right,\n      trackpad = false,\n      // Elyra Extension - the preventBackGesture variable is used to determine\n      // if the default behavior in browsers, which is that a two finger swipe\n      // right is a 'back page' gesture, is to be prevented or not.\n      preventBackGesture = false;\n\n  function zoom(selection) {\n    selection\n        .property(\"__zoom\", defaultTransform)\n        .on(\"wheel.zoom\", wheeled)\n        .on(\"mousedown.zoom\", mousedowned)\n        .on(\"dblclick.zoom\", dblclicked)\n        // Elyra Extension - These three gesture* event handlers are added for\n        // Safari support. By default, Safari interprets the finger spread\n        // gesture as zooming the entire page. These handlers allow the behavior\n        // to be overriden.\n        .on(\"gesturestart\", gesturestart)\n        .on(\"gesturechange\", gesturechange)\n        .on(\"gestureend\", gestureend)\n      .filter(touchable)\n        .on(\"touchstart.zoom\", touchstarted)\n        .on(\"touchmove.zoom\", touchmoved)\n        .on(\"touchend.zoom touchcancel.zoom\", touchended)\n        .style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  zoom.transform = function(collection, transform, point, event) {\n    var selection = collection.selection ? collection.selection() : collection;\n    selection.property(\"__zoom\", defaultTransform);\n    if (collection !== selection) {\n      schedule(collection, transform, point, event);\n    } else {\n      selection.interrupt().each(function() {\n        gesture(this, arguments)\n          .event(event)\n          .start()\n          .zoom(null, typeof transform === \"function\" ? transform.apply(this, arguments) : transform)\n          .end();\n      });\n    }\n  };\n\n  zoom.scaleBy = function(selection, k, p, event) {\n    zoom.scaleTo(selection, function() {\n      var k0 = this.__zoom.k,\n          k1 = typeof k === \"function\" ? k.apply(this, arguments) : k;\n      return k0 * k1;\n    }, p, event);\n  };\n\n  zoom.scaleTo = function(selection, k, p, event) {\n    zoom.transform(selection, function() {\n      var e = extent.apply(this, arguments),\n          t0 = this.__zoom,\n          p0 = p == null ? centroid(e) : typeof p === \"function\" ? p.apply(this, arguments) : p,\n          p1 = t0.invert(p0),\n          k1 = typeof k === \"function\" ? k.apply(this, arguments) : k;\n      return constrain(translate(scale(t0, k1), p0, p1), e, translateExtent);\n    }, p, event);\n  };\n\n  zoom.translateBy = function(selection, x, y, event) {\n    zoom.transform(selection, function() {\n      return constrain(this.__zoom.translate(\n        typeof x === \"function\" ? x.apply(this, arguments) : x,\n        typeof y === \"function\" ? y.apply(this, arguments) : y\n      ), extent.apply(this, arguments), translateExtent);\n    }, null, event);\n  };\n\n  zoom.translateTo = function(selection, x, y, p, event) {\n    zoom.transform(selection, function() {\n      var e = extent.apply(this, arguments),\n          t = this.__zoom,\n          p0 = p == null ? centroid(e) : typeof p === \"function\" ? p.apply(this, arguments) : p;\n      return constrain(identity.translate(p0[0], p0[1]).scale(t.k).translate(\n        typeof x === \"function\" ? -x.apply(this, arguments) : -x,\n        typeof y === \"function\" ? -y.apply(this, arguments) : -y\n      ), e, translateExtent);\n    }, p, event);\n  };\n\n  function scale(transform, k) {\n    k = Math.max(scaleExtent[0], Math.min(scaleExtent[1], k));\n    return k === transform.k ? transform : new Transform(k, transform.x, transform.y);\n  }\n\n  function translate(transform, p0, p1) {\n    var x = p0[0] - p1[0] * transform.k, y = p0[1] - p1[1] * transform.k;\n    return x === transform.x && y === transform.y ? transform : new Transform(transform.k, x, y);\n  }\n\n  function centroid(extent) {\n    return [(+extent[0][0] + +extent[1][0]) / 2, (+extent[0][1] + +extent[1][1]) / 2];\n  }\n\n  function schedule(transition, transform, point, event) {\n    transition\n        .on(\"start.zoom\", function() { gesture(this, arguments).event(event).start(); })\n        .on(\"interrupt.zoom end.zoom\", function() { gesture(this, arguments).event(event).end(); })\n        .tween(\"zoom\", function() {\n          var that = this,\n              args = arguments,\n              g = gesture(that, args).event(event),\n              e = extent.apply(that, args),\n              p = point == null ? centroid(e) : typeof point === \"function\" ? point.apply(that, args) : point,\n              w = Math.max(e[1][0] - e[0][0], e[1][1] - e[0][1]),\n              a = that.__zoom,\n              b = typeof transform === \"function\" ? transform.apply(that, args) : transform,\n              i = interpolate(a.invert(p).concat(w / a.k), b.invert(p).concat(w / b.k));\n          return function(t) {\n            if (t === 1) t = b; // Avoid rounding error on end.\n            else { var l = i(t), k = w / l[2]; t = new Transform(k, p[0] - l[0] * k, p[1] - l[1] * k); }\n            g.zoom(null, t);\n          };\n        });\n  }\n\n  function gesture(that, args, clean) {\n    return (!clean && that.__zooming) || new Gesture(that, args);\n  }\n\n  function Gesture(that, args) {\n    this.that = that;\n    this.args = args;\n    this.active = 0;\n    this.sourceEvent = null;\n    this.extent = extent.apply(that, args);\n    this.taps = 0;\n  }\n\n  Gesture.prototype = {\n    event: function(event) {\n      if (event) this.sourceEvent = event;\n      return this;\n    },\n    start: function() {\n      if (++this.active === 1) {\n        this.that.__zooming = this;\n        this.emit(\"start\");\n      }\n      return this;\n    },\n    zoom: function(key, transform) {\n      if (this.mouse && key !== \"mouse\") this.mouse[1] = transform.invert(this.mouse[0]);\n      if (this.touch0 && key !== \"touch\") this.touch0[1] = transform.invert(this.touch0[0]);\n      if (this.touch1 && key !== \"touch\") this.touch1[1] = transform.invert(this.touch1[0]);\n      this.that.__zoom = transform;\n      this.emit(\"zoom\");\n      return this;\n    },\n    end: function() {\n      if (--this.active === 0) {\n        delete this.that.__zooming;\n        this.emit(\"end\");\n      }\n      return this;\n    },\n    emit: function(type) {\n      var d = select(this.that).datum();\n      listeners.call(\n        type,\n        this.that,\n        new ZoomEvent(type, {\n          sourceEvent: this.sourceEvent,\n          target: zoom,\n          type,\n          transform: this.that.__zoom,\n          dispatch: listeners\n        }),\n        d\n      );\n    }\n  };\n\n  function wheeled(event, ...args) {\n    // Elyra Extension - Doing the noevent calls here prevents the swipe right\n    // gesture causing a Back page action in the browser.\n    if (preventBackGesture) {\n      noevent(event);\n    }\n\n    if (!filter.apply(this, arguments)) return;\n    var g = gesture(this, args).event(event),\n        t = this.__zoom,\n        k = Math.max(scaleExtent[0], Math.min(scaleExtent[1], t.k * Math.pow(2, wheelDelta.apply(this, arguments)))),\n        p = pointer(event);\n\n    // If the mouse is in the same location as before, reuse it.\n    // If there were recent wheel events, reset the wheel idle timeout.\n    if (g.wheel) {\n      if (g.mouse[0][0] !== p[0] || g.mouse[0][1] !== p[1]) {\n        g.mouse[1] = t.invert(g.mouse[0] = p);\n      }\n      clearTimeout(g.wheel);\n    }\n\n    // If this wheel event won’t trigger a transform change, ignore it.\n    else if (t.k === k) return;\n\n    // Otherwise, capture the mouse point and location at the start.\n    else {\n      // Elyra Extension - Calculate wheel translation start amounts. See\n      // comments below for more details.\n      if (trackpad && !event.ctrlKey && !event.safariPinchZoom) {\n        g.wheelTransX = -t.x;\n        g.wheelTransY = -t.y;\n      }\n      g.mouse = [p, t.invert(p)];\n      interrupt(this);\n      g.start();\n    }\n\n    noevent(event);\n    g.wheel = setTimeout(wheelidled, wheelDelay);\n\n    // Elyra Extension - On Chrome and Firefox, the wheel event will be called\n    // for the pinch/spread gesture with ctrlKey set to true (even when the\n    // ctrl key is not pressed). See this stack overflow issue for details:\n    // https://stackoverflow.com/questions/52130484/how-to-catch-pinch-and-stretch-gesture-events-in-d3-zoom-d3v4-v5\n    // On Chrome, Firefox and Safari, the wheel event will be called\n    // for two finger scroll. This code interprets the two finger scroll gesture\n    // as a pan movement (horizontal and/or vertical).\n    if (trackpad && !event.ctrlKey && !event.safariPinchZoom) {\n      g.wheelTransX += event.deltaX;\n      g.wheelTransY += event.deltaY;\n      var p0 = [t.x, t.y], p1 = [t.x + g.wheelTransX, t.y + g.wheelTransY];\n      g.zoom(\"mouse\", constrain(translate(t, p0, p1), g.extent, translateExtent));\n\n    } else {\n      g.zoom(\"mouse\", constrain(translate(scale(t, k), g.mouse[0], g.mouse[1]), g.extent, translateExtent));\n    }\n\n    function wheelidled() {\n      g.wheel = null;\n      g.end();\n    }\n  }\n\n  // Elyra Extension - On Safari, gesturestart, gesturechange, and gestureend\n  // will be called for the pinch/spread gesture. This code not only implements\n  // zoom on pinch/spread but also stops the whole browser page being\n  // zoomed which is the default behavior for that gesture on Safari.\n  // https://stackoverflow.com/questions/36458954/prevent-pinch-zoom-in-safari-for-osx\n  function gesturestart(event) {\n    noevent(event);\n    this.scale = event.scale;\n  }\n\n  function gesturechange(event) {\n    noevent(event);\n\n    if (this.__zoom) {\n      event.deltaY = (this.scale - event.scale) * 100;\n      this.scale = event.scale;\n    }\n\n    event.safariPinchZoom = true;\n    wheeled.apply(this, [event, ...arguments]);\n  }\n\n  function gestureend(event) {\n    noevent(event);\n  }\n\n  // Elyra Extension - End of added gesture functions for Safari.\n\n  function mousedowned(event, ...args) {\n    if (touchending || !filter.apply(this, arguments)) return;\n    var g = gesture(this, args, true).event(event),\n        v = select(event.view).on(\"mousemove.zoom\", mousemoved, true).on(\"mouseup.zoom\", mouseupped, true),\n        p = pointer(event, currentTarget),\n        currentTarget = event.currentTarget,\n        x0 = event.clientX,\n        y0 = event.clientY;\n\n    dragDisable(event.view);\n    nopropagation(event);\n    g.mouse = [p, this.__zoom.invert(p)];\n    interrupt(this);\n    g.start();\n\n    function mousemoved(event) {\n      noevent(event);\n      if (!g.moved) {\n        var dx = event.clientX - x0, dy = event.clientY - y0;\n        g.moved = dx * dx + dy * dy > clickDistance2;\n      }\n      g.event(event)\n       .zoom(\"mouse\", constrain(translate(g.that.__zoom, g.mouse[0] = pointer(event, currentTarget), g.mouse[1]), g.extent, translateExtent));\n    }\n\n    function mouseupped(event) {\n      v.on(\"mousemove.zoom mouseup.zoom\", null);\n      dragEnable(event.view, g.moved);\n      noevent(event);\n      g.event(event).end();\n    }\n  }\n\n  function dblclicked(event, ...args) {\n    if (!filter.apply(this, arguments)) return;\n    var t0 = this.__zoom,\n        p0 = pointer(event.changedTouches ? event.changedTouches[0] : event, this),\n        p1 = t0.invert(p0),\n        k1 = t0.k * (event.shiftKey ? 0.5 : 2),\n        t1 = constrain(translate(scale(t0, k1), p0, p1), extent.apply(this, args), translateExtent);\n\n    noevent(event);\n    if (duration > 0) select(this).transition().duration(duration).call(schedule, t1, p0, event);\n    else select(this).call(zoom.transform, t1, p0, event);\n  }\n\n  function touchstarted(event, ...args) {\n    if (!filter.apply(this, arguments)) return;\n    var touches = event.touches,\n        n = touches.length,\n        g = gesture(this, args, event.changedTouches.length === n).event(event),\n        started, i, t, p;\n\n    nopropagation(event);\n    for (i = 0; i < n; ++i) {\n      t = touches[i], p = pointer(t, this);\n      p = [p, this.__zoom.invert(p), t.identifier];\n      if (!g.touch0) g.touch0 = p, started = true, g.taps = 1 + !!touchstarting;\n      else if (!g.touch1 && g.touch0[2] !== p[2]) g.touch1 = p, g.taps = 0;\n    }\n\n    if (touchstarting) touchstarting = clearTimeout(touchstarting);\n\n    if (started) {\n      if (g.taps < 2) touchfirst = p[0], touchstarting = setTimeout(function() { touchstarting = null; }, touchDelay);\n      interrupt(this);\n      g.start();\n    }\n  }\n\n  function touchmoved(event, ...args) {\n    if (!this.__zooming) return;\n    var g = gesture(this, args).event(event),\n        touches = event.changedTouches,\n        n = touches.length, i, t, p, l;\n\n    noevent(event);\n    for (i = 0; i < n; ++i) {\n      t = touches[i], p = pointer(t, this);\n      if (g.touch0 && g.touch0[2] === t.identifier) g.touch0[0] = p;\n      else if (g.touch1 && g.touch1[2] === t.identifier) g.touch1[0] = p;\n    }\n    t = g.that.__zoom;\n    if (g.touch1) {\n      var p0 = g.touch0[0], l0 = g.touch0[1],\n          p1 = g.touch1[0], l1 = g.touch1[1],\n          dp = (dp = p1[0] - p0[0]) * dp + (dp = p1[1] - p0[1]) * dp,\n          dl = (dl = l1[0] - l0[0]) * dl + (dl = l1[1] - l0[1]) * dl;\n      t = scale(t, Math.sqrt(dp / dl));\n      p = [(p0[0] + p1[0]) / 2, (p0[1] + p1[1]) / 2];\n      l = [(l0[0] + l1[0]) / 2, (l0[1] + l1[1]) / 2];\n    }\n    else if (g.touch0) p = g.touch0[0], l = g.touch0[1];\n    else return;\n\n    g.zoom(\"touch\", constrain(translate(t, p, l), g.extent, translateExtent));\n  }\n\n  function touchended(event, ...args) {\n    if (!this.__zooming) return;\n    var g = gesture(this, args).event(event),\n        touches = event.changedTouches,\n        n = touches.length, i, t;\n\n    nopropagation(event);\n    if (touchending) clearTimeout(touchending);\n    touchending = setTimeout(function() { touchending = null; }, touchDelay);\n    for (i = 0; i < n; ++i) {\n      t = touches[i];\n      if (g.touch0 && g.touch0[2] === t.identifier) delete g.touch0;\n      else if (g.touch1 && g.touch1[2] === t.identifier) delete g.touch1;\n    }\n    if (g.touch1 && !g.touch0) g.touch0 = g.touch1, delete g.touch1;\n    if (g.touch0) g.touch0[1] = this.__zoom.invert(g.touch0[0]);\n    else {\n      g.end();\n      // If this was a dbltap, reroute to the (optional) dblclick.zoom handler.\n      if (g.taps === 2) {\n        t = pointer(t, this);\n        if (Math.hypot(touchfirst[0] - t[0], touchfirst[1] - t[1]) < tapDistance) {\n          var p = select(this).on(\"dblclick.zoom\");\n          if (p) p.apply(this, arguments);\n        }\n      }\n    }\n  }\n\n  zoom.wheelDelta = function(_) {\n    return arguments.length ? (wheelDelta = typeof _ === \"function\" ? _ : constant(+_), zoom) : wheelDelta;\n  };\n\n  zoom.filter = function(_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), zoom) : filter;\n  };\n\n  zoom.touchable = function(_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), zoom) : touchable;\n  };\n\n  zoom.extent = function(_) {\n    return arguments.length ? (extent = typeof _ === \"function\" ? _ : constant([[+_[0][0], +_[0][1]], [+_[1][0], +_[1][1]]]), zoom) : extent;\n  };\n\n  zoom.scaleExtent = function(_) {\n    return arguments.length ? (scaleExtent[0] = +_[0], scaleExtent[1] = +_[1], zoom) : [scaleExtent[0], scaleExtent[1]];\n  };\n\n  zoom.translateExtent = function(_) {\n    return arguments.length ? (translateExtent[0][0] = +_[0][0], translateExtent[1][0] = +_[1][0], translateExtent[0][1] = +_[0][1], translateExtent[1][1] = +_[1][1], zoom) : [[translateExtent[0][0], translateExtent[0][1]], [translateExtent[1][0], translateExtent[1][1]]];\n  };\n\n  zoom.constrain = function(_) {\n    return arguments.length ? (constrain = _, zoom) : constrain;\n  };\n\n  // Elyra Extension - Function added for trackpad support\n  zoom.trackpad = function(_) {\n    return arguments.length ? (trackpad = _, zoom) : trackpad;\n  };\n\n  // Elyra Extension - Function added for 'prevent page back' support\n  zoom.preventBackGesture = function(_) {\n    return arguments.length ? (preventBackGesture = _, zoom) : preventBackGesture;\n  };\n\n  zoom.duration = function(_) {\n    return arguments.length ? (duration = +_, zoom) : duration;\n  };\n\n  zoom.interpolate = function(_) {\n    return arguments.length ? (interpolate = _, zoom) : interpolate;\n  };\n\n  zoom.on = function() {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? zoom : value;\n  };\n\n  zoom.clickDistance = function(_) {\n    return arguments.length ? (clickDistance2 = (_ = +_) * _, zoom) : Math.sqrt(clickDistance2);\n  };\n\n  zoom.tapDistance = function(_) {\n    return arguments.length ? (tapDistance = +_, zoom) : tapDistance;\n  };\n\n  return zoom;\n}\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class SvgCanvasDisplay {\n\tconstructor(canvasController, isSubflow, pipelineId, breadcrumbs) {\n\t\tthis.canvasController = canvasController;\n\t\tthis.isSubflow = isSubflow;\n\t\tthis.pipelineId = pipelineId;\n\t\tthis.breadcrumbs = breadcrumbs;\n\t}\n\n\tisDisplayingCurrentPipeline() {\n\t\tconst currentBreadcrumb = this.breadcrumbs[this.breadcrumbs.length - 1];\n\t\treturn currentBreadcrumb.pipelineId === this.pipelineId;\n\t}\n\n\tsetDisplayState() {\n\t\tif (this.breadcrumbs.length > 1 &&\n\t\t\t\tthis.isDisplayingCurrentPipeline()) {\n\t\t\tthis.displayState = \"sub-flow-full-page\";\n\n\t\t} else if (this.isSubflow) {\n\t\t\tthis.displayState = \"sub-flow-in-place\";\n\n\t\t} else {\n\t\t\tthis.displayState = \"primary-flow-full-page\";\n\t\t}\n\t}\n\n\tgetDisplayStateMsg() {\n\t\treturn \"Display state set to \" + this.displayState;\n\t}\n\n\tisDisplayingPrimaryFlowFullPage() {\n\t\treturn this.displayState === \"primary-flow-full-page\";\n\t}\n\n\tisDisplayingSubFlow() {\n\t\treturn this.displayState === \"sub-flow-in-place\" || this.displayState === \"sub-flow-full-page\";\n\t}\n\n\tisDisplayingSubFlowInPlace() {\n\t\treturn this.displayState === \"sub-flow-in-place\";\n\t}\n\n\tisDisplayingSubFlowFullPage() {\n\t\treturn this.displayState === \"sub-flow-full-page\";\n\t}\n\n\tisDisplayingFullPage() {\n\t\treturn this.displayState === \"primary-flow-full-page\" || this.displayState === \"sub-flow-full-page\";\n\t}\n}\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport CanvasUtils from \"./common-canvas-utils.js\";\nimport { ERROR, WARNING, NODE_ERROR_ICON, NODE_WARNING_ICON,\n\tTEXT_AREA_BORDER_ADJUSTMENT } from \"./constants/canvas-constants\";\n\nexport default class SvgCanvasNodes {\n\tconstructor(canvasLayout) {\n\t\tthis.canvasLayout = canvasLayout;\n\t}\n\n\tisPointInNodeBoundary(pos, node) {\n\t\treturn pos.x >= node.x_pos &&\n\t\t\tpos.x <= node.x_pos + node.width &&\n\t\t\tpos.y >= node.y_pos &&\n\t\t\tpos.y <= node.y_pos + node.height;\n\t}\n\n\tgetNodeImageClass(node) {\n\t\treturn \"d3-node-image\";\n\t}\n\n\tgetNodeLabelClass(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn \"d3-node-label d3-label-single-line \" + this.getMessageLabelClass(node.messages);\n\t\t}\n\t\tconst lineTypeClass = node.layout.labelSingleLine ? \" d3-label-single-line\" : \" d3-label-multi-line\";\n\t\tconst justificationClass = node.layout.labelAlign === \"center\" ? \" d3-label-center\" : \"\";\n\t\treturn \"d3-node-label \" + this.getMessageLabelClass(node.messages) + lineTypeClass + justificationClass;\n\t}\n\n\tgetNodeLabelTextAreaClass(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn \"d3-node-label-entry d3-label-single-line\";\n\t\t}\n\t\tconst lineTypeClass = node.layout.labelSingleLine ? \" d3-label-single-line\" : \" d3-label-multi-line\";\n\t\tconst justificationClass = node.layout.labelAlign === \"center\" ? \" d3-label-center\" : \"\";\n\t\treturn \"d3-node-label-entry\" + lineTypeClass + justificationClass;\n\t}\n\n\tgetErrorMarkerIcon(data) {\n\t\tconst messageLevel = this.getMessageLevel(data.messages);\n\t\tlet iconPath = \"\";\n\t\tswitch (messageLevel) {\n\t\tcase ERROR:\n\t\t\ticonPath = NODE_ERROR_ICON;\n\t\t\tbreak;\n\t\tcase WARNING:\n\t\t\ticonPath = NODE_WARNING_ICON;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\treturn iconPath;\n\t}\n\n\tgetMessageLevel(messages) {\n\t\tlet messageLevel = \"\";\n\t\tif (messages && messages.length > 0) {\n\t\t\tfor (const message of messages) {\n\t\t\t\tif (message.type === ERROR) {\n\t\t\t\t\treturn message.type;\n\t\t\t\t} else if (message.type === WARNING) {\n\t\t\t\t\tmessageLevel = message.type;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn messageLevel;\n\t}\n\n\tgetMessageLabelClass(messages) {\n\t\tconst messageLevel = this.getMessageLevel(messages);\n\t\tlet labelClass = \"\";\n\t\tswitch (messageLevel) {\n\t\tcase ERROR:\n\t\t\tlabelClass = \"d3-node-error-label\";\n\t\t\tbreak;\n\t\tcase WARNING:\n\t\t\tlabelClass = \"d3-node-warning-label\";\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\treturn labelClass;\n\t}\n\n\tgetErrorMarkerClass(messages) {\n\t\tconst messageLevel = this.getMessageLevel(messages);\n\t\tlet labelClass = \"d3-error-circle-off\";\n\t\tswitch (messageLevel) {\n\t\tcase ERROR:\n\t\t\tlabelClass = \"d3-error-circle\";\n\t\t\tbreak;\n\t\tcase WARNING:\n\t\t\tlabelClass = \"d3-warning-circle\";\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\treturn labelClass;\n\t}\n\n\t// Returns the absolute x coordinate of the center of the node. If node is\n\t// an expanded supernode, its expanded width is in the 'width' field.\n\tgetNodeCenterPosX(node) {\n\t\treturn node.x_pos + (node.width / 2);\n\t}\n\n\t// Returns the absolute y coordinate of the center of the node.  If node is\n\t// an expanded supernode, its expanded height is in the 'height' field.\n\tgetNodeCenterPosY(node) {\n\t\treturn node.y_pos + (node.height / 2);\n\t}\n\n\t// Returns the absolute x coordinate of the center of the node image\n\tgetNodeImageCenterPosX(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn node.x_pos + this.canvasLayout.supernodeImagePosX + (this.canvasLayout.supernodeImageWidth / 2);\n\t\t}\n\t\treturn node.x_pos +\n\t\t\tthis.getElementPosX(node.width, node.layout.imagePosX, node.layout.imagePosition) +\n\t\t\t(node.layout.imageWidth / 2);\n\t}\n\n\t// Returns the absolute y coordinate of the center of the node image\n\tgetNodeImageCenterPosY(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn node.y_pos + this.canvasLayout.supernodeImagePosY + (this.canvasLayout.supernodeImageHeight / 2);\n\t\t}\n\t\treturn node.y_pos +\n\t\t\tthis.getElementPosY(node.height, node.layout.imagePosY, node.layout.imagePosition) +\n\t\t\t(node.layout.imageHeight / 2);\n\t}\n\n\tgetNodeImagePosX(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeImagePosX;\n\t\t}\n\t\treturn this.getElementPosX(node.width, node.layout.imagePosX, node.layout.imagePosition);\n\t}\n\n\tgetNodeImagePosY(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeImagePosY;\n\t\t}\n\t\treturn this.getElementPosY(node.height, node.layout.imagePosY, node.layout.imagePosition);\n\t}\n\n\tgetNodeImageWidth(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeImageWidth;\n\t\t}\n\t\treturn node.layout.imageWidth;\n\t}\n\n\tgetNodeImageHeight(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeImageHeight;\n\t\t}\n\t\treturn node.layout.imageHeight;\n\t}\n\n\tgetNodeLabelPosX(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeLabelPosX;\n\t\t}\n\t\tconst x = this.getElementPosX(node.width, node.layout.labelPosX, node.layout.labelPosition);\n\t\treturn node.layout.labelAlign === \"center\" ? x - (node.layout.labelWidth / 2) : x;\n\t}\n\n\tgetNodeLabelPosY(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeLabelPosY;\n\t\t}\n\t\treturn this.getElementPosY(node.height, node.layout.labelPosY, node.layout.labelPosition);\n\t}\n\n\tgetNodeLabelWidth(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn node.width - this.canvasLayout.supernodeLabelPosX + this.canvasLayout.supernodeErrorPosX;\n\t\t}\n\t\treturn node.layout.labelWidth;\n\t}\n\n\tgetNodeLabelHeight(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeLabelHeight;\n\t\t}\n\t\treturn node.layout.labelHeight;\n\t}\n\n\tgetNodeLabelEditIconTranslate(node, spanObj, zoomScale, fullLabelOnHover) {\n\t\treturn `translate(${this.getNodeLabelEditIconPosX(node, spanObj, zoomScale, fullLabelOnHover)}, ${this.getNodeLabelEditIconPosY(node)})`;\n\t}\n\n\tgetNodeLabelEditIconPosX(node, spanObj, zoomScale, fullLabelOnHover) {\n\t\tconst labelWidth = fullLabelOnHover ? this.getNodeLabelHoverWidth(node) : this.getNodeLabelWidth(node);\n\t\tconst posX = fullLabelOnHover ? this.getNodeLabelHoverPosX(node) : this.getNodeLabelPosX(node);\n\t\tconst spanWidth = spanObj.getBoundingClientRect().width;\n\n\t\tif (node.layout.labelAlign === \"center\" && !CanvasUtils.isExpandedSupernode(node)) {\n\t\t\tconst halfLabelWidth = labelWidth / 2;\n\t\t\tconst xCenterPosition = posX + halfLabelWidth;\n\t\t\tconst xOffsetFromCenter = Math.min(halfLabelWidth, ((spanWidth / zoomScale) / 2));\n\t\t\treturn xCenterPosition + xOffsetFromCenter;\n\t\t}\n\t\tconst xOffsetFromStart = Math.min(labelWidth, (spanWidth / zoomScale));\n\t\treturn this.getNodeLabelPosX(node) + xOffsetFromStart;\n\t}\n\n\tgetNodeLabelEditIconPosY(node) {\n\t\treturn this.getNodeLabelPosY(node);\n\t}\n\n\tgetNodeLabelHoverPosX(node) {\n\t\tif (node.layout.labelSingleLine &&\n\t\t\t\tnode.layout.labelAlign === \"center\") {\n\t\t\treturn this.getNodeLabelPosX(node) - 250;\n\t\t}\n\t\treturn this.getNodeLabelPosX(node);\n\t}\n\n\tgetNodeLabelHoverWidth(node) {\n\t\tif (node.layout.labelSingleLine) {\n\t\t\tif (node.layout.labelAlign === \"center\") {\n\t\t\t\treturn node.layout.labelWidth + 500;\n\t\t\t}\n\t\t\treturn node.layout.labelWidth + 40;\n\t\t}\n\t\treturn node.layout.labelWidth;\n\t}\n\n\tgetNodeLabelHoverHeight(node, spanObj, zoomScale) {\n\t\tif (node.layout.labelSingleLine) {\n\t\t\treturn node.layout.labelHeight;\n\t\t}\n\t\tconst calcHeight = spanObj.getBoundingClientRect().height / zoomScale;\n\t\treturn Math.max(calcHeight, node.layout.labelHeight);\n\t}\n\n\tgetNodeLabelTextAreaWidth(node) {\n\t\treturn this.getNodeLabelWidth(node) + (2 * TEXT_AREA_BORDER_ADJUSTMENT);\n\t}\n\n\tgetNodeLabelTextAreaHeight(node) {\n\t\treturn this.getNodeLabelHeight(node) + (2 * TEXT_AREA_BORDER_ADJUSTMENT);\n\t}\n\n\tgetNodeLabelTextAreaPosX(node) {\n\t\treturn this.getNodeLabelPosX(node) - TEXT_AREA_BORDER_ADJUSTMENT;\n\t}\n\n\tgetNodeLabelTextAreaPosY(node) {\n\t\treturn this.getNodeLabelPosY(node) - TEXT_AREA_BORDER_ADJUSTMENT;\n\t}\n\n\tgetNodeEllipsisTranslate(node) {\n\t\treturn `translate(${this.getNodeEllipsisPosX(node)}, ${this.getNodeEllipsisPosY(node)})`;\n\t}\n\n\tgetNodeEllipsisWidth(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeEllipsisWidth;\n\t\t}\n\t\treturn node.layout.ellipsisWidth;\n\t}\n\n\tgetNodeEllipsisHeight(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeEllipsisHeight;\n\t\t}\n\t\treturn node.layout.ellipsisHeight;\n\t}\n\n\tgetNodeEllipsisIconWidth(node) {\n\t\treturn this.getNodeEllipsisWidth(node) - (2 * node.layout.ellipsisHoverAreaPadding);\n\t}\n\n\tgetNodeEllipsisIconHeight(node) {\n\t\treturn this.getNodeEllipsisHeight(node) - (2 * node.layout.ellipsisHoverAreaPadding);\n\t}\n\n\tgetNodeEllipsisPosX(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn node.width + this.canvasLayout.supernodeEllipsisPosX;\n\t\t}\n\n\t\treturn this.getElementPosX(node.width, node.layout.ellipsisPosX, node.layout.ellipsisPosition);\n\t}\n\n\tgetNodeEllipsisPosY(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeEllipsisPosY;\n\t\t}\n\n\t\treturn this.getElementPosY(node.height, node.layout.ellipsisPosY, node.layout.ellipsisPosition);\n\t}\n\n\tgetNodeExpansionIconTranslate(node) {\n\t\tconst posX = node.width + this.canvasLayout.supernodeExpansionIconPosX;\n\t\treturn `translate(${posX}, ${this.canvasLayout.supernodeExpansionIconPosY})`;\n\t}\n\n\tgetNodeErrorPosX(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn node.width + this.canvasLayout.supernodeErrorPosX;\n\t\t}\n\t\treturn this.getElementPosX(node.width, node.layout.errorXPos, node.layout.errorPosition);\n\t}\n\n\tgetNodeErrorPosY(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeErrorPosY;\n\t\t}\n\t\treturn this.getElementPosY(node.height, node.layout.errorYPos, node.layout.errorPosition);\n\t}\n\n\tgetNodeErrorWidth(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeErrorWidth;\n\t\t}\n\t\treturn node.layout.errorWidth;\n\t}\n\n\tgetNodeErrorHeight(node) {\n\t\tif (CanvasUtils.isExpandedSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeErrorHeight;\n\t\t}\n\t\treturn node.layout.errorHeight;\n\t}\n\n\tgetNodeInputPortLeftPosX(node) {\n\t\treturn this.getElementPosX(node.width, node.layout.inputPortLeftPosX, node.layout.inputPortLeftPosition);\n\t}\n\n\tgetNodeInputPortLeftPosY(node) {\n\t\treturn this.getElementPosY(node.height, node.layout.inputPortLeftPosY, node.layout.inputPortLeftPosition);\n\t}\n\n\tgetNodeOutputPortRightPosX(node) {\n\t\treturn this.getElementPosX(node.width, node.layout.outputPortRightPosX, node.layout.outputPortRightPosition);\n\t}\n\n\tgetNodeOutputPortRightPosY(node) {\n\t\treturn this.getElementPosY(node.height, node.layout.outputPortRightPosY, node.layout.outputPortRightPosition);\n\t}\n\n\tgetElementPosX(width, xOffset = 0, position = \"topLeft\") {\n\t\tlet x = 0;\n\n\t\tif (position.endsWith(\"Center\")) {\n\t\t\tx += (width / 2);\n\t\t} else if (position.endsWith(\"Right\")) {\n\t\t\tx += width;\n\t\t}\n\t\treturn x + Number(xOffset);\n\t}\n\n\tgetElementPosY(height, yOffset = 0, position = \"topLeft\") {\n\t\tlet y = 0;\n\n\t\tif (position.startsWith(\"middle\")) {\n\t\t\ty += (height / 2);\n\t\t} else if (position.startsWith(\"bottom\")) {\n\t\t\ty += height;\n\t\t}\n\t\treturn y + Number(yOffset);\n\t}\n\n\t// Returns the X offset for the port which references the nodeId passed in\n\t// based on the precalculated X coordinate of the port.\n\tgetSupernodePortXOffset(nodeId, ports) {\n\t\tif (ports) {\n\t\t\tconst supernodePort = ports.find((port) => port.subflow_node_ref === nodeId);\n\t\t\treturn supernodePort.cx - this.canvasLayout.supernodeSVGAreaPadding;\n\t\t}\n\t\treturn 0;\n\t}\n\n\t// Returns the Y offset for the port which references the nodeId passed in\n\t// based on the pre-calculated Y coordinate of the port.\n\tgetSupernodePortYOffset(nodeId, ports) {\n\t\tif (ports) {\n\t\t\tconst supernodePort = ports.find((port) => port.subflow_node_ref === nodeId);\n\t\t\treturn supernodePort.cy;\n\t\t}\n\t\treturn 0;\n\t}\n}\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class SvgCanvasUtilsComments {\n\t// Returns the absolute x coordinate of the center of the comment\n\tgetCommentCenterPosX(com) {\n\t\treturn com.x_pos + (com.width / 2);\n\t}\n\n\t// Returns the absolute y coordinate of the center of the comment\n\tgetCommentCenterPosY(com) {\n\t\treturn com.y_pos + (com.height / 2);\n\t}\n}\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint no-lonely-if: \"off\" */\n\nimport CanvasUtils from \"./common-canvas-utils.js\";\nimport { ASSOC_RIGHT_SIDE_CURVE, ASSOCIATION_LINK, COMMENT_LINK, NODE_LINK,\n\tASSOC_VAR_CURVE_LEFT, ASSOC_VAR_CURVE_RIGHT, ASSOC_VAR_DOUBLE_BACK_LEFT, ASSOC_VAR_DOUBLE_BACK_RIGHT,\n\tLINK_TYPE_CURVE, LINK_TYPE_ELBOW, LINK_TYPE_STRAIGHT,\n\tLINK_DIR_TOP_BOTTOM, LINK_DIR_BOTTOM_TOP,\n\tNORTH, SOUTH, EAST, WEST }\n\tfrom \"./constants/canvas-constants\";\n\nconst CLOCKWISE = false;\nconst ANTI_CLOCKWISE = true;\nconst ONE_EIGHTY_DEGREES_IN_RADIANS = Math.PI;\n\nexport default class SvgCanvasLinks {\n\tconstructor(config, canvasLayout, nodeUtils, commentUtils) {\n\t\tthis.canvasLayout = canvasLayout;\n\t\tthis.config = config;\n\t\tthis.nodeUtils = nodeUtils;\n\t\tthis.commentUtils = commentUtils;\n\t}\n\n\t// Returns an object containing the x and y coordinates of the start position\n\t// of a straight line which extends from the source comment passed in to the\n\t// end position which is an x, y cordinate.\n\tgetNewStraightCommentLinkStartPos(srcComment, endPos) {\n\t\treturn CanvasUtils.getOuterCoord(\n\t\t\tsrcComment.x_pos,\n\t\t\tsrcComment.y_pos,\n\t\t\tsrcComment.width,\n\t\t\tsrcComment.height,\n\t\t\tthis.canvasLayout.linkGap,\n\t\t\tthis.commentUtils.getCommentCenterPosX(srcComment),\n\t\t\tthis.commentUtils.getCommentCenterPosY(srcComment),\n\t\t\tendPos.x,\n\t\t\tendPos.y);\n\t}\n\n\t// Returns an object containing the x and y coordinates of the start position\n\t// of a straight line which extends from the node passed in to the\n\t// end position which is also an x, y coordinate. If an originInfo object is\n\t// passed in we use it to offset the origin position for the line.\n\tgetNewStraightNodeLinkStartPos(node, endPos, originInfo) {\n\t\tlet originX;\n\t\tlet originY;\n\n\t\tif (node.layout.drawNodeLinkLineFromTo === \"image_center\" && !CanvasUtils.isExpanded(node)) {\n\t\t\toriginX = this.nodeUtils.getNodeImageCenterPosX(node);\n\t\t\toriginY = this.nodeUtils.getNodeImageCenterPosY(node);\n\t\t} else {\n\t\t\tif (originInfo) {\n\t\t\t\t({ x: originX, y: originY } = this.getCenterOffset(node, originInfo));\n\t\t\t} else {\n\t\t\t\toriginX = this.nodeUtils.getNodeCenterPosX(node);\n\t\t\t\toriginY = this.nodeUtils.getNodeCenterPosY(node);\n\t\t\t}\n\t\t}\n\n\t\treturn CanvasUtils.getOuterCoord(\n\t\t\tnode.x_pos,\n\t\t\tnode.y_pos,\n\t\t\tnode.width,\n\t\t\tnode.height,\n\t\t\tthis.canvasLayout.linkGap,\n\t\t\toriginX,\n\t\t\toriginY,\n\t\t\tendPos.x,\n\t\t\tendPos.y);\n\t}\n\n\t// Returns the lineArray passed in with connection path info added to it.\n\taddConnectionPaths(links) {\n\t\tlinks.forEach((link) => {\n\t\t\t// Only necessary to get the path info, if the start and end coords of\n\t\t\t// the link have changed.\n\t\t\tif (link.coordsUpdated) {\n\t\t\t\tlink.pathInfo = this.getConnectorPathInfo(link);\n\t\t\t}\n\t\t});\n\t\treturn links;\n\t}\n\n\t// Returns an SVG path string for the link (described by the line passed in)\n\t// based on the connection and link type in the layout info.\n\tgetConnectorPathInfo(link, drawingNewLinkMinInitialLine) {\n\t\tconst minInitialLine = this.getMinInitialLine(link, drawingNewLinkMinInitialLine);\n\n\t\t// If its a very short line to be drawn just draw a straight line instead\n\t\t// of zig-zagging in a very small space.\n\t\tif (Math.abs(link.x1 - link.x2) < 20 &&\n\t\t\t\tMath.abs(link.y1 - link.y2) < 20) {\n\t\t\treturn this.getStraightPath(link);\n\n\t\t} else if (link.type === NODE_LINK) {\n\n\t\t\tif (this.canvasLayout.linkType === LINK_TYPE_CURVE ||\n\t\t\t\t\tthis.canvasLayout.linkType === LINK_TYPE_ELBOW) {\n\t\t\t\treturn this.getPortLinkPath(link, minInitialLine);\n\t\t\t}\n\n\t\t} else if (link.type === ASSOCIATION_LINK &&\n\t\t\t\t\t\t\t\tthis.config.enableAssocLinkType === ASSOC_RIGHT_SIDE_CURVE) {\n\t\t\treturn this.getAssociationCurvePath(link, minInitialLine);\n\t\t}\n\n\t\treturn this.getStraightPath(link);\n\t}\n\n\t// Returns the minInitialLine layout variable that will be either zero for a\n\t// comment link or from the link-data object (if the size has been\n\t// pre-calculated for elbow style connections) or from the source node\n\t// object (data.src) if we are drawing an existing connection or from\n\t// this.drawingNewLinkData.minInitialLine if we are dynamically drawing\n\t// a new link.\n\tgetMinInitialLine(link, drawingNewLinkMinInitialLine) {\n\t\tlet minInitialLine;\n\t\tif (link.type === COMMENT_LINK) {\n\t\t\tminInitialLine = 0;\n\t\t} else if (link.minInitialLineForElbow) {\n\t\t\tminInitialLine = link.minInitialLineForElbow;\n\t\t} else if (link.srcObj && link.srcObj.layout) {\n\t\t\tminInitialLine = link.srcObj.layout.minInitialLine;\n\t\t} else if (drawingNewLinkMinInitialLine) {\n\t\t\tminInitialLine = drawingNewLinkMinInitialLine;\n\t\t} else {\n\t\t\tminInitialLine = 10;\n\t\t}\n\t\treturn minInitialLine;\n\t}\n\n\tgetLinkCoords(link, srcObj, srcPortId, trgNode, trgPortId, assocLinkVariation) {\n\t\tlet coords = null;\n\t\tif (link.type === NODE_LINK) {\n\t\t\tif (this.canvasLayout.linkType === LINK_TYPE_STRAIGHT) {\n\t\t\t\tcoords = this.getNodeLinkCoordsForStraightLine(srcObj, trgNode, link);\n\t\t\t} else {\n\t\t\t\tcoords = this.getNodeLinkCoordsForPorts(srcObj, srcPortId, trgNode, trgPortId);\n\t\t\t}\n\t\t} else if (link.type === ASSOCIATION_LINK) {\n\t\t\tif (this.config.enableAssocLinkType === ASSOC_RIGHT_SIDE_CURVE) {\n\t\t\t\tcoords = this.getAssociationCurveLinkCoords(srcObj, trgNode, assocLinkVariation);\n\t\t\t} else {\n\t\t\t\tcoords = this.getNodeLinkCoordsForStraightLine(srcObj, trgNode);\n\t\t\t}\n\t\t} else {\n\t\t\tcoords = this.getCommentLinkCoords(srcObj, trgNode);\n\t\t}\n\t\treturn coords;\n\t}\n\n\tgetNodeLinkCoordsForStraightLine(srcNode, trgNode, link) {\n\t\tlet srcCenterX;\n\t\tlet srcCenterY;\n\t\tlet trgCenterX;\n\t\tlet trgCenterY;\n\n\t\tif (srcNode.layout.drawNodeLinkLineFromTo === \"image_center\" && !CanvasUtils.isExpanded(srcNode)) {\n\t\t\tsrcCenterX = this.nodeUtils.getNodeImageCenterPosX(srcNode);\n\t\t\tsrcCenterY = this.nodeUtils.getNodeImageCenterPosY(srcNode);\n\t\t} else {\n\t\t\tif (link && link.srcOriginInfo) {\n\t\t\t\t({ x: srcCenterX, y: srcCenterY } = this.getCenterOffset(srcNode, link.srcOriginInfo));\n\t\t\t} else {\n\t\t\t\tsrcCenterX = this.nodeUtils.getNodeCenterPosX(srcNode);\n\t\t\t\tsrcCenterY = this.nodeUtils.getNodeCenterPosY(srcNode);\n\t\t\t}\n\t\t}\n\n\t\tif (trgNode.layout.drawNodeLinkLineFromTo === \"image_center\" && !CanvasUtils.isExpanded(trgNode)) {\n\t\t\ttrgCenterX = this.nodeUtils.getNodeImageCenterPosX(trgNode);\n\t\t\ttrgCenterY = this.nodeUtils.getNodeImageCenterPosY(trgNode);\n\t\t} else {\n\t\t\tif (link && link.trgOriginInfo) {\n\t\t\t\t({ x: trgCenterX, y: trgCenterY } = this.getCenterOffset(trgNode, link.trgOriginInfo));\n\t\t\t} else {\n\t\t\t\ttrgCenterX = this.nodeUtils.getNodeCenterPosX(trgNode);\n\t\t\t\ttrgCenterY = this.nodeUtils.getNodeCenterPosY(trgNode);\n\t\t\t}\n\t\t}\n\n\t\tconst startPos = CanvasUtils.getOuterCoord(\n\t\t\tsrcNode.x_pos,\n\t\t\tsrcNode.y_pos,\n\t\t\tsrcNode.width,\n\t\t\tsrcNode.height,\n\t\t\tthis.canvasLayout.linkGap,\n\t\t\tsrcCenterX,\n\t\t\tsrcCenterY,\n\t\t\ttrgCenterX,\n\t\t\ttrgCenterY);\n\n\t\tconst endPos = CanvasUtils.getOuterCoord(\n\t\t\ttrgNode.x_pos,\n\t\t\ttrgNode.y_pos,\n\t\t\ttrgNode.width,\n\t\t\ttrgNode.height,\n\t\t\tthis.canvasLayout.linkGap,\n\t\t\ttrgCenterX,\n\t\t\ttrgCenterY,\n\t\t\tsrcCenterX,\n\t\t\tsrcCenterY);\n\n\t\treturn {\n\t\t\toriginX: startPos.originX, originY: startPos.originY,\n\t\t\tx1: startPos.x, y1: startPos.y,\n\t\t\tx2: endPos.x, y2: endPos.y\n\t\t};\n\t}\n\n\tgetCenterOffset(node, originInfo) {\n\t\tconst parts = originInfo.len + 1;\n\t\tconst index = originInfo.idx + 1;\n\n\t\tlet x = 0;\n\t\tlet y = 0;\n\n\t\tif (originInfo.dir === NORTH ||\n\t\t\t\toriginInfo.dir === SOUTH) {\n\t\t\tx = node.x_pos + ((node.width / parts) * index);\n\t\t\ty = this.nodeUtils.getNodeCenterPosY(node);\n\n\t\t} else if (originInfo.dir === EAST ||\n\t\t\t\t\t\t\t\toriginInfo.dir === WEST) {\n\t\t\tx = this.nodeUtils.getNodeCenterPosX(node);\n\t\t\ty = node.y_pos + ((node.height / parts) * index);\n\t\t}\n\n\t\treturn { x, y };\n\t}\n\n\tgetNodeLinkCoordsForPorts(srcNode, srcPortId, trgNode, trgPortId) {\n\t\tlet srcX = srcNode.width + srcNode.layout.outputPortRightPosX;\n\t\tlet srcY = srcNode.layout.outputPortRightPosY;\n\t\tlet trgX = trgNode.layout.inputPortLeftPosX;\n\t\tlet trgY = trgNode.layout.inputPortLeftPosY;\n\n\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM) {\n\t\t\tsrcX = srcNode.layout.outputPortBottomPosX;\n\t\t\tsrcY = srcNode.height + srcNode.layout.outputPortBottomPosY;\n\t\t\ttrgX = trgNode.layout.inputPortTopPosX;\n\t\t\ttrgY = trgNode.layout.inputPortTopPosY;\n\n\t\t} else if (this.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\tsrcX = srcNode.layout.outputPortBottomPosX;\n\t\t\tsrcY = srcNode.layout.outputPortBottomPosY;\n\t\t\ttrgX = trgNode.layout.inputPortTopPosX;\n\t\t\ttrgY = trgNode.height + trgNode.layout.inputPortTopPosY;\n\t\t}\n\n\t\tif (srcNode.outputs && srcNode.outputs.length > 0) {\n\t\t\tconst port = srcNode.outputs.find((srcPort) => srcPort.id === srcPortId);\n\t\t\tsrcX = port ? port.cx : srcX;\n\t\t\tsrcY = port ? port.cy : srcY;\n\t\t}\n\n\t\tif (trgNode.inputs && trgNode.inputs.length > 0) {\n\t\t\tconst port = trgNode.inputs.find((trgPort) => trgPort.id === trgPortId);\n\t\t\ttrgX = port ? port.cx : trgX;\n\t\t\ttrgY = port ? port.cy : trgY;\n\t\t}\n\n\t\treturn {\n\t\t\tx1: srcNode.x_pos + srcX,\n\t\t\ty1: srcNode.y_pos + srcY,\n\t\t\tx2: trgNode.x_pos + trgX,\n\t\t\ty2: trgNode.y_pos + trgY\n\t\t};\n\t}\n\n\tgetAssociationCurveLinkCoords(srcNode, trgNode, assocLinkVariation) {\n\t\tlet x1 = 0;\n\t\tlet x2 = 0;\n\n\t\tif (assocLinkVariation === ASSOC_VAR_CURVE_RIGHT) {\n\t\t\tx1 = srcNode.x_pos + srcNode.width;\n\t\t\tx2 = trgNode.x_pos;\n\n\t\t} else if (assocLinkVariation === ASSOC_VAR_CURVE_LEFT) {\n\t\t\tx1 = srcNode.x_pos;\n\t\t\tx2 = trgNode.x_pos + trgNode.width;\n\n\t\t} else if (assocLinkVariation === ASSOC_VAR_DOUBLE_BACK_LEFT) {\n\t\t\tx1 = srcNode.x_pos;\n\t\t\tx2 = trgNode.x_pos;\n\n\t\t} else {\n\t\t\tx1 = srcNode.x_pos + srcNode.width;\n\t\t\tx2 = trgNode.x_pos + trgNode.width;\n\t\t}\n\n\t\treturn {\n\t\t\tx1: x1,\n\t\t\ty1: srcNode.y_pos + srcNode.layout.outputPortRightPosY,\n\t\t\tx2: x2,\n\t\t\ty2: trgNode.y_pos + trgNode.layout.inputPortLeftPosY };\n\t}\n\n\tgetCommentLinkCoords(srcComment, trgNode) {\n\t\tconst srcCenterX = this.commentUtils.getCommentCenterPosX(srcComment);\n\t\tconst srcCenterY = this.commentUtils.getCommentCenterPosY(srcComment);\n\t\tlet trgCenterX;\n\t\tlet trgCenterY;\n\n\t\tif (trgNode.layout.drawCommentLinkLineTo === \"image_center\") {\n\t\t\ttrgCenterX = this.nodeUtils.getNodeImageCenterPosX(trgNode);\n\t\t\ttrgCenterY = this.nodeUtils.getNodeImageCenterPosY(trgNode);\n\t\t} else {\n\t\t\ttrgCenterX = this.nodeUtils.getNodeCenterPosX(trgNode);\n\t\t\ttrgCenterY = this.nodeUtils.getNodeCenterPosY(trgNode);\n\t\t}\n\n\t\tconst startPos = CanvasUtils.getOuterCoord(\n\t\t\tsrcComment.x_pos,\n\t\t\tsrcComment.y_pos,\n\t\t\tsrcComment.width,\n\t\t\tsrcComment.height,\n\t\t\tthis.canvasLayout.linkGap,\n\t\t\tsrcCenterX,\n\t\t\tsrcCenterY,\n\t\t\ttrgCenterX,\n\t\t\ttrgCenterY);\n\n\t\tconst endPos = CanvasUtils.getOuterCoord(\n\t\t\ttrgNode.x_pos,\n\t\t\ttrgNode.y_pos,\n\t\t\ttrgNode.width,\n\t\t\ttrgNode.height,\n\t\t\tthis.canvasLayout.linkGap,\n\t\t\ttrgCenterX,\n\t\t\ttrgCenterY,\n\t\t\tsrcCenterX,\n\t\t\tsrcCenterY);\n\n\t\treturn { x1: startPos.x, y1: startPos.y, x2: endPos.x, y2: endPos.y };\n\t}\n\n\t// Returns the path info, for the object passed in, which describes either a\n\t// curved or elbow connector line. This method can be called either for\n\t// drawing a connection line between nodes or for a new link line being\n\t// drawn out from a source node towards a target node. This method handles\n\t// the Top->Bottom and Bottom->Top configurations by rotating the input\n\t// variables to make them look like a Left->Right configuration and then,\n\t// after calculating the link line path, rotating the path back to fit the\n\t// Top->Bottom or Bottom->Top configuration.\n\t// The pathInfo returned contains:\n\t// path - an SVG path string describing the curved/elbow line\n\t// centerPoint - the center point of the line used for decoration placement\n\tgetPortLinkPath(link, minInitialLine) {\n\t\tlet topSrc;\n\t\tlet topTrg;\n\t\tlet bottomSrc;\n\t\tlet bottomTrg;\n\n\t\t// When drawing a link from node to node we will have src and trg nodes.\n\t\tif (link.srcObj && link.trgNode) {\n\t\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM) {\n\t\t\t\ttopSrc = -(link.srcObj.x_pos + link.srcObj.width);\n\t\t\t\tbottomSrc = -(link.srcObj.x_pos);\n\t\t\t\ttopTrg = -(link.trgNode.x_pos + link.trgNode.width);\n\t\t\t\tbottomTrg = -(link.trgNode.x_pos);\n\n\t\t\t} else if (this.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\t\ttopSrc = link.srcObj.x_pos;\n\t\t\t\tbottomSrc = link.srcObj.x_pos + link.srcObj.width;\n\t\t\t\ttopTrg = link.trgNode.x_pos;\n\t\t\t\tbottomTrg = link.trgNode.x_pos + link.trgNode.width;\n\n\t\t\t} else {\n\t\t\t\ttopSrc = link.srcObj.y_pos;\n\t\t\t\tbottomSrc = link.srcObj.y_pos + link.srcObj.height;\n\t\t\t\ttopTrg = link.trgNode.y_pos;\n\t\t\t\tbottomTrg = link.trgNode.y_pos + link.trgNode.height;\n\t\t\t}\n\t\t// When dragging out a new link we will not have src nor trg nodes so we\n\t\t// make a best guess at the node dimensions.\n\t\t} else {\n\t\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM) {\n\t\t\t\ttopSrc = -link.x1;\n\t\t\t\ttopTrg = -link.x2;\n\t\t\t\tbottomSrc = -link.x1;\n\t\t\t\tbottomTrg = -link.x2;\n\n\t\t\t} else if (this.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\t\ttopSrc = link.x1;\n\t\t\t\ttopTrg = link.x2;\n\t\t\t\tbottomSrc = link.x1;\n\t\t\t\tbottomTrg = link.x2;\n\n\t\t\t} else {\n\t\t\t\ttopSrc = link.y1;\n\t\t\t\ttopTrg = link.y2;\n\t\t\t\tbottomSrc = link.y1;\n\t\t\t\tbottomTrg = link.y2;\n\t\t\t}\n\t\t}\n\n\t\tlet newData = link;\n\t\t// Rotate the input data for TB and BT link configurations to be Left->Right\n\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM) {\n\t\t\tnewData = this.rotateData90Degrees(newData, ANTI_CLOCKWISE);\n\n\t\t} else if (this.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\tnewData = this.rotateData90Degrees(newData, CLOCKWISE);\n\t\t}\n\n\t\tconst pathInfo = this.canvasLayout.linkType === LINK_TYPE_ELBOW\n\t\t\t? this.getElbowPathInfo(newData, minInitialLine, topSrc, topTrg, bottomSrc, bottomTrg)\n\t\t\t: this.getCurvePathInfo(newData, minInitialLine, topSrc, topTrg, bottomSrc, bottomTrg);\n\n\t\t// For TB and BT link directions rotate the path elements from Left-Right\n\t\t// back to the appropriate orientation.\n\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM) {\n\t\t\tpathInfo.elements = this.rotateElements90Degrees(pathInfo.elements, CLOCKWISE);\n\t\t\tpathInfo.centerPoint = this.rotatePoint90Degrees(pathInfo.centerPoint.x, pathInfo.centerPoint.y, CLOCKWISE);\n\n\t\t} else if (this.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\tpathInfo.elements = this.rotateElements90Degrees(pathInfo.elements, ANTI_CLOCKWISE);\n\t\t\tpathInfo.centerPoint = this.rotatePoint90Degrees(pathInfo.centerPoint.x, pathInfo.centerPoint.y, ANTI_CLOCKWISE);\n\t\t}\n\n\t\tpathInfo.path = this.createPath(pathInfo.elements);\n\n\t\treturn pathInfo;\n\t}\n\n\t// Returns a pathInfo object describing a curved conneciton line based on the\n\t// data object and minInitialLine passed in. topSrc, topTrg, bottomSrc,\n\t// bottomTrg describe the boundaries of the source and target node as they\n\t// would be in the left->right orientation. The output object contains the\n\t// following fields:\n\t// elements - an array of path elements describing the line\n\t// centerPoint - an object with x, y coordinate for the center of the line\n\t// centerPoint is used for decoration placement.\n\tgetCurvePathInfo(data, minInitialLine, topSrc, topTrg, bottomSrc, bottomTrg) {\n\t\t// Declare points for decorator positioning. CenterPoint will be the\n\t\t// middle of the line.\n\t\tconst centerPoint = { x: 0, y: 0 };\n\t\tconst xDiff = data.x2 - data.x1;\n\n\t\tconst elements = [];\n\t\telements.push({ p: \"M\", x: data.x1, y: data.y1 });\n\n\t\tif (xDiff >= minInitialLine ||\n\t\t\t\t(bottomTrg > topSrc - this.canvasLayout.wrapAroundNodePadding &&\n\t\t\t\t\ttopTrg < bottomSrc + this.canvasLayout.wrapAroundNodePadding &&\n\t\t\t\t\tdata.x2 > data.x1)) {\n\t\t\tconst corner1X = data.x1 + (data.x2 - data.x1) / 2;\n\t\t\tconst corner1Y = data.y1;\n\t\t\tconst corner2X = corner1X;\n\t\t\tconst corner2Y = data.y2;\n\n\t\t\telements.push(\n\t\t\t\t{ p: \"C\", x: corner1X, y: corner1Y, x2: corner2X, y2: corner2Y, x3: data.x2, y3: data.y2 }\n\t\t\t);\n\t\t\tcenterPoint.x = corner1X;\n\t\t\tcenterPoint.y = corner1Y + ((corner2Y - corner1Y) / 2);\n\n\t\t} else {\n\t\t\tconst yDiff = data.y2 - data.y1;\n\n\t\t\tconst midY = this.calculateMidY(data, topSrc, bottomSrc, topTrg, bottomTrg);\n\n\t\t\t// Calculate an offset for the start points of the straight line. This\n\t\t\t// will be relative to the start and end point of the curve. This needs\n\t\t\t// to be based on the X gap between the source and target nodes but also\n\t\t\t// dependent on the Y gap between those nodes because, as the Y gap\n\t\t\t// increases, we want the straight line to decrease in size.\n\t\t\tconst offsetForStraightLine = Math.min((Math.abs(yDiff) / 2), -(xDiff - minInitialLine / 2));\n\n\t\t\t// Calculate an offset for the first and last corners. This allows the\n\t\t\t// curve to 'grow' slowly out from a straight line to a point where the\n\t\t\t// initial corners of the curve are a maximum of minInitialLine.\n\t\t\tconst offsetForFirstCorner = minInitialLine - Math.max((xDiff / 2), 0);\n\n\t\t\tconst corner1X = data.x1 + offsetForFirstCorner;\n\t\t\tconst corner1Y = data.y1;\n\n\t\t\tconst corner2X = corner1X;\n\t\t\tconst corner2Y = data.y1 + ((midY - data.y1) / 2);\n\n\t\t\tconst corner4X = data.x1 + ((data.x2 - data.x1) / 2);\n\t\t\tconst corner4Y = midY;\n\n\t\t\tconst corner4aX = data.x1 - offsetForStraightLine;\n\t\t\tconst corner4aY = midY;\n\n\t\t\tconst corner4bX = data.x2 + offsetForStraightLine;\n\t\t\tconst corner4bY = midY;\n\n\t\t\tconst corner5X = data.x2 - offsetForFirstCorner;\n\t\t\tconst corner5Y = midY;\n\n\t\t\tconst corner6X = corner5X;\n\t\t\tconst corner6Y = midY + ((data.y2 - midY) / 2);\n\n\t\t\t// There is enough space we draw a straight line to join one end of the\n\t\t\t// curve to another. Otherwise we just draw a continuous curve with no\n\t\t\t// straight line.\n\t\t\tif (corner4aX > corner4bX) {\n\t\t\t\telements.push(\n\t\t\t\t\t{ p: \"Q\", x: corner1X, y: corner1Y, x2: corner2X, y2: corner2Y },\n\t\t\t\t\t{ p: \"T\", x: corner4aX, y: corner4aY },\n\t\t\t\t\t{ p: \"L\", x: corner4bX, y: corner4bY },\n\t\t\t\t\t{ p: \"Q\", x: corner5X, y: corner5Y, x2: corner6X, y2: corner6Y },\n\t\t\t\t\t{ p: \"T\", x: data.x2, y: data.y2 }\n\t\t\t\t);\n\n\t\t\t\tcenterPoint.x = corner4aX + ((corner4bX - corner4aX) / 2);\n\t\t\t\tcenterPoint.y = corner4aY;\n\t\t\t} else {\n\t\t\t\telements.push(\n\t\t\t\t\t{ p: \"Q\", x: corner1X, y: corner1Y, x2: corner2X, y2: corner2Y },\n\t\t\t\t\t{ p: \"T\", x: corner4X, y: corner4Y },\n\t\t\t\t\t{ p: \"Q\", x: corner5X, y: corner5Y, x2: corner6X, y2: corner6Y },\n\t\t\t\t\t{ p: \"T\", x: data.x2, y: data.y2 }\n\t\t\t\t);\n\n\t\t\t\tcenterPoint.x = corner4X;\n\t\t\t\tcenterPoint.y = corner4Y;\n\t\t\t}\n\t\t}\n\n\t\treturn { elements, centerPoint };\n\t}\n\n\t// Returns a pathInfo object describing an elbow connection line based on the\n\t// data object and minInitialLine passed in. The output object contains the\n\t// following fields:\n\t// elements - an array of path elements describing the line\n\t// centerPoint - an object with x, y coordinates for the center of the line\n\t//               used for decoration placement.\n\tgetElbowPathInfo(data, minInitialLine, topSrc, topTrg, bottomSrc, bottomTrg) {\n\t\t// The minimum size of the line entering the target port. When\n\t\t// dynamically drawing a new connection we will not have a target node\n\t\t// so use a fixed value for this.\n\t\tconst minFinalLine = data.trgNode ? data.trgNode.layout.minFinalLine : 30;\n\n\t\t// Initalize centerPoint which can be used by the link decorations\n\t\tconst centerPoint = { x: 0, y: 0 };\n\n\t\tconst corner1X = data.x1 + minInitialLine;\n\t\tconst corner1Y = data.y1;\n\t\tlet corner2X = corner1X;\n\t\tconst corner2Y = data.y2;\n\n\t\tconst xDiff = data.x2 - data.x1;\n\t\tconst yDiff = data.y2 - data.y1;\n\n\t\tlet elbowYOffset;\n\n\t\t// This is a special case where the source and target handles are very\n\t\t// close together.\n\t\tif (xDiff > 0 &&\n\t\t\t\tyDiff < (4 * this.canvasLayout.elbowSize) &&\n\t\t\t\tyDiff > -(4 * this.canvasLayout.elbowSize)) {\n\t\t\tif (xDiff < (minInitialLine + minFinalLine)) {\n\t\t\t\telbowYOffset = yDiff / 4;\n\t\t\t} else {\n\t\t\t\telbowYOffset = yDiff / 2;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (yDiff >= 0) {\n\t\t\t\telbowYOffset = this.canvasLayout.elbowSize;\n\t\t\t} else {\n\t\t\t\telbowYOffset = -this.canvasLayout.elbowSize;\n\t\t\t}\n\t\t}\n\n\t\tlet elbowXOffset = this.canvasLayout.elbowSize;\n\t\tlet extraSegments = false;\t// Indicates need for extra elbows and lines\n\n\t\tif (xDiff < (minInitialLine + minFinalLine)) {\n\t\t\textraSegments = true;\n\t\t\tcorner2X = data.x2 - minFinalLine;\n\t\t\telbowXOffset = Math.min(this.canvasLayout.elbowSize, -((xDiff - (minInitialLine + minFinalLine)) / 2));\n\t\t}\n\n\t\tconst elements = [];\n\t\telements.push(\n\t\t\t{ p: \"M\", x: data.x1, y: data.y1 },\n\t\t\t{ p: \"L\", x: (corner1X - this.canvasLayout.elbowSize), y: corner1Y },\n\t\t);\n\n\t\tif (extraSegments === false) {\n\t\t\telements.push(\n\t\t\t\t{ p: \"Q\", x: corner1X, y: corner1Y, x2: corner1X, y2: (corner1Y + elbowYOffset) },\n\t\t\t\t{ p: \"L\", x: corner2X, y: (corner2Y - elbowYOffset) }\n\t\t\t);\n\n\t\t\tcenterPoint.x = corner2X;\n\t\t\tcenterPoint.y = corner2Y;\n\n\t\t} else {\n\t\t\tconst midY = (xDiff < 0)\n\t\t\t\t? this.calculateMidY(data, topSrc, bottomSrc, topTrg, bottomTrg)\n\t\t\t\t: corner2Y - (corner2Y - corner1Y) / 2;\n\n\t\t\tif (xDiff < 0) {\n\t\t\t\tif (midY >= bottomSrc) {\n\t\t\t\t\telbowYOffset = this.canvasLayout.elbowSize;\n\t\t\t\t} else {\n\t\t\t\t\telbowYOffset = -this.canvasLayout.elbowSize;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet corner2Ya;\n\t\t\tlet corner2Yb;\n\n\t\t\tif ((midY < topTrg && midY < topSrc) ||\n\t\t\t\t\t(midY > bottomTrg && midY > bottomSrc)) {\n\t\t\t\tcorner2Ya = midY - elbowYOffset;\n\t\t\t\tcorner2Yb = corner2Y + elbowYOffset;\n\n\t\t\t} else {\n\t\t\t\tcorner2Ya = midY + elbowYOffset;\n\t\t\t\tcorner2Yb = corner2Y - elbowYOffset;\n\t\t\t}\n\n\t\t\telements.push(\n\t\t\t\t{ p: \"Q\", x: corner1X, y: corner1Y, x2: corner1X, y2: (corner1Y + elbowYOffset) },\n\t\t\t\t{ p: \"L\", x: corner1X, y: (midY - elbowYOffset) },\n\t\t\t\t{ p: \"Q\", x: corner1X, y: midY, x2: (corner1X - elbowXOffset), y2: midY },\n\t\t\t\t{ p: \"L\", x: (corner2X + elbowXOffset), y: midY },\n\t\t\t\t{ p: \"Q\", x: corner2X, y: midY, x2: corner2X, y2: corner2Ya },\n\t\t\t\t{ p: \"L\", x: corner2X, y: corner2Yb }\n\t\t\t);\n\n\t\t\tcenterPoint.x = corner1X;\n\t\t\tcenterPoint.y = midY;\n\t\t}\n\n\t\telements.push(\n\t\t\t{ p: \"Q\", x: corner2X, y: corner2Y, x2: (corner2X + this.canvasLayout.elbowSize), y2: corner2Y },\n\t\t\t{ p: \"L\", x: data.x2, y: data.y2 }\n\t\t);\n\n\t\treturn { elements, centerPoint };\n\t}\n\n\t// Returns a Y coordinate for the horizontal line that joins the source and\n\t// target nodes (to be connected either with a curve or elbow line style) when\n\t// the target node is to the left of the source node. This is either the\n\t// center point between the source and target nodes, if there is room to draw\n\t// the line between them, or it is the coordinate of a wrap-around line to be\n\t// drawn around the outside of the source and target nodes. The direction of\n\t// the wrap around line is chosen based on which is the shortest route from\n\t// the source port to the target port.\n\tcalculateMidY(data, topSrc, bottomSrc, topTrg, bottomTrg) {\n\t\tlet midY;\n\n\t\tif (topTrg >= bottomSrc + this.canvasLayout.wrapAroundNodePadding) {\n\t\t\tmidY = bottomSrc + ((topTrg - bottomSrc) / 2);\n\n\t\t} else if (bottomTrg <= topSrc - this.canvasLayout.wrapAroundNodePadding) {\n\t\t\tmidY = bottomTrg + ((topSrc - bottomTrg) / 2);\n\n\t\t} else {\n\t\t\tconst maxBottom = Math.max(bottomSrc, bottomTrg);\n\t\t\tconst srcBottomInc = maxBottom - data.y1;\n\t\t\tconst trgBottomInc = maxBottom - data.y2;\n\n\t\t\tconst minTop = Math.min(topSrc, topTrg);\n\t\t\tconst srcTopInc = data.y1 - minTop;\n\t\t\tconst trgTopInc = data.y2 - minTop;\n\n\t\t\t// Set the mid-point based in the shortest distance from the source port\n\t\t\t// on the source node to the target port on the target node.\n\t\t\tif (srcBottomInc + trgBottomInc > srcTopInc + trgTopInc) {\n\t\t\t\tmidY = minTop - this.canvasLayout.wrapAroundSpacing;\n\t\t\t} else {\n\t\t\t\tmidY = maxBottom + this.canvasLayout.wrapAroundSpacing;\n\t\t\t}\n\t\t}\n\n\t\treturn midY;\n\t}\n\n\t// Returns a new data object based on the data object passed in with its\n\t// x1,y1 and x2,y2 coordinates rotated 90 degrees in the clockwise direction\n\t// or 90 degress in the anti-clockwise dirction if the antiClockwise\n\t// parameter is set to true.\n\trotateData90Degrees(data, antiClockwise) {\n\t\tconst newPoint1 = this.rotatePoint90Degrees(data.x1, data.y1, antiClockwise);\n\t\tconst newPoint2 = this.rotatePoint90Degrees(data.x2, data.y2, antiClockwise);\n\t\treturn { x1: newPoint1.x, y1: newPoint1.y, x2: newPoint2.x, y2: newPoint2.y };\n\t}\n\n\t// Returns the array of path elements passed in rotated by 90 degrees in the\n\t// clockwise direction or 90 degrees in the anti-clockwise direction if the\n\t// antiClockwise parameter is set to true.\n\trotateElements90Degrees(elements, antiClockwise) {\n\t\tlet newPoint;\n\t\telements.forEach((el) => {\n\t\t\tnewPoint = this.rotatePoint90Degrees(el.x, el.y, antiClockwise);\n\t\t\tel.x = newPoint.x;\n\t\t\tel.y = newPoint.y;\n\t\t\tif (el.p === \"Q\" || el.p === \"C\") {\n\t\t\t\tnewPoint = this.rotatePoint90Degrees(el.x2, el.y2, antiClockwise);\n\t\t\t\tel.x2 = newPoint.x;\n\t\t\t\tel.y2 = newPoint.y;\n\t\t\t\tif (el.p === \"C\") {\n\t\t\t\t\tnewPoint = this.rotatePoint90Degrees(el.x3, el.y3, antiClockwise);\n\t\t\t\t\tel.x3 = newPoint.x;\n\t\t\t\t\tel.y3 = newPoint.y;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn elements;\n\t}\n\n\t// Returns an object containing x and y coordinate passed in rotated by 90\n\t// degrees in the clockwise direction or by 90 degrees anit-clockwise if the\n\t// antiClockwise parameter is set to true.\n\t// https://math.stackexchange.com/questions/1330161/how-to-rotate-points-through-90-degree\n\trotatePoint90Degrees(x, y, antiClockwise) {\n\t\tif (antiClockwise) {\n\t\t\treturn { x: y, y: -x };\n\t\t}\n\t\treturn { x: -y, y: x };\n\t}\n\n\t// Returns an SVG path string from the array of path elements passed in.\n\tcreatePath(elements) {\n\t\tconst count = elements.length - 1;\n\t\tlet path = \"\";\n\t\telements.forEach((el, i) => {\n\t\t\tif (el.p === \"M\") {\n\t\t\t\tpath += \"M \" + el.x + \" \" + el.y;\n\t\t\t} else if (el.p === \"L\") {\n\t\t\t\tpath += \"L \" + el.x + \" \" + el.y;\n\t\t\t} else if (el.p === \"T\") {\n\t\t\t\tpath += \"T \" + el.x + \" \" + el.y;\n\t\t\t} else if (el.p === \"Q\") {\n\t\t\t\tpath += \"Q \" + el.x + \" \" + el.y + \" \" + el.x2 + \" \" + el.y2;\n\t\t\t} else if (el.p === \"C\") {\n\t\t\t\tpath += \"C \" + el.x + \" \" + el.y + \" \" + el.x2 + \" \" + el.y2 + \" \" + el.x3 + \" \" + el.y3;\n\t\t\t}\n\t\t\tif (i < count) {\n\t\t\t\tpath += \" \";\n\t\t\t}\n\t\t});\n\t\treturn path;\n\t}\n\n\t// Returns an object containing the path string, center position and angle\n\t// for the line object passed in which describes a simple straight connector\n\t// line from source to target.\n\tgetStraightPath(data) {\n\t\tconst path = \"M \" + data.x1 + \" \" + data.y1 + \" L \" + data.x2 + \" \" + data.y2;\n\t\tconst xDiff = data.x2 - data.x1;\n\t\tconst yDiff = data.y2 - data.y1;\n\t\tconst centerPoint = {\n\t\t\tx: data.x1 + (xDiff / 2),\n\t\t\ty: data.y1 + (yDiff / 2)\n\t\t};\n\t\tlet angle = Math.atan(yDiff / xDiff); // Atan(Opposite / Adjacent) = Angle in Radians\n\n\t\tif (xDiff < 0) {\n\t\t\tangle = ONE_EIGHTY_DEGREES_IN_RADIANS + angle;\n\t\t}\n\n\t\treturn { path, centerPoint, angle };\n\t}\n\n\tgetAssociationCurvePath(data, minInitialLine) {\n\t\tif (data.assocLinkVariation === ASSOC_VAR_CURVE_LEFT) {\n\t\t\treturn this.getCurveLeftPath(data, minInitialLine);\n\n\t\t} else if (data.assocLinkVariation === ASSOC_VAR_DOUBLE_BACK_LEFT) {\n\t\t\treturn this.getDoubleBackLeft(data, minInitialLine);\n\n\t\t} else if (data.assocLinkVariation === ASSOC_VAR_DOUBLE_BACK_RIGHT) {\n\t\t\treturn this.getDoubleBackRight(data, minInitialLine);\n\n\t\t}\n\t\treturn this.getCurveRightPath(data, minInitialLine);\n\t}\n\n\tgetCurveLeftPath(data, minInitialLine) {\n\t\tconst corner1X = data.x1 - ((data.x1 - data.x2) / 2);\n\t\treturn this.getCurveOutPath(data, minInitialLine, corner1X);\n\t}\n\n\tgetCurveRightPath(data, minInitialLine) {\n\t\tconst corner1X = data.x1 + ((data.x2 - data.x1) / 2);\n\t\treturn this.getCurveOutPath(data, minInitialLine, corner1X);\n\t}\n\n\tgetCurveOutPath(data, minInitialLine, corner1X) {\n\t\tconst corner1Y = data.y1;\n\t\tconst corner2X = corner1X;\n\t\tconst corner2Y = data.y2;\n\t\tconst path = \"M \" + data.x1 + \" \" + data.y1 +\n\t\t\t\" C \" + corner1X + \" \" + corner1Y + \" \" + corner2X + \" \" + corner2Y + \" \" + data.x2 + \" \" + data.y2;\n\t\tconst centerPoint = { x: corner1X, y: corner1Y + ((corner2Y - corner1Y) / 2) };\n\t\treturn { path, centerPoint };\n\t}\n\n\tgetDoubleBackLeft(data, minInitialLine) {\n\t\tconst corner1X = Math.min(data.x1, data.x2) - minInitialLine - 100;\n\t\treturn this.getDoubleBack(data, minInitialLine, corner1X);\n\t}\n\n\tgetDoubleBackRight(data, minInitialLine) {\n\t\tconst corner1X = Math.max(data.x1, data.x2) + minInitialLine + 100;\n\t\treturn this.getDoubleBack(data, minInitialLine, corner1X);\n\t}\n\n\tgetDoubleBack(data, minInitialLine, corner1X) {\n\t\tconst corner1Y = data.y1;\n\t\tconst corner2X = corner1X;\n\t\tconst corner2Y = data.y2;\n\t\tconst path = \"M \" + data.x1 + \" \" + data.y1 +\n\t\t\t\" C \" + corner1X + \" \" + corner1Y + \" \" +\n\t\t\tcorner2X + \" \" + corner2Y + \" \" + data.x2 + \" \" + data.y2;\n\t\tconst centerPointX = this.calcCenterPoint(data.x1, corner1X, corner2X, data.x2);\n\t\tconst centerPointY = this.calcCenterPoint(data.y1, corner1Y, corner2Y, data.y2);\n\t\tconst centerPoint = { x: centerPointX, y: centerPointY };\n\t\treturn { path, centerPoint };\n\t}\n\n\t// Returns an x or y coordinate of the center point on a bezier curve from\n\t// the four x or y coordinates passed in which are the coordinates of the four\n\t// control points that describe the curve.\n\tcalcCenterPoint(c1, c2, c3, c4) {\n\t\tconst t = 0.5;\n\n\t\tconst part1 = Math.pow((1 - t), 3) * c1;\n\t\tconst part2 = 3 * Math.pow((1 - t), 2) * t * c2;\n\t\tconst part3 = 3 * Math.pow((1 - t), 2) * t * c3;\n\t\tconst part4 = Math.pow(t, 3) * c4;\n\n\t\treturn part1 + part2 + part3 + part4;\n\t}\n\n}\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { has } from \"lodash\";\nimport { DEC_LINK, TEXT_AREA_BORDER_ADJUSTMENT } from \"./constants/canvas-constants\";\n\nexport default class SvgCanvasDecs {\n\tconstructor(canvasLayout) {\n\t\tthis.canvasLayout = canvasLayout;\n\t}\n\n\tgetDec(id, decorations) {\n\t\tif (decorations) {\n\t\t\tconst dec = decorations.find((nd) => nd.id === id);\n\t\t\treturn dec;\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetDecLabelClass(dec, objType) {\n\t\tconst lineTypeClass = dec.label_single_line ? \" d3-label-single-line\" : \" d3-label-multi-line\";\n\t\tconst justificationClass = dec.label_align === \"center\" ? \" d3-label-center\" : \"\";\n\t\treturn this.getDecClass(dec, `d3-${objType}-dec-label`) + lineTypeClass + justificationClass;\n\t}\n\n\tgetDecLabelTextAreaClass(dec) {\n\t\tconst lineTypeClass = dec.label_single_line ? \" d3-label-single-line\" : \" d3-label-multi-line-entry\";\n\t\tconst justificationClass = dec.label_align === \"center\" ? \" d3-label-center\" : \"\";\n\t\treturn \"d3-dec-label-entry\" + lineTypeClass + justificationClass;\n\t}\n\n\tgetDecTransform(dec, d, objType) {\n\t\treturn `translate(${this.getDecPosX(dec, d, objType)}, ${this.getDecPosY(dec, d, objType)})`;\n\t}\n\n\tgetDecPosX(dec, data, objType) {\n\t\tif (objType === DEC_LINK) {\n\t\t\treturn this.getLinkDecPosX(dec, data, objType);\n\t\t}\n\t\treturn this.getNodeDecPosX(dec, data);\n\t}\n\n\tgetNodeDecPosX(dec, node) {\n\t\tconst position = dec.position || \"topLeft\";\n\t\tlet x = 0;\n\t\tif (position === \"topLeft\" || position === \"middleLeft\" || position === \"bottomLeft\") {\n\t\t\tx = typeof dec.x_pos !== \"undefined\" ? Number(dec.x_pos) : node.layout.decoratorLeftX;\n\t\t} else if (position === \"topCenter\" || position === \"middleCenter\" || position === \"bottomCenter\") {\n\t\t\tx = (node.width / 2) + (typeof dec.x_pos !== \"undefined\" ? Number(dec.x_pos) : node.layout.decoratorCenterX);\n\t\t} else if (position === \"topRight\" || position === \"middleRight\" || position === \"bottomRight\") {\n\t\t\tx = node.width + (typeof dec.x_pos !== \"undefined\" ? Number(dec.x_pos) : node.layout.decoratorRightX);\n\t\t}\n\t\treturn x;\n\t}\n\n\tgetLinkDecPosX(dec, link, objType) {\n\t\tconst position = dec.position || \"middle\";\n\t\tlet x = 0;\n\t\tif (position === \"middle\") {\n\t\t\tx = link.pathInfo.centerPoint ? link.pathInfo.centerPoint.x : link.x1 + ((link.x2 - link.x1) / 2);\n\t\t} else if (position === \"source\") {\n\t\t\tx = link.pathInfo.sourcePoint ? link.pathInfo.sourcePoint.x : link.x1;\n\t\t} else if (position === \"target\") {\n\t\t\tx = link.pathInfo.targetPoint ? link.pathInfo.targetPoint.x : link.x2;\n\t\t}\n\t\tx = typeof dec.x_pos !== \"undefined\" ? x + Number(dec.x_pos) : x;\n\n\t\t// 'angle' will only be available when displaying straight link lines so\n\t\t//  distance field is only applicable with straight lines.\n\t\t// 'angle' may be 0 so use has to check that it is not undefined.\n\t\tif (dec.distance && has(link, \"pathInfo.angle\")) {\n\t\t\tx += Math.cos(link.pathInfo.angle) * dec.distance;\n\t\t}\n\n\t\t// Subtract half the width for center aligned labels.\n\t\tif (dec.label_align === \"center\") {\n\t\t\tx -= this.getDecWidth(dec, link, objType) / 2;\n\t\t}\n\t\treturn x;\n\t}\n\n\tgetDecPosY(dec, data, objType) {\n\t\tif (objType === DEC_LINK) {\n\t\t\treturn this.getLinkDecPosY(dec, data);\n\t\t}\n\t\treturn this.getNodeDecPosY(dec, data);\n\t}\n\n\tgetNodeDecPosY(dec, node) {\n\t\tconst position = dec.position || \"topLeft\";\n\t\tlet y = 0;\n\t\tif (position === \"topLeft\" || position === \"topCenter\" || position === \"topRight\") {\n\t\t\ty = typeof dec.y_pos !== \"undefined\" ? Number(dec.y_pos) : node.layout.decoratorTopY;\n\t\t} else if (position === \"middleLeft\" || position === \"middleCenter\" || position === \"middleRight\") {\n\t\t\ty = (node.height / 2) + (typeof dec.y_pos !== \"undefined\" ? Number(dec.y_pos) : node.layout.decoratorMiddleY);\n\t\t} else if (position === \"bottomLeft\" || position === \"bottomCenter\" || position === \"bottomRight\") {\n\t\t\ty = node.height + (typeof dec.y_pos !== \"undefined\" ? Number(dec.y_pos) : node.layout.decoratorBottomY);\n\t\t}\n\t\treturn y;\n\t}\n\n\tgetLinkDecPosY(dec, link) {\n\t\tconst position = dec.position || \"middle\";\n\t\tlet y = 0;\n\t\tif (position === \"middle\") {\n\t\t\ty = link.pathInfo.centerPoint ? link.pathInfo.centerPoint.y : link.y1 + ((link.y2 - link.y1) / 2);\n\t\t} else if (position === \"source\") {\n\t\t\ty = link.pathInfo.sourcePoint ? link.pathInfo.sourcePoint.y : link.y1;\n\t\t} else if (position === \"target\") {\n\t\t\ty = link.pathInfo.targetPoint ? link.pathInfo.targetPoint.y : link.y2;\n\t\t}\n\t\ty = typeof dec.y_pos !== \"undefined\" ? y + Number(dec.y_pos) : y;\n\n\t\t// 'angle' will only be available when displaying straight link lines so\n\t\t// distance field is only applicable with straight lines.\n\t\t// 'angle' may be 0 so use has to check that it is not undefined.\n\t\tif (dec.distance && has(link, \"pathInfo.angle\")) {\n\t\t\ty += Math.sin(link.pathInfo.angle) * dec.distance;\n\t\t}\n\n\t\treturn y;\n\t}\n\n\tgetDecPadding(dec, obj, objType) {\n\t\t// If outline is set to false we don't pad the decorator image.\n\t\tif (dec.outline === false) {\n\t\t\treturn 0;\n\t\t}\n\t\tif (objType === DEC_LINK) {\n\t\t\treturn this.canvasLayout.linkDecoratorPadding;\n\t\t}\n\t\treturn obj.layout.decoratorPadding;\n\t}\n\n\tgetDecWidth(dec, obj, objType) {\n\t\tif (typeof dec.width !== \"undefined\") {\n\t\t\treturn Number(dec.width);\n\t\t} else if (objType === DEC_LINK) {\n\t\t\treturn this.canvasLayout.linkDecoratorWidth;\n\t\t}\n\t\treturn obj.layout.decoratorWidth;\n\t}\n\n\tgetDecHeight(dec, obj, objType) {\n\t\tif (typeof dec.height !== \"undefined\") {\n\t\t\treturn Number(dec.height);\n\t\t} else if (objType === DEC_LINK) {\n\t\t\treturn this.canvasLayout.linkDecoratorHeight;\n\t\t}\n\t\treturn obj.layout.decoratorHeight;\n\t}\n\n\tgetDecClass(dec, inClassName) {\n\t\tlet className = inClassName;\n\t\tif (dec && dec.class_name) {\n\t\t\tclassName += \" \" + dec.class_name;\n\t\t}\n\t\treturn className;\n\t}\n\n\tgetDecImage(dec) {\n\t\tif (dec) {\n\t\t\treturn dec.image;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tgetDecLabelEditIconTranslate(dec, obj, objType, spanObj, zoomScale) {\n\t\treturn `translate(${this.getDecLabelEditIconPosX(dec, obj, objType, spanObj, zoomScale)}, ${this.getDecLabelEditIconPosY(dec)})`;\n\t}\n\n\tgetDecLabelEditIconPosX(dec, obj, objType, spanObj, zoomScale) {\n\t\tconst minWidth = Math.min(spanObj.getBoundingClientRect().width, this.getDecLabelWidth(dec, obj, objType));\n\t\tif (dec.label_align === \"center\") {\n\t\t\tconst halfWid = this.getDecLabelWidth(dec, obj, objType) / 2;\n\t\t\treturn halfWid + (minWidth / 2) / zoomScale;\n\t\t}\n\t\treturn minWidth / zoomScale;\n\t}\n\n\tgetDecLabelEditIconPosY(dec) {\n\t\treturn 0;\n\t}\n\n\tgetDecLabelWidth(dec, obj, objType) {\n\t\tif (typeof dec.width !== \"undefined\") {\n\t\t\treturn Number(dec.width);\n\t\t} else if (objType === DEC_LINK) {\n\t\t\treturn this.canvasLayout.linkDecoratorLabelWidth;\n\t\t}\n\t\treturn obj.layout.decoratorLabelWidth;\n\t}\n\n\tgetDecLabelHeight(dec, obj, objType) {\n\t\tif (typeof dec.height !== \"undefined\") {\n\t\t\treturn Number(dec.height);\n\t\t} else if (objType === DEC_LINK) {\n\t\t\treturn this.canvasLayout.linkDecoratorLabelHeight;\n\t\t}\n\t\treturn obj.layout.decoratorLabelHeight;\n\t}\n\n\tgetDecLabelTextAreaWidth(dec, obj, objType) {\n\t\treturn this.getDecLabelWidth(dec, obj, objType) + (2 * TEXT_AREA_BORDER_ADJUSTMENT);\n\t}\n\n\tgetDecLabelTextAreaHeight(dec, obj, objType) {\n\t\treturn this.getDecLabelHeight(dec, obj, objType) + (2 * TEXT_AREA_BORDER_ADJUSTMENT);\n\t}\n\n\tgetDecLabelTextAreaPosX() {\n\t\treturn -TEXT_AREA_BORDER_ADJUSTMENT;\n\t}\n\n\tgetDecLabelTextAreaPosY() {\n\t\treturn -(TEXT_AREA_BORDER_ADJUSTMENT - 1);\n\t}\n}\n","var basePropertyOf = require('./_basePropertyOf');\n\n/** Used to map HTML entities to characters. */\nvar htmlUnescapes = {\n  '&amp;': '&',\n  '&lt;': '<',\n  '&gt;': '>',\n  '&quot;': '\"',\n  '&#39;': \"'\"\n};\n\n/**\n * Used by `_.unescape` to convert HTML entities to characters.\n *\n * @private\n * @param {string} chr The matched character to unescape.\n * @returns {string} Returns the unescaped character.\n */\nvar unescapeHtmlChar = basePropertyOf(htmlUnescapes);\n\nmodule.exports = unescapeHtmlChar;\n","var toString = require('./toString'),\n    unescapeHtmlChar = require('./_unescapeHtmlChar');\n\n/** Used to match HTML entities and HTML characters. */\nvar reEscapedHtml = /&(?:amp|lt|gt|quot|#39);/g,\n    reHasEscapedHtml = RegExp(reEscapedHtml.source);\n\n/**\n * The inverse of `_.escape`; this method converts the HTML entities\n * `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#39;` in `string` to\n * their corresponding characters.\n *\n * **Note:** No other HTML entities are unescaped. To unescape additional\n * HTML entities use a third-party library like [_he_](https://mths.be/he).\n *\n * @static\n * @memberOf _\n * @since 0.6.0\n * @category String\n * @param {string} [string=''] The string to unescape.\n * @returns {string} Returns the unescaped string.\n * @example\n *\n * _.unescape('fred, barney, &amp; pebbles');\n * // => 'fred, barney, & pebbles'\n */\nfunction unescape(string) {\n  string = toString(string);\n  return (string && reHasEscapedHtml.test(string))\n    ? string.replace(reEscapedHtml, unescapeHtmlChar)\n    : string;\n}\n\nmodule.exports = unescape;\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class SvgCanvasUtilsComments {\n\n\t// Processes the action passed in and returns an object containing:\n\t// newText - new text based on the input text passed in with markdown\n\t//           characters added based on the selected part of the text\n\t// newStart - a new starting point for selection highlighting\n\t// newEnd - a new ending point for selection highlighting\n\tstatic processMarkdownAction(action, text, inStart, inEnd) {\n\t\tlet start = inStart;\n\t\tlet end = inEnd;\n\t\tlet mdObj = null;\n\n\t\tif (start === end) {\n\t\t\tstart = this.findFirstSpace(text, start);\n\t\t\tend = this.findLastSpace(text, end);\n\n\t\t} else if (this.allWhiteSpace(text, start, end)) {\n\t\t\tstart = end;\n\n\t\t} else {\n\t\t\tstart = this.findFirstNonSpace(text, start, end);\n\t\t\tend = this.findLastNonSpace(text, start, end);\n\t\t}\n\n\t\tswitch (action) {\n\t\tcase \"title\":\n\t\tcase \"header\":\n\t\tcase \"subheader\":\n\t\tcase \"body\":\n\t\tcase \"increaseHashes\":\n\t\tcase \"decreaseHashes\": {\n\t\t\tmdObj = this.processHeaderCommand(text, start, end, action);\n\t\t\tbreak;\n\t\t}\n\t\tcase \"bold\": {\n\t\t\tmdObj = this.processWrapCommand(text, start, end, \"**\");\n\t\t\tbreak;\n\t\t}\n\t\tcase \"italics\": {\n\t\t\tmdObj = this.processWrapCommand(text, start, end, \"_\");\n\t\t\tbreak;\n\t\t}\n\t\tcase \"strikethrough\": {\n\t\t\tmdObj = this.processWrapCommand(text, start, end, \"~~\");\n\t\t\tbreak;\n\t\t}\n\t\tcase \"code\": {\n\t\t\tmdObj = this.processCodeCommand(text, start, end);\n\t\t\tbreak;\n\t\t}\n\t\tcase \"link\": {\n\t\t\tmdObj = this.processLinkCommand(text, start, end);\n\t\t\tbreak;\n\t\t}\n\t\tcase \"quote\":\n\t\tcase \"numberedList\":\n\t\tcase \"bulletedList\": {\n\t\t\tmdObj = this.processMultiLineCommand(text, start, end, action);\n\t\t\tbreak;\n\t\t}\n\t\tcase \"return\": {\n\t\t\tmdObj = this.processReturnCommand(text, start, end, inStart, inEnd);\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tbreak;\n\t\t}\n\t\t}\n\t\treturn mdObj;\n\t}\n\n\tstatic findFirstSpace(text, start) {\n\t\tconst spacePos = text.lastIndexOf(\" \", start - 1) + 1;\n\t\tconst newLinePos = text.lastIndexOf(\"\\n\", start - 1) + 1;\n\t\treturn Math.max(spacePos, newLinePos, 0);\n\t}\n\n\tstatic findLastSpace(text, end) {\n\t\tlet spacePos = text.indexOf(\" \", end);\n\t\tlet newLinePos = text.indexOf(\"\\n\", end);\n\t\tspacePos = spacePos === -1 ? text.length : spacePos;\n\t\tnewLinePos = newLinePos === -1 ? text.length : newLinePos;\n\t\treturn Math.min(spacePos, newLinePos, text.length);\n\t}\n\n\tstatic allWhiteSpace(text, start, end) {\n\t\treturn text.slice(start, end).trim().length === 0;\n\t}\n\n\tstatic findFirstNonSpace(text, start, end) {\n\t\tlet newStart = start;\n\t\twhile ((text[newStart] === \" \" || text[newStart] === \"\\n\") && newStart <= end) {\n\t\t\tnewStart++;\n\t\t}\n\t\treturn newStart;\n\t}\n\n\tstatic findLastNonSpace(text, start, end) {\n\t\tlet newEnd = end;\n\t\twhile ((text[newEnd - 1] === \" \" || text[newEnd - 1] === \"\\n\") && newEnd >= start) {\n\t\t\tnewEnd--;\n\t\t}\n\t\treturn newEnd;\n\t}\n\n\tstatic processHeaderCommand(text, inStart, inEnd, action) {\n\t\tconst start = this.findPrecedingNewLine(text, inStart);\n\t\tconst end = this.findSuceedingNewLine(text, inEnd);\n\n\t\tconst startText = text.slice(0, start);\n\t\tconst selectedText = text.slice(start, end);\n\t\tconst endText = text.slice(end);\n\n\t\tlet newStart = start;\n\t\tlet newEnd = end;\n\t\tlet newText = \"\";\n\t\tlet tempText = selectedText;\n\n\t\t// Remove all hashes if any from the line.\n\t\tconst hashCount = this.getHashCount(selectedText);\n\t\tif (hashCount > 0) {\n\t\t\tconst firstSpace = selectedText.indexOf(\" \");\n\t\t\ttempText = selectedText.slice(firstSpace + 1);\n\t\t\tnewText = startText + tempText + endText;\n\t\t\tnewEnd -= firstSpace + 1;\n\t\t}\n\n\t\t// Add as many hashes as appropriate for the action.\n\t\tconst headerSyntax = this.getHeaderSyntax(action, hashCount);\n\t\tif (headerSyntax) {\n\t\t\tnewText = startText + headerSyntax + tempText + endText;\n\t\t\tnewStart += headerSyntax.length;\n\t\t\tnewEnd += headerSyntax.length;\n\t\t}\n\t\treturn { newText, newStart, newEnd };\n\t}\n\n\tstatic getHeaderSyntax(action, hashCount) {\n\t\tswitch (action) {\n\t\tcase \"title\": return \"# \";\n\t\tcase \"header\": return \"## \";\n\t\tcase \"subheader\": return \"### \";\n\t\tcase \"body\": return false;\n\t\tcase \"increaseHashes\": {\n\t\t\tif (hashCount === 0) {\n\t\t\t\treturn \"# \";\n\t\t\t} else if (hashCount === 1) {\n\t\t\t\treturn \"## \";\n\t\t\t} else if (hashCount === 2) {\n\t\t\t\treturn \"### \";\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\tcase \"decreaseHashes\": {\n\t\t\tif (hashCount === 0) {\n\t\t\t\treturn \"### \";\n\t\t\t} else if (hashCount === 1) {\n\t\t\t\treturn false;\n\t\t\t} else if (hashCount === 2) {\n\t\t\t\treturn \"# \";\n\t\t\t} else if (hashCount === 3) {\n\t\t\t\treturn \"## \";\n\t\t\t}\n\t\t\treturn \"### \";\n\t\t}\n\t\tdefault:\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic getHashCount(text) {\n\t\tif (text.startsWith(\"# \")) {\n\t\t\treturn 1;\n\t\t} else if (text.startsWith(\"## \")) {\n\t\t\treturn 2;\n\t\t} else if (text.startsWith(\"### \")) {\n\t\t\treturn 3;\n\t\t} else if (text.startsWith(\"#### \")) {\n\t\t\treturn 4;\n\t\t} else if (text.startsWith(\"##### \")) {\n\t\t\treturn 5;\n\t\t} else if (text.startsWith(\"###### \")) {\n\t\t\treturn 6;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tstatic processWrapCommand(text, start, end, chars) {\n\t\tlet newText = \"\";\n\t\tlet newStart = start;\n\t\tlet newEnd = end;\n\n\t\tconst startText = text.slice(0, start);\n\t\tconst selectedText = text.slice(start, end);\n\t\tconst endText = text.slice(end);\n\t\tconst charsCount = chars.length;\n\n\t\tif (startText.endsWith(chars) && endText.startsWith(chars)) {\n\t\t\tnewText = startText.slice(0, startText.length - charsCount) +\n\t\t\t\tselectedText +\n\t\t\t\tendText.slice(charsCount);\n\t\t\tnewStart = start - charsCount;\n\t\t\tnewEnd = end - charsCount;\n\n\t\t} else if (selectedText.startsWith(chars) && selectedText.endsWith(chars)) {\n\t\t\tnewText = startText +\n\t\t\t\tselectedText\n\t\t\t\t\t.slice(0, selectedText.length - charsCount) // Remove ending chars\n\t\t\t\t\t.slice(charsCount) + // Remove beginning chars\n\t\t\t\tendText;\n\t\t\tnewStart = start;\n\t\t\tnewEnd = end - (2 * charsCount);\n\n\t\t} else {\n\t\t\tnewText = startText + chars + selectedText + chars + endText;\n\t\t\tnewStart = start + charsCount;\n\t\t\tnewEnd = end + charsCount;\n\t\t}\n\n\t\treturn { newText, newStart, newEnd };\n\t}\n\n\tstatic processCodeCommand(text, start, end) {\n\t\tconst selText = text.slice(start, end);\n\t\tif (selText.indexOf(\"\\n\") > -1) {\n\t\t\treturn this.processTripleBackTicks(text, start, end);\n\t\t}\n\n\t\treturn this.processWrapCommand(text, start, end, \"`\");\n\t}\n\n\tstatic processTripleBackTicks(text, inStart, inEnd) {\n\t\tconst start = this.findPrecedingNewLine(text, inStart);\n\t\tconst end = this.findSuceedingNewLine(text, inEnd);\n\n\t\tconst startText = text.slice(0, start);\n\t\tconst selectedText = text.slice(start, end);\n\t\tconst endText = text.slice(end);\n\n\t\tlet newStart = start;\n\t\tlet newEnd = end;\n\t\tlet newText = \"\";\n\n\t\tif (startText.endsWith(\"```\\n\") && endText.startsWith(\"\\n```\")) {\n\t\t\tnewText = startText.slice(0, start - 4) + selectedText + endText.slice(4);\n\t\t\tnewStart -= 4;\n\t\t\tnewEnd -= 4;\n\n\t\t} else {\n\t\t\tnewText = startText + \"```\\n\" + selectedText + \"\\n```\" + endText;\n\t\t\tnewStart += 4;\n\t\t\tnewEnd += 4;\n\t\t}\n\n\t\treturn { newText, newStart, newEnd };\n\t}\n\n\tstatic processLinkCommand(text, start, end) {\n\t\tlet newText = \"\";\n\t\tlet newStart = start;\n\t\tlet newEnd = end;\n\n\t\tconst startText = text.slice(0, start);\n\t\tconst selectedText = text.slice(start, end);\n\t\tconst endText = text.slice(end);\n\n\t\tif (startText.endsWith(\"[\") && endText.startsWith(\"](url)\")) {\n\t\t\tnewText = startText.slice(0, startText.length - 1) + selectedText + endText.slice(6);\n\t\t\tnewStart = start - 1;\n\t\t\tnewEnd = end - 1;\n\n\t\t} else if (selectedText === \"[](url)\") {\n\t\t\tnewText = startText + endText;\n\t\t\tnewStart = start;\n\t\t\tnewEnd = newStart;\n\n\t\t} else if (start === end) {\n\t\t\tnewText = startText + \"[](url)\" + endText;\n\t\t\tnewStart = start + 1;\n\t\t\tnewEnd = start + 1;\n\n\t\t} else {\n\t\t\tnewText = startText + \"[\" + selectedText + \"](url)\" + endText;\n\t\t\tnewStart = start + 1;\n\t\t\tnewEnd = end + 1;\n\t\t}\n\n\t\treturn { newText, newStart, newEnd };\n\t}\n\n\tstatic processMultiLineCommand(text, start, end, action) {\n\t\tif (this.isMultiLineMarkdown(text, start, end, action)) {\n\t\t\treturn this.removeMultiLineMarkdown(text, start, end, action);\n\t\t}\n\t\treturn this.addMultiLineMarkdown(text, start, end, action);\n\t}\n\n\tstatic isMultiLineMarkdown(text, inStart, inEnd, action) {\n\t\tconst start = this.findPrecedingNewLine(text, inStart);\n\t\tconst end = this.findSuceedingNewLine(text, inEnd);\n\t\tconst selectedText = text.slice(start, end);\n\n\t\tconst lines = selectedText.split(\"\\n\");\n\t\treturn lines.every((line) => this.isMultiLineItem(line, action));\n\t}\n\n\tstatic isMultiLineItem(text, action) {\n\t\tswitch (action) {\n\t\tcase \"quote\":\n\t\t\treturn text.startsWith(\"> \");\n\t\tcase \"bulletedList\":\n\t\t\treturn text.startsWith(\"* \");\n\t\tcase \"numberedList\": {\n\t\t\tconst number = this.getPrefixNumber(text);\n\t\t\treturn (!isNaN(number) && number > 0);\n\t\t}\n\t\tdefault:\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic getPrefixNumber(text) {\n\t\tconst firstSpace = text.indexOf(\". \");\n\t\tconst firstText = text.slice(0, firstSpace);\n\t\treturn Number(firstText);\n\t}\n\n\tstatic removeMultiLineMarkdown(text, inStart, inEnd, action) {\n\t\tconst start = this.findPrecedingNewLine(text, inStart);\n\t\tconst end = this.findSuceedingNewLine(text, inEnd);\n\n\t\tconst startText = text.slice(0, start);\n\t\tconst selectedText = text.slice(start, end);\n\t\tconst endText = text.slice(end);\n\n\t\tconst newStart = start;\n\t\tlet newEnd = end;\n\t\tlet newText = startText;\n\n\t\tconst lines = selectedText.split(\"\\n\");\n\t\tlines.forEach((line, i) => {\n\t\t\tconst newLine = this.removeListPrefix(line, action);\n\t\t\tnewEnd -= (line.length - newLine.length);\n\t\t\tnewText += newLine;\n\t\t\tif (i < lines.length - 1) {\n\t\t\t\tnewText += \"\\n\";\n\t\t\t}\n\t\t});\n\t\tnewText += endText;\n\n\t\treturn { newText, newStart, newEnd };\n\t}\n\n\tstatic removeListPrefix(text, action) {\n\t\tswitch (action) {\n\t\tcase \"quote\":\n\t\t\treturn text.slice(2); // Remove 2 characters: \"> \"\n\t\tcase \"bulletedList\":\n\t\t\treturn text.slice(2); // Remove 2 characters: \"* \"\n\t\tcase \"numberedList\": {\n\t\t\tconst firstSpace = text.indexOf(\". \"); // Remove characters: \"5. \" or \"10. \"\n\t\t\treturn text.slice(firstSpace + 2);\n\t\t}\n\t\tdefault:\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tstatic addMultiLineMarkdown(text, inStart, inEnd, action) {\n\t\tconst start = this.findPrecedingNewLine(text, inStart);\n\t\tconst end = this.findSuceedingNewLine(text, inEnd);\n\n\t\tconst startText = text.slice(0, start);\n\t\tconst selectedText = text.slice(start, end);\n\t\tconst endText = text.slice(end);\n\n\t\tlet newStart = start;\n\t\tlet newEnd = end;\n\t\tlet newText = startText;\n\n\t\tif (selectedText === \"\") {\n\t\t\tconst itemText = this.getListPrefix(action, 1);\n\t\t\tnewText = startText + itemText + endText;\n\t\t\tnewStart = start + itemText.length;\n\t\t\tnewEnd = newStart;\n\n\t\t} else {\n\t\t\tconst lines = selectedText.split(\"\\n\");\n\t\t\tlines.forEach((line, i) => {\n\t\t\t\tconst newLine = this.getListPrefix(action, i + 1, line);\n\t\t\t\tnewEnd += (newLine.length - line.length);\n\t\t\t\tnewText += newLine;\n\n\t\t\t\tif (i === lines.length - 1) {\n\t\t\t\t\tif (text[end] !== \"\\n\" || text[end + 1] !== \"\\n\") {\n\t\t\t\t\t\tnewText += \"\\n\";\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnewText += \"\\n\";\n\t\t\t\t}\n\t\t\t});\n\t\t\tnewText += endText;\n\t\t}\n\n\t\treturn { newText, newStart, newEnd };\n\t}\n\n\tstatic getListPrefix(action, i, suffixText = \"\") {\n\t\tswitch (action) {\n\t\tcase \"quote\":\n\t\t\treturn \"> \" + suffixText;\n\t\tcase \"bulletedList\":\n\t\t\treturn \"* \" + suffixText;\n\t\tcase \"numberedList\":\n\t\t\treturn i + \". \" + suffixText;\n\t\tdefault:\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic findPrecedingNewLine(text, start) {\n\t\tlet preStart = start;\n\t\twhile (preStart > 0 && text[preStart - 1] !== \"\\n\") {\n\t\t\tpreStart--;\n\t\t}\n\t\treturn preStart;\n\t}\n\n\tstatic findSuceedingNewLine(text, end) {\n\t\tlet sucEnd = end;\n\t\twhile (sucEnd < text.length && text[sucEnd] !== \"\\n\") {\n\t\t\tsucEnd++;\n\t\t}\n\t\treturn sucEnd;\n\t}\n\n\tstatic processReturnCommand(text, inStart, inEnd, originalStart, originalEnd) {\n\t\tconst start = this.findPrecedingNewLine(text, inStart);\n\t\tconst end = this.findSuceedingNewLine(text, inEnd);\n\n\t\tconst startText = text.slice(0, start);\n\t\tconst selectedText = text.slice(start, end);\n\t\tconst endText = text.slice(end);\n\n\t\t// If cursor is at the beginning of the line we just let it insert the\n\t\t// newline by default, if not we insert a new multi-line element.\n\t\tif (!this.isCursorAtBeginningOfLine(start, originalStart, originalEnd)) {\n\t\t\tif (this.isMultiLineItem(selectedText, \"quote\")) {\n\t\t\t\treturn this.insertMultiLineItem(\">\", startText, selectedText, endText, end);\n\n\t\t\t} else if (this.isMultiLineItem(selectedText, \"bulletedList\")) {\n\t\t\t\treturn this.insertMultiLineItem(\"*\", startText, selectedText, endText, end);\n\n\t\t\t} else if (this.isMultiLineItem(selectedText, \"numberedList\")) {\n\t\t\t\tconst number = this.getPrefixNumber(selectedText) + 1; // Increment for next multi-line item\n\t\t\t\tconst newEndText = this.renumberEndText(endText, number);\n\t\t\t\treturn this.insertMultiLineItem(number + \".\", startText, selectedText, newEndText, end);\n\t\t\t}\n\t\t}\n\n\t\treturn null; // Return null is there is nothing to do so key processing is ignored.\n\t}\n\n\tstatic isCursorAtBeginningOfLine(start, originalStart, originalEnd) {\n\t\treturn (originalStart === originalEnd && originalStart === start);\n\t}\n\n\tstatic insertMultiLineItem(char, startText, selectedText, endText, end) {\n\t\tconst newText = startText + selectedText + \"\\n\" + char + \" \" + endText;\n\t\tconst newStart = end + 2 + char.length; // Add 2 for newline and space plus length of the char.\n\t\tconst newEnd = newStart;\n\t\treturn { newText, newStart, newEnd };\n\t}\n\n\tstatic renumberEndText(text, startIndex) {\n\t\tconst lines = text.split(\"\\n\");\n\t\tlet newText = \"\";\n\t\tlet finished = false;\n\n\t\tlines.forEach((line, i) => {\n\t\t\tif (this.isMultiLineItem(line, \"numberedList\") && finished === false) {\n\t\t\t\tnewText += this.renumberLine(line, startIndex + i);\n\t\t\t} else {\n\t\t\t\tnewText += line;\n\t\t\t\tif (i > 0) {\n\t\t\t\t\tfinished = true; // As soon as we hit a line without a number we finished renumbering\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn newText;\n\t}\n\n\tstatic renumberLine(text, number) {\n\t\tconst firstSpace = text.indexOf(\". \");\n\t\treturn number + \". \" + text.slice(firstSpace + 2);\n\t}\n}\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* eslint no-invalid-this: \"off\" */\n\nimport * as d3Selection from \"d3-selection\";\nconst d3 = Object.assign({}, d3Selection);\n\nimport { unescape as unescapeText } from \"lodash\";\n\nimport Logger from \"../logging/canvas-logger.js\";\nimport CanvasUtils from \"./common-canvas-utils.js\";\nimport SvgCanvasMarkdown from \"./svg-canvas-utils-markdown.js\";\n\nconst BACKSPACE_KEY = 8;\nconst RETURN_KEY = 13;\nconst ESC_KEY = 27;\nconst LEFT_ARROW_KEY = 37;\nconst UP_ARROW_KEY = 38;\nconst RIGHT_ARROW_KEY = 39;\nconst DOWN_ARROW_KEY = 40;\nconst DELETE_KEY = 46;\nconst A_KEY = 65;\nconst B_KEY = 66;\nconst E_KEY = 69;\nconst I_KEY = 73;\nconst K_KEY = 75;\nconst X_KEY = 88;\nconst LAB_KEY = 188; // Left angle bracket <\nconst RAB_KEY = 190; // Right angle bracket >\nconst SEVEN_KEY = 55;\nconst EIGHT_KEY = 56;\n\nconst SCROLL_PADDING = 12;\n\nexport default class SvgCanvasTextArea {\n\n\tconstructor(config, dispUtils, nodeUtils, decUtils, canvasController,\n\t\tcanvasDiv, activePipeline, displayCommentsCallback, displayLinksCallback, getCommentToolbarPosCallback) {\n\n\t\tthis.config = config;\n\t\tthis.dispUtils = dispUtils;\n\t\tthis.nodeUtils = nodeUtils;\n\t\tthis.decUtils = decUtils;\n\t\tthis.canvasController = canvasController;\n\t\tthis.canvasDiv = canvasDiv;\n\t\tthis.activePipeline = activePipeline;\n\t\tthis.displayCommentsCallback = displayCommentsCallback;\n\t\tthis.displayLinksCallback = displayLinksCallback;\n\t\tthis.getCommentToolbarPosCallback = getCommentToolbarPosCallback;\n\n\t\tthis.logger = new Logger(\"SvgCanvasTextArea\");\n\n\t\t// Allows us to track the editing of text (either comments or node labels)\n\t\tthis.editingText = false;\n\t\tthis.editingTextId = \"\";\n\n\t\t// Keeps track of when text is in the process of being added.\n\t\tthis.addingTextToTextArea = false;\n\n\t\t// Keeps track of textarea height.\n\t\tthis.textAreaHeight = null;\n\t}\n\n\tisEditingText() {\n\t\treturn this.editingText;\n\t}\n\n\tgetEditingTextId() {\n\t\treturn this.editingTextId;\n\t}\n\n\tdisplayCommentTextArea(d, parentDomObj) {\n\t\tthis.editingTextData = {\n\t\t\tid: d.id,\n\t\t\ttext: d.content,\n\t\t\tsingleLine: false,\n\t\t\tmaxCharacters: null,\n\t\t\tallowReturnKey: true,\n\t\t\ttextCanBeEmpty: true,\n\t\t\txPos: 0,\n\t\t\tyPos: 0,\n\t\t\twidth: d.width,\n\t\t\theight: d.height,\n\t\t\tclassName: \"d3-comment-entry\",\n\t\t\tparentDomObj: parentDomObj,\n\t\t\tkeyboardInputCallback: this.config.enableMarkdownInComments ? this.commentKeyboardHandler.bind(this) : null,\n\t\t\tautoSizeCallback: this.autoSizeComment.bind(this),\n\t\t\tsaveTextChangesCallback: this.saveCommentChanges.bind(this),\n\t\t\tcloseTextAreaCallback: this.closeCommentTextArea.bind(this)\n\t\t};\n\t\tthis.displayTextArea(this.editingTextData);\n\n\t\tif (this.config.enableMarkdownInComments && this.dispUtils.isDisplayingFullPage()) {\n\t\t\tconst pos = this.getCommentToolbarPosCallback(d);\n\t\t\tthis.canvasController.openTextToolbar(pos.x, pos.y,\n\t\t\t\tthis.markdownActionHandler.bind(this),\n\t\t\t\tthis.blurInTextToolbar.bind(this));\n\t\t}\n\t}\n\n\t// Handles markdown actions initiated through the keyboard.\n\tcommentKeyboardHandler(d3Event) {\n\t\tconst action = this.getMarkdownAction(d3Event);\n\t\tif (action) {\n\t\t\tif (action !== \"return\") {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t}\n\t\t\tthis.markdownActionHandler(action, d3Event);\n\t\t}\n\t}\n\n\t// Called when the blur event occurs for the text toolbar.\n\tblurInTextToolbar(evt) {\n\t\t// When Cypress tests are running a call to focus() in addTextToTextArea()\n\t\t// can cause an incorrect blur event to be generated for the text toolbar\n\t\t// (where relatedTarget is null). This flag therefore allows us to avoid\n\t\t// that blur event that occurs while addTextToTextArea() is executing.\n\t\tif (this.addingTextToTextArea) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If there is a relatedTarget and it is set to one of the elements for the\n\t\t// textarea, texttoolbar, etc we ignore the blur event.\n\t\tif (evt.relatedTarget &&\n\t\t\t\t(CanvasUtils.getParentElementWithClass(evt.relatedTarget, \"d3-comment-entry\") ||\n\t\t\t\t\tCanvasUtils.getParentElementWithClass(evt.relatedTarget, \"text-toolbar\") ||\n\t\t\t\t\tCanvasUtils.getParentElementWithClass(evt.relatedTarget, \"bx--overflow-menu-options__btn\"))) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If the blur event is ocurring for an object outside of the textarea and\n\t\t// text toolbar we save the current text and close the textarea.\n\t\tthis.completeEditing(evt);\n\t}\n\n\t// Applies a markdown action to the comment text being edited using\n\t// the same commands as the toolbar.\n\tgetMarkdownAction(d3Event) {\n\t\tif (CanvasUtils.isCmndCtrlPressed(d3Event)) {\n\t\t\tswitch (d3Event.keyCode) {\n\t\t\tcase B_KEY: return \"bold\";\n\t\t\tcase I_KEY: return \"italics\";\n\t\t\tcase X_KEY: return d3Event.shiftKey ? \"strikethrough\" : null;\n\t\t\tcase SEVEN_KEY: return d3Event.shiftKey ? \"numberedList\" : null;\n\t\t\tcase EIGHT_KEY: return d3Event.shiftKey ? \"bulletedList\" : null;\n\t\t\tcase E_KEY: return \"code\";\n\t\t\tcase K_KEY: return \"link\";\n\t\t\tcase LAB_KEY: return \"decreaseHashes\";\n\t\t\tcase RAB_KEY: return d3Event.shiftKey ? \"quote\" : \"increaseHashes\";\n\t\t\tdefault:\n\t\t\t}\n\t\t} else if (d3Event.keyCode === RETURN_KEY) {\n\t\t\treturn \"return\";\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// Handles any actions requested on the comment text to add markdown\n\t// characters to the text. evt can be either a d3Event object from D3 when\n\t// this method is called from keyboard entry in the textarea or it can be\n\t// a synthetic event object from React when called from the text toolbar.\n\tmarkdownActionHandler(action, evt) {\n\t\tthis.logger.log(\"markdownActionHandler - action = \" + action);\n\n\t\tconst commentEntry = this.canvasDiv.selectAll(\".d3-comment-entry\");\n\t\tconst commentEntryElement = commentEntry.node();\n\t\tconst start = commentEntryElement.selectionStart;\n\t\tconst end = commentEntryElement.selectionEnd;\n\t\tconst text = commentEntryElement.value;\n\n\t\tconst mdObj = SvgCanvasMarkdown.processMarkdownAction(action, text, start, end);\n\t\tif (mdObj) {\n\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt);\n\t\t\tthis.addTextToTextArea(mdObj, commentEntryElement);\n\t\t}\n\t}\n\n\t// Replaces the text in the currently displayed textarea with the text\n\t// passed in. We use execCommand because this adds the inserted text to the\n\t// textarea's undo/redo stack whereas setting the text directly into the\n\t// textarea control does not.\n\taddTextToTextArea(mdObj, commentEntryElement) {\n\t\tthis.addingTextToTextArea = true;\n\t\tconst text = unescapeText(mdObj.newText);\n\t\tcommentEntryElement.focus();\n\t\tcommentEntryElement.select();\n\t\tdocument.execCommand(\"insertText\", false, text);\n\t\tcommentEntryElement.setSelectionRange(mdObj.newStart, mdObj.newEnd);\n\t\tthis.addingTextToTextArea = false;\n\t}\n\n\tautoSizeComment(textArea, data) {\n\t\tthis.logger.log(\"autoSizeComment - textAreaHt = \" + this.textAreaHeight + \" scroll ht = \" + textArea.scrollHeight);\n\n\t\tconst scrollHeight = textArea.scrollHeight + SCROLL_PADDING;\n\t\tif (this.textAreaHeight < scrollHeight) {\n\t\t\tthis.textAreaHeight = scrollHeight;\n\t\t\tthis.foreignObject.style(\"height\", this.textAreaHeight + \"px\");\n\t\t\tthis.activePipeline.getComment(data.id).height = this.textAreaHeight;\n\t\t\tthis.displayCommentsCallback();\n\t\t\tthis.displayLinksCallback();\n\t\t}\n\t}\n\n\tsaveCommentChanges(id, newText, newHeight) {\n\t\tconst comment = this.activePipeline.getComment(id);\n\t\tconst data = {\n\t\t\teditType: \"editComment\",\n\t\t\teditSource: \"canvas\",\n\t\t\tid: comment.id,\n\t\t\tcontent: newText,\n\t\t\twidth: comment.width,\n\t\t\theight: newHeight,\n\t\t\tx_pos: comment.x_pos,\n\t\t\ty_pos: comment.y_pos,\n\t\t\tpipelineId: this.activePipeline.id\n\t\t};\n\t\tthis.canvasController.editActionHandler(data);\n\t}\n\n\tcloseCommentTextArea() {\n\t\tthis.canvasController.closeTextToolbar();\n\t}\n\n\tdisplayNodeLabelTextArea(node, parentDomObj) {\n\t\t// Save the current style for the display <div> and set the style so the\n\t\t// <div> is hidden while the text area is displayed on top of it. This\n\t\t// prevents the <div> from protruding below the text area.\n\t\tthis.displayDiv = d3.select(parentDomObj).selectAll(\".d3-foreign-object-node-label div\");\n\t\tthis.displayDivStyle = this.displayDiv.attr(\"style\");\n\t\tthis.displayDiv.attr(\"style\", \"display:none;\");\n\n\t\tthis.editingTextData = {\n\t\t\tid: node.id,\n\t\t\ttext: node.label,\n\t\t\tsingleLine: node.layout.labelSingleLine,\n\t\t\tmaxCharacters: node.layout.labelMaxCharacters,\n\t\t\tallowReturnKey: node.layout.labelAllowReturnKey,\n\t\t\ttextCanBeEmpty: false,\n\t\t\txPos: this.nodeUtils.getNodeLabelTextAreaPosX(node),\n\t\t\tyPos: this.nodeUtils.getNodeLabelTextAreaPosY(node),\n\t\t\twidth: this.nodeUtils.getNodeLabelTextAreaWidth(node),\n\t\t\theight: this.nodeUtils.getNodeLabelTextAreaHeight(node),\n\t\t\tclassName: this.nodeUtils.getNodeLabelTextAreaClass(node),\n\t\t\tparentDomObj: parentDomObj,\n\t\t\tautoSizeCallback: this.autoSizeMultiLineLabel.bind(this),\n\t\t\tsaveTextChangesCallback: this.saveNodeLabelChanges.bind(this),\n\t\t\tcloseTextAreaCallback: this.closeEntryTextArea.bind(this)\n\t\t};\n\t\tthis.displayTextArea(this.editingTextData);\n\t}\n\n\t// Increases the size of the editable multi-line text area for a label based\n\t//  on the characters entered, and also ensures the maximum number of\n\t//  characters for the label, if one is provided, is not exceeded.\n\t// This callback works for editable multi-line node labels and also\n\t// editable multi-line text decorations for either nodes or links.\n\tautoSizeMultiLineLabel(textArea, data) {\n\t\tthis.logger.log(\"autoSizeNodeLabel - textAreaHt = \" + this.textAreaHeight + \" scroll ht = \" + textArea.scrollHeight);\n\n\t\t// Restrict max characters in case text was pasted in to the text area.\n\t\tif (data.maxCharacters &&\n\t\t\t\ttextArea.value.length > data.maxCharacters) {\n\t\t\ttextArea.value = textArea.value.substring(0, data.maxCharacters);\n\t\t}\n\t\t// Temporarily set the height to zero so the scrollHeight will get set to\n\t\t// the full height of the text in the textarea. This allows us to close up\n\t\t// the text area when the lines of text reduce.\n\t\tthis.foreignObject.style(\"height\", 0);\n\t\tconst scrollHeight = textArea.scrollHeight + SCROLL_PADDING;\n\t\tthis.textAreaHeight = scrollHeight;\n\t\tthis.foreignObject.style(\"height\", this.textAreaHeight + \"px\");\n\t}\n\n\tsaveNodeLabelChanges(id, newText, newHeight, taData) {\n\t\tconst data = {\n\t\t\teditType: \"setNodeLabel\",\n\t\t\teditSource: \"canvas\",\n\t\t\tnodeId: id,\n\t\t\tlabel: newText,\n\t\t\tpipelineId: this.activePipeline.id\n\t\t};\n\t\tthis.canvasController.editActionHandler(data);\n\t}\n\n\t// Called when the node label or decoration label text area is closing.\n\t// Resets the inline style of the <div>, that displays the text, back\n\t// to what is was before it was hidden when the entry text area opened.\n\tcloseEntryTextArea() {\n\t\tthis.displayDiv.attr(\"style\", this.displayDivStyle);\n\t}\n\n\t// Displays a text area for an editable text decoration on either a node\n\t// or link.\n\tdisplayDecLabelTextArea(dec, obj, objType, parentDomObj) {\n\t\t// Save the current style for the display <div> and set the style so the\n\t\t// <div> is hidden while the text area is displayed on top of it. This\n\t\t// prevents the <div> from protruding below the text area.\n\t\tthis.displayDiv = d3.select(parentDomObj).selectAll(\".d3-foreign-object-dec-label div\");\n\t\tthis.displayDivStyle = this.displayDiv.attr(\"style\");\n\t\tthis.displayDiv.attr(\"style\", \"display:none;\");\n\n\t\tthis.editingTextData = {\n\t\t\tid: dec.id,\n\t\t\ttext: dec.label,\n\t\t\tsingleLine: dec.label_single_line || false,\n\t\t\tmaxCharacters: dec.label_max_characters || null,\n\t\t\tallowReturnKey: dec.label_allow_return_key || false,\n\t\t\ttextCanBeEmpty: false,\n\t\t\txPos: this.decUtils.getDecLabelTextAreaPosX(),\n\t\t\tyPos: this.decUtils.getDecLabelTextAreaPosY(),\n\t\t\twidth: this.decUtils.getDecLabelTextAreaWidth(dec, obj, objType),\n\t\t\theight: this.decUtils.getDecLabelTextAreaHeight(dec, obj, objType),\n\t\t\tclassName: this.decUtils.getDecLabelTextAreaClass(dec),\n\t\t\tparentDomObj: parentDomObj,\n\t\t\tobjId: obj.id,\n\t\t\tobjType: objType,\n\t\t\tautoSizeCallback: this.autoSizeMultiLineLabel.bind(this),\n\t\t\tsaveTextChangesCallback: this.saveDecLabelChanges.bind(this),\n\t\t\tcloseTextAreaCallback: this.closeEntryTextArea.bind(this)\n\t\t};\n\t\tthis.displayTextArea(this.editingTextData);\n\t}\n\n\t// Handles saved changes to editable text decorations.\n\tsaveDecLabelChanges(id, newText, newHeight, taData) {\n\t\tconst data = {\n\t\t\teditType: \"editDecorationLabel\",\n\t\t\teditSource: \"canvas\",\n\t\t\tdecId: id,\n\t\t\tobjId: taData.objId,\n\t\t\tobjType: taData.objType,\n\t\t\tlabel: newText,\n\t\t\tpipelineId: this.activePipeline.id\n\t\t};\n\t\tthis.canvasController.editActionHandler(data);\n\t}\n\n\t// Displays a text area to allow text entry and editing for: comments;\n\t// node labels; or text decorations on either a node or link.\n\tdisplayTextArea(data) {\n\t\tthis.textAreaHeight = data.height; // Save for comparison during auto-resize\n\t\tthis.editingText = true;\n\t\tthis.editingTextId = data.id;\n\n\t\tthis.foreignObject = d3.select(data.parentDomObj)\n\t\t\t.append(\"foreignObject\")\n\t\t\t.attr(\"class\", \"d3-foreign-object-text-entry\")\n\t\t\t.attr(\"width\", data.width)\n\t\t\t.attr(\"height\", data.height)\n\t\t\t.attr(\"x\", data.xPos)\n\t\t\t.attr(\"y\", data.yPos);\n\n\t\tconst textArea = this.foreignObject\n\t\t\t.append(\"xhtml:textarea\")\n\t\t\t.attr(\"class\", data.className)\n\t\t\t.text(unescapeText(data.text))\n\t\t\t.on(\"keydown\", (d3Event) => {\n\t\t\t\t// If user hits return/enter\n\t\t\t\tif (d3Event.keyCode === RETURN_KEY) {\n\t\t\t\t\tif (data.allowReturnKey === \"save\") {\n\t\t\t\t\t\tthis.textContentSaved = true;\n\t\t\t\t\t\tthis.saveAndCloseTextArea(data, d3Event.target.value, d3Event);\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t// Don't accept return key press when text is all on one line or\n\t\t\t\t\t// if application doesn't want line feeds inserted in the label.\n\t\t\t\t\t} else if (data.singleLine || !data.allowReturnKey) {\n\t\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// If user presses ESC key revert back to original text by just\n\t\t\t\t// closing the text area.\n\t\t\t\tif (d3Event.keyCode === ESC_KEY) {\n\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t\tthis.textAreaEscKeyPressed = true;\n\t\t\t\t\tthis.closeTextArea(data);\n\t\t\t\t}\n\t\t\t\t// Prevent user entering more than any allowed maximum for characters.\n\t\t\t\tif (data.maxCharacters &&\n\t\t\t\t\t\td3Event.target.value.length >= data.maxCharacters &&\n\t\t\t\t\t\t!this.textAreaAllowedKeys(d3Event)) {\n\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t}\n\t\t\t\t// Call any specific keyboard handler for the type of\n\t\t\t\t// text being edited.\n\t\t\t\tif (data.keyboardInputCallback) {\n\t\t\t\t\tdata.keyboardInputCallback(d3Event);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"keyup\", (d3Event) => {\n\t\t\t\tdata.autoSizeCallback(d3Event.target, data);\n\t\t\t})\n\t\t\t.on(\"paste\", (d3Event) => {\n\t\t\t\tthis.logger.log(\"Text area - Paste - Scroll Ht = \" + d3Event.target.scrollHeight);\n\t\t\t\t// Allow some time for pasted text (from context menu) to be\n\t\t\t\t// loaded into the text area. Otherwise the text is not there\n\t\t\t\t// and the auto size does not increase the height correctly.\n\t\t\t\tsetTimeout(data.autoSizeCallback, 500, d3Event.target, data);\n\t\t\t})\n\t\t\t.on(\"blur\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Text area - blur\");\n\t\t\t\t// If the esc key was pressed to cause the blur event just return\n\t\t\t\t// so label returns to what it was before editing started.\n\t\t\t\tif (this.textAreaEscKeyPressed) {\n\t\t\t\t\tthis.textAreaEscKeyPressed = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// If the text label has been saved by the user hitting the return key\n\t\t\t\t// we just return since there's nothing further to do.\n\t\t\t\tif (this.textContentSaved) {\n\t\t\t\t\tthis.textContentSaved = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// If the user clicked on an element in the text toolbar to cause the\n\t\t\t\t// blur event, just return.\n\t\t\t\tif (d3Event.relatedTarget && CanvasUtils.getParentElementWithClass(d3Event.relatedTarget, \"text-toolbar\")) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.saveAndCloseTextArea(data, d3Event.target.value, d3Event);\n\t\t\t})\n\t\t\t.on(\"focus\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Text area - focus\");\n\t\t\t\tdata.autoSizeCallback(d3Event.target, data);\n\t\t\t})\n\t\t\t.on(\"mousedown click dblclick contextmenu\", (d3Event, d) => {\n\t\t\t\td3Event.stopPropagation(); // Allow default behavior to show system contenxt menu\n\t\t\t});\n\n\t\ttextArea.node().focus();\n\n\t\t// Set the cusrsor to the end of the text.\n\t\ttextArea.node().setSelectionRange(data.text.length, data.text.length);\n\t}\n\n\t// Complete the text editing. evt may be undefined when called from the\n\t// canvas renderer.\n\tcompleteEditing(evt) {\n\t\t// const commentEntry = this.canvasDiv.selectAll(\".d3-comment-entry\");\n\t\tconst commentEntry = this.foreignObject.selectAll(\"textarea\");\n\t\tconst commentEntryElement = commentEntry.node();\n\t\tthis.textContentSaved = true;\n\t\tthis.saveAndCloseTextArea(this.editingTextData, commentEntryElement.value, evt);\n\t}\n\n\tsaveAndCloseTextArea(data, newValue, d3Event) {\n\t\t// If there is no text for the label and textCanBeEmpty is false\n\t\t// just return, so label returns to what it was before editing started.\n\t\tif (!newValue && !data.textCanBeEmpty) {\n\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\tthis.closeTextArea(data);\n\t\t\treturn;\n\t\t}\n\t\tconst newText = newValue; // Save the text before closing the foreign object\n\t\tthis.closeTextArea(data);\n\t\tif (data.text !== newText || this.textAreaHeight !== data.height) {\n\t\t\tdata.saveTextChangesCallback(data.id, newText, this.textAreaHeight, data);\n\t\t}\n\t}\n\n\t// Closes the text area and resets the flags.\n\tcloseTextArea(data) {\n\t\tif (data.closeTextAreaCallback) {\n\t\t\tdata.closeTextAreaCallback(data.id);\n\t\t}\n\t\tthis.foreignObject.remove();\n\t\tthis.editingText = false;\n\t\tthis.editingTextId = \"\";\n\t}\n\n\t// Returns true if one of the keys that are allowed in the text area, when\n\t// checking for maximum characters, has been pressed.\n\ttextAreaAllowedKeys(d3Event) {\n\t\treturn d3Event.keyCode === DELETE_KEY ||\n\t\t\td3Event.keyCode === BACKSPACE_KEY ||\n\t\t\td3Event.keyCode === LEFT_ARROW_KEY ||\n\t\t\td3Event.keyCode === RIGHT_ARROW_KEY ||\n\t\t\td3Event.keyCode === UP_ARROW_KEY ||\n\t\t\td3Event.keyCode === DOWN_ARROW_KEY ||\n\t\t\t(d3Event.keyCode === A_KEY && CanvasUtils.isCmndCtrlPressed(d3Event));\n\t}\n}\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* eslint brace-style: \"off\" */\n\nimport { isEmpty } from \"lodash\";\nimport Logger from \"../logging/canvas-logger.js\";\nimport CanvasUtils from \"./common-canvas-utils.js\";\nimport { COMMENT_LINK } from \"./constants/canvas-constants\";\n\n\nexport default class SVGCanvasPipeline {\n\tconstructor(pipelineId, canvasInfo, selectionInfo) {\n\t\tthis.logger = new Logger(\"SVGCanvasActivePipeline\");\n\t\tthis.logger.log(\"constructor - start\");\n\n\t\tthis.initialize(pipelineId, canvasInfo, selectionInfo);\n\n\t\tthis.logger.log(\"constructor - end\");\n\t}\n\n\tinitialize(pipelineId, canvasInfo, selectionInfo) {\n\t\tthis.logger.logStartTimer(\"initialize\");\n\t\tthis.canvasInfo = canvasInfo;\n\t\tthis.selections = selectionInfo.pipelineId === pipelineId ? selectionInfo.selections : [];\n\t\tthis.pipeline = this.getPipeline(pipelineId, canvasInfo);\n\n\t\t// These variables are accessed directly by svg-canvas-renderer\n\t\tthis.id = this.pipeline.id;\n\t\tthis.zoom = this.pipeline.zoom;\n\t\tthis.nodes = this.pipeline.nodes;\n\t\tthis.comments = this.pipeline.comments;\n\t\tthis.links = this.pipeline.links;\n\n\t\t// We create mapped arrays for quick lookup\n\t\tthis.mappedNodes = this.getMappedArray(this.pipeline.nodes);\n\t\tthis.mappedComments = this.getMappedArray(this.pipeline.comments);\n\t\tthis.mappedLinks = this.getMappedArray(this.pipeline.links);\n\n\t\t// preProcessPipeline uses the mapped objects so this needs to be done\n\t\t// after they have been created.\n\t\tthis.pipeline = this.preProcessPipeline(this.pipeline);\n\t\tthis.logger.logEndTimer(\"initialize\");\n\t}\n\n\tgetCanvasDimensions(gap) {\n\t\treturn CanvasUtils.getCanvasDimensions(\n\t\t\tthis.pipeline.nodes, this.pipeline.comments,\n\t\t\tthis.pipeline.links, gap);\n\t}\n\n\t// Returns the name of the type of object d.\n\tgetObjectTypeName(d) {\n\t\tif (this.getComment(d.id)) {\n\t\t\treturn \"comment\";\n\t\t} else if (this.getNode(d.id)) {\n\t\t\treturn \"node\";\n\t\t}\n\t\treturn \"link\";\n\t}\n\n\tgetNode(nodeId) {\n\t\tconst node = this.mappedNodes[nodeId];\n\t\treturn (typeof node === \"undefined\") ? null : node;\n\t}\n\n\tgetNodes(nodeIds) {\n\t\tconst nodes = [];\n\t\tnodeIds.forEach((nId) => {\n\t\t\tconst n = this.getNode(nId);\n\t\t\tif (n) {\n\t\t\t\tnodes.push(n);\n\t\t\t}\n\t\t});\n\t\treturn nodes;\n\t}\n\n\tgetSupernodes() {\n\t\treturn this.pipeline.nodes.filter((node) => CanvasUtils.isSupernode(node));\n\t}\n\n\t// Returns true if the pipeline is empty except for any binding nodes.\n\tisEmptyOrBindingsOnly() {\n\t\treturn (isEmpty(this.pipeline.nodes) || this.containsOnlyBindingNodes()) &&\n\t\t\t\t\t\tisEmpty(this.pipeline.comments);\n\t}\n\n\tcontainsOnlyBindingNodes() {\n\t\treturn !this.pipeline.nodes.find((node) => !CanvasUtils.isSuperBindingNode(node));\n\t}\n\n\tgetComment(commentId) {\n\t\tconst com = this.mappedComments[commentId];\n\t\treturn (typeof com === \"undefined\") ? null : com;\n\t}\n\n\tgetComments(commentIds) {\n\t\tconst comments = [];\n\t\tcommentIds.forEach((cId) => {\n\t\t\tconst c = this.getComment(cId);\n\t\t\tif (c) {\n\t\t\t\tcomments.push(c);\n\t\t\t}\n\t\t});\n\t\treturn comments;\n\t}\n\n\tgetNodesAndComments() {\n\t\treturn this.pipeline.nodes.concat(this.pipeline.comments);\n\t}\n\n\tgetNodeOrComment(id) {\n\t\tlet obj = this.getNode(id);\n\t\tif (obj === null) {\n\t\t\tobj = this.getComment(id);\n\t\t}\n\t\treturn obj;\n\t}\n\n\tgetLink(linkId) {\n\t\tconst link = this.mappedLinks[linkId];\n\t\treturn (typeof link === \"undefined\") ? null : link;\n\t}\n\n\tgetLinks(linkIds) {\n\t\tconst links = [];\n\t\tlinkIds.forEach((lId) => {\n\t\t\tconst l = this.getLink(lId);\n\t\t\tif (l) {\n\t\t\t\tlinks.push(l);\n\t\t\t}\n\t\t});\n\t\treturn links;\n\t}\n\n\t// Replaces the link in the links array with the one passed in.\n\treplaceLink(oldLink) {\n\t\tconst index = this.pipeline.links.findIndex((l) => l.id === oldLink.id);\n\t\tthis.pipeline.links.splice(index, 1, oldLink);\n\t\tthis.mappedLinks = this.getMappedArray(this.pipeline.links);\n\t}\n\n\tgetPipeline(pipelineId, canvasInfo) {\n\t\tconst pipeline = canvasInfo.pipelines.find((p) => p.id === pipelineId);\n\t\tif (pipeline) {\n\t\t\treturn pipeline;\n\t\t}\n\t\treturn { id: pipelineId, nodes: [], comments: [], links: [] };\n\t}\n\n\t// Preprocesses the pipeline to set the connected attribute of the ports\n\t// for each node. This is used when rendering the connection satus of ports.\n\tpreProcessPipeline(pipeline) {\n\t\tthis.setAllPortsDisconnected(pipeline);\n\n\t\tpipeline.links.forEach((link) => {\n\t\t\tif (link.type === COMMENT_LINK) {\n\t\t\t\tlink.srcObj = this.getComment(link.srcNodeId);\n\t\t\t\tlink.trgNode = this.getNode(link.trgNodeId);\n\n\t\t\t} else {\n\t\t\t\tlink.srcObj = this.getNode(link.srcNodeId);\n\t\t\t\tlink.trgNode = this.getNode(link.trgNodeId);\n\n\t\t\t\tif (link.srcObj) {\n\t\t\t\t\tthis.setOutputPortConnected(link.srcObj, link.srcNodePortId);\n\t\t\t\t}\n\t\t\t\tif (link.trgNode) {\n\t\t\t\t\tthis.setInputPortConnected(link.trgNode, link.trgNodePortId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn pipeline;\n\t}\n\n\t// Sets the isConnected property of all ports in the pipeline to false.\n\tsetAllPortsDisconnected(pipeline) {\n\t\tpipeline.nodes.forEach((n) => {\n\t\t\tif (n.inputs) {\n\t\t\t\tn.inputs.forEach((inp) => (inp.isConnected = false));\n\t\t\t}\n\t\t\tif (n.outputs) {\n\t\t\t\tn.outputs.forEach((out) => (out.isConnected = false));\n\t\t\t}\n\t\t});\n\t}\n\n\t// Sets the isConnected property of the port, identified by inPortId,\n\t// for the trgNode to true.\n\tsetInputPortConnected(trgNode, inPortId) {\n\t\tconst portId = inPortId || CanvasUtils.getDefaultInputPortId(trgNode);\n\t\tif (trgNode.inputs) {\n\t\t\ttrgNode.inputs.forEach((inp) => {\n\t\t\t\tif (inp.id === portId) {\n\t\t\t\t\tinp.isConnected = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// Sets the isConnected property of the port, identified by outPortId,\n\t// for the srcNode to true.\n\tsetOutputPortConnected(srcNode, outPortId) {\n\t\tconst portId = outPortId || CanvasUtils.getDefaultOutputPortId(srcNode);\n\t\tif (srcNode.outputs) {\n\t\t\tsrcNode.outputs.forEach((out) => {\n\t\t\t\tif (out.id === portId) {\n\t\t\t\t\tout.isConnected = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// Returns an object where each element in the array provided is indexed by\n\t// the id property of the element.\n\tgetMappedArray(array) {\n\t\treturn array.reduce((map, o) => { map[o.id] = o; return map; }, {});\n\t}\n\n\t// Returns the IDs of the selected objects for this pipeline.\n\tgetSelectedObjectIds() {\n\t\treturn this.selections;\n\t}\n\n\t// Returns an array of any currently selected nodes and comments.\n\tgetSelectedNodesAndComments() {\n\t\tvar objs = this.getSelectedNodes();\n\n\t\tthis.comments.forEach((comment) => {\n\t\t\tif (this.getSelectedObjectIds().includes(comment.id)) {\n\t\t\t\tobjs.push(comment);\n\t\t\t}\n\t\t});\n\t\treturn objs;\n\t}\n\n\t// Returns an array of any currently selected nodes.\n\tgetSelectedNodes() {\n\t\tvar objs = [];\n\t\tthis.nodes.forEach((node) => {\n\t\t\tif (this.getSelectedObjectIds().includes(node.id)) {\n\t\t\t\tobjs.push(node);\n\t\t\t}\n\t\t});\n\t\treturn objs;\n\t}\n\n\t// Returns an array of any currently selected node IDs.\n\tgetSelectedNodeIds() {\n\t\treturn this.getSelectedNodes().map((n) => n.id);\n\t}\n\n\t// Returns an array of any currently selected links\n\tgetSelectedLinks() {\n\t\tvar objs = [];\n\t\tthis.links.forEach((link) => {\n\t\t\tif (this.getSelectedObjectIds().includes(link.id)) {\n\t\t\t\tobjs.push(link);\n\t\t\t}\n\t\t});\n\t\treturn objs;\n\t}\n\n\t// Returns an array of selected detached links. Detached links are recognized\n\t// if they have either a srcPos or trgPos field which holds the coordinates\n\t// of the source or target of the link. If they have one of these fields they\n\t// are semi-detached and if they have both they are fully detached.\n\tgetSelectedDetachedLinks() {\n\t\treturn this.getSelectedLinks().filter((l) => l.srcPos || l.trgPos);\n\t}\n\n\t// Returns the number of selected links.\n\tgetSelectedLinksCount() {\n\t\treturn this.getSelectedLinks().length;\n\t}\n\n\tisSelected(objId) {\n\t\treturn this.getSelectedObjectIds().indexOf(objId) >= 0;\n\t}\n}\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint no-invalid-this: \"off\" */\n/* eslint brace-style: \"off\" */\n/* eslint no-lonely-if: \"off\" */\n\n// Import just the D3 modules that are needed and combine them as the 'd3' object.\nimport * as d3Drag from \"d3-drag\";\nimport * as d3Ease from \"d3-ease\";\nimport * as d3Selection from \"d3-selection\";\nimport * as d3Fetch from \"d3-fetch\";\nimport * as d3Zoom from \"./d3-zoom-extension/src\";\nconst d3 = Object.assign({}, d3Drag, d3Ease, d3Selection, d3Fetch, d3Zoom);\n\nconst markdownIt = require(\"markdown-it\")({\n\thtml: false, // Don't allow HTML to be executed in comments.\n\tlinkify: false, // Don't convert strings, in URL format, to be links.\n\ttypographer: true\n});\n\nimport { cloneDeep, escape as escapeText, forOwn, get } from \"lodash\";\nimport { ASSOC_RIGHT_SIDE_CURVE, ASSOCIATION_LINK, NODE_LINK, COMMENT_LINK,\n\tASSOC_VAR_CURVE_LEFT, ASSOC_VAR_CURVE_RIGHT, ASSOC_VAR_DOUBLE_BACK_RIGHT,\n\tLINK_TYPE_CURVE, LINK_TYPE_ELBOW, LINK_TYPE_STRAIGHT,\n\tLINK_DIR_LEFT_RIGHT, LINK_DIR_TOP_BOTTOM, LINK_DIR_BOTTOM_TOP,\n\tLINK_SELECTION_NONE, LINK_SELECTION_HANDLES, LINK_SELECTION_DETACHABLE,\n\tCONTEXT_MENU_BUTTON, DEC_LINK, DEC_NODE, LEFT_ARROW_ICON, EDIT_ICON,\n\tNODE_MENU_ICON, SUPER_NODE_EXPAND_ICON, PORT_OBJECT_CIRCLE, PORT_OBJECT_IMAGE,\n\tTIP_TYPE_NODE, TIP_TYPE_PORT, TIP_TYPE_DEC, TIP_TYPE_LINK,\n\tINTERACTION_MOUSE, INTERACTION_TRACKPAD, INTERACTION_CARBON,\n\tUSE_DEFAULT_ICON, USE_DEFAULT_EXT_ICON,\n\tSUPER_NODE, SNAP_TO_GRID_AFTER, SNAP_TO_GRID_DURING,\n\tNORTH, SOUTH, EAST, WEST }\n\tfrom \"./constants/canvas-constants\";\nimport SUPERNODE_ICON from \"../../assets/images/supernode.svg\";\nimport SUPERNODE_EXT_ICON from \"../../assets/images/supernode_ext.svg\";\nimport Logger from \"../logging/canvas-logger.js\";\nimport CanvasUtils from \"./common-canvas-utils.js\";\nimport SvgCanvasDisplay from \"./svg-canvas-utils-display.js\";\nimport SvgCanvasNodes from \"./svg-canvas-utils-nodes.js\";\nimport SvgCanvasComments from \"./svg-canvas-utils-comments.js\";\nimport SvgCanvasLinks from \"./svg-canvas-utils-links.js\";\nimport SvgCanvasDecs from \"./svg-canvas-utils-decs.js\";\nimport SvgCanvasTextArea from \"./svg-canvas-utils-textarea.js\";\nimport SVGCanvasPipeline from \"./svg-canvas-pipeline\";\n\nconst NINETY_DEGREES = 90;\n\nconst INPUT_TYPE = \"input_type\";\nconst OUTPUT_TYPE = \"output_type\";\n\n\nexport default class SVGCanvasRenderer {\n\tconstructor(pipelineId, canvasDiv, canvasController, canvasInfo, selectionInfo, breadcrumbs, nodeLayout, canvasLayout, config, supernodeInfo = {}) {\n\t\tthis.logger = new Logger([\"SVGCanvasRenderer\", \"PipeId\", pipelineId]);\n\t\tthis.logger.logStartTimer(\"constructor\" + pipelineId.substring(0, 5));\n\t\tthis.pipelineId = pipelineId;\n\t\tthis.supernodeInfo = supernodeInfo; // Contents will be 'empty object' in case of primary pipeline renderer\n\t\tthis.canvasDiv = canvasDiv;\n\t\tthis.canvasInfo = canvasInfo;\n\t\tthis.selectionInfo = selectionInfo;\n\t\tthis.breadcrumbs = breadcrumbs;\n\t\tthis.nodeLayout = nodeLayout;\n\t\tthis.canvasLayout = canvasLayout;\n\t\tthis.config = config;\n\t\tthis.canvasController = canvasController;\n\t\tthis.activePipeline = new SVGCanvasPipeline(pipelineId, canvasInfo, selectionInfo);\n\n\t\t// An array of renderers for the supernodes on the canvas.\n\t\tthis.superRenderers = [];\n\n\t\t// Our instance ID for adding to DOM element IDs\n\t\tthis.instanceId = this.canvasController.getInstanceId();\n\n\t\tthis.dispUtils = new SvgCanvasDisplay(this.canvasController, this.supernodeInfo.d3Selection, this.pipelineId, breadcrumbs);\n\t\tthis.nodeUtils = new SvgCanvasNodes(this.canvasLayout);\n\t\tthis.commentUtils = new SvgCanvasComments();\n\t\tthis.linkUtils = new SvgCanvasLinks(this.config, this.canvasLayout, this.nodeUtils, this.commentUtils);\n\t\tthis.decUtils = new SvgCanvasDecs(this.canvasLayout);\n\t\tthis.svgCanvasTextArea = new SvgCanvasTextArea(\n\t\t\tthis.config,\n\t\t\tthis.dispUtils,\n\t\t\tthis.nodeUtils,\n\t\t\tthis.decUtils,\n\t\t\tthis.canvasController,\n\t\t\tthis.canvasDiv,\n\t\t\tthis.activePipeline,\n\t\t\tthis.displayComments.bind(this), // Function\n\t\t\tthis.displayLinks.bind(this), // Function\n\t\t\tthis.getCommentToolbarPos.bind(this) // Function\n\t\t);\n\n\t\tthis.dispUtils.setDisplayState();\n\t\tthis.logger.log(this.dispUtils.getDisplayStateMsg());\n\n\t\t// Initialize zoom variables\n\t\tthis.initializeZoomVariables();\n\n\t\t// Dimensions for extent of canvas scaling\n\t\tthis.minScaleExtent = 0.2;\n\t\tthis.maxScaleExtent = 1.8;\n\n\t\t// Allows us to track the sizing behavior of comments\n\t\tthis.commentSizing = false;\n\t\tthis.commentSizingDirection = \"\";\n\n\t\t// Allows us to track the sizing behavior of nodes\n\t\tthis.nodeSizing = false;\n\t\tthis.nodeSizingDirection = \"\";\n\t\tthis.nodeSizingObjectsInfo = {};\n\t\tthis.nodeSizingDetLinksInfo = {};\n\n\t\t// Keeps track of the size and position, at the start of the sizing event,\n\t\t// of the object (node or comment) being sized.\n\t\tthis.resizeObjInitialInfo = null;\n\n\t\t// Keeps track of the size and position, during a sizing event, of the\n\t\t// object (node or comment) being sized, before it is snapped to grid.\n\t\tthis.notSnappedXPos = 0;\n\t\tthis.notSnappedYPos = 0;\n\t\tthis.notSnappedWidth = 0;\n\t\tthis.notSnappedHeight = 0;\n\n\t\t// Allows us to record the drag behavior or nodes and comments.\n\t\tthis.dragging = false;\n\t\tthis.dragOffsetX = 0;\n\t\tthis.dragOffsetY = 0;\n\t\tthis.dragRunningX = 0;\n\t\tthis.dragRunningY = 0;\n\t\tthis.dragObjects = [];\n\t\tthis.dragStartX = 0;\n\t\tthis.dragStartY = 0;\n\n\t\t// The data link a node is currently being dragged over. It will be null\n\t\t// when the node being dragged is not over a data link.\n\t\tthis.dragOverLink = null;\n\n\t\t// The detached data links a node is currently being dragged over. It will\n\t\t// be empty when the node being dragged is not over any data links.\n\t\t// When dragging a node over detached links there may be more than one\n\t\t// entry in this array.\n\t\tthis.dragOverDetachedLinks = [];\n\n\t\t// An object containing the x and y offset of the position of the mouse\n\t\t// pointer from the top left corner of the node that is being dragged.\n\t\tthis.dragPointerOffsetInNode = null;\n\n\t\t// The node over which the 'guide' object for a new link or a link handle\n\t\t// is being dragged. Used when enableHighlightNodeOnNewLinkDrag config\n\t\t// option is switched on.\n\t\tthis.dragNewLinkOverNode = null;\n\n\t\t// Flag to indicate if the current drag operation is for a node that can\n\t\t// be inserted into a link. Such a node would need input and output ports.\n\t\tthis.existingNodeInsertableIntoLink = false;\n\n\t\t// Flag to indicate if the current drag operation is for a node that can\n\t\t// be attached to a detached link.\n\t\tthis.existingNodeAttachableToDetachedLinks = false;\n\n\t\t// Flag to indicate when the space key is down (used when dragging).\n\t\tthis.spaceKeyPressed = false;\n\n\t\t// Flag to indicate when a zoom is invoked programmatically.\n\t\tthis.zoomingAction = false;\n\n\t\t// Keep track of when the context menu has been closed, so we don't remove\n\t\t// selections when a context menu is closed during a zoom gesture.\n\t\tthis.contextMenuClosedOnZoom = false;\n\n\t\t// Keep track of when text editing has been closed, so we don't remove\n\t\t// selections when that happens during a zoom gesture.\n\t\tthis.textEditingClosedOnZoom = false;\n\n\t\t// Used to monitor the region selection rectangle.\n\t\tthis.regionSelect = false;\n\n\t\t// Used to track the start of the zoom.\n\t\tthis.zoomStartPoint = { x: 0, y: 0, k: 0, startX: 0, startY: 0 };\n\n\t\t// I was not able to figure out how to use the zoom filter method to\n\t\t// allow mousedown and mousemove messages to go through to the canvas to\n\t\t// do region selection. Therefore I had to implement region selection in\n\t\t// the zoom methods. This has the side effect that, when a region is\n\t\t// selected, d3Event.transform.x and d3Event.transform.y are incremented\n\t\t// even though the objects in the canvas have not moved. The values below\n\t\t// are used to store the current transform x and y amounts at the beginning\n\t\t// of the region selection and then restore those amounts at the end of\n\t\t// the region selection.\n\t\tthis.regionStartTransformX = 0;\n\t\tthis.regionStartTransformY = 0;\n\n\t\t// Object to store variables for dynamically drawing a new link line. The\n\t\t// existence of this object means a new link is being drawn. A null means\n\t\t// no link is currently being drawn.\n\t\tthis.drawingNewLinkData = null;\n\n\t\t// Create a drag object for use with nodes and comments.\n\t\tthis.drag = d3.drag()\n\t\t\t.on(\"start\", this.dragStart.bind(this))\n\t\t\t.on(\"drag\", this.dragMove.bind(this))\n\t\t\t.on(\"end\", this.dragEnd.bind(this));\n\n\t\tthis.draggingLinkData = null;\n\n\t\tthis.dragSelectionHandle = d3.drag()\n\t\t\t.on(\"start\", this.dragStartLinkHandle.bind(this))\n\t\t\t.on(\"drag\", this.dragMoveLinkHandle.bind(this))\n\t\t\t.on(\"end\", this.dragEndLinkHandle.bind(this));\n\n\t\t// Create a zoom object for use with the canvas.\n\t\tthis.zoom =\n\t\t\td3.zoom()\n\t\t\t\t.trackpad(this.config.enableInteractionType === INTERACTION_TRACKPAD)\n\t\t\t\t.preventBackGesture(true)\n\t\t\t\t.wheelDelta((d3Event) => -d3Event.deltaY * (this.config.enableInteractionType === INTERACTION_TRACKPAD ? 0.02 : 0.002))\n\t\t\t\t.scaleExtent([this.minScaleExtent, this.maxScaleExtent])\n\t\t\t\t.on(\"start\", this.zoomStart.bind(this))\n\t\t\t\t.on(\"zoom\", this.zoomAction.bind(this))\n\t\t\t\t.on(\"end\", this.zoomEnd.bind(this));\n\n\t\tthis.initializeGhostDiv();\n\n\t\tthis.canvasSVG = this.createCanvasSVG();\n\t\tthis.canvasGrp = this.createCanvasGroup(this.canvasSVG, \"d3-canvas-group\"); // Group to contain all canvas objects\n\t\tthis.canvasUnderlay = this.createCanvasUnderlay(this.canvasGrp, \"d3-canvas-underlay\"); // Put underlay rectangle under comments, nodes and links\n\t\tthis.commentsGrp = this.createCanvasGroup(this.canvasGrp, \"d3-comments-group\"); // Group to always position comments under nodes and links\n\t\tthis.nodesLinksGrp = this.createCanvasGroup(this.canvasGrp, \"d3-nodes-links-group\"); // Group to position nodes and links over comments\n\t\tthis.boundingRectsGrp = this.createBoundingRectanglesGrp(this.canvasGrp, \"d3-bounding-rect-group\"); // Group to optionally add bounding rectangles over all objects\n\n\n\t\tthis.resetCanvasSVGBehaviors();\n\n\t\tthis.displayCanvas();\n\n\t\tif (this.dispUtils.isDisplayingFullPage()) {\n\t\t\tthis.restoreZoom();\n\t\t}\n\n\t\t// If we are showing a sub-flow in full screen mode, or the options is\n\t\t// switched on to always display it, show the 'back to parent' control.\n\t\tif (this.dispUtils.isDisplayingSubFlowFullPage() ||\n\t\t\t\tthis.canvasLayout.alwaysDisplayBackToParentFlow) {\n\t\t\tthis.addBackToParentFlowArrow(this.canvasSVG);\n\t\t}\n\n\t\t// If we are showing a sub-flow in full screen mode and there\n\t\t// is no saved zoom for this pipeline, zoom it to fit the\n\t\t// screen so it looks similar to the in-place sub-flow view.\n\t\tif (this.dispUtils.isDisplayingSubFlowFullPage() &&\n\t\t\t\t!this.canvasController.getSavedZoom(this.pipelineId)) {\n\t\t\tthis.zoomToFit();\n\t\t}\n\n\t\t// If we are showing an in-place subflow make sure any already existing\n\t\t// port on the parent supernode overlap on top of our SVG area.\n\t\tif (this.dispUtils.isDisplayingSubFlowInPlace()) {\n\t\t\tthis.supernodeInfo.d3Selection.selectAll(\".d3-node-port-input\").raise();\n\t\t\tthis.supernodeInfo.d3Selection.selectAll(\".d3-node-port-output\").raise();\n\t\t}\n\n\t\tthis.logger.logEndTimer(\"constructor\" + pipelineId.substring(0, 5));\n\t}\n\n\tsetSpaceKeyPressed(state) {\n\t\tthis.spaceKeyPressed = state;\n\t\tthis.resetCanvasCursor();\n\t}\n\n\t// Returns true if the space bar is pressed and held down. This is called\n\t// from outside canvas via svg-canvas-d3 as well as internally.\n\tisSpaceKeyPressed() {\n\t\treturn this.spaceKeyPressed;\n\t}\n\n\t// Returns true if the event indicates that a drag is in action. This means\n\t// with regular Mouse interation that the space bar is pressed or with\n\t// legacy interation it means the shift key is NOT pressed.\n\tisDragActivated(d3Event) {\n\t\tif (this.config.enableInteractionType === INTERACTION_CARBON) {\n\t\t\treturn this.isSpaceKeyPressed();\n\t\t}\n\t\treturn (d3Event && d3Event.sourceEvent && !d3Event.sourceEvent.shiftKey);\n\t}\n\n\t// Returns the data object for the parent supernode that references the\n\t// active pipeline (managed by this renderer). We get the supernode by\n\t// looking through the overall canvas info objects.\n\t// Don't be tempted into thinking you can retrieve the supernode datum by\n\t// calling the parent renderer because there is no parent renderer when we\n\t// are showing a sub-flow in full page mode.\n\tgetParentSupernodeDatum() {\n\t\tlet node = null;\n\t\tthis.canvasInfo.pipelines.forEach((pipeline) => {\n\t\t\tif (pipeline.id === this.supernodeInfo.pipelineId) {\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode =\n\t\t\t\t\t\tpipeline.nodes.find((n) =>\n\t\t\t\t\t\t\tCanvasUtils.isSupernode(n) && n.id === this.supernodeInfo.id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn node;\n\t}\n\n\tgetZoomTransform() {\n\t\treturn this.zoomTransform;\n\t}\n\n\tinitializeZoomVariables() {\n\t\t// Allows us to record the current zoom amounts.\n\t\tthis.zoomTransform = d3.zoomIdentity.translate(0, 0).scale(1);\n\t}\n\n\tsetCanvasInfoRenderer(canvasInfo, selectionInfo, breadcrumbs, nodeLayout, canvasLayout) {\n\t\tthis.logger.logStartTimer(\"setCanvasInfoRenderer\" + this.pipelineId.substring(0, 5));\n\t\tthis.canvasInfo = canvasInfo;\n\t\tthis.selectionInfo = selectionInfo;\n\t\tthis.breadcrumbs = breadcrumbs;\n\t\tthis.nodeLayout = nodeLayout;\n\t\tthis.canvasLayout = canvasLayout;\n\n\t\tthis.activePipeline.initialize(this.pipelineId, canvasInfo, selectionInfo);\n\n\t\t// Set the display state incase we changed from in-place to full-page\n\t\t// sub-flow display.\n\t\tthis.dispUtils.setDisplayState();\n\t\tthis.logger.log(this.dispUtils.getDisplayStateMsg());\n\n\t\t// Reset the SVG area's zoom behaviors. We do this in case the canvas has\n\t\t// changed from empty (no nodes/comments) where we do not need any zoom\n\t\t// behavior to populated (with at least one node or comment) where we do\n\t\t// need the zoom behavior, or vice versa.\n\t\tthis.resetCanvasSVGBehaviors();\n\n\t\t// If a supernode and its corresponding pipeline has been deleted in the\n\t\t// object model we need to make sure the renderer is removed.\n\t\tthis.superRenderers = this.cleanUpSuperRenderers();\n\n\t\t// Display all objects for this renderer's pipeline. When supernodes in\n\t\t// this pipeline are rendered they will pass on the new canvasinfo to their\n\t\t// associated renderer.\n\t\tthis.displayCanvas();\n\n\t\tthis.logger.logEndTimer(\"setCanvasInfoRenderer\" + this.pipelineId.substring(0, 5));\n\t}\n\n\t// Updates the selection info for all renderers and displays the selection\n\t// highlighting for nodes, links and comments. This provides a performance\n\t// inmprovment over running the displayCanvas method which displays the\n\t// whole canvas.\n\tsetSelectionInfo(selectionInfo) {\n\t\tthis.selectionInfo = selectionInfo;\n\t\tthis.activePipeline.initialize(this.pipelineId, this.canvasInfo, selectionInfo);\n\n\t\tthis.displayCommentsSelectionStatus();\n\t\tthis.displayNodesSelectionStatus();\n\t\tthis.displayLinksSelectionStatus();\n\n\t\tthis.superRenderers.forEach((renderer) => {\n\t\t\trenderer.setSelectionInfo(selectionInfo);\n\t\t});\n\n\t}\n\n\t// Returns a subset of renderers, from the current set of super renderers,\n\t// that correspond to the supernodes for the active pipeline. This will\n\t// remove any renderers that do not have a corresponding supernode which\n\t// might happen when a supernode is deleted directly, or removed through an\n\t// undo action.\n\tcleanUpSuperRenderers() {\n\t\tconst newSuperRenderers = [];\n\t\tconst supernodes = this.activePipeline.getSupernodes();\n\n\t\tsupernodes.forEach((supernode) => {\n\t\t\tconst ren = this.getRendererForSupernode(supernode);\n\t\t\tif (ren) {\n\t\t\t\tnewSuperRenderers.push(ren);\n\t\t\t}\n\n\t\t\tthis.getDiscardedRenderersForSupernode(supernode)\n\t\t\t\t.forEach((dr) => dr.canvasSVG.remove());\n\t\t});\n\n\t\treturn newSuperRenderers;\n\t}\n\n\tclearCanvas() {\n\t\tthis.initializeZoomVariables();\n\t\tthis.canvasSVG.remove();\n\t}\n\n\t// This is called when the user changes the size of the canvas area.\n\trefreshOnSizeChange() {\n\t\tthis.logger.log(\"refreshOnSizeChange\");\n\t\tif (this.dispUtils.isDisplayingSubFlowFullPage()) {\n\t\t\tthis.displayBindingNodesToFitSVG();\n\t\t}\n\n\t\tif (this.config.enableBoundingRectangles) {\n\t\t\tthis.displayBoundingRectangles();\n\t\t}\n\n\t\tif (this.config.enablePositionNodeOnRightFlyoutOpen &&\n\t\t\t\tthis.canvasController.isRightFlyoutOpen()) {\n\t\t\tconst posInfo = this.config.enablePositionNodeOnRightFlyoutOpen;\n\t\t\tconst x = posInfo.x ? posInfo.x : 50;\n\t\t\tconst y = posInfo.y ? posInfo.y : 50;\n\t\t\tconst selNodeIds = this.activePipeline.getSelectedNodeIds();\n\t\t\tconst zoom = this.getZoomToReveal(selNodeIds, x, y);\n\t\t\tthis.zoomTo(zoom);\n\t\t}\n\t}\n\n\thideCanvas() {\n\t\tthis.canvasSVG.style(\"display\", \"none\");\n\t}\n\n\tdisplayCanvas() {\n\t\tthis.logger.logStartTimer(\"displayCanvas\");\n\n\t\t// Ensure the SVG area is displayed, incase it was previously hidden.\n\t\tthis.canvasSVG.style(\"display\", \"inherit\");\n\n\t\tthis.displayComments();\n\t\tthis.displayNodes();\n\t\tthis.displayLinks();\n\n\t\tif (this.dispUtils.isDisplayingSubFlowInPlace()) {\n\t\t\tthis.displaySVGToFitSupernode();\n\t\t}\n\n\t\t// The supernode will not have any calculated port positions when the\n\t\t// subflow is being displayed full screen, so calculate them first.\n\t\tif (this.dispUtils.isDisplayingSubFlowFullPage()) {\n\t\t\tthis.displayPortsForSubFlowFullPage();\n\t\t}\n\n\t\tthis.displayCanvasAccoutrements();\n\n\t\tthis.logger.logEndTimer(\"displayCanvas\");\n\t}\n\n\tdisplayCanvasAccoutrements() {\n\t\tif (this.config.enableBoundingRectangles) {\n\t\t\tthis.displayBoundingRectangles();\n\t\t}\n\n\t\tif (this.config.enableCanvasUnderlay !== \"None\" && this.dispUtils.isDisplayingPrimaryFlowFullPage()) {\n\t\t\tthis.setCanvasUnderlaySize();\n\t\t}\n\t}\n\n\t// Ensures the binding ports for a full-page sub-flow are calculated\n\t// and displayed correctly.\n\tdisplayPortsForSubFlowFullPage() {\n\t\tthis.setPortPositionsForNode(this.getParentSupernodeDatum());\n\t\tthis.displayBindingNodesToFitSVG();\n\t}\n\n\t// Called during a resize.\n\tdisplaySVGToFitSupernode() {\n\t\tthis.logger.log(\"displaySVGToFitSupernode - start\");\n\t\tconst dims = this.getParentSupernodeSVGDimensions();\n\t\tthis.canvasSVG.attr(\"width\", dims.width);\n\t\tthis.canvasSVG.attr(\"height\", dims.height);\n\t\tthis.canvasSVG.attr(\"x\", dims.x);\n\t\tthis.canvasSVG.attr(\"y\", dims.y);\n\n\t\t// Keep the background rectangle the same size as the SVG area.\n\t\tconst background = this.canvasSVG.selectChildren(\".d3-svg-background\");\n\t\tbackground.attr(\"width\", dims.width);\n\t\tbackground.attr(\"height\", dims.height);\n\n\t\tthis.zoomToFit();\n\t\tthis.displayBindingNodesToFitSVG();\n\t\tthis.logger.log(\"displaySVGToFitSupernode - end\");\n\t}\n\n\tdisplayBindingNodesToFitSVG() {\n\t\tthis.logger.log(\"displayBindingNodesToFitSVG - start\");\n\t\t// Need to set port positions before moving super binding nodes because\n\t\t// we need ports poitioned correctly on the supernode so binding nodes are\n\t\t// moved to the right place.\n\t\tthis.setPortPositionsAllNodes();\n\t\tthis.moveSuperBindingNodes();\n\n\t\tthis.displayMovedNodes();\n\t\tthis.displayMovedLinks();\n\n\t\tthis.logger.log(\"displayBindingNodesToFitSVG - end\");\n\t}\n\n\tgetParentSupernodeSVGDimensions() {\n\t\tconst datum = this.getParentSupernodeDatum();\n\t\treturn {\n\t\t\twidth: datum.width - (2 * this.canvasLayout.supernodeSVGAreaPadding),\n\t\t\theight: datum.height - this.canvasLayout.supernodeTopAreaHeight - this.canvasLayout.supernodeSVGAreaPadding,\n\t\t\tx: this.canvasLayout.supernodeSVGAreaPadding,\n\t\t\ty: this.canvasLayout.supernodeTopAreaHeight,\n\t\t\tx_pos: datum.x_pos + this.canvasLayout.supernodeSVGAreaPadding,\n\t\t\ty_pos: datum.y_pos + this.canvasLayout.supernodeTopAreaHeight\n\t\t};\n\t}\n\n\t// Moves the binding nodes in a sub-flow, which map to nodes in the parent\n\t// supernode, to the edge of the SVG area.\n\tmoveSuperBindingNodes() {\n\t\tconst transformedSVGRect = this.getTransformedViewportDimensions();\n\n\t\t// this.logger.log(\"transformedSVGRect\" +\n\t\t// \t\" x = \" + transformedSVGRect.x +\n\t\t// \t\" y = \" + transformedSVGRect.y +\n\t\t// \t\" width = \" + transformedSVGRect.width +\n\t\t// \t\" height = \" + transformedSVGRect.height);\n\n\t\tconst supernodeDatum = this.getParentSupernodeDatum();\n\n\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM ||\n\t\t\t\tthis.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\tconst svgWid = supernodeDatum.width - (2 * this.canvasLayout.supernodeSVGAreaPadding);\n\t\t\tthis.activePipeline.nodes.forEach((d) => {\n\t\t\t\tif (d.isSupernodeInputBinding) {\n\t\t\t\t\tconst x = this.nodeUtils.getSupernodePortXOffset(d.id, supernodeDatum.inputs);\n\t\t\t\t\td.x_pos = (transformedSVGRect.width * (x / svgWid)) + transformedSVGRect.x - d.outputs[0].cx;\n\t\t\t\t\td.y_pos = this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM\n\t\t\t\t\t\t? transformedSVGRect.y - d.height\n\t\t\t\t\t\t: transformedSVGRect.y + transformedSVGRect.height;\n\t\t\t\t}\n\t\t\t\tif (d.isSupernodeOutputBinding) {\n\t\t\t\t\tconst x = this.nodeUtils.getSupernodePortXOffset(d.id, supernodeDatum.outputs);\n\t\t\t\t\td.x_pos = (transformedSVGRect.width * (x / svgWid)) + transformedSVGRect.x - d.inputs[0].cx;\n\t\t\t\t\td.y_pos = this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM\n\t\t\t\t\t\t? d.y_pos = transformedSVGRect.y + transformedSVGRect.height\n\t\t\t\t\t\t: d.y_pos = transformedSVGRect.y - d.height;\n\t\t\t\t}\n\t\t\t});\n\n\t\t} else {\n\t\t\t// If we have navigated from an in-place supernode view the supernode\n\t\t\t// will be expanded. If we navigated from a collapsed node (directly to\n\t\t\t// the full screen view) the supernode will not be expanded so we set the\n\t\t\t// dimensions accordingly.\n\t\t\tlet topAreaHeight;\n\t\t\tlet svgHt;\n\t\t\tif (CanvasUtils.isExpanded(supernodeDatum)) {\n\t\t\t\ttopAreaHeight = this.canvasLayout.supernodeTopAreaHeight;\n\t\t\t\tsvgHt = supernodeDatum.height - (this.canvasLayout.supernodeTopAreaHeight + this.canvasLayout.supernodeSVGAreaPadding);\n\t\t\t} else {\n\t\t\t\ttopAreaHeight = 0;\n\t\t\t\tsvgHt = supernodeDatum.height;\n\t\t\t}\n\n\t\t\t// Position the binding nodes.\n\t\t\tthis.activePipeline.nodes.forEach((d) => {\n\t\t\t\tif (d.isSupernodeInputBinding) {\n\t\t\t\t\td.x_pos = transformedSVGRect.x - d.width;\n\t\t\t\t\tconst y = this.nodeUtils.getSupernodePortYOffset(d.id, supernodeDatum.inputs) - topAreaHeight;\n\t\t\t\t\td.y_pos = (transformedSVGRect.height * (y / svgHt)) + transformedSVGRect.y - d.outputs[0].cy;\n\t\t\t\t}\n\t\t\t\tif (d.isSupernodeOutputBinding) {\n\t\t\t\t\td.x_pos = transformedSVGRect.x + transformedSVGRect.width;\n\t\t\t\t\tconst y = this.nodeUtils.getSupernodePortYOffset(d.id, supernodeDatum.outputs) - topAreaHeight;\n\t\t\t\t\td.y_pos = (transformedSVGRect.height * (y / svgHt)) + transformedSVGRect.y - d.inputs[0].cy;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// Display bounding rectangles around the SVG area and the canvas area defined\n\t// by the nodes and comments.\n\tdisplayBoundingRectangles() {\n\t\tif (!this.activePipeline) {\n\t\t\treturn;\n\t\t}\n\t\tconst svgRect = this.getViewportDimensions();\n\t\tconst transformedSVGRect = this.getTransformedRect(svgRect, 1);\n\t\tconst canv = this.getCanvasDimensionsAdjustedForScale(1);\n\t\tconst canvWithPadding = this.getCanvasDimensionsAdjustedForScale(1, this.getZoomToFitPadding());\n\n\t\tthis.boundingRectsGrp.selectChildren(\".d3-bounding\").remove();\n\n\t\tconst grp = this.boundingRectsGrp\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"d3-bounding\");\n\n\t\tgrp\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"height\", svgRect.height)\n\t\t\t.attr(\"width\", svgRect.width)\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", 0)\n\t\t\t.style(\"fill\", \"none\")\n\t\t\t.style(\"stroke\", \"darkorange\");\n\n\t\tgrp\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"height\", transformedSVGRect.height)\n\t\t\t.attr(\"width\", transformedSVGRect.width - 2)\n\t\t\t.attr(\"x\", transformedSVGRect.x)\n\t\t\t.attr(\"y\", transformedSVGRect.y)\n\t\t\t.style(\"fill\", \"none\")\n\t\t\t.style(\"stroke\", \"red\");\n\n\t\tif (canv) {\n\t\t\tgrp\n\t\t\t\t.append(\"rect\")\n\t\t\t\t.attr(\"height\", canv.height)\n\t\t\t\t.attr(\"width\", canv.width)\n\t\t\t\t.attr(\"x\", canv.left)\n\t\t\t\t.attr(\"y\", canv.top)\n\t\t\t\t.style(\"fill\", \"none\")\n\t\t\t\t.style(\"stroke\", \"blue\");\n\t\t}\n\n\t\tif (canvWithPadding) {\n\t\t\tgrp\n\t\t\t\t.append(\"rect\")\n\t\t\t\t.attr(\"height\", canvWithPadding.height)\n\t\t\t\t.attr(\"width\", canvWithPadding.width)\n\t\t\t\t.attr(\"x\", canvWithPadding.left)\n\t\t\t\t.attr(\"y\", canvWithPadding.top)\n\t\t\t\t.style(\"fill\", \"none\")\n\t\t\t\t.style(\"stroke\", \"green\");\n\t\t}\n\n\t\tif (this.config.enableBoundingRectangles &&\n\t\t\t\tthis.superRenderers.length > 0) {\n\t\t\tthis.superRenderers.forEach((sr) => sr.displayBoundingRectangles());\n\t\t}\n\t}\n\n\t// Returns true when we are editing text. Called by svg-canvas-d3.\n\tisEditingText() {\n\t\tif (this.svgCanvasTextArea.isEditingText()) {\n\t\t\treturn true;\n\t\t}\n\t\tlet state = false;\n\t\tthis.superRenderers.forEach((superRen) => {\n\t\t\tif (!state) {\n\t\t\t\tstate = superRen.isEditingText();\n\t\t\t}\n\t\t});\n\t\treturn state;\n\t}\n\n\t// Returns true when we are dragging objects. Called by svg-canvas-d3.\n\tisDragging() {\n\t\treturn this.dragging;\n\t}\n\n\t// Returns true if the node should be resizeable. Expanded supernodes are\n\t// always resizabele and all other nodes, except collapsed supernodes, are\n\t// resizeable when enableResizableNodes is switched on.\n\tisNodeResizable(node) {\n\t\tif (!this.config.enableEditingActions ||\n\t\t\t\tCanvasUtils.isSuperBindingNode(node) ||\n\t\t\t\tCanvasUtils.isCollapsedSupernode(node) ||\n\t\t\t\t(!this.config.enableResizableNodes && !CanvasUtils.isExpandedSupernode(node))) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t// Returns true if the node should have a resizing area. We should display\n\t// a sizing area even for collapsed supernodes so it is available if/when\n\t// the supernode is expanded\n\tshouldDisplayNodeSizingArea(node) {\n\t\treturn !CanvasUtils.isSuperBindingNode(node) &&\n\t\t\t(CanvasUtils.isSupernode(node) || this.config.enableResizableNodes);\n\t}\n\n\tgetAllNodeGroupsSelection() {\n\t\treturn this.nodesLinksGrp.selectChildren(\".d3-node-group\");\n\t}\n\n\tgetAllLinkGroupsSelection() {\n\t\treturn this.nodesLinksGrp.selectChildren(\".d3-link-group\");\n\t}\n\n\tgetAllCommentGroupsSelection() {\n\t\treturn this.commentsGrp.selectChildren(\".d3-comment-group\");\n\t}\n\n\tgetNodeGroupSelectionById(nodeId) {\n\t\tconst nodeGrpSelector = this.getSelectorForId(\"node_grp\", nodeId);\n\t\treturn this.nodesLinksGrp.selectChildren(nodeGrpSelector);\n\t}\n\n\tgetLinkGroupSelectionById(linkId) {\n\t\tconst linkGrpSelector = this.getSelectorForId(\"link_grp\", linkId);\n\t\treturn this.nodesLinksGrp.selectChildren(linkGrpSelector);\n\t}\n\n\tgetCommentGroupSelectionById(comId) {\n\t\tconst selector = this.getSelectorForId(\"comment_grp\", comId);\n\t\treturn this.commentsGrp.selectChildren(selector);\n\t}\n\n\tgetNodeDecSelectionById(decId, nodeId) {\n\t\tconst nodeSel = this.getNodeGroupSelectionById(nodeId);\n\t\tconst selector = this.getSelectorForId(\"node_dec_group\", decId);\n\t\treturn nodeSel.selectAll(selector);\n\t}\n\n\tgetLinkDecSelectionById(decId, linkId) {\n\t\tconst linkSel = this.getLinkGroupSelectionById(linkId);\n\t\tconst selector = this.getSelectorForId(\"link_dec_group\", decId);\n\t\treturn linkSel.selectAll(selector);\n\t}\n\n\t// Returns a selector for the ID string like one of the following:\n\t// * [data-id='prefix_instanceID']\n\t// * [data-id='prefix_instanceID_suffix']\n\t// * [data-id='prefix_instanceID_suffix_suffix2']\n\t// depending on what parameters are provided.\n\tgetSelectorForId(prefix, suffix, suffix2) {\n\t\treturn `[data-id='${this.getId(prefix, suffix, suffix2)}']`;\n\t}\n\n\t// Returns an ID string like one of the following:\n\t// * 'prefix_instanceID'\n\t// * 'prefix_instanceID_suffix'\n\t// * 'prefix_instanceID_suffix_suffix2'\n\t// depending on what parameters are provided.\n\tgetId(prefix, suffix, suffix2) {\n\t\tlet id = `${prefix}_${this.instanceId}`;\n\t\tif (suffix) {\n\t\t\tid += `_${suffix}`;\n\t\t}\n\t\tif (suffix2) {\n\t\t\tid += `_${suffix2}`;\n\t\t}\n\t\treturn id;\n\t}\n\n\t// Returns the passed in mouse position snapped to the grid\n\t// if either option is switched on.\n\tgetMousePosSnapToGrid(mousePos) {\n\t\tlet transPos = mousePos;\n\n\t\tif (this.config.enableSnapToGridType === SNAP_TO_GRID_DURING ||\n\t\t\t\tthis.config.enableSnapToGridType === SNAP_TO_GRID_AFTER) {\n\t\t\ttransPos = this.snapToGridPosition(transPos);\n\t\t}\n\t\treturn transPos;\n\t}\n\n\t// Returns the object passed in with its position and size snapped to\n\t// the current grid dimensions.\n\tsnapToGridObject(inResizeObj) {\n\t\tconst resizeObj = inResizeObj;\n\t\tresizeObj.x_pos = CanvasUtils.snapToGrid(resizeObj.x_pos, this.canvasLayout.snapToGridXPx);\n\t\tresizeObj.y_pos = CanvasUtils.snapToGrid(resizeObj.y_pos, this.canvasLayout.snapToGridYPx);\n\t\tresizeObj.width = CanvasUtils.snapToGrid(resizeObj.width, this.canvasLayout.snapToGridXPx);\n\t\tresizeObj.height = CanvasUtils.snapToGrid(resizeObj.height, this.canvasLayout.snapToGridYPx);\n\t\treturn resizeObj;\n\t}\n\n\t// Returns the current mouse position transformed by the current zoom\n\t// transformation amounts based on the local SVG -- that is, if we're\n\t// displaying a sub-flow it is based on the SVG in the supernode.\n\tgetTransformedMousePos(d3Event) {\n\t\treturn this.transformPos(this.getMousePos(d3Event, this.canvasSVG));\n\t}\n\n\t// Returns the current mouse position based on the D3 SVG selection object\n\t// passed in.\n\tgetMousePos(d3Event, svgSel) {\n\t\t// The d3Event must have either a sourceEvent or be an actual event, which\n\t\t// can be indicated by the existence of a pageX attribute. This test is only\n\t\t// necessary on Firefox and then only when the action (such as zoom)\n\t\t// calling this function is itself called programmatically - for example,\n\t\t// when the user clicks one of the zoom buttons on the toolbar. It's not\n\t\t// clear why d3.pointer cannot handle all events like it can on Chrome.\n\t\tif (d3Event.sourceEvent || d3Event.pageX) {\n\t\t\tconst mousePos = d3.pointer(d3Event, svgSel.node());\n\t\t\treturn { x: mousePos[0], y: mousePos[1] };\n\t\t}\n\t\treturn { x: 0, y: 0 };\n\t}\n\n\t// Convert coordinates from the page (based on the page top left corner) to\n\t// canvas coordinates based on the canvas coordinate system.\n\tconvertPageCoordsToCanvasCoords(x, y) {\n\t\tconst svgRect = this.canvasSVG.node().getBoundingClientRect();\n\t\treturn this.transformPos({ x: x - Math.round(svgRect.left), y: y - Math.round(svgRect.top) });\n\t}\n\n\t// Transforms the x and y fields passed in by the current zoom\n\t// transformation amounts to convert a coordinate position in screen pixels\n\t// to a canvas coordinate position.\n\ttransformPos(pos) {\n\t\treturn {\n\t\t\tx: (pos.x - this.zoomTransform.x) / this.zoomTransform.k,\n\t\t\ty: (pos.y - this.zoomTransform.y) / this.zoomTransform.k\n\t\t};\n\t}\n\n\t// Transforms the x and y fields passed in by the current zoom\n\t// transformation amounts to convert a canvas coordinate position\n\t// to a coordinate position in screen pixels.\n\tunTransformPos(pos) {\n\t\treturn {\n\t\t\tx: (pos.x * this.zoomTransform.k) + this.zoomTransform.x,\n\t\t\ty: (pos.y * this.zoomTransform.k) + this.zoomTransform.y\n\t\t};\n\t}\n\n\t// Transforms the x, y, height and width fields of the object passed in by the\n\t// current zoom transformation amounts to convert coordinate positions and\n\t// dimensions in screen pixels to coordinate positions and dimensions in\n\t// zoomed pixels.\n\tgetTransformedRect(svgRect, pad) {\n\t\tconst transPad = (pad / this.zoomTransform.k);\n\t\treturn {\n\t\t\tx: (-this.zoomTransform.x / this.zoomTransform.k) + transPad,\n\t\t\ty: (-this.zoomTransform.y / this.zoomTransform.k) + transPad,\n\t\t\theight: (svgRect.height / this.zoomTransform.k) - (2 * transPad),\n\t\t\twidth: (svgRect.width / this.zoomTransform.k) - (2 * transPad)\n\t\t};\n\t}\n\n\t// Creates the div which contains the ghost node for drag and\n\t// drop actions from the palette. The way setDragImage is handled in\n\t// browsers for HTML drag and drop is very odd since the image has to be\n\t// 'visible' but not necssarily on display! I know, it confusing. Checkout\n\t// this link for an explanation:\n\t// https://www.kryogenix.org/code/browser/custom-drag-image.html\n\t// Consequently, we place the ghost div, using CSS, within the canvas div\n\t// with an absolute position and with a z-index to make it 'appear'\n\t// underneath the svg area.\n\tinitializeGhostDiv() {\n\t\tif (this.dispUtils.isDisplayingFullPage() &&\n\t\t\t\tthis.getGhostDivSel().empty()) {\n\t\t\tthis.canvasDiv\n\t\t\t\t.append(\"div\")\n\t\t\t\t.attr(\"class\", \"d3-ghost-div\");\n\t\t}\n\t}\n\n\t// Returns the ghost div selection. We always reselect the ghost div when it\n\t// is required because there is one ghost div for the whole common-canvas so\n\t// if this renderer is for an in-place subflow we need to get the ghost image\n\t// from the parent div.\n\tgetGhostDivSel() {\n\t\treturn this.canvasDiv.selectAll(\".d3-ghost-div\");\n\t}\n\n\t// Returns a ghost data object for displaying a ghost image when dragging\n\t// nodes from the palette. The object contains a DOM element to display\n\t// plus its width and height. This needs to be called each time a new node\n\t// is dragged from the palette, in case the dimensions of the ghost node\n\t// have changed because the canvas has been zoomed.\n\tgetGhostNode(nodeTemplate) {\n\t\tconst that = this;\n\t\tconst ghost = this.getGhostDimensions();\n\t\tconst node = this.canvasController.convertNodeTemplate(nodeTemplate);\n\t\tnode.layout = this.nodeLayout;\n\t\tif (node.is_expanded) {\n\t\t\tnode.width = node.expanded_width;\n\t\t\tnode.height = node.expanded_height;\n\t\t} else if (node.isResized) {\n\t\t\tnode.width = node.resizeWidth;\n\t\t\tnode.height = node.resizeHeight;\n\t\t} else {\n\t\t\tnode.width = ghost.width;\n\t\t\tnode.height = ghost.height;\n\t\t}\n\t\tconst nodeImage = this.getNodeImage(node);\n\t\tconst nodeImageType = this.getImageType(nodeImage);\n\t\tconst ghostDivSel = this.getGhostDivSel();\n\n\t\t// Calculate the ghost area width which is the maximum of either the node\n\t\t// label or the default node width.\n\t\tconst ghostAreaWidth = Math.max(this.nodeLayout.labelWidth, node.width);\n\n\t\t// Remove any existing SVG object from the div\n\t\tghostDivSel\n\t\t\t.selectAll(\".d3-ghost-svg\")\n\t\t\t.remove();\n\n\t\t// Create a new SVG area for the ghost area.\n\t\tconst ghostAreaSVG = ghostDivSel\n\t\t\t.append(\"svg\")\n\t\t\t.attr(\"width\", ghostAreaWidth * this.zoomTransform.k)\n\t\t\t.attr(\"height\", (50 + node.height) * this.zoomTransform.k) // Add some extra pixels, in case label is below label bottom\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", 0)\n\t\t\t.attr(\"class\", \"d3-ghost-svg\");\n\n\t\tconst ghostGrp = ghostAreaSVG\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"d3-node-group\");\n\n\t\tghostGrp\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"class\", \"d3-ghost-node\")\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", 0)\n\t\t\t.attr(\"width\", node.width)\n\t\t\t.attr(\"height\", node.height);\n\n\t\tghostGrp\n\t\t\t.append(nodeImageType)\n\t\t\t.attr(\"class\", \"d3-node-image\")\n\t\t\t.each(function() { that.setNodeImageContent(this, node); })\n\t\t\t.attr(\"x\", this.nodeUtils.getNodeImagePosX(node))\n\t\t\t.attr(\"y\", this.nodeUtils.getNodeImagePosY(node))\n\t\t\t.attr(\"width\", this.nodeUtils.getNodeImageWidth(node))\n\t\t\t.attr(\"height\", this.nodeUtils.getNodeImageHeight(node));\n\n\t\tconst fObject = ghostGrp\n\t\t\t.append(\"foreignObject\")\n\t\t\t.attr(\"x\", this.nodeUtils.getNodeLabelPosX(node))\n\t\t\t.attr(\"y\", this.nodeUtils.getNodeLabelPosY(node))\n\t\t\t.attr(\"width\", this.nodeUtils.getNodeLabelWidth(node))\n\t\t\t.attr(\"height\", this.nodeUtils.getNodeLabelHeight(node))\n\t\t\t.attr(\"class\", \"d3-foreign-object-ghost-label\");\n\n\t\tconst fObjectDiv = fObject\n\t\t\t.append(\"xhtml:div\")\n\t\t\t.attr(\"class\", this.nodeUtils.getNodeLabelClass(node));\n\n\t\tconst fObjectSpan = fObjectDiv\n\t\t\t.html(node.label);\n\n\t\t// At the time of writing, Firefox takes the ghost image from only those\n\t\t// objects that are visible (ignoring any invisible objects like the div\n\t\t// and SVG area) consequently we position the node and label so the label\n\t\t// (if bigger than the node width) is positioned up against the left edge\n\t\t// of the invisible div and SVG area. If the label is shorter than the node\n\t\t// width, the node is positioned up against the left edge of the SVG. We do\n\t\t// this by translating the group object in the x direction.\n\n\t\t// First calculate the display width of the label. The span will be the\n\t\t// full text but it may be constricted by the label width in the layout.\n\t\tconst labelSpanWidth = fObjectSpan.node().getBoundingClientRect().width + 4; // Include border for label\n\t\tconst nodeLabelWidth = this.nodeUtils.getNodeLabelWidth(node);\n\t\tconst labelDisplayLength = Math.min(nodeLabelWidth, labelSpanWidth);\n\n\t\t// Next calculate the amount, if any, the label protrudes beyond the edge\n\t\t// of the node width and move the ghost group by that amount.\n\t\tconst xOffset = Math.max(0, (labelDisplayLength - ghost.width) / 2) * this.zoomTransform.k;\n\t\tghostGrp.attr(\"transform\", `translate(${xOffset}, 0) scale(${this.zoomTransform.k})`);\n\n\t\t// If the label is center justified, restrict the label width to the\n\t\t// display amount and adjust the x coordinate to compensate for the change\n\t\t// in width.\n\t\tif (node.layout.labelAlign === \"center\") {\n\t\t\tconst labelDiff = Math.max(0, (nodeLabelWidth - labelDisplayLength) / 2);\n\n\t\t\tfObject\n\t\t\t\t.attr(\"width\", labelDisplayLength)\n\t\t\t\t.attr(\"x\", this.nodeUtils.getNodeLabelPosX(node) + labelDiff);\n\t\t\tfObjectDiv.attr(\"width\", labelDisplayLength);\n\t\t}\n\n\t\t// Get the amount the actual browser page is 'zoomed'. This is differet\n\t\t// to the zoom amount for the canvas objects.\n\t\tconst browserZoom = this.getBrowserZoom();\n\n\t\t// Calculate the center of the node area for positioning the mouse pointer\n\t\t// on the image when it is being dragged.\n\t\tconst centerX = (xOffset + ((ghost.width / 2) * this.zoomTransform.k)) * browserZoom;\n\t\tconst centerY = ((ghost.height / 2) * this.zoomTransform.k) * browserZoom;\n\n\t\treturn {\n\t\t\telement: ghostDivSel.node(),\n\t\t\tcenterX: centerX,\n\t\t\tcenterY: centerY\n\t\t};\n\t}\n\n\t// Returns the amount the actual browser page is 'zoomed'. This is differet\n\t// to the zoom amount for the canvas objects. Unfortunately, this value is not\n\t// returned the same for each type of browser so we have to calculate it based\n\t// on the type of browser.\n\tgetBrowserZoom() {\n\t\tlet browserZoom = window.devicePixelRatio;\n\n\t\t// Make sure we search for browser idntifiers in this order because with\n\t\t// the Chrome browser userAgent contains the words \"Chrome and \"Safari\"!\n\t\t// However, with the Safari browser, userAgent only contains the word \"Safari\".\n\t\tif (navigator.userAgent.includes(\"Chrome\")) {\n\t\t\tbrowserZoom = 1; // This works for Chrome\n\n\t\t} else if (navigator.userAgent.includes(\"Safari\")) {\n\t\t\tbrowserZoom = (window.outerWidth - 8) / window.innerWidth; // This works for Safari\n\n\t\t} else if (navigator.userAgent.includes(\"Firefox\")) {\n\t\t\tbrowserZoom = 1; // This works for Firefox\n\t\t}\n\n\t\treturn browserZoom;\n\t}\n\n\t// Returns an object containing the dimensions of the ghost node that hovers\n\t// over canvas when a node is being dragged from the palette. The ghost node\n\t// is based on the default node width and height so any change to these values\n\t// that might be made to a node by the layoutHandler will not be reflected here.\n\tgetGhostDimensions() {\n\t\treturn {\n\t\t\twidth: this.nodeLayout.defaultNodeWidth,\n\t\t\theight: this.nodeLayout.defaultNodeHeight\n\t\t};\n\t}\n\n\tnodeTemplateDragStart(nodeTemplate) {\n\t\tif (this.isNodeTemplateInsertableIntoLink(nodeTemplate)) {\n\t\t\tthis.setDataLinkSelectionAreaWider(true);\n\t\t}\n\t}\n\n\tnodeTemplateDragEnd(nodeTemplate) {\n\t\tif (this.isNodeTemplateInsertableIntoLink(nodeTemplate)) {\n\t\t\tthis.setDataLinkSelectionAreaWider(false);\n\t\t}\n\t}\n\n\t// Highlights any data link, that an 'insertable' nodeTemplate from the\n\t// palette, is dragged over. The x and y passed in are in page coordinates\n\t// based on the top left corner of the page.\n\tnodeTemplateDragOver(nodeTemplate, x, y) {\n\t\tif (this.isNodeTemplateInsertableIntoLink(nodeTemplate)) {\n\t\t\tconst link = this.getLinkAtMousePos(x, y);\n\t\t\t// Set highlighting when there is no link because this will turn\n\t\t\t// current highlighting off. And only switch on highlighting when we are\n\t\t\t// over a fully attached link (not a detached link).\n\t\t\tif (!link || this.isLinkFullyAttached(link)) {\n\t\t\t\tthis.setInsertNodeIntoLinkHighlighting(link);\n\t\t\t}\n\t\t}\n\n\t\tif (this.isNodeTemplateAttachableToDetachedLinks(nodeTemplate)) {\n\t\t\tconst mousePos = this.convertPageCoordsToCanvasCoords(x, y);\n\t\t\tconst ghost = this.getGhostDimensions();\n\t\t\tconst ghostArea = {\n\t\t\t\tx1: mousePos.x - (ghost.width / 2),\n\t\t\t\ty1: mousePos.y - (ghost.height / 2),\n\t\t\t\tx2: mousePos.x + (ghost.width / 2),\n\t\t\t\ty2: mousePos.y + (ghost.height / 2)\n\t\t\t};\n\t\t\tconst template = this.canvasController.convertNodeTemplate(nodeTemplate);\n\t\t\tconst links = this.getAttachableLinksForNodeAtPos(template, ghostArea);\n\t\t\tthis.setDetachedLinkHighlighting(links);\n\t\t}\n\n\t\tif (this.config.enableCanvasUnderlay !== \"None\" && this.dispUtils.isDisplayingPrimaryFlowFullPage()) {\n\t\t\tthis.setCanvasUnderlaySize(x, y);\n\t\t}\n\t}\n\n\t// Switches on or off data link highlighting depending on the element\n\t// passed in and keeps track of the currently highlighted link. This is\n\t// called when a node is being dragged from the palette or canvas onto an\n\t// attached link (which joins two nodes together) which is enabled when\n\t// 'enableInsertNodeDroppedOnLink' is true.\n\tsetInsertNodeIntoLinkHighlighting(link) {\n\t\tif (link) {\n\t\t\tif (!this.dragOverLink) {\n\t\t\t\tthis.dragOverLink = link;\n\t\t\t\tthis.setNodeDragOverLinkHighlighting(this.dragOverLink, true);\n\n\t\t\t} else if (link.id !== this.dragOverLink.id) {\n\t\t\t\tthis.unsetInsertNodeIntoLinkHighlighting();\n\t\t\t\tthis.dragOverLink = link;\n\t\t\t\tthis.setNodeDragOverLinkHighlighting(this.dragOverLink, true);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.unsetInsertNodeIntoLinkHighlighting();\n\t\t}\n\t}\n\n\t// Switchs off the data link highlighting caused when an insertable\n\t// node is dragged over a link (which joins two nodes together)\n\t// which is enabled when 'enableInsertNodeDroppedOnLink' is true.\n\tunsetInsertNodeIntoLinkHighlighting(link) {\n\t\tif (this.dragOverLink) {\n\t\t\tthis.setNodeDragOverLinkHighlighting(this.dragOverLink, false);\n\t\t\tthis.dragOverLink = null;\n\t\t}\n\t}\n\n\t// Switches on or off data link highlighting depending on the link array\n\t// passed in and keeps track of the currently highlighted links. This is\n\t// called when a node is dragged from the palette or the canvas over a\n\t// fully or partially detached link This beheavior is enabled when\n\t// 'enableLinkSelection 'is set to LINK_SELECTION_DETACHABLE.\n\tsetDetachedLinkHighlighting(links) {\n\t\tif (links && links.length > 0) {\n\t\t\tthis.unsetDetachedLinkHighlighting();\n\t\t\tthis.dragOverDetachedLinks = links;\n\t\t\tthis.dragOverDetachedLinks.forEach((link) => this.setNodeDragOverLinkHighlighting(link, true));\n\n\t\t} else {\n\t\t\tif (this.dragOverDetachedLinks.length > 0) {\n\t\t\t\tthis.unsetDetachedLinkHighlighting();\n\t\t\t}\n\t\t}\n\t}\n\n\t// Switchs off the link highlighting when a node is dragged over a fully or\n\t// partially detached link. This beheavior is enabled when\n\t// 'enableLinkSelection 'is set to LINK_SELECTION_DETACHABLE.\n\tunsetDetachedLinkHighlighting() {\n\t\tthis.dragOverDetachedLinks.forEach((link) => this.setNodeDragOverLinkHighlighting(link, false));\n\t\tthis.dragOverDetachedLinks = [];\n\t}\n\n\t// Switches on or off the drop-node highlighting on the link passed in.\n\t// This is called when the user drags a node over a link.\n\t// Link highlighting is used for the 'enableInsertNodeDroppedOnLink' function\n\t// where a node can be dragged from either the palette or the canvas onto a\n\t// link between two nodes AND it is used for the function where a node can\n\t// be dragged from either the palette of canvas onto a detached link. This is\n\t// enabled when enableLinkSelection is set to LINK_SELECTION_DETACHABLE.\n\tsetNodeDragOverLinkHighlighting(link, state) {\n\t\tthis.getLinkGroupSelectionById(link.id)\n\t\t\t.attr(\"data-drag-node-over\", state ? true : null); // true will add the attr, null will remove it\n\t}\n\n\t// Switches on or off node port highlighting depending on the node\n\t// passed in and keeps track of the currently highlighted node. This is\n\t// called as a new link is being drawn towards a target node to highlight\n\t// the target node.\n\tsetNewLinkOverNode(d3Event) {\n\t\tconst nodeNearMouse = this.getNodeNearMousePos(d3Event, this.canvasLayout.nodeProximity);\n\t\tif (nodeNearMouse && this.isConnectionAllowedToNearbyNode(d3Event, nodeNearMouse)) {\n\t\t\tif (!this.dragNewLinkOverNode) {\n\t\t\t\tthis.dragNewLinkOverNode = nodeNearMouse;\n\t\t\t\tthis.setNewLinkOverNodeHighlighting(this.dragNewLinkOverNode, true);\n\n\t\t\t} else if (nodeNearMouse.id !== this.dragNewLinkOverNode.id) {\n\t\t\t\tthis.setNewLinkOverNodeHighlighting(this.dragNewLinkOverNode, false);\n\t\t\t\tthis.dragNewLinkOverNode = nodeNearMouse;\n\t\t\t\tthis.setNewLinkOverNodeHighlighting(this.dragNewLinkOverNode, true);\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (this.dragNewLinkOverNode) {\n\t\t\t\tthis.setNewLinkOverNodeHighlighting(this.dragNewLinkOverNode, false);\n\t\t\t\tthis.dragNewLinkOverNode = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tisConnectionAllowedToNearbyNode(d3Event, nodeNearMouse) {\n\t\tif (this.drawingNewLinkData) {\n\t\t\tif (this.drawingNewLinkData.action === NODE_LINK) {\n\t\t\t\tconst srcNode = this.drawingNewLinkData.srcNode;\n\t\t\t\tconst trgNode = nodeNearMouse;\n\t\t\t\tconst srcNodePortId = this.drawingNewLinkData.srcNodePortId;\n\t\t\t\tconst trgNodePortId = CanvasUtils.getDefaultInputPortId(trgNode); // TODO - make specific to nodes.\n\t\t\t\treturn CanvasUtils.isDataConnectionAllowed(srcNodePortId, trgNodePortId, srcNode, trgNode, this.activePipeline.links);\n\n\t\t\t} else if (this.drawingNewLinkData.action === ASSOCIATION_LINK) {\n\t\t\t\tconst srcNode = this.drawingNewLinkData.srcNode;\n\t\t\t\tconst trgNode = nodeNearMouse;\n\t\t\t\treturn CanvasUtils.isAssocConnectionAllowed(srcNode, trgNode, this.activePipeline.links);\n\n\t\t\t} else if (this.drawingNewLinkData.action === COMMENT_LINK) {\n\t\t\t\tconst srcObjId = this.drawingNewLinkData.srcObjId;\n\t\t\t\tconst trgNodeId = nodeNearMouse.id;\n\t\t\t\treturn CanvasUtils.isCommentLinkConnectionAllowed(srcObjId, trgNodeId, this.activePipeline.links);\n\t\t\t}\n\t\t} else if (this.draggingLinkData) {\n\t\t\tconst newLink = this.getNewLinkOnDrag(d3Event, this.canvasLayout.nodeProximity);\n\t\t\tif (newLink) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t// Switches on or off the input-port highlighting on the node passed in.\n\t// This is called when the user drags a new link towards a target node.\n\tsetNewLinkOverNodeHighlighting(node, state) {\n\t\tif (node) {\n\t\t\tthis.getNodeGroupSelectionById(node.id)\n\t\t\t\t.attr(\"data-new-link-over\", state ? \"yes\" : \"no\");\n\t\t}\n\t}\n\n\t// Removes the data-new-link-over attribute used for highlighting a node\n\t// that a new link is being dragged towards or over.\n\tsetNewLinkOverNodeCancel() {\n\t\tthis.setNewLinkOverNodeHighlighting(this.dragNewLinkOverNode, false);\n\t\tthis.dragNewLinkOverNode = null;\n\t}\n\n\t// Processes the drop of a palette node template onto the canvas.\n\tnodeTemplateDropped(nodeTemplate, x, y) {\n\t\tif (nodeTemplate === null) {\n\t\t\treturn;\n\t\t}\n\t\tconst transPos = this.transformMousePosForNode(x, y);\n\n\t\t// If the node template was dropped on a link\n\t\tif (this.dragOverLink) {\n\t\t\tthis.canvasController.createNodeFromTemplateOnLinkAt(\n\t\t\t\tnodeTemplate, this.dragOverLink, transPos, this.pipelineId);\n\t\t\tthis.unsetInsertNodeIntoLinkHighlighting();\n\n\t\t// If the node template was dropped on one or more detached links.\n\t\t} else if (this.dragOverDetachedLinks.length > 0) {\n\t\t\tthis.canvasController.createNodeFromTemplateAttachLinks(\n\t\t\t\tnodeTemplate, this.dragOverDetachedLinks, transPos, this.pipelineId);\n\t\t\tthis.unsetDetachedLinkHighlighting();\n\n\t\t// If the node template was dropped on the canvas.\n\t\t} else {\n\t\t\tthis.canvasController.createNodeFromTemplateAt(\n\t\t\t\tnodeTemplate, transPos, this.pipelineId);\n\t\t}\n\t}\n\n\t// Processes the drop of an 'external' object onto the canvas. This may be\n\t// either a node from the desktop or even from elsewhere on the browser page.\n\texternalObjectDropped(dropData, x, y) {\n\t\tif (dropData === null) {\n\t\t\treturn;\n\t\t}\n\t\tconst transPos = this.transformMousePosForNode(x, y);\n\t\tthis.canvasController.createDroppedExternalObject(dropData, transPos, this.pipelineId);\n\t}\n\n\t// Transforms the mouse position passed in to be appropriate for a palette\n\t// node or external object being dragged over the canvas.\n\ttransformMousePosForNode(x, y) {\n\t\tconst mousePos = this.convertPageCoordsToCanvasCoords(x, y);\n\n\t\t// Offset mousePos so new node appears in center of mouse location.\n\t\tconst ghost = this.getGhostDimensions();\n\t\tmousePos.x -= ghost.width / 2;\n\t\tmousePos.y -= ghost.height / 2;\n\n\t\treturn this.getMousePosSnapToGrid(mousePos);\n\t}\n\n\t// Returns true if the nodeTemplate passed in is 'insertable' into a data\n\t// link between nodes on the canvas. This involves ensuring the node template\n\t// will create a non binding node and also that the cardinality of the ports\n\t// is not explicitely set to zero (which some crazy apps want to do!).\n\tisNodeTemplateInsertableIntoLink(nodeTemplate) {\n\t\treturn this.config.enableInsertNodeDroppedOnLink &&\n\t\t\tCanvasUtils.hasInputAndOutputPorts(nodeTemplate) &&\n\t\t\t!this.isPortMaxCardinalityZero(nodeTemplate.inputs[0]) &&\n\t\t\t!this.isPortMaxCardinalityZero(nodeTemplate.outputs[0]);\n\t}\n\n\t// Returns true if the current drag objects array has a single node which\n\t// is 'insertable' into a data link between nodes on the canvas.  Returns\n\t// false otherwise, including if a single comment is being dragged.\n\tisExistingNodeInsertableIntoLink() {\n\t\treturn (this.config.enableInsertNodeDroppedOnLink &&\n\t\t\tthis.dragObjects.length === 1 &&\n\t\t\tCanvasUtils.isNode(this.dragObjects[0]) &&\n\t\t\tCanvasUtils.hasInputAndOutputPorts(this.dragObjects[0]) &&\n\t\t\t!CanvasUtils.isNodeDefaultPortsCardinalityAtMax(this.dragObjects[0], this.activePipeline.links));\n\t}\n\n\t// Returns true if the current drag objects array has a single node which\n\t// is 'attachable' to any detached link on the canvas. Returns false otherwise,\n\t// including if a single comment is being dragged.\n\tisExistingNodeAttachableToDetachedLinks() {\n\t\treturn (this.config.enableLinkSelection === LINK_SELECTION_DETACHABLE &&\n\t\t\tthis.dragObjects.length === 1 &&\n\t\t\tCanvasUtils.isNode(this.dragObjects[0]));\n\t}\n\n\t// Returns true if the current node template being dragged from the palette\n\t// is 'attachable' to any detached link on the canvas. Returns false otherwise.\n\tisNodeTemplateAttachableToDetachedLinks(nodeTemplate) {\n\t\treturn this.config.enableLinkSelection === LINK_SELECTION_DETACHABLE;\n\t}\n\n\t// Returns an array of detached links, which can be attached to the node\n\t// passed in, that exist in proximity to the mouse position provided. Proximity\n\t// is specified by the dimensions of the ghost area passed in.\n\t// Note: The passed in 'node' will be a node when an existing node on the\n\t// canvas is being dragged but will be a node template when a node is being\n\t// dragged from the palette. Since both have inputs and outputs all should be OK.\n\tgetAttachableLinksForNodeAtPos(node, ghostArea) {\n\t\tconst nodeHasInputs = node.inputs && node.inputs.length > 0;\n\t\tconst nodeHasOutputs = node.outputs && node.outputs.length > 0;\n\n\t\tlet attachableLinks = this.activePipeline.links.filter((link) => {\n\t\t\tif (link.srcPos && nodeHasOutputs &&\n\t\t\t\t\tCanvasUtils.isPosInArea(link.srcPos, ghostArea, this.canvasLayout.ghostAreaPadding)) {\n\t\t\t\tlink.nodeOverSrcPos = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (link.trgPos && nodeHasInputs &&\n\t\t\t\t\tCanvasUtils.isPosInArea(link.trgPos, ghostArea, this.canvasLayout.ghostAreaPadding)) {\n\t\t\t\tlink.nodeOverTrgPos = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tlink.nodeOverSrcPos = false;\n\t\t\tlink.nodeOverTrgPos = false;\n\t\t\treturn false;\n\t\t});\n\n\t\tif (attachableLinks.length > 0) {\n\n\t\t\t// Make sure the attachable links can be attached to the node based on\n\t\t\t// the availability of ports and whether they are maxed out or not.\n\t\t\tconst linkArrays =\n\t\t\t\tCanvasUtils.getDetachedLinksToUpdate(node, attachableLinks, this.activePipeline.links);\n\t\t\tattachableLinks = linkArrays.oldLinks;\n\t\t}\n\t\treturn attachableLinks;\n\t}\n\n\t// Returns true if the link is attached to both a source node and a\n\t// target node which is indicated by the link having srcNodeId and trgNodeId\n\t// fields. When either or both of these fields are undefined the link is\n\t// semi or fully detached. This can happen when detachable links are allowed.\n\tisLinkFullyAttached(link) {\n\t\tif (link) {\n\t\t\treturn typeof link.srcNodeId !== \"undefined\" && typeof link.trgNodeId !== \"undefined\";\n\t\t}\n\t\treturn false;\n\t}\n\n\t// Sets the maximum zoom extent if we are the renderer of the top level flow\n\t// or calls the same method on our parent renderer if we are a sub-flow. This\n\t// means the factors will multiply as they percolate up to the top flow.\n\tsetMaxZoomExtent(factor) {\n\t\tif (this.dispUtils.isDisplayingFullPage()) {\n\t\t\tconst newMaxExtent = this.maxScaleExtent * factor;\n\n\t\t\tthis.zoom.scaleExtent([this.minScaleExtent, newMaxExtent]);\n\t\t} else {\n\t\t\tconst newFactor = Number(factor) * 1 / this.zoomTransform.k;\n\t\t\tthis.supernodeInfo.renderer.setMaxZoomExtent(newFactor);\n\t\t}\n\t}\n\n\tcreateCanvasSVG() {\n\t\tthis.logger.log(\"Create Canvas SVG.\");\n\n\t\t// For full screen display of primary or sub flows we use the canvasDiv as\n\t\t// the parent for the svg object and set width and height to fill the\n\t\t// containing Div.\n\t\tlet parentObject = this.canvasDiv;\n\t\tlet dims = {\n\t\t\twidth: \"100%\",\n\t\t\theight: \"100%\",\n\t\t\tx: 0,\n\t\t\ty: 0\n\t\t};\n\n\t\t// When rendering supernode contents we use the parent supernode as the\n\t\t// parent for the svg object.\n\t\tif (this.dispUtils.isDisplayingSubFlowInPlace()) {\n\t\t\tparentObject = this.supernodeInfo.d3Selection;\n\t\t\tdims = this.getParentSupernodeSVGDimensions();\n\t\t}\n\n\t\tconst canvasSVG = parentObject\n\t\t\t.append(\"svg\")\n\t\t\t.attr(\"class\", \"svg-area\") // svg-area used in tests.\n\t\t\t.attr(\"data-pipeline-id\", this.activePipeline.id)\n\t\t\t.attr(\"width\", dims.width)\n\t\t\t.attr(\"height\", dims.height)\n\t\t\t.attr(\"x\", dims.x)\n\t\t\t.attr(\"y\", dims.y)\n\t\t\t.on(\"mouseenter\", (d3Event, d) => {\n\t\t\t\t// If we are a sub-flow (i.e we have a parent renderer) set the max\n\t\t\t\t// zoom extent with a factor calculated from our zoom amount.\n\t\t\t\tif (this.supernodeInfo.renderer && this.config.enableZoomIntoSubFlows) {\n\t\t\t\t\tthis.supernodeInfo.renderer.setMaxZoomExtent(1 / this.zoomTransform.k);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", (d3Event, d) => {\n\t\t\t\t// If we are a sub-flow (i.e we have a parent renderer) set the max\n\t\t\t\t// zoom extent with a factor of 1.\n\t\t\t\tif (this.supernodeInfo.renderer && this.config.enableZoomIntoSubFlows) {\n\t\t\t\t\tthis.supernodeInfo.renderer.setMaxZoomExtent(1);\n\t\t\t\t}\n\t\t\t});\n\n\t\t// This rectangle is added for two reasons:\n\t\t// 1. On Safari, wheel events will not go to the SVG unless there is an\n\t\t//    SVG object under the mouse pointer. Therefore we open this rectangle\n\t\t//    to fill the SVG area to catch those events in Safari. See this stack\n\t\t//    overflow issue for details:\n\t\t//    https://stackoverflow.com/questions/40887193/d3-js-zoom-is-not-working-with-mousewheel-in-safari\n\t\t// 2. If we're displaying a sub-flow inside a supernode (on any browser)\n\t\t//    we need a background rectangle to display the same color as\n\t\t//    the background of the main canvas.\n\t\t// So this rectangle is not needed on Chrome and Firefox with full page\n\t\t// display but we open it anyway, for consistency.\n\t\tcanvasSVG\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", 0)\n\t\t\t.attr(\"width\", dims.width)\n\t\t\t.attr(\"height\", dims.height)\n\t\t\t.attr(\"data-pipeline-id\", this.activePipeline.id)\n\t\t\t.attr(\"class\", \"d3-svg-background\")\n\t\t\t.attr(\"pointer-events\", \"all\")\n\t\t\t.style(\"cursor\", \"default\");\n\n\t\t// Only attach the 'defs' to the top most SVG area when we are displaying\n\t\t// either the primary pipeline full page or a sub-pipeline full page.\n\t\tif (this.dispUtils.isDisplayingFullPage()) {\n\t\t\t// Add defs element to allow a filter for the drop shadow\n\t\t\t// This only needs to be done once for the whole page.\n\t\t\tvar defs = canvasSVG.append(\"defs\");\n\t\t\tthis.createDropShadow(defs);\n\t\t}\n\n\t\treturn canvasSVG;\n\t}\n\n\t// Sets the canvas zoom and mouse behaviors on the canvas SVG area. This is\n\t// done when the SVG area is created and also when set new canvas info is\n\t// called. This is necessary because the canvas may transition between an\n\t// empty canvas and a populated canvas (i.e. a canvas with at least one node\n\t// or comment). In the empty case we do not want any zoom behavior and in\n\t// the populated case we do.\n\tresetCanvasSVGBehaviors() {\n\t\t// Remove zoom behaviors from canvasSVG area.\n\t\tthis.canvasSVG.on(\".zoom\", null);\n\n\t\t// If there are no nodes or comments we don't apply any zoom behaviors\n\t\t// to the SVG area. We only attach the zoom behaviour to the top most SVG\n\t\t// area i.e. when we are displaying either the primary pipeline full page\n\t\t// or a sub-pipeline full page.\n\t\tif (!this.activePipeline.isEmptyOrBindingsOnly() &&\n\t\t\t\tthis.dispUtils.isDisplayingFullPage()) {\n\t\t\tthis.canvasSVG\n\t\t\t\t.call(this.zoom);\n\t\t}\n\n\t\t// These behaviors will be applied to SVG areas at the top level and\n\t\t// SVG areas displaying an in-place subflow\n\t\tthis.canvasSVG\n\t\t\t.on(\"mousemove.zoom\", (d3Event) => {\n\t\t\t\t// this.logger.log(\"Zoom - mousemove - drawingNewLink = \" + this.drawingNewLinkData ? \"yes\" : \"no\");\n\t\t\t\tif (this.drawingNewLinkData) {\n\t\t\t\t\tthis.drawNewLink(d3Event);\n\t\t\t\t}\n\t\t\t\tif (this.draggingLinkData) {\n\t\t\t\t\tthis.dragLinkHandle(d3Event);\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Don't use mousedown.zoom here as it will replace the zoom start behavior\n\t\t\t// and prevent panning of canvas background.\n\t\t\t.on(\"mousedown\", (d3Event) => {\n\t\t\t\tthis.logger.log(\"Canvas - mousedown\");\n\t\t\t\t// When displaying inplace subflow and a context menu is requested\n\t\t\t\t// suppress the mouse down which would go to the containing supernode.\n\t\t\t\t// This prevents the deselection of any selected nodes in the subflow.\n\t\t\t\tif (this.dispUtils.isDisplayingSubFlowInPlace() &&\n\t\t\t\t\t\td3Event.button === CONTEXT_MENU_BUTTON) {\n\t\t\t\t\td3Event.stopPropagation();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseup.zoom\", (d3Event) => {\n\t\t\t\tthis.logger.log(\"Canvas - mouseup-zoom\");\n\t\t\t\tif (this.drawingNewLinkData) {\n\t\t\t\t\tthis.completeNewLink(d3Event);\n\t\t\t\t}\n\t\t\t\tif (this.draggingLinkData) {\n\t\t\t\t\tthis.completeDraggedLink(d3Event);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"click.zoom\", (d3Event) => {\n\t\t\t\tthis.logger.log(\"Canvas - click-zoom\");\n\n\t\t\t\tthis.canvasController.clickActionHandler({\n\t\t\t\t\tclickType: d3Event.type === \"contextmenu\" ? \"SINGLE_CLICK_CONTEXTMENU\" : \"SINGLE_CLICK\",\n\t\t\t\t\tobjectType: \"canvas\",\n\t\t\t\t\tselectedObjectIds: this.activePipeline.getSelectedObjectIds()\n\t\t\t\t});\n\t\t\t})\n\t\t\t.on(\"dblclick.zoom\", () => {\n\t\t\t\tthis.logger.log(\"Zoom - double click\");\n\t\t\t\tthis.canvasController.clickActionHandler({\n\t\t\t\t\tclickType: \"DOUBLE_CLICK\",\n\t\t\t\t\tobjectType: \"canvas\",\n\t\t\t\t\tselectedObjectIds: this.activePipeline.getSelectedObjectIds() });\n\t\t\t})\n\t\t\t.on(\"contextmenu.zoom\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Zoom - context menu\");\n\t\t\t\tthis.openContextMenu(d3Event, \"canvas\");\n\t\t\t});\n\t}\n\n\t// Resets the pointer cursor on the background rectangle in the Canvas SVG area.\n\tresetCanvasCursor() {\n\t\tconst selector = \".d3-svg-background[data-pipeline-id='\" + this.activePipeline.id + \"']\";\n\t\tthis.canvasSVG.select(selector).style(\"cursor\", this.isDragActivated() && this.dispUtils.isDisplayingFullPage() ? \"grab\" : \"default\");\n\t}\n\n\tcreateCanvasGroup(canvasObj, className) {\n\t\treturn canvasObj.append(\"g\").attr(\"class\", className);\n\t}\n\n\tcreateCanvasUnderlay(canvasGrp, className) {\n\t\tif (this.config.enableCanvasUnderlay !== \"None\" && this.dispUtils.isDisplayingPrimaryFlowFullPage()) {\n\t\t\treturn canvasGrp.append(\"rect\").attr(\"class\", className);\n\t\t}\n\t\treturn null;\n\t}\n\n\tcreateBoundingRectanglesGrp(canvasGrp, className) {\n\t\tif (this.config.enableBoundingRectangles) {\n\t\t\treturn canvasGrp.append(\"g\").attr(\"class\", className);\n\t\t}\n\t\treturn null;\n\t}\n\n\tsetCanvasUnderlaySize(x = 0, y = 0) {\n\t\tconst canv = this.getCanvasDimensionsAdjustedForScale(1, this.getZoomToFitPadding());\n\t\tif (canv) {\n\t\t\tthis.canvasUnderlay\n\t\t\t\t.attr(\"x\", canv.left - 50)\n\t\t\t\t.attr(\"y\", canv.top - 50)\n\t\t\t\t.attr(\"width\", canv.width + 100)\n\t\t\t\t.attr(\"height\", canv.height + 100);\n\t\t}\n\t}\n\n\taddBackToParentFlowArrow(canvasSVG) {\n\t\tconst g = canvasSVG\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"transform\", \"translate(15, 15)\")\n\t\t\t.on(\"mouseenter\", function(d3Event, d) { // Use function keyword so 'this' pointer references the DOM text object\n\t\t\t\td3.select(this).select(\"rect\")\n\t\t\t\t\t.attr(\"data-pointer-hover\", \"yes\");\n\t\t\t})\n\t\t\t.on(\"mouseleave\", function(d3Event, d) { // Use function keyword so 'this' pointer references the DOM text object\n\t\t\t\td3.select(this).select(\"rect\")\n\t\t\t\t\t.attr(\"data-pointer-hover\", \"no\");\n\t\t\t})\n\t\t\t.on(\"mousedown mouseup\", (d3Event) => {\n\t\t\t\t// Prevent mouse events going through to the canvas. This prevents\n\t\t\t\t// a drag gesture on the button activating the canvas drag action.\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t})\n\t\t\t.on(\"click\", (d3Event) => {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\tthis.canvasController.displayPreviousPipeline();\n\t\t\t});\n\n\t\tg.append(\"rect\")\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", 0)\n\t\t\t.attr(\"width\", 210)\n\t\t\t.attr(\"height\", 40)\n\t\t\t.attr(\"class\", \"d3-back-to-previous-flow-box\");\n\n\t\tg.append(\"svg\")\n\t\t\t.attr(\"x\", 16)\n\t\t\t.attr(\"y\", 11)\n\t\t\t.attr(\"width\", 16)\n\t\t\t.attr(\"height\", 16)\n\t\t\t.html(LEFT_ARROW_ICON)\n\t\t\t.attr(\"class\", \"d3-back-to-previous-flow-text\");\n\n\t\tg.append(\"text\")\n\t\t\t.attr(\"x\", 40)\n\t\t\t.attr(\"y\", 24)\n\t\t\t.attr(\"class\", \"d3-back-to-previous-flow-text\")\n\t\t\t.text(\"Return to previous flow\");\n\t}\n\n\tcreateDropShadow(defs) {\n\t\tvar dropShadowFilter = defs.append(\"filter\")\n\t\t\t.attr(\"id\", this.getId(\"node_drop_shadow\"))\n\t\t\t.attr(\"x\", \"-20%\")\n\t\t\t.attr(\"y\", \"-20%\")\n\t\t\t.attr(\"width\", \"200%\")\n\t\t\t.attr(\"height\", \"200%\");\n\n\t\tdropShadowFilter.append(\"feOffset\")\n\t\t\t.attr(\"in\", \"SourceAlpha\")\n\t\t\t.attr(\"dx\", 1)\n\t\t\t.attr(\"dy\", 1)\n\t\t\t.attr(\"result\", \"offOut\");\n\n\t\tdropShadowFilter.append(\"feGaussianBlur\")\n\t\t\t.attr(\"in\", \"offOut\")\n\t\t\t.attr(\"stdDeviation\", \"3\")\n\t\t\t.attr(\"result\", \"blurOut\");\n\n\t\tdropShadowFilter.append(\"feBlend\")\n\t\t\t.attr(\"in\", \"SourceGraphic\")\n\t\t\t.attr(\"in2\", \"blurOut\")\n\t\t\t.attr(\"mode\", \"normal\");\n\n\t\tdropShadowFilter.append(\"feComponentTransfer\")\n\t\t\t.append(\"feFuncA\")\n\t\t\t.attr(\"type\", \"linear\")\n\t\t\t.attr(\"slope\", \"0.2\");\n\n\t\tvar feMerge = dropShadowFilter.append(\"feMerge\");\n\t\tfeMerge.append(\"feMergeNode\");\n\t\tfeMerge.append(\"feMergeNode\").attr(\"in\", \"SourceGraphic\");\n\t}\n\n\tsetNodeLabelEditingMode(nodeId, pipelineId) {\n\t\tif (this.pipelineId === pipelineId) {\n\t\t\tconst node = this.activePipeline.getNode(nodeId);\n\t\t\tif (node && node.layout.labelEditable && this.config.enableEditingActions) {\n\t\t\t\tconst nodeSel = this.getNodeGroupSelectionById(nodeId);\n\t\t\t\tconst nodeDomObj = nodeSel.node();\n\t\t\t\tthis.displayNodeLabelTextArea(node, nodeDomObj);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.superRenderers.forEach((renderer) => {\n\t\t\t\trenderer.setNodeLabelEditingMode(nodeId, pipelineId);\n\t\t\t});\n\t\t}\n\t}\n\n\tsetNodeDecorationLabelEditingMode(decId, nodeId, pipelineId) {\n\t\tif (this.pipelineId === pipelineId) {\n\t\t\tconst node = this.activePipeline.getNode(nodeId);\n\t\t\tif (node && node.decorations) {\n\t\t\t\tconst dec = node.decorations.find((d) => d.id === decId);\n\t\t\t\tif (dec && typeof dec.label !== \"undefined\" && dec.label_editable && this.config.enableEditingActions) {\n\t\t\t\t\tconst nodeDecSel = this.getNodeDecSelectionById(decId, nodeId);\n\t\t\t\t\tconst nodeDecDomObj = nodeDecSel.node();\n\t\t\t\t\tthis.displayDecLabelTextArea(dec, node, \"node\", nodeDecDomObj);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.superRenderers.forEach((renderer) => {\n\t\t\t\trenderer.setLinkDecorationLabelEditingMode(decId, nodeId, pipelineId);\n\t\t\t});\n\t\t}\n\t}\n\n\tsetLinkDecorationLabelEditingMode(decId, linkId, pipelineId) {\n\t\tif (this.pipelineId === pipelineId) {\n\t\t\tconst link = this.activePipeline.getLink(linkId);\n\t\t\tif (link && link.decorations) {\n\t\t\t\tconst dec = link.decorations.find((d) => d.id === decId);\n\t\t\t\tif (dec && typeof dec.label !== \"undefined\" && dec.label_editable && this.config.enableEditingActions) {\n\t\t\t\t\tconst linkDecSel = this.getLinkDecSelectionById(decId, linkId);\n\t\t\t\t\tconst linkDecDomObj = linkDecSel.node();\n\t\t\t\t\tthis.displayDecLabelTextArea(dec, link, \"link\", linkDecDomObj);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.superRenderers.forEach((renderer) => {\n\t\t\t\trenderer.setLinkDecorationLabelEditingMode(decId, linkId, pipelineId);\n\t\t\t});\n\t\t}\n\t}\n\n\t// Restores the zoom of the canvas, if it has changed, based on the type\n\t// of 'save zoom' specified in the configuration and, if no saved zoom, was\n\t// provided pans the canvas area so it is always visible.\n\trestoreZoom() {\n\t\tlet newZoom = this.canvasController.getSavedZoom(this.pipelineId);\n\n\t\t// If there's no saved zoom, and enablePanIntoViewOnOpen is set, pan so\n\t\t// the canvas area (containing nodes and comments) is visible in the viewport.\n\t\tif (!newZoom && this.config.enablePanIntoViewOnOpen) {\n\t\t\tconst canvWithPadding = this.getCanvasDimensionsAdjustedForScale(1, this.getZoomToFitPadding());\n\t\t\tif (canvWithPadding) {\n\t\t\t\tnewZoom = { x: -canvWithPadding.left, y: -canvWithPadding.top, k: 1 };\n\t\t\t}\n\t\t}\n\n\t\t// If there's no saved zoom and we have some initial pan amounts provided use them.\n\t\tif (!newZoom && this.canvasLayout.initialPanX && this.canvasLayout.initialPanY) {\n\t\t\tnewZoom = { x: this.canvasLayout.initialPanX, y: this.canvasLayout.initialPanY, k: 1 };\n\t\t}\n\n\t\t// If new zoom is different to the current zoom amount, apply it.\n\t\tif (newZoom &&\n\t\t\t\t(newZoom.k !== this.zoomTransform.k ||\n\t\t\t\t\tnewZoom.x !== this.zoomTransform.x ||\n\t\t\t\t\tnewZoom.y !== this.zoomTransform.y)) {\n\t\t\tthis.zoomCanvasInvokeZoomBehavior(newZoom);\n\t\t}\n\t}\n\n\t// Zooms the canvas to amount specified in zoomTransform. Zooming the canvas\n\t// in this way will invoke the zoom behavior methods (zoomStart, zoomAction\n\t// and zoomEnd).\n\tzoomCanvasInvokeZoomBehavior(newZoomTransform, animateTime) {\n\t\tif (isFinite(newZoomTransform.x) &&\n\t\t\t\tisFinite(newZoomTransform.y) &&\n\t\t\t\tisFinite(newZoomTransform.k)) {\n\t\t\tthis.zoomingAction = true;\n\t\t\tconst zoomTransform = d3.zoomIdentity.translate(newZoomTransform.x, newZoomTransform.y).scale(newZoomTransform.k);\n\t\t\tif (animateTime) {\n\t\t\t\tthis.canvasSVG.call(this.zoom).transition()\n\t\t\t\t\t.duration(animateTime)\n\t\t\t\t\t.call(this.zoom.transform, zoomTransform);\n\t\t\t} else {\n\t\t\t\tthis.canvasSVG.call(this.zoom.transform, zoomTransform);\n\t\t\t}\n\t\t\tthis.zoomingAction = false;\n\t\t}\n\t}\n\n\tzoomToFit() {\n\t\tconst padding = this.getZoomToFitPadding();\n\t\tconst canvasDimensions = this.getCanvasDimensionsAdjustedForScale(1, padding);\n\t\tconst viewPortDimensions = this.getViewportDimensions();\n\n\t\tif (canvasDimensions) {\n\t\t\tconst xRatio = viewPortDimensions.width / canvasDimensions.width;\n\t\t\tconst yRatio = viewPortDimensions.height / canvasDimensions.height;\n\t\t\tconst newScale = Math.min(xRatio, yRatio, 1); // Don't let the canvas be scaled more than 1 in either direction\n\n\t\t\tlet x = (viewPortDimensions.width - (canvasDimensions.width * newScale)) / 2;\n\t\t\tlet y = (viewPortDimensions.height - (canvasDimensions.height * newScale)) / 2;\n\n\t\t\tx -= newScale * canvasDimensions.left;\n\t\t\ty -= newScale * canvasDimensions.top;\n\n\t\t\tthis.zoomCanvasInvokeZoomBehavior({ x: x, y: y, k: newScale });\n\t\t}\n\t}\n\n\t// Returns the padding space for the canvas objects to be zoomed which takes\n\t// into account any connections that need to be made to/from any sub-flow\n\t// binding nodes plus any space needed for the binding nodes ports.\n\tgetZoomToFitPadding() {\n\t\tlet padding = this.canvasLayout.zoomToFitPadding;\n\n\t\tif (this.dispUtils.isDisplayingSubFlow()) {\n\t\t\t// Allocate some space for connecting lines and the binding node ports\n\t\t\tconst newPadding = this.getMaxZoomToFitPaddingForConnections() + (2 * this.canvasLayout.supernodeBindingPortRadius);\n\t\t\tpadding = Math.max(padding, newPadding);\n\t\t}\n\t\treturn padding;\n\t}\n\n\tzoomTo(zoomObject) {\n\t\tconst animateTime = 500;\n\t\tthis.zoomCanvasInvokeZoomBehavior(zoomObject, animateTime);\n\t}\n\n\tgetZoom() {\n\t\treturn { x: this.zoomTransform.x, y: this.zoomTransform.y, k: this.zoomTransform.k };\n\t}\n\n\ttranslateBy(x, y, animateTime) {\n\t\tconst z = this.getZoomTransform();\n\t\tconst zoomObject = d3.zoomIdentity.translate(z.x + x, z.y + y).scale(z.k);\n\t\tthis.zoomCanvasInvokeZoomBehavior(zoomObject, animateTime);\n\t}\n\n\tzoomIn() {\n\t\tif (this.zoomTransform.k < this.maxScaleExtent) {\n\t\t\tconst newScale = Math.min(this.zoomTransform.k * 1.1, this.maxScaleExtent);\n\t\t\tthis.canvasSVG.call(this.zoom.scaleTo, newScale);\n\t\t}\n\t}\n\n\tzoomOut() {\n\t\tif (this.zoomTransform.k > this.minScaleExtent) {\n\t\t\tconst newScale = Math.max(this.zoomTransform.k / 1.1, this.minScaleExtent);\n\t\t\tthis.canvasSVG.call(this.zoom.scaleTo, newScale);\n\t\t}\n\t}\n\n\tisZoomedToMax() {\n\t\treturn this.zoomTransform ? this.zoomTransform.k === this.maxScaleExtent : false;\n\t}\n\n\tisZoomedToMin() {\n\t\treturn this.zoomTransform ? this.zoomTransform.k === this.minScaleExtent : false;\n\t}\n\n\tgetZoomToReveal(objectIDs, xPos, yPos) {\n\t\tconst transformedSVGRect = this.getTransformedViewportDimensions();\n\t\tconst nodes = this.activePipeline.getNodes(objectIDs);\n\t\tconst comments = this.activePipeline.getComments(objectIDs);\n\t\tconst links = this.activePipeline.getLinks(objectIDs);\n\n\t\tif (nodes.length > 0 || comments.length > 0 || links.length > 0) {\n\t\t\tconst canvasDimensions = CanvasUtils.getCanvasDimensions(nodes, comments, links, 0, 0, true);\n\t\t\tconst canv = this.convertCanvasDimensionsAdjustedForScaleWithPadding(canvasDimensions, 1, 10);\n\t\t\tconst xPosInt = parseInt(xPos, 10);\n\t\t\tconst yPosInt = typeof yPos === \"undefined\" ? xPosInt : parseInt(yPos, 10);\n\n\t\t\tif (canv) {\n\t\t\t\tlet xOffset;\n\t\t\t\tlet yOffset;\n\n\t\t\t\tif (!Number.isNaN(xPosInt) && !Number.isNaN(yPosInt)) {\n\t\t\t\t\txOffset = transformedSVGRect.x + (transformedSVGRect.width * (xPosInt / 100)) - (canv.left + (canv.width / 2));\n\t\t\t\t\tyOffset = transformedSVGRect.y + (transformedSVGRect.height * (yPosInt / 100)) - (canv.top + (canv.height / 2));\n\n\t\t\t\t} else {\n\t\t\t\t\tif (canv.right > transformedSVGRect.x + transformedSVGRect.width) {\n\t\t\t\t\t\txOffset = transformedSVGRect.x + transformedSVGRect.width - canv.right;\n\t\t\t\t\t}\n\t\t\t\t\tif (canv.left < transformedSVGRect.x) {\n\t\t\t\t\t\txOffset = transformedSVGRect.x - canv.left;\n\t\t\t\t\t}\n\t\t\t\t\tif (canv.bottom > transformedSVGRect.y + transformedSVGRect.height) {\n\t\t\t\t\t\tyOffset = transformedSVGRect.y + transformedSVGRect.height - canv.bottom;\n\t\t\t\t\t}\n\t\t\t\t\tif (canv.top < transformedSVGRect.y) {\n\t\t\t\t\t\tyOffset = transformedSVGRect.y - canv.top;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (typeof xOffset !== \"undefined\" || typeof yOffset !== \"undefined\") {\n\t\t\t\t\tconst x = this.zoomTransform.x + ((xOffset || 0)) * this.zoomTransform.k;\n\t\t\t\t\tconst y = this.zoomTransform.y + ((yOffset || 0)) * this.zoomTransform.k;\n\t\t\t\t\treturn { x: x || 0, y: y || 0, k: this.zoomTransform.k };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// Returns an object representing the viewport dimensions which have been\n\t// transformed for the current zoom amount.\n\tgetTransformedViewportDimensions() {\n\t\tconst svgRect = this.getViewportDimensions();\n\t\treturn this.getTransformedRect(svgRect, 0);\n\t}\n\n\t// Returns the dimensions of the SVG area. When we are displaying a sub-flow\n\t// we can use the supernode's dimensions. If not we are displaying\n\t// full-page so we can use getBoundingClientRect() to get the dimensions\n\t// (for some reason that method doesn't return correct values with embedded SVG areas).\n\tgetViewportDimensions() {\n\t\tlet viewportDimensions = {};\n\n\t\tif (this.dispUtils.isDisplayingSubFlowInPlace()) {\n\t\t\tconst dims = this.getParentSupernodeSVGDimensions();\n\t\t\tviewportDimensions.width = dims.width;\n\t\t\tviewportDimensions.height = dims.height;\n\n\t\t} else {\n\t\t\tif (this.canvasSVG && this.canvasSVG.node()) {\n\t\t\t\tviewportDimensions = this.canvasSVG.node().getBoundingClientRect();\n\t\t\t} else {\n\t\t\t\tviewportDimensions = { x: 0, y: 0, width: 1100, height: 640 }; // Return a sensible default (for Jest tests)\n\t\t\t}\n\t\t}\n\t\treturn viewportDimensions;\n\t}\n\n\tzoomStart(d3Event) {\n\t\tthis.logger.log(\"zoomStart - \" + JSON.stringify(d3Event.transform));\n\n\t\t// Ensure any open tip is closed before starting a zoom operation.\n\t\tthis.canvasController.closeTip();\n\n\t\t// Close the context menu, if it's open, before panning or zooming.\n\t\t// If the context menu is opened inside the expanded supernode (in-place\n\t\t// subflow), when the user zooms the canvas, the full page flow is handling\n\t\t// that zoom, which causes a refresh in the subflow, so the full page flow\n\t\t// will take care of closing the context menu. This means the in-place\n\t\t// subflow doesn’t need to do anything on zoom,\n\t\t// hence: !this.dispUtils.isDisplayingSubFlowInPlace()\n\t\tif (this.canvasController.isContextMenuDisplayed() &&\n\t\t\t\t!this.dispUtils.isDisplayingSubFlowInPlace()) {\n\t\t\tthis.canvasController.closeContextMenu();\n\t\t\tthis.contextMenuClosedOnZoom = true;\n\t\t}\n\n\t\t// Any text editing in progress will be closed by the textarea's blur event\n\t\t// if the user clicks on the canvas background. So we set this flag to\n\t\t// prevent the selection being lost in the zoomEnd (mouseup) event.\n\t\tif (this.svgCanvasTextArea.isEditingText()) {\n\t\t\tthis.textEditingClosedOnZoom = true;\n\t\t}\n\n\t\tthis.regionSelect = this.shouldDoRegionSelect(d3Event);\n\n\t\tif (this.regionSelect) {\n\t\t\t// Add a delay so, if the user just clicks, they don't see the crosshair.\n\t\t\t// This will be cleared in zoomEnd if the user's click takes less than 200 ms.\n\t\t\tthis.addingCursorOverlay = setTimeout(() => this.addTempCursorOverlay(\"crosshair\"), 200);\n\t\t\tthis.regionStartTransformX = d3Event.transform.x;\n\t\t\tthis.regionStartTransformY = d3Event.transform.y;\n\n\t\t} else {\n\t\t\tif (this.isDragActivated(d3Event)) {\n\t\t\t\tthis.addingCursorOverlay = setTimeout(() => this.addTempCursorOverlay(\"grabbing\"), 200);\n\t\t\t} else {\n\t\t\t\tthis.addingCursorOverlay = setTimeout(() => this.addTempCursorOverlay(\"default\"), 200);\n\t\t\t}\n\t\t}\n\n\t\tconst transPos = this.getTransformedMousePos(d3Event);\n\t\tthis.zoomStartPoint = { x: d3Event.transform.x, y: d3Event.transform.y, k: d3Event.transform.k, startX: transPos.x, startY: transPos.y };\n\t\tthis.previousD3Event = { x: d3Event.transform.x, y: d3Event.transform.y, k: d3Event.transform.k };\n\t\t// Calculate the canvas dimensions here, so we don't have to recalculate\n\t\t// them for every zoom action event.\n\t\tthis.zoomCanvasDimensions = CanvasUtils.getCanvasDimensions(\n\t\t\tthis.activePipeline.nodes, this.activePipeline.comments,\n\t\t\tthis.activePipeline.links, this.canvasLayout.commentHighlightGap);\n\t}\n\n\tzoomAction(d3Event) {\n\t\tthis.logger.log(\"zoomAction - \" + JSON.stringify(d3Event.transform));\n\n\t\t// If the scale amount is the same we are not zooming, so we must be panning.\n\t\tif (d3Event.transform.k === this.zoomStartPoint.k) {\n\t\t\tif (this.regionSelect) {\n\t\t\t\tthis.drawRegionSelector(d3Event);\n\n\t\t\t} else {\n\t\t\t\tthis.zoomCanvasBackground(d3Event);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.addTempCursorOverlay(\"default\");\n\t\t\tthis.zoomCanvasBackground(d3Event);\n\t\t\tthis.zoomCommentToolbar();\n\t\t}\n\t}\n\n\tzoomEnd(d3Event) {\n\t\tthis.logger.log(\"zoomEnd - \" + JSON.stringify(d3Event.transform));\n\n\t\t// Clears the display of the cursor overlay if the user clicks within 200 ms\n\t\tclearTimeout(this.addingCursorOverlay);\n\n\t\tconst transPos = this.getTransformedMousePos(d3Event);\n\n\t\tif (this.drawingNewLinkData) {\n\t\t\tthis.stopDrawingNewLink();\n\n\t\t} else if (this.draggingLinkData) {\n\t\t\tthis.stopDraggingLink();\n\n\t\t// The user just clicked -- with no drag.\n\t\t} else if (transPos.x === this.zoomStartPoint.startX &&\n\t\t\t\t\t\t\ttransPos.y === this.zoomStartPoint.startY &&\n\t\t\t\t\t\t\t!this.zoomChanged()) {\n\t\t\tthis.zoomClick();\n\n\t\t} else if (this.regionSelect) {\n\t\t\tthis.zoomEndRegionSelect(d3Event);\n\n\t\t} else if (this.dispUtils.isDisplayingFullPage() && this.zoomChanged()) {\n\t\t\tthis.zoomSave();\n\t\t}\n\n\t\t// Remove the cursor overlay and reset the SVG background rectangle\n\t\t// cursor style, which was set in the zoom start method.\n\t\tthis.resetCanvasCursor(d3Event);\n\t\tthis.removeTempCursorOverlay();\n\t\tthis.contextMenuClosedOnZoom = false;\n\t\tthis.textEditingClosedOnZoom = false;\n\t\tthis.regionSelect = false;\n\t}\n\n\t// Returns true if the region select gesture is requested by the user.\n\tshouldDoRegionSelect(d3Event) {\n\t\t// The this.zoomingAction flag indicates zooming is being invoked\n\t\t// programmatically.\n\t\tif (this.zoomingAction) {\n\t\t\treturn false;\n\n\t\t} else if (this.config.enableInteractionType === INTERACTION_MOUSE &&\n\t\t\t\t(d3Event && d3Event.sourceEvent && d3Event.sourceEvent.shiftKey)) {\n\t\t\treturn true;\n\n\t\t} else if (this.config.enableInteractionType === INTERACTION_CARBON &&\n\t\t\t\t\t\t\t!this.isSpaceKeyPressed(d3Event)) {\n\t\t\treturn true;\n\n\t\t} else if (this.config.enableInteractionType === INTERACTION_TRACKPAD &&\n\t\t\t\t(d3Event.sourceEvent && d3Event.sourceEvent.buttons === 1) && // Main button is pressed\n\t\t\t\t!this.spaceKeyPressed) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// Returns true if the current zoom transform is different from the\n\t// zoom values at the beginning of the zoom action.\n\tzoomChanged() {\n\t\treturn (this.zoomTransform.k !== this.zoomStartPoint.k ||\n\t\t\tthis.zoomTransform.x !== this.zoomStartPoint.x ||\n\t\t\tthis.zoomTransform.y !== this.zoomStartPoint.y);\n\t}\n\n\tzoomCanvasBackground(d3Event) {\n\t\tthis.regionSelect = false;\n\n\t\tif (this.dispUtils.isDisplayingPrimaryFlowFullPage()) {\n\t\t\tconst incTransform = this.getTransformIncrement(d3Event);\n\t\t\tthis.zoomTransform = this.zoomConstrainRegular(incTransform, this.getViewportDimensions(), this.zoomCanvasDimensions);\n\t\t} else {\n\t\t\tthis.zoomTransform = d3.zoomIdentity.translate(d3Event.transform.x, d3Event.transform.y).scale(d3Event.transform.k);\n\t\t}\n\n\t\tthis.canvasGrp.attr(\"transform\", this.zoomTransform);\n\n\t\tif (this.config.enableBoundingRectangles) {\n\t\t\tthis.displayBoundingRectangles();\n\t\t}\n\n\t\tif (this.config.enableCanvasUnderlay !== \"None\" &&\n\t\t\t\tthis.dispUtils.isDisplayingPrimaryFlowFullPage()) {\n\t\t\tthis.setCanvasUnderlaySize();\n\t\t}\n\n\t\t// The supernode will not have any calculated port positions when the\n\t\t// subflow is being displayed full screen, so calculate them first.\n\t\tif (this.dispUtils.isDisplayingSubFlowFullPage()) {\n\t\t\tthis.displayPortsForSubFlowFullPage();\n\t\t}\n\t}\n\n\t// Handles a zoom operation that is just a click on the canvas background.\n\tzoomClick() {\n\t\t// Only clear selections if clicked on the canvas of the current active pipeline.\n\t\t// Clicking the canvas of an expanded supernode will select that node.\n\t\t// Also, don't clear selections if we have closed a context menu or\n\t\t// closed text editing.\n\t\tif (this.dispUtils.isDisplayingCurrentPipeline() && !this.contextMenuClosedOnZoom && !this.textEditingClosedOnZoom) {\n\t\t\tthis.canvasController.clearSelections();\n\t\t}\n\t}\n\n\t// Handles the behavior when the user stops doing a region select.\n\tzoomEndRegionSelect(d3Event) {\n\t\tthis.removeRegionSelector();\n\n\t\t// Reset the transform x and y to what they were before the region\n\t\t// selection action was started. This directly sets the x and y values\n\t\t// in the __zoom property of the svgCanvas DOM object.\n\t\td3Event.transform.x = this.regionStartTransformX;\n\t\td3Event.transform.y = this.regionStartTransformY;\n\n\t\tconst { startX, startY, width, height } = this.getRegionDimensions(d3Event);\n\n\t\tconst region = { x1: startX, y1: startY, x2: startX + width, y2: startY + height };\n\t\tconst selections =\n\t\t\tCanvasUtils.selectInRegion(region, this.activePipeline,\n\t\t\t\tthis.config.enableLinkSelection !== LINK_SELECTION_NONE,\n\t\t\t\tthis.config.enableLinkType,\n\t\t\t\tthis.config.enableAssocLinkType);\n\t\tthis.canvasController.setSelections(selections, this.activePipeline.id);\n\t}\n\n\t// Save the zoom amount. The canvas controller/object model will decide\n\t// how this info is saved.\n\tzoomSave() {\n\t\t// Set the internal zoom value for canvasSVG used by D3. This will be\n\t\t// used by d3Event next time a zoom action is initiated.\n\t\tthis.canvasSVG.property(\"__zoom\", this.zoomTransform);\n\n\t\tconst data = {\n\t\t\teditType: \"setZoom\",\n\t\t\teditSource: \"canvas\",\n\t\t\tzoom: this.zoomTransform,\n\t\t\tpipelineId: this.activePipeline.id\n\t\t};\n\t\tthis.canvasController.editActionHandler(data);\n\n\t}\n\n\t// Repositions the comment toolbar so it is always over the top of the\n\t// comment being edited.\n\tzoomCommentToolbar() {\n\t\tif (this.config.enableMarkdownInComments &&\n\t\t\t\tthis.dispUtils.isDisplayingFullPage() &&\n\t\t\t\tthis.svgCanvasTextArea.isEditingText()) {\n\t\t\t// If a node label or text decoration is being edited com will be undefined.\n\t\t\tconst com = this.activePipeline.getComment(this.svgCanvasTextArea.getEditingTextId());\n\t\t\tif (com) {\n\t\t\t\tconst pos = this.getCommentToolbarPos(com);\n\t\t\t\tthis.canvasController.moveTextToolbar(pos.x, pos.y);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Returns a position object that describes the position in page coordinates\n\t// of the comment toolbar so that it is positioned above the comment being edited.\n\tgetCommentToolbarPos(com) {\n\t\tconst pos = this.unTransformPos({ x: com.x_pos, y: com.y_pos });\n\t\treturn {\n\t\t\tx: pos.x + this.canvasLayout.commentToolbarPosX,\n\t\t\ty: pos.y + this.canvasLayout.commentToolbarPosY\n\t\t};\n\t}\n\n\t// Returns a new zoom which is the result of incrementing the current zoom\n\t// by the amount since the previous d3Event transform amount.\n\t// We calculate increments because d3Event.transform is not based on\n\t// the constrained zoom position (which is very annoying) so we keep track\n\t// of the current constraind zoom amount in this.zoomTransform.\n\tgetTransformIncrement(d3Event) {\n\t\tconst xInc = d3Event.transform.x - this.previousD3Event.x;\n\t\tconst yInc = d3Event.transform.y - this.previousD3Event.y;\n\n\t\tconst newTransform = { x: this.zoomTransform.x + xInc, y: this.zoomTransform.y + yInc, k: d3Event.transform.k };\n\t\tthis.previousD3Event = { x: d3Event.transform.x, y: d3Event.transform.y, k: d3Event.transform.k };\n\t\treturn newTransform;\n\t}\n\n\t// Returns a modifed transform object so that the canvas area (the area\n\t// containing nodes and comments) is constrained such that it never totally\n\t// disappears from the view port.\n\tzoomConstrainRegular(transform, viewPort, canvasDimensions) {\n\t\tif (!canvasDimensions) {\n\t\t\treturn this.zoomTransform;\n\t\t}\n\n\t\tconst k = transform.k;\n\t\tlet x = transform.x;\n\t\tlet y = transform.y;\n\n\t\tconst canv =\n\t\t\tthis.convertCanvasDimensionsAdjustedForScaleWithPadding(canvasDimensions, k, this.getZoomToFitPadding());\n\n\t\tconst rightOffsetLimit = viewPort.width - Math.min((viewPort.width * 0.25), (canv.width * 0.25));\n\t\tconst leftOffsetLimit = -(Math.max((canv.width - (viewPort.width * 0.25)), (canv.width * 0.75)));\n\n\t\tconst bottomOffsetLimit = viewPort.height - Math.min((viewPort.height * 0.25), (canv.height * 0.25));\n\t\tconst topOffsetLimit = -(Math.max((canv.height - (viewPort.height * 0.25)), (canv.height * 0.75)));\n\n\t\tif (x > -canv.left + rightOffsetLimit) {\n\t\t\tx = -canv.left + rightOffsetLimit;\n\n\t\t} else if (x < -canv.left + leftOffsetLimit) {\n\t\t\tx = -canv.left + leftOffsetLimit;\n\t\t}\n\n\t\tif (y > -canv.top + bottomOffsetLimit) {\n\t\t\ty = -canv.top + bottomOffsetLimit;\n\n\t\t} else if (y < -canv.top + topOffsetLimit) {\n\t\t\ty = -canv.top + topOffsetLimit;\n\t\t}\n\n\t\treturn d3.zoomIdentity.translate(x, y).scale(k);\n\t}\n\n\t// Returns the dimensions in SVG coordinates of the canvas area. This is\n\t// based on the position and width and height of the nodes and comments. It\n\t// does not include the 'super binding nodes' which are the binding nodes in\n\t// a sub-flow that map to a port in the containing supernode. The dimensions\n\t// are scaled by k and padded by pad (if provided).\n\tgetCanvasDimensionsAdjustedForScale(k, pad) {\n\t\tconst gap = this.canvasLayout.commentHighlightGap;\n\t\tconst canvasDimensions = this.activePipeline.getCanvasDimensions(gap);\n\t\treturn this.convertCanvasDimensionsAdjustedForScaleWithPadding(canvasDimensions, k, pad);\n\t}\n\n\tconvertCanvasDimensionsAdjustedForScaleWithPadding(canv, k, pad) {\n\t\tconst padding = pad || 0;\n\t\tif (canv) {\n\t\t\treturn {\n\t\t\t\tleft: (canv.left * k) - padding,\n\t\t\t\ttop: (canv.top * k) - padding,\n\t\t\t\tright: (canv.right * k) + padding,\n\t\t\t\tbottom: (canv.bottom * k) + padding,\n\t\t\t\twidth: (canv.width * k) + (2 * padding),\n\t\t\t\theight: (canv.height * k) + (2 * padding)\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t}\n\n\tdrawRegionSelector(d3Event) {\n\t\tthis.removeRegionSelector();\n\t\tconst { startX, startY, width, height } = this.getRegionDimensions(d3Event);\n\n\t\tthis.canvasGrp\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"width\", width)\n\t\t\t.attr(\"height\", height)\n\t\t\t.attr(\"x\", startX)\n\t\t\t.attr(\"y\", startY)\n\t\t\t.attr(\"class\", \"d3-region-selector\");\n\t}\n\n\tremoveRegionSelector() {\n\t\tthis.canvasGrp.selectAll(\".d3-region-selector\").remove();\n\t}\n\n\t// Returns the startX, startY, width and height of the selection region\n\t// where startX and startY are always the top left corner of the region\n\t// and width and height are therefore always positive.\n\tgetRegionDimensions(d3Event) {\n\t\tconst transPos = this.getTransformedMousePos(d3Event);\n\t\tlet startX = this.zoomStartPoint.startX;\n\t\tlet startY = this.zoomStartPoint.startY;\n\t\tlet width = transPos.x - startX;\n\t\tlet height = transPos.y - startY;\n\n\t\tif (width < 0) {\n\t\t\twidth = Math.abs(width);\n\t\t\tstartX -= width;\n\t\t}\n\t\tif (height < 0) {\n\t\t\theight = Math.abs(height);\n\t\t\tstartY -= height;\n\t\t}\n\n\t\treturn { startX, startY, width, height };\n\t}\n\n\t// Records the initial starting position of the object being sized so\n\t// that drag increments can be added to the original starting\n\t// position to aid calculating the snap-to-grid position.\n\tinitializeResizeVariables(resizeObj) {\n\t\tthis.resizeObjInitialInfo = {\n\t\t\tx_pos: resizeObj.x_pos, y_pos: resizeObj.y_pos, width: resizeObj.width, height: resizeObj.height };\n\t\tthis.notSnappedXPos = resizeObj.x_pos;\n\t\tthis.notSnappedYPos = resizeObj.y_pos;\n\t\tthis.notSnappedWidth = resizeObj.width;\n\t\tthis.notSnappedHeight = resizeObj.height;\n\t}\n\n\t// Returns an array of objects to drag. If enableDragWithoutSelect is true,\n\t// and the object on which this drag start has initiated is not in the\n\t// set of selected objects, then just that object is to be dragged. Otherwise,\n\t// the selected objects are the objects to be dragged.\n\tgetDragObjects(d) {\n\t\tconst selectedObjects = this.activePipeline.getSelectedNodesAndComments();\n\n\t\tif (this.config.enableDragWithoutSelect &&\n\t\t\t\tselectedObjects.findIndex((o) => o.id === d.id) === -1) {\n\t\t\treturn [d];\n\t\t}\n\n\t\treturn selectedObjects;\n\t}\n\n\tdragStart(d3Event, d) {\n\t\tthis.logger.logStartTimer(\"dragStart\");\n\n\t\tthis.closeContextMenuIfOpen();\n\n\t\t// Note: Comment and Node resizing is started by the comment/node highlight rectangle.\n\t\tif (this.commentSizing) {\n\t\t\tthis.initializeResizeVariables(d);\n\n\t\t} else if (this.nodeSizing) {\n\t\t\tthis.initializeResizeVariables(d);\n\n\t\t} else {\n\t\t\tthis.dragObjectsStart(d3Event, d);\n\t\t}\n\t\tthis.logger.logEndTimer(\"dragStart\", true);\n\t}\n\n\tdragMove(d3Event, d) {\n\t\tthis.logger.logStartTimer(\"dragMove\");\n\t\tif (this.commentSizing) {\n\t\t\tthis.resizeComment(d3Event, d);\n\t\t} else if (this.nodeSizing) {\n\t\t\tthis.resizeNode(d3Event, d);\n\t\t} else {\n\t\t\tthis.dragObjectsAction(d3Event);\n\t\t}\n\n\t\tthis.logger.logEndTimer(\"dragMove\", true);\n\t}\n\n\tdragEnd(d3Event, d) {\n\t\tthis.logger.logStartTimer(\"dragEnd\");\n\n\t\tthis.removeTempCursorOverlay();\n\n\t\tif (this.commentSizing) {\n\t\t\tthis.endCommentSizing(d);\n\n\t\t} else if (this.nodeSizing) {\n\t\t\tthis.endNodeSizing(d);\n\n\t\t} else if (this.dragging) {\n\t\t\tthis.dragObjectsEnd(d3Event, d);\n\t\t}\n\n\t\tthis.logger.logEndTimer(\"dragEnd\", true);\n\t}\n\n\t// Starts the dragging action for canvas objects (nodes and comments).\n\tdragObjectsStart(d3Event, d) {\n\t\t// Ensure flags are false before staring a new drag.\n\t\tthis.existingNodeInsertableIntoLink = false;\n\t\tthis.existingNodeAttachableToDetachedLinks = false;\n\n\t\tthis.dragging = true;\n\t\tthis.dragOffsetX = 0;\n\t\tthis.dragOffsetY = 0;\n\t\tthis.dragRunningX = 0;\n\t\tthis.dragRunningY = 0;\n\t\tthis.dragObjects = this.getDragObjects(d);\n\t\tif (this.dragObjects && this.dragObjects.length > 0) {\n\t\t\tthis.dragStartX = this.dragObjects[0].x_pos;\n\t\t\tthis.dragStartY = this.dragObjects[0].y_pos;\n\t\t}\n\n\t\t// If we are dragging an 'insertable' node, set it to be translucent so\n\t\t// that, when it is dragged over a link line, the highlightd line can be seen OK.\n\t\tif (this.isExistingNodeInsertableIntoLink()) {\n\t\t\tthis.existingNodeInsertableIntoLink = true;\n\t\t\tthis.setNodeTranslucentState(this.dragObjects[0].id, true);\n\t\t\tthis.setDataLinkSelectionAreaWider(true);\n\t\t}\n\n\t\t// If we are dragging an 'attachable' node, set it to be translucent so\n\t\t// that, when it is dragged over link lines, the highlightd lines can be seen OK.\n\t\tif (this.isExistingNodeAttachableToDetachedLinks()) {\n\t\t\tthis.existingNodeAttachableToDetachedLinks = true;\n\t\t\tconst mousePos = this.getTransformedMousePos(d3Event);\n\t\t\tthis.dragPointerOffsetInNode = {\n\t\t\t\tx: mousePos.x - this.dragObjects[0].x_pos,\n\t\t\t\ty: mousePos.y - this.dragObjects[0].y_pos\n\t\t\t};\n\t\t\tthis.setNodeTranslucentState(this.dragObjects[0].id, true);\n\t\t}\n\t}\n\n\t// Performs the dragging action for canvas objects (nodes and comments).\n\tdragObjectsAction(d3Event) {\n\t\tthis.dragOffsetX += d3Event.dx;\n\t\tthis.dragOffsetY += d3Event.dy;\n\n\t\t// Limit the size a drag can be so, when the user is dragging objects in\n\t\t// an in-place subflow they do not drag them too far.\n\t\t// this.logger.log(\"Drag offset X = \" + this.dragOffsetX + \" y = \" + this.dragOffsetY);\n\t\tif (this.dispUtils.isDisplayingSubFlowInPlace() &&\n\t\t\t\t(this.dragOffsetX > 1000 || this.dragOffsetX < -1000 ||\n\t\t\t\t\tthis.dragOffsetY > 1000 || this.dragOffsetY < -1000)) {\n\t\t\tthis.dragOffsetX -= d3Event.dx;\n\t\t\tthis.dragOffsetY -= d3Event.dy;\n\n\t\t} else {\n\t\t\tlet\tincrement = { x: 0, y: 0 };\n\n\t\t\tif (this.config.enableSnapToGridType === SNAP_TO_GRID_DURING) {\n\t\t\t\tconst stgPos = this.snapToGridDraggedNode();\n\n\t\t\t\tincrement = {\n\t\t\t\t\tx: stgPos.x - this.dragObjects[0].x_pos,\n\t\t\t\t\ty: stgPos.y - this.dragObjects[0].y_pos\n\t\t\t\t};\n\n\t\t\t} else {\n\t\t\t\tincrement = {\n\t\t\t\t\tx: d3Event.dx,\n\t\t\t\t\ty: d3Event.dy\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.dragRunningX += increment.x;\n\t\t\tthis.dragRunningY += increment.y;\n\n\t\t\tthis.dragObjects.forEach((d) => {\n\t\t\t\td.x_pos += increment.x;\n\t\t\t\td.y_pos += increment.y;\n\t\t\t});\n\n\t\t\tif (this.config.enableLinkSelection === LINK_SELECTION_DETACHABLE) {\n\t\t\t\tthis.activePipeline.getSelectedLinks().forEach((link) => {\n\t\t\t\t\tif (link.srcPos) {\n\t\t\t\t\t\tlink.srcPos.x_pos += increment.x;\n\t\t\t\t\t\tlink.srcPos.y_pos += increment.y;\n\t\t\t\t\t}\n\t\t\t\t\tif (link.trgPos) {\n\t\t\t\t\t\tlink.trgPos.x_pos += increment.x;\n\t\t\t\t\t\tlink.trgPos.y_pos += increment.y;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.displayMovedComments();\n\t\tthis.displayMovedNodes();\n\t\tthis.displayMovedLinks();\n\t\tthis.displayCanvasAccoutrements();\n\n\t\tif (this.dispUtils.isDisplayingSubFlowInPlace()) {\n\t\t\tthis.displaySVGToFitSupernode();\n\t\t}\n\n\n\t\tif (this.existingNodeInsertableIntoLink) {\n\t\t\tconst link = this.getLinkAtMousePos(d3Event.sourceEvent.clientX, d3Event.sourceEvent.clientY);\n\t\t\t// Set highlighting when there is no link because this will turn\n\t\t\t// current highlighting off. And only switch on highlighting when we are\n\t\t\t// over a fully attached link (not a detached link) and provided the\n\t\t\t// link is not to/from the node being dragged (which is possible in\n\t\t\t// some odd situations).\n\t\t\tif (!link ||\n\t\t\t\t\t(this.isLinkFullyAttached(link) &&\n\t\t\t\t\t\tthis.dragObjects[0].id !== link.srcNodeId &&\n\t\t\t\t\t\tthis.dragObjects[0].id !== link.trgNodeId)) {\n\t\t\t\tthis.setInsertNodeIntoLinkHighlighting(link);\n\t\t\t}\n\t\t}\n\n\t\tif (this.existingNodeAttachableToDetachedLinks) {\n\t\t\tconst mousePos = this.getTransformedMousePos(d3Event);\n\t\t\tconst node = this.dragObjects[0];\n\t\t\tconst ghostArea = {\n\t\t\t\tx1: mousePos.x - this.dragPointerOffsetInNode.x,\n\t\t\t\ty1: mousePos.y - this.dragPointerOffsetInNode.y,\n\t\t\t\tx2: mousePos.x - this.dragPointerOffsetInNode.x + node.width,\n\t\t\t\ty2: mousePos.y - this.dragPointerOffsetInNode.y + node.height\n\t\t\t};\n\t\t\tconst links = this.getAttachableLinksForNodeAtPos(node, ghostArea);\n\t\t\tthis.setDetachedLinkHighlighting(links);\n\t\t}\n\t}\n\n\t// Ends the dragging action for canvas objects (nodes and comments).\n\tdragObjectsEnd(d3Event, d) {\n\t\t// Set to false before updating object model so main body of displayNodes is run.\n\t\tthis.dragging = false;\n\n\t\t// If the pointer hasn't moved and enableDragWithoutSelect we interpret\n\t\t// that as a select on the object.\n\t\tif (this.dragOffsetX === 0 &&\n\t\t\t\tthis.dragOffsetY === 0 &&\n\t\t\t\tthis.config.enableDragWithoutSelect) {\n\t\t\tthis.selectObjectSourceEvent(d3Event, d);\n\n\t\t} else {\n\t\t\tif (this.dragRunningX !== 0 ||\n\t\t\t\t\tthis.dragRunningY !== 0) {\n\t\t\t\tlet dragFinalOffset = null;\n\t\t\t\tif (this.config.enableSnapToGridType === SNAP_TO_GRID_AFTER) {\n\t\t\t\t\tconst stgPos = this.snapToGridDraggedNode();\n\t\t\t\t\tdragFinalOffset = {\n\t\t\t\t\t\tx: stgPos.x - this.dragStartX,\n\t\t\t\t\t\ty: stgPos.y - this.dragStartY\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tdragFinalOffset = { x: this.dragRunningX, y: this.dragRunningY };\n\t\t\t\t}\n\n\t\t\t\tif (this.existingNodeInsertableIntoLink &&\n\t\t\t\t\t\tthis.dragOverLink) {\n\t\t\t\t\tthis.canvasController.editActionHandler({\n\t\t\t\t\t\teditType: \"insertNodeIntoLink\",\n\t\t\t\t\t\teditSource: \"canvas\",\n\t\t\t\t\t\tnode: this.dragObjects[0],\n\t\t\t\t\t\tlink: this.dragOverLink,\n\t\t\t\t\t\toffsetX: dragFinalOffset.x,\n\t\t\t\t\t\toffsetY: dragFinalOffset.y,\n\t\t\t\t\t\tpipelineId: this.activePipeline.id });\n\n\t\t\t\t} else if (this.existingNodeAttachableToDetachedLinks &&\n\t\t\t\t\t\t\t\t\t\tthis.dragOverDetachedLinks.length > 0) {\n\t\t\t\t\tthis.canvasController.editActionHandler({\n\t\t\t\t\t\teditType: \"attachNodeToLinks\",\n\t\t\t\t\t\teditSource: \"canvas\",\n\t\t\t\t\t\tnode: this.dragObjects[0],\n\t\t\t\t\t\tdetachedLinks: this.dragOverDetachedLinks,\n\t\t\t\t\t\toffsetX: dragFinalOffset.x,\n\t\t\t\t\t\toffsetY: dragFinalOffset.y,\n\t\t\t\t\t\tpipelineId: this.activePipeline.id });\n\n\t\t\t\t} else {\n\t\t\t\t\tthis.canvasController.editActionHandler({\n\t\t\t\t\t\teditType: \"moveObjects\",\n\t\t\t\t\t\teditSource: \"canvas\",\n\t\t\t\t\t\tnodes: this.dragObjects.map((o) => o.id),\n\t\t\t\t\t\tlinks: this.activePipeline.getSelectedDetachedLinks(),\n\t\t\t\t\t\toffsetX: dragFinalOffset.x,\n\t\t\t\t\t\toffsetY: dragFinalOffset.y,\n\t\t\t\t\t\tpipelineId: this.activePipeline.id });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Switch off any drag highlighting\n\t\tthis.setDataLinkSelectionAreaWider(false);\n\t\tthis.unsetNodeTranslucentState();\n\t\tthis.unsetInsertNodeIntoLinkHighlighting();\n\t\tthis.unsetDetachedLinkHighlighting();\n\t}\n\n\tdragStartLinkHandle(d3Event, d) {\n\t\tthis.logger.logStartTimer(\"dragStartLinkHandle\");\n\n\t\tthis.closeContextMenuIfOpen();\n\n\t\tthis.draggingLinkHandle = true;\n\n\t\tconst handleSelection = d3.select(d3Event.sourceEvent.currentTarget);\n\t\tconst link = this.activePipeline.getLink(d.id);\n\t\tconst oldLink = cloneDeep(link);\n\n\t\tconst linkGrpSelector = this.getLinkGroupSelectionById(d.id);\n\n\t\tthis.draggingLinkData = {\n\t\t\tlineInfo: d,\n\t\t\tlink: link,\n\t\t\toldLink: oldLink,\n\t\t\tlinkGrpSelection: d3.select(linkGrpSelector)\n\t\t};\n\n\t\tif (handleSelection.attr(\"class\").includes(\"d3-link-handle-end\")) {\n\t\t\tthis.draggingLinkData.endBeingDragged = \"end\";\n\n\t\t} else if (handleSelection.attr(\"class\").includes(\"d3-link-handle-start\")) {\n\t\t\tthis.draggingLinkData.endBeingDragged = \"start\";\n\t\t}\n\n\t\tif (this.config.enableHighlightUnavailableNodes) {\n\t\t\tif (this.draggingLinkData.endBeingDragged === \"end\") {\n\t\t\t\tconst links = this.activePipeline.links.filter((lnk) => lnk.id !== link.id);\n\t\t\t\tthis.setUnavailableTargetNodesHighlighting(\n\t\t\t\t\tthis.activePipeline.getNode(this.draggingLinkData.link.srcNodeId),\n\t\t\t\t\tthis.draggingLinkData.link.srcNodePortId,\n\t\t\t\t\tlinks\n\t\t\t\t);\n\t\t\t} else if (this.draggingLinkData.endBeingDragged === \"start\") {\n\t\t\t\tconst links = this.activePipeline.links.filter((lnk) => lnk.id !== link.id);\n\t\t\t\tthis.setUnavailableSourceNodesHighlighting(\n\t\t\t\t\tthis.activePipeline.getNode(this.draggingLinkData.oldLink.trgNodeId),\n\t\t\t\t\tthis.draggingLinkData.link.trgNodePortId,\n\t\t\t\t\tlinks\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.dragLinkHandle(d3Event);\n\t\tthis.logger.logEndTimer(\"dragStartLinkHandle\", true);\n\t}\n\n\tdragMoveLinkHandle(d3Event) {\n\t\tthis.logger.logStartTimer(\"dragMoveLinkHandle\");\n\t\tthis.dragLinkHandle(d3Event);\n\t\tthis.logger.logEndTimer(\"dragMoveLinkHandle\", true);\n\t}\n\n\tdragEndLinkHandle(d3Event) {\n\t\tthis.logger.logStartTimer(\"dragEndLinkHandle\");\n\t\tthis.completeDraggedLink(d3Event);\n\t\tthis.draggingLinkHandle = false;\n\t\tthis.logger.logEndTimer(\"dragEndLinkHandle\", true);\n\t}\n\n\t// Switches on or off the translucent state of the node identified by the\n\t// node ID passed in. This is used when an 'insertable' node is dragged on\n\t// the canvas. It makes is easier for the user to see the highlighted link\n\t// when the node is dragged over it.\n\tsetNodeTranslucentState(nodeId, state) {\n\t\tthis.getNodeGroupSelectionById(nodeId).classed(\"d3-node-group-translucent\", state);\n\t}\n\n\t// Switched off the translucent state of the objects being dragged (if\n\t// there are any).\n\tunsetNodeTranslucentState() {\n\t\tif (this.dragObjects && this.dragObjects.length > 0) {\n\t\t\tthis.setNodeTranslucentState(this.dragObjects[0].id, false);\n\t\t}\n\t}\n\n\t// Returns the snap-to-grid position of the object positioned at\n\t// this.dragStartX and this.dragStartY after applying the current offset of\n\t// this.dragOffsetX and this.dragOffsetY.\n\tsnapToGridDraggedNode() {\n\t\tconst objPosX = this.dragStartX + this.dragOffsetX;\n\t\tconst objPosY = this.dragStartY + this.dragOffsetY;\n\n\t\treturn this.snapToGridPosition({ x: objPosX, y: objPosY });\n\t}\n\n\t// Returns the snap-to-grid position of the object positioned at objPos.x\n\t// and objPos.y. The grid that is snapped to is defined by this.snapToGridXPx\n\t// and this.snapToGridYPx values which are pixel values.\n\tsnapToGridPosition(objPos) {\n\t\tconst stgPosX = CanvasUtils.snapToGrid(objPos.x, this.canvasLayout.snapToGridXPx);\n\t\tconst stgPosY = CanvasUtils.snapToGrid(objPos.y, this.canvasLayout.snapToGridYPx);\n\n\t\treturn { x: stgPosX, y: stgPosY };\n\t}\n\n\t// Displays all the nodes on the canvas either by creating new nodes,\n\t// updating existing nodes or removing unwanted nodes.\n\tdisplayNodes() {\n\t\tthis.logger.logStartTimer(\"displayNodes \" + this.getFlags());\n\n\t\t// Set the port positions for all ports - these will be needed when displaying\n\t\t// nodes and links. This needs to be done here because a resized supernode\n\t\t// will cause its ports to move and resizing comments causes links to be\n\t\t// redrawn which will need port positions to be set appropriately.\n\t\tthis.setPortPositionsAllNodes();\n\n\t\tconst sel = this.getAllNodeGroupsSelection();\n\t\tthis.displayNodesSubset(sel, this.activePipeline.nodes);\n\n\t\tthis.logger.logEndTimer(\"displayNodes \" + this.getFlags());\n\t}\n\n\tdisplayMovedNodes() {\n\t\tthis.logger.logStartTimer(\"displayMovedNodes\");\n\t\tconst nodeGroupSel = this.getAllNodeGroupsSelection();\n\n\t\tnodeGroupSel\n\t\t\t.datum((d) => this.activePipeline.getNode(d.id))\n\t\t\t.attr(\"transform\", (d) => `translate(${d.x_pos}, ${d.y_pos})`);\n\n\t\tif (this.dispUtils.isDisplayingSubFlow()) {\n\t\t\tnodeGroupSel\n\t\t\t\t.each((d, i, nodeGrps) => {\n\t\t\t\t\tif (d.isSupernodeInputBinding) {\n\t\t\t\t\t\tthis.updatePortRadiusAndPos(nodeGrps[i], d, \"d3-node-port-output-main\");\n\t\t\t\t\t}\n\t\t\t\t\tif (d.isSupernodeOutputBinding) {\n\t\t\t\t\t\tthis.updatePortRadiusAndPos(nodeGrps[i], d, \"d3-node-port-input-main\");\n\t\t\t\t\t\tthis.updatePortArrowPath(nodeGrps[i], \"d3-node-port-input-arrow\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t\tthis.logger.logEndTimer(\"displayMovedNodes\");\n\t}\n\n\tdisplayNodesSelectionStatus(selectionInfo) {\n\t\tthis.logger.logStartTimer(\"displayNodesSelectionStatus\");\n\n\t\tthis.getAllNodeGroupsSelection()\n\t\t\t.selectChildren(\".d3-node-selection-highlight\")\n\t\t\t.attr(\"data-selected\", (d) => (this.activePipeline.isSelected(d.id) ? \"yes\" : \"no\"));\n\n\t\tthis.logger.logEndTimer(\"displayNodesSelectionStatus\");\n\t}\n\n\tdisplaySingleNode(d) {\n\t\tthis.logger.logStartTimer(\"displaySingleNode \" + this.getFlags());\n\n\t\tthis.setPortPositionsForNode(d);\n\n\t\tconst selection = this.getNodeGroupSelectionById(d.id);\n\t\tthis.displayNodesSubset(selection, [d]);\n\n\t\tthis.logger.logEndTimer(\"displaySingleNode \" + this.getFlags());\n\t}\n\n\tdisplayNodesSubset(selection, data) {\n\t\tselection\n\t\t\t.data(data, (d) => d.id)\n\t\t\t.join(\n\t\t\t\t(enter) => this.createNodes(enter)\n\t\t\t)\n\t\t\t.attr(\"transform\", (d) => `translate(${d.x_pos}, ${d.y_pos})`)\n\t\t\t.attr(\"class\", (d) => this.getNodeGroupClass(d))\n\t\t\t.attr(\"style\", (d) => this.getNodeGrpStyle(d))\n\t\t\t.call((joinedNodeGrps) => this.updateNodes(joinedNodeGrps));\n\t}\n\n\tcreateNodes(enter) {\n\t\tthis.logger.logStartTimer(\"createNodes\");\n\n\t\tconst newNodeGroups = enter\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"data-id\", (d) => this.getId(\"node_grp\", d.id))\n\t\t\t.call(this.attachNodeGroupListeners.bind(this));\n\n\t\tif (this.config.enableEditingActions) {\n\t\t\tnewNodeGroups\n\t\t\t\t.call(this.drag);\t // Must put drag after mousedown listener so mousedown gets called first.\n\t\t}\n\n\t\t// Node Sizing Area.\n\t\tnewNodeGroups.filter((d) => this.shouldDisplayNodeSizingArea(d))\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"d3-node-sizing\")\n\t\t\t.call(this.attachNodeSizingListeners.bind(this));\n\n\t\t// Node Selection Highlighting Outline.\n\t\tnewNodeGroups.filter((d) => !CanvasUtils.isSuperBindingNode(d))\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"d3-node-selection-highlight\");\n\n\t\t// Node Body\n\t\tnewNodeGroups.filter((d) => !CanvasUtils.isSuperBindingNode(d))\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"d3-node-body-outline\");\n\n\t\t// Node Image\n\t\tnewNodeGroups.filter((d) => !CanvasUtils.isSuperBindingNode(d) && d.layout.imageDisplay)\n\t\t\t.each((node, i, nodeGrps) => {\n\t\t\t\tconst nodeImage = this.getNodeImage(node);\n\t\t\t\tconst nodeImageType = this.getImageType(nodeImage);\n\t\t\t\td3.select(nodeGrps[i])\n\t\t\t\t\t.append(nodeImageType)\n\t\t\t\t\t.attr(\"class\", (d) => this.nodeUtils.getNodeImageClass(d));\n\t\t\t});\n\n\t\t// Node Label\n\t\tnewNodeGroups.filter((d) => !CanvasUtils.isSuperBindingNode(d))\n\t\t\t.append(\"foreignObject\")\n\t\t\t.attr(\"class\", \"d3-foreign-object-node-label\")\n\t\t\t.call(this.attachNodeLabelListeners.bind(this))\n\t\t\t.append(\"xhtml:div\") // Provide a namespace when div is inside foreignObject\n\t\t\t.call(this.attachNodeLabelSpanListeners.bind(this));\n\n\t\tthis.logger.logEndTimer(\"createNodes\");\n\n\t\treturn newNodeGroups;\n\t}\n\n\tupdateNodes(joinedNodeGrps) {\n\t\tthis.logger.logStartTimer(\"updateNodes\");\n\n\t\t// Node Sizing Area\n\t\tjoinedNodeGrps.selectChildren(\".d3-node-sizing\")\n\t\t\t.datum((d) => this.activePipeline.getNode(d.id))\n\t\t\t.attr(\"d\", (d) => this.getNodeShapePathSizing(d));\n\n\t\t// Node Selection Highlighting Outline.\n\t\tjoinedNodeGrps.selectChildren(\".d3-node-selection-highlight\")\n\t\t\t.datum((d) => this.activePipeline.getNode(d.id))\n\t\t\t.attr(\"d\", (d) => this.getNodeSelectionOutline(d))\n\t\t\t.attr(\"data-selected\", (d) => (this.activePipeline.isSelected(d.id) ? \"yes\" : \"no\"))\n\t\t\t.attr(\"style\", (d) => this.getNodeSelectionOutlineStyle(d, \"default\"));\n\n\t\t// Node Body\n\t\tjoinedNodeGrps.selectChildren(\".d3-node-body-outline\")\n\t\t\t.datum((d) => this.activePipeline.getNode(d.id))\n\t\t\t.attr(\"d\", (d) => this.getNodeShapePath(d))\n\t\t\t.attr(\"style\", (d) => this.getNodeBodyStyle(d, \"default\"));\n\n\t\t// Node Image\n\t\tjoinedNodeGrps.selectChildren(\".d3-node-image\")\n\t\t\t.datum((d) => this.activePipeline.getNode(d.id))\n\t\t\t.each((d, i, nodeGrps) => this.setNodeImageContent(nodeGrps[i], d))\n\t\t\t.attr(\"x\", (d) => this.nodeUtils.getNodeImagePosX(d))\n\t\t\t.attr(\"y\", (d) => this.nodeUtils.getNodeImagePosY(d))\n\t\t\t.attr(\"width\", (d) => this.nodeUtils.getNodeImageWidth(d))\n\t\t\t.attr(\"height\", (d) => this.nodeUtils.getNodeImageHeight(d))\n\t\t\t.attr(\"style\", (d) => this.getNodeImageStyle(d, \"default\"));\n\n\t\t// Node Label\n\t\tjoinedNodeGrps.selectChildren(\".d3-foreign-object-node-label\")\n\t\t\t.datum((d) => this.activePipeline.getNode(d.id))\n\t\t\t.attr(\"x\", (d) => this.nodeUtils.getNodeLabelPosX(d))\n\t\t\t.attr(\"y\", (d) => this.nodeUtils.getNodeLabelPosY(d))\n\t\t\t.attr(\"width\", (d) => this.nodeUtils.getNodeLabelWidth(d))\n\t\t\t.attr(\"height\", (d) => this.nodeUtils.getNodeLabelHeight(d))\n\t\t\t.select(\"div\")\n\t\t\t.attr(\"class\", (d) => this.nodeUtils.getNodeLabelClass(d))\n\t\t\t.attr(\"style\", (d) => this.getNodeLabelStyle(d, \"default\"))\n\t\t\t.html((d) => d.label);\n\n\t\t// Node Ellipsis Icon - if one exists\n\t\tjoinedNodeGrps.selectChildren(\".d3-node-ellipsis-group\")\n\t\t\t.attr(\"transform\", (d) => this.nodeUtils.getNodeEllipsisTranslate(d));\n\n\t\t// Node (Supernode) Expansion Icon - if one exists\n\t\tjoinedNodeGrps.selectChildren(\".d3-node-super-expand-icon-group\")\n\t\t\t.attr(\"transform\", (d) => this.nodeUtils.getNodeExpansionIconTranslate(d));\n\n\t\t// Ports display; Supernode sub-flow display; Error marker display; and\n\t\t// Decoration display.\n\t\tjoinedNodeGrps.each((d, index, grps) => {\n\t\t\tconst nodeGrp = d3.select(grps[index]);\n\n\t\t\tthis.displayPorts(nodeGrp, d);\n\n\t\t\tif (CanvasUtils.isSupernode(d)) {\n\t\t\t\tthis.displaySupernodeContents(d, d3.select(grps[index]));\n\t\t\t}\n\n\t\t\tif (!CanvasUtils.isSuperBindingNode(d)) {\n\t\t\t\t// Display error indicator\n\t\t\t\tthis.addErrorMarker(d, nodeGrp);\n\n\t\t\t\t// Display Decorators\n\t\t\t\tconst decorations = CanvasUtils.getCombinedDecorations(d.layout.decorations, d.decorations);\n\t\t\t\tthis.displayDecorations(d, DEC_NODE, nodeGrp, decorations);\n\t\t\t}\n\t\t});\n\t\tthis.logger.logEndTimer(\"updateNodes\");\n\t}\n\n\t// Handles the display of a supernode sub-flow contents or hides the contents\n\t// as necessary.\n\tdisplaySupernodeContents(d, supernodeD3Object) {\n\t\tlet ren = this.getRendererForSupernode(d);\n\n\t\tif (CanvasUtils.isExpanded(d)) {\n\t\t\tif (!ren) {\n\t\t\t\tren = this.createSupernodeRenderer(d, supernodeD3Object); // Create will call displayCanvas\n\t\t\t\tthis.superRenderers.push(ren);\n\t\t\t} else {\n\t\t\t\t// Setting canvas info will call displayCanvas for the sub-flow\n\t\t\t\tren.setCanvasInfoRenderer(\n\t\t\t\t\tthis.canvasInfo,\n\t\t\t\t\tthis.selectionInfo,\n\t\t\t\t\tthis.breadcrumbs,\n\t\t\t\t\tthis.nodeLayout,\n\t\t\t\t\tthis.canvasLayout\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tif (ren) {\n\t\t\t\tren.hideCanvas(d);\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplayPorts(nodeGrp, d) {\n\t\t// Empty inputs arrays are allowed because some apps support that when ports are deleted.\n\t\tif (d.layout.inputPortDisplay && Array.isArray(d.inputs)) {\n\t\t\tthis.displayInputPorts(nodeGrp, d);\n\t\t}\n\n\t\t// Empty outputs arrays are allowed because some apps support that when ports are deleted.\n\t\tif (d.layout.outputPortDisplay && Array.isArray(d.outputs)) {\n\t\t\tthis.displayOutputPorts(nodeGrp, d);\n\t\t}\n\t}\n\n\tdisplayInputPorts(nodeGrp, node) {\n\t\tconst inSelector = \".\" + this.getNodeInputPortClassName();\n\n\t\tnodeGrp.selectChildren(inSelector)\n\t\t\t.data(node.inputs, (p) => p.id)\n\t\t\t.join(\n\t\t\t\t(enter) => this.createInputPorts(enter, node)\n\t\t\t)\n\t\t\t.attr(\"connected\", (port) => (port.isConnected ? \"yes\" : \"no\"))\n\t\t\t.attr(\"class\", (port) => this.getNodeInputPortClassName() + (port.class_name ? \" \" + port.class_name : \"\"))\n\t\t\t.call((joinedInputPortGrps) => this.updateInputPorts(joinedInputPortGrps, node));\n\t}\n\n\tcreateInputPorts(enter, node) {\n\t\tconst inputPortGroups = enter\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"data-port-id\", (port) => port.id)\n\t\t\t.attr(\"isSupernodeBinding\", CanvasUtils.isSuperBindingNode(node) ? \"yes\" : \"no\")\n\t\t\t.call(this.attachInputPortListeners.bind(this), node);\n\n\t\tinputPortGroups\n\t\t\t.append(node.layout.inputPortObject)\n\t\t\t.attr(\"class\", \"d3-node-port-input-main\");\n\n\t\t// Don't show the port arrow when we are supporting association\n\t\t// link creation\n\t\tif (!this.config.enableAssocLinkCreation &&\n\t\t\t\tnode.layout.inputPortObject === \"circle\" &&\n\t\t\t\t!CanvasUtils.isSuperBindingNode(node)) {\n\t\t\t// Input port arrow in circle for nodes which are not supernode binding nodes.\n\t\t\tinputPortGroups\n\t\t\t\t.append(\"path\")\n\t\t\t\t.attr(\"class\", \"d3-node-port-input-arrow\");\n\t\t}\n\n\t\treturn inputPortGroups;\n\t}\n\n\tupdateInputPorts(joinedInputPortGrps, node) {\n\t\tjoinedInputPortGrps.selectChildren(\".d3-node-port-input-main\")\n\t\t\t.datum((port) => node.inputs.find((i) => port.id === i.id))\n\t\t\t.each((port, i, inputPorts) => {\n\t\t\t\tconst obj = d3.select(inputPorts[i]);\n\t\t\t\tif (node.layout.inputPortObject === PORT_OBJECT_IMAGE) {\n\t\t\t\t\tobj\n\t\t\t\t\t\t.attr(\"xlink:href\", node.layout.inputPortImage)\n\t\t\t\t\t\t.attr(\"x\", port.cx - (node.layout.inputPortWidth / 2))\n\t\t\t\t\t\t.attr(\"y\", port.cy - (node.layout.inputPortHeight / 2))\n\t\t\t\t\t\t.attr(\"width\", node.layout.inputPortWidth)\n\t\t\t\t\t\t.attr(\"height\", node.layout.inputPortHeight);\n\t\t\t\t} else {\n\t\t\t\t\tobj\n\t\t\t\t\t\t.attr(\"r\", this.getPortRadius(node))\n\t\t\t\t\t\t.attr(\"cx\", port.cx)\n\t\t\t\t\t\t.attr(\"cy\", port.cy);\n\t\t\t\t}\n\t\t\t});\n\n\t\tjoinedInputPortGrps.selectChildren(\".d3-node-port-input-arrow\")\n\t\t\t.datum((port) => node.inputs.find((i) => port.id === i.id))\n\t\t\t.each((port, i, inputPorts) => {\n\t\t\t\tconst obj = d3.select(inputPorts[i]);\n\t\t\t\tif (node.layout.inputPortObject !== PORT_OBJECT_IMAGE) {\n\t\t\t\t\tobj\n\t\t\t\t\t\t.attr(\"d\", this.getPortArrowPath(port))\n\t\t\t\t\t\t.attr(\"transform\", this.getPortArrowPathTransform(port));\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tdisplayOutputPorts(nodeGrp, node) {\n\t\tconst outSelector = \".\" + this.getNodeOutputPortClassName();\n\n\t\tconst outputs = this.config.enableSingleOutputPortDisplay && node.outputs.length > 1\n\t\t\t? [node.outputs[node.outputs.length - 1]]\n\t\t\t: node.outputs;\n\n\t\tnodeGrp.selectChildren(outSelector)\n\t\t\t.data(outputs, (p) => p.id)\n\t\t\t.join(\n\t\t\t\t(enter) => this.createOutputPorts(enter, node)\n\t\t\t)\n\t\t\t.attr(\"connected\", (port) => (port.isConnected ? \"yes\" : \"no\"))\n\t\t\t.attr(\"class\", (port) => this.getNodeOutputPortClassName() + (port.class_name ? \" \" + port.class_name : \"\"))\n\t\t\t.call((joinedOutputPortGrps) => this.updateOutputPorts(joinedOutputPortGrps, node));\n\t}\n\n\tcreateOutputPorts(enter, node) {\n\t\tconst outputPortGroups = enter\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"data-port-id\", (port) => port.id)\n\t\t\t.attr(\"isSupernodeBinding\", CanvasUtils.isSuperBindingNode(node) ? \"yes\" : \"no\")\n\t\t\t.call(this.attachOutputPortListeners.bind(this), node);\n\n\t\toutputPortGroups\n\t\t\t.append(node.layout.outputPortObject)\n\t\t\t.attr(\"class\", \"d3-node-port-output-main\");\n\n\t\treturn outputPortGroups;\n\t}\n\n\tupdateOutputPorts(joinedOutputPortGroups, node) {\n\t\tjoinedOutputPortGroups.selectChildren(\".d3-node-port-output-main\")\n\t\t\t.datum((port) => node.outputs.find((o) => port.id === o.id))\n\t\t\t.each((port, i, outputPorts) => {\n\t\t\t\tconst obj = d3.select(outputPorts[i]);\n\t\t\t\tif (node.layout.outputPortObject === PORT_OBJECT_IMAGE) {\n\t\t\t\t\tobj\n\t\t\t\t\t\t.attr(\"xlink:href\", node.layout.outputPortImage)\n\t\t\t\t\t\t.attr(\"x\", port.cx - (node.layout.outputPortWidth / 2))\n\t\t\t\t\t\t.attr(\"y\", port.cy - (node.layout.outputPortHeight / 2))\n\t\t\t\t\t\t.attr(\"width\", node.layout.outputPortWidth)\n\t\t\t\t\t\t.attr(\"height\", node.layout.outputPortHeight);\n\t\t\t\t} else {\n\t\t\t\t\tobj\n\t\t\t\t\t\t.attr(\"r\", this.getPortRadius(node))\n\t\t\t\t\t\t.attr(\"cx\", port.cx)\n\t\t\t\t\t\t.attr(\"cy\", port.cy);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t// Attaches the appropriate listeners to the node groups.\n\tattachNodeGroupListeners(nodeGrps) {\n\t\tnodeGrps\n\t\t\t.on(\"mouseenter\", (d3Event, d) => {\n\t\t\t\tconst nodeGrp = d3.select(d3Event.currentTarget);\n\t\t\t\tthis.raiseNodeToTop(nodeGrp);\n\t\t\t\tthis.setNodeStyles(d, \"hover\", nodeGrp);\n\t\t\t\tthis.addDynamicNodeIcons(d, nodeGrp);\n\t\t\t\tif (this.canOpenTip(TIP_TYPE_NODE)) {\n\t\t\t\t\tthis.canvasController.closeTip(); // Ensure existing tip is removed when moving pointer within an in-place supernode\n\t\t\t\t\tthis.canvasController.openTip({\n\t\t\t\t\t\tid: this.getId(\"node_tip\", d.id),\n\t\t\t\t\t\ttype: TIP_TYPE_NODE,\n\t\t\t\t\t\ttargetObj: d3Event.currentTarget,\n\t\t\t\t\t\tpipelineId: this.activePipeline.id,\n\t\t\t\t\t\tnode: d\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", (d3Event, d) => {\n\t\t\t\tconst nodeGrp = d3.select(d3Event.currentTarget);\n\t\t\t\tthis.setNodeStyles(d, \"default\", nodeGrp);\n\t\t\t\tthis.removeDynamicNodeIcons(d, nodeGrp);\n\t\t\t\tthis.canvasController.closeTip();\n\t\t\t})\n\t\t\t// Use mouse down instead of click because it gets called before drag start.\n\t\t\t.on(\"mousedown\", (d3Event, d) => {\n\t\t\t\tthis.logger.logStartTimer(\"Node Group - mouse down\");\n\t\t\t\tif (this.svgCanvasTextArea.isEditingText()) {\n\t\t\t\t\tthis.svgCanvasTextArea.completeEditing();\n\t\t\t\t}\n\t\t\t\tif (!this.config.enableDragWithoutSelect) {\n\t\t\t\t\tthis.selectObjectD3Event(d3Event, d);\n\t\t\t\t}\n\t\t\t\tthis.logger.logEndTimer(\"Node Group - mouse down\");\n\t\t\t})\n\t\t\t.on(\"mousemove\", (d3Event, d) => {\n\t\t\t\t// this.logger.log(\"Node Group - mouse move\");\n\t\t\t\t// Don't stop propogation. Mouse move messages must be allowed to\n\t\t\t\t// propagate to canvas zoom operation.\n\t\t\t})\n\t\t\t.on(\"mouseup\", (d3Event, d) => {\n\t\t\t\td3Event.stopPropagation();\n\t\t\t\tthis.logger.log(\"Node Group - mouse up\");\n\t\t\t\tif (this.drawingNewLinkData) {\n\t\t\t\t\tthis.completeNewLink(d3Event);\n\t\t\t\t}\n\t\t\t\tif (this.draggingLinkData) {\n\t\t\t\t\tthis.completeDraggedLink(d3Event, d);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"click\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Node Group - click\");\n\t\t\t\td3Event.stopPropagation();\n\t\t\t})\n\t\t\t.on(\"dblclick\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Node Group - double click\");\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\tthis.canvasController.clickActionHandler({\n\t\t\t\t\tclickType: \"DOUBLE_CLICK\",\n\t\t\t\t\tobjectType: \"node\",\n\t\t\t\t\tid: d.id,\n\t\t\t\t\tselectedObjectIds: this.activePipeline.getSelectedObjectIds(),\n\t\t\t\t\tpipelineId: this.activePipeline.id\n\t\t\t\t});\n\t\t\t})\n\t\t\t.on(\"contextmenu\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Node Group - context menu\");\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\tif (!CanvasUtils.isSuperBindingNode(d)) {\n\t\t\t\t\t// With enableDragWithoutSelect set to true, the object for which the\n\t\t\t\t\t// context menu is being requested needs to be implicitely selected.\n\t\t\t\t\tif (this.config.enableDragWithoutSelect) {\n\t\t\t\t\t\tthis.selectObjectD3Event(d3Event, d);\n\t\t\t\t\t}\n\t\t\t\t\tthis.openContextMenu(d3Event, \"node\", d);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tattachNodeSizingListeners(nodeGrps) {\n\t\tnodeGrps\n\t\t\t.on(\"mousedown\", (d3Event, d) => {\n\t\t\t\tif (this.isNodeResizable(d)) {\n\t\t\t\t\tthis.nodeSizing = true;\n\t\t\t\t\t// Note - node resizing and finalization of size is handled by drag functions.\n\t\t\t\t\tthis.addTempCursorOverlay(this.nodeSizingCursor);\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Use mousemove as well as mouseenter so the cursor will change\n\t\t\t// if the pointer moves from one area of the node outline to another\n\t\t\t// (eg. from east area to north-east area) without exiting the node outline.\n\t\t\t// A mouseenter is triggered when the sizing operation stops and the\n\t\t\t// pointer leaves the temporary overlay (which is removed) and enters\n\t\t\t// the node outline.\n\t\t\t.on(\"mousemove mouseenter\", (d3Event, d) => {\n\t\t\t\tif (this.isNodeResizable(d) &&\n\t\t\t\t\t\t!this.isRegionSelectOrSizingInProgress()) { // Don't switch sizing direction if we are already sizing\n\t\t\t\t\tlet cursorType = \"default\";\n\t\t\t\t\tif (!this.isPointerCloseToBodyEdge(d3Event, d)) {\n\t\t\t\t\t\tthis.nodeSizingDirection = this.getSizingDirection(d3Event, d, d.layout.nodeCornerResizeArea);\n\t\t\t\t\t\tthis.nodeSizingCursor = this.getCursorBasedOnDirection(this.nodeSizingDirection);\n\t\t\t\t\t\tcursorType = this.nodeSizingCursor;\n\t\t\t\t\t}\n\t\t\t\t\td3.select(d3Event.currentTarget).style(\"cursor\", cursorType);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", (d3Event, d) => {\n\t\t\t\td3.select(d3Event.currentTarget).style(\"cursor\", \"default\");\n\t\t\t});\n\t}\n\n\tattachNodeLabelListeners(nodeLabels) {\n\t\tnodeLabels\n\t\t\t.on(\"mouseenter\", (d3Event, d) => {\n\t\t\t\tconst labelSel = d3.select(d3Event.currentTarget);\n\t\t\t\tif (this.config.enableDisplayFullLabelOnHover && !CanvasUtils.isExpandedSupernode(d)) {\n\t\t\t\t\tconst spanSel = labelSel.selectAll(\"span\");\n\t\t\t\t\tlabelSel\n\t\t\t\t\t\t.attr(\"x\", this.nodeUtils.getNodeLabelHoverPosX(d))\n\t\t\t\t\t\t.attr(\"width\", this.nodeUtils.getNodeLabelHoverWidth(d))\n\t\t\t\t\t\t.attr(\"height\", this.nodeUtils.getNodeLabelHoverHeight(d, spanSel.node(), this.zoomTransform.k));\n\t\t\t\t\tspanSel.classed(\"d3-label-full\", true);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", (d3Event, d) => {\n\t\t\t\tconst labelSel = d3.select(d3Event.currentTarget);\n\t\t\t\tif (this.config.enableDisplayFullLabelOnHover && !CanvasUtils.isExpandedSupernode(d)) {\n\t\t\t\t\tlabelSel\n\t\t\t\t\t\t.attr(\"x\", this.nodeUtils.getNodeLabelPosX(d))\n\t\t\t\t\t\t.attr(\"width\", this.nodeUtils.getNodeLabelWidth(d))\n\t\t\t\t\t\t.attr(\"height\", this.nodeUtils.getNodeLabelHeight(d));\n\t\t\t\t\tlabelSel.selectAll(\"span\").classed(\"d3-label-full\", false);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"dblclick\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Node Label - double click\");\n\t\t\t\tif (d.layout.labelEditable && this.config.enableEditingActions) {\n\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t\tthis.displayNodeLabelTextArea(d, d3Event.currentTarget.parentNode);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tattachNodeLabelSpanListeners(nodeLabelSpans) {\n\t\tnodeLabelSpans\n\t\t\t.on(\"mouseenter\", (d3Event, d) => {\n\t\t\t\tif (d.layout.labelEditable && this.config.enableEditingActions) {\n\t\t\t\t\tthis.displayNodeLabelEditIcon(d3Event.currentTarget, d);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", (d3Event, d) => {\n\t\t\t\tif (d.layout.labelEditable && this.config.enableEditingActions) {\n\t\t\t\t\t// Wait half a sec to let the user get the pointer into the edit icon, otherwise it is closed immediately.\n\t\t\t\t\tthis.hideEditIconPending = setTimeout(this.hideEditIcon.bind(this), 500, d3Event.currentTarget, d);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tattachInputPortListeners(inputPorts, node) {\n\t\tinputPorts\n\t\t\t.on(\"mousedown\", (d3Event, port) => {\n\t\t\t\tif (this.config.enableAssocLinkCreation) {\n\t\t\t\t\t// Make sure this is just a left mouse button click - we don't want context menu click starting a line being drawn\n\t\t\t\t\tif (d3Event.button === 0) {\n\t\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event); // Stops the node drag behavior when clicking on the handle/circle\n\t\t\t\t\t\tconst srcNode = this.activePipeline.getNode(node.id);\n\t\t\t\t\t\tthis.drawingNewLinkData = {\n\t\t\t\t\t\t\tsrcObjId: node.id,\n\t\t\t\t\t\t\tsrcPortId: port.id,\n\t\t\t\t\t\t\taction: this.config.enableAssocLinkCreation ? ASSOCIATION_LINK : NODE_LINK,\n\t\t\t\t\t\t\tsrcNode: srcNode,\n\t\t\t\t\t\t\tstartPos: { x: srcNode.x_pos + port.cx, y: srcNode.y_pos + port.cy },\n\t\t\t\t\t\t\tportType: \"input\",\n\t\t\t\t\t\t\tportObject: node.layout.inputPortObject,\n\t\t\t\t\t\t\tportImage: node.layout.inputPortImage,\n\t\t\t\t\t\t\tportWidth: node.layout.inputPortWidth,\n\t\t\t\t\t\t\tportHeight: node.layout.inputPortHeight,\n\t\t\t\t\t\t\tportRadius: this.getPortRadius(srcNode),\n\t\t\t\t\t\t\tminInitialLine: srcNode.layout.minInitialLine,\n\t\t\t\t\t\t\tguideObject: node.layout.inputPortGuideObject,\n\t\t\t\t\t\t\tguideImage: node.layout.inputPortGuideImage,\n\t\t\t\t\t\t\tlinkArray: []\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.drawNewLink(d3Event);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseenter\", (d3Event, port) => {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event); // stop event propagation, otherwise node tip is shown\n\t\t\t\tif (this.canOpenTip(TIP_TYPE_PORT)) {\n\t\t\t\t\tthis.canvasController.closeTip();\n\t\t\t\t\tthis.canvasController.openTip({\n\t\t\t\t\t\tid: this.getId(\"node_port_tip\", port.id),\n\t\t\t\t\t\ttype: TIP_TYPE_PORT,\n\t\t\t\t\t\ttargetObj: d3Event.currentTarget,\n\t\t\t\t\t\tpipelineId: this.activePipeline.id,\n\t\t\t\t\t\tnode: node,\n\t\t\t\t\t\tport: port\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", () => {\n\t\t\t\tthis.canvasController.closeTip();\n\t\t\t})\n\t\t\t.on(\"contextmenu\", (d3Event, port) => {\n\t\t\t\tthis.logger.log(\"Input Port Circle - context menu\");\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t// With enableDragWithoutSelect set to true, the object for which the\n\t\t\t\t// context menu is being requested needs to be implicitely selected.\n\t\t\t\tif (this.config.enableDragWithoutSelect) {\n\t\t\t\t\tthis.selectObjectD3Event(d3Event, node);\n\t\t\t\t}\n\n\t\t\t\tthis.openContextMenu(d3Event, \"input_port\", node, port);\n\t\t\t});\n\t}\n\n\tattachOutputPortListeners(outputPorts, node) {\n\t\toutputPorts\n\t\t\t.on(\"mousedown\", (d3Event, port) => {\n\t\t\t\t// Make sure this is just a left mouse button click - we don't want context menu click starting a line being drawn\n\t\t\t\tif (d3Event.button === 0) {\n\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event); // Stops the node drag behavior when clicking on the handle/circle\n\t\t\t\t\tconst srcNode = this.activePipeline.getNode(node.id);\n\t\t\t\t\tif (!CanvasUtils.isSrcCardinalityAtMax(port.id, srcNode, this.activePipeline.links)) {\n\t\t\t\t\t\tthis.drawingNewLinkData = {\n\t\t\t\t\t\t\tsrcObjId: node.id,\n\t\t\t\t\t\t\tsrcPortId: port.id,\n\t\t\t\t\t\t\taction: this.config.enableAssocLinkCreation ? ASSOCIATION_LINK : NODE_LINK,\n\t\t\t\t\t\t\tsrcNode: srcNode,\n\t\t\t\t\t\t\tstartPos: { x: srcNode.x_pos + port.cx, y: srcNode.y_pos + port.cy },\n\t\t\t\t\t\t\tportType: \"output\",\n\t\t\t\t\t\t\tportObject: node.layout.outputPortObject,\n\t\t\t\t\t\t\tportImage: node.layout.outputPortImage,\n\t\t\t\t\t\t\tportWidth: node.layout.outputPortWidth,\n\t\t\t\t\t\t\tportHeight: node.layout.outputPortHeight,\n\t\t\t\t\t\t\tportRadius: this.getPortRadius(srcNode),\n\t\t\t\t\t\t\tminInitialLine: srcNode.layout.minInitialLine,\n\t\t\t\t\t\t\tguideObject: node.layout.outputPortGuideObject,\n\t\t\t\t\t\t\tguideImage: node.layout.outputPortGuideImage,\n\t\t\t\t\t\t\tlinkArray: []\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (this.config.enableHighlightUnavailableNodes) {\n\t\t\t\t\t\t\tthis.setUnavailableTargetNodesHighlighting(srcNode, port.id, this.activePipeline.links);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.drawNewLink(d3Event);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseenter\", (d3Event, port) => {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event); // stop event propagation, otherwise node tip is shown\n\t\t\t\tif (this.canOpenTip(TIP_TYPE_PORT)) {\n\t\t\t\t\tthis.canvasController.closeTip();\n\t\t\t\t\tthis.canvasController.openTip({\n\t\t\t\t\t\tid: this.getId(\"node_port_tip\", port.id),\n\t\t\t\t\t\ttype: TIP_TYPE_PORT,\n\t\t\t\t\t\ttargetObj: d3Event.currentTarget,\n\t\t\t\t\t\tpipelineId: this.activePipeline.id,\n\t\t\t\t\t\tnode: node,\n\t\t\t\t\t\tport: port\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", () => {\n\t\t\t\tthis.canvasController.closeTip();\n\t\t\t})\n\t\t\t.on(\"contextmenu\", (d3Event, port) => {\n\t\t\t\tthis.logger.log(\"Output Port Circle - context menu\");\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t// With enableDragWithoutSelect set to true, the object for which the\n\t\t\t\t// context menu is being requested needs to be implicitely selected.\n\t\t\t\tif (this.config.enableDragWithoutSelect) {\n\t\t\t\t\tthis.selectObjectD3Event(d3Event, node);\n\t\t\t\t}\n\t\t\t\tthis.openContextMenu(d3Event, \"output_port\", node, port);\n\t\t\t});\n\t}\n\n\t// Sets the d3-node-unavailable class on any node that is currently not\n\t// available for connection as a target node for the source node and port ID,\n\t// passed in, of the link being manipulated. srcNode and scrPortId may be\n\t// undefined if a detached link is being manipulated.\n\tsetUnavailableTargetNodesHighlighting(srcNode, srcPortId, links) {\n\t\tthis.getAllNodeGroupsSelection()\n\t\t\t.filter((trgNode) => !CanvasUtils.isTrgNodeAvailable(trgNode, srcNode, srcPortId, links))\n\t\t\t.classed(\"d3-node-unavailable\", true);\n\t}\n\n\t// Sets the d3-node-unavailable class on any node that is currently not\n\t// available for connection as a source node for the target node and port ID,\n\t// passed in, of the link being manipulated. trgNode and trgPortId may be\n\t// undefined if a detached link is being manipulated.\n\tsetUnavailableSourceNodesHighlighting(trgNode, trgPortId, links) {\n\t\tthis.getAllNodeGroupsSelection()\n\t\t\t.filter((srcNode) => !CanvasUtils.isSrcNodeAvailable(srcNode, trgNode, trgPortId, links))\n\t\t\t.classed(\"d3-node-unavailable\", true);\n\t}\n\n\t// Removes the d3-node-unavailable class from any node that currently has it.\n\tunsetUnavailableNodesHighlighting() {\n\t\tthis.getAllNodeGroupsSelection().classed(\"d3-node-unavailable\", false);\n\t}\n\n\tdisplayNodeLabelEditIcon(spanObj, node) {\n\t\tconst labelObj = spanObj.parentElement;\n\t\tconst foreignObj = labelObj.parentElement;\n\t\tconst nodeObj = foreignObj.parentElement;\n\t\tconst nodeGrpSel = d3.select(nodeObj);\n\t\tconst transform = this.nodeUtils.getNodeLabelEditIconTranslate(node, spanObj,\n\t\t\tthis.zoomTransform.k, this.config.enableDisplayFullLabelOnHover);\n\n\t\tthis.displayEditIcon(spanObj, nodeGrpSel, transform,\n\t\t\t(d3Event, d) => this.displayNodeLabelTextArea(d, d3Event.currentTarget.parentNode));\n\t}\n\n\t// Displays the edit icon for an editable decoration label.\n\t// obj can be either DEC_NODE or DEC_LINK.\n\tdisplayDecLabelEditIcon(spanObj, dec, obj, objType) {\n\t\tconst labelObj = spanObj.parentElement;\n\t\tconst foreignObj = labelObj.parentElement;\n\t\tconst decObj = foreignObj.parentElement;\n\t\tconst decGrpSel = d3.select(decObj);\n\t\tconst transform = this.decUtils.getDecLabelEditIconTranslate(\n\t\t\tdec, obj, objType, spanObj, this.zoomTransform.k);\n\n\t\tthis.displayEditIcon(spanObj, decGrpSel, transform,\n\t\t\t(d3Event, d) => this.displayDecLabelTextArea(dec, obj, objType, d3Event.currentTarget.parentNode));\n\t}\n\n\t// Displays the edit icon (which can be clicked to start editing) next\n\t// to an editable node label or editable text decoration\n\tdisplayEditIcon(spanObj, grpSel, transform, displayTextArea) {\n\t\tconst that = this;\n\n\t\tconst editIconGrpSel = grpSel.append(\"g\")\n\t\t\t.attr(\"class\", \"d3-label-edit-icon-group\")\n\t\t\t.attr(\"transform\", transform)\n\t\t\t.on(\"mouseenter\", function(d3Event, d) {\n\t\t\t\tthat.mouseOverLabelEditIcon = true;\n\t\t\t})\n\t\t\t.on(\"mouseleave\", function(d3Event, d) {\n\t\t\t\tthat.mouseOverLabelEditIcon = false;\n\t\t\t\tthat.hideEditIcon(this);\n\t\t\t})\n\t\t\t.on(\"click\", function(d3Event, d) {\n\t\t\t\tdisplayTextArea(d3Event, d);\n\t\t\t\tthat.mouseOverLabelEditIcon = false;\n\t\t\t\tthat.hideEditIcon(this);\n\t\t\t});\n\n\t\tconst EDIT_ICON_X_OFFSET = 5;\n\t\tconst EDIT_ICON_Y_OFFSET = -4;\n\t\tconst EDIT_ICON_POS_X = 4;\n\t\tconst EDIT_ICON_POS_Y = 4;\n\n\t\teditIconGrpSel\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"class\", \"d3-label-edit-icon-background1\")\n\t\t\t.attr(\"width\", 24 + EDIT_ICON_X_OFFSET)\n\t\t\t.attr(\"height\", 24)\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", EDIT_ICON_Y_OFFSET);\n\n\t\teditIconGrpSel\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"class\", \"d3-label-edit-icon-background2\")\n\t\t\t.attr(\"width\", 24)\n\t\t\t.attr(\"height\", 24)\n\t\t\t.attr(\"x\", EDIT_ICON_X_OFFSET)\n\t\t\t.attr(\"y\", EDIT_ICON_Y_OFFSET);\n\n\t\teditIconGrpSel\n\t\t\t.append(\"svg\")\n\t\t\t.attr(\"class\", \"d3-node-edit-label-icon\")\n\t\t\t.html(EDIT_ICON)\n\t\t\t.attr(\"width\", 16)\n\t\t\t.attr(\"height\", 16)\n\t\t\t.attr(\"x\", EDIT_ICON_X_OFFSET + EDIT_ICON_POS_X)\n\t\t\t.attr(\"y\", EDIT_ICON_Y_OFFSET + EDIT_ICON_POS_Y);\n\t}\n\n\thideEditIcon(spanObj) {\n\t\tif (!this.mouseOverLabelEditIcon) {\n\t\t\tconst labelObj = spanObj.parentElement;\n\t\t\tconst foreignObj = labelObj.parentElement;\n\t\t\tconst nodeObj = foreignObj.parentElement;\n\t\t\tconst nodeGrpSel = d3.select(nodeObj);\n\t\t\tnodeGrpSel.selectAll(\".d3-label-edit-icon-group\").remove();\n\t\t}\n\t}\n\n\t// Adds the object passed in to the set of selected objects using\n\t// the d3Event object passed in.\n\tselectObjectD3Event(d3Event, d) {\n\t\tthis.selectObject(\n\t\t\td,\n\t\t\td3Event.type,\n\t\t\td3Event.shiftKey,\n\t\t\tCanvasUtils.isCmndCtrlPressed(d3Event));\n\t}\n\n\t// Adds the object passed in to the set of selected objects using\n\t// the d3Event object's sourceEvent object.\n\tselectObjectSourceEvent(d3Event, d) {\n\t\tthis.selectObject(\n\t\t\td,\n\t\t\td3Event.type,\n\t\t\td3Event.sourceEvent.shiftKey,\n\t\t\tCanvasUtils.isCmndCtrlPressed(d3Event.sourceEvent));\n\t}\n\n\t// Performs required action for when either a comment, node or link is selected.\n\t// This may mean: simply selecting the object; or adding the object to the\n\t// currently selected set of objects; or even toggling the object's selection\n\t// off. This method also sends a SINGLE_CLICK action to the\n\t// clickActionHandler callback in the host application.\n\tselectObject(d, d3EventType, isShiftKeyPressed, isCmndCtrlPressed) {\n\t\tthis.canvasController.selectObject(d.id, isShiftKeyPressed, isCmndCtrlPressed, this.activePipeline.id);\n\n\t\t// Even though the single click message below should be emitted\n\t\t// from common canvas for comments, if we uncomment this line it prevents\n\t\t// the double click event going to the comment group object. This seems\n\t\t// to be a timing issue since the same problem is not evident with the\n\t\t// similar code for the node group object.\n\t\t// TODO - Issue 2465 - Find out why this problem occurs.\n\t\tconst objectTypeName = this.activePipeline.getObjectTypeName(d);\n\t\tif (objectTypeName === \"node\" || objectTypeName === \"link\") {\n\t\t\tthis.canvasController.clickActionHandler({\n\t\t\t\tclickType: d3EventType === \"contextmenu\" || this.ellipsisClicked ? \"SINGLE_CLICK_CONTEXTMENU\" : \"SINGLE_CLICK\",\n\t\t\t\tobjectType: objectTypeName,\n\t\t\t\tid: d.id,\n\t\t\t\tselectedObjectIds: this.activePipeline.getSelectedObjectIds(),\n\t\t\t\tpipelineId: this.activePipeline.id });\n\t\t\tthis.ellipsisClicked = false;\n\t\t}\n\t}\n\n\t// Displays a set of decorations on either a node or link object.\n\t// d       - This is a node or link object.\n\t// objType - A string set to either DEC_NODE or DEC_LINK.\n\t// trgGrp  - A D3 selection object that references the node or link to\n\t//           which the decorations are to be attached.\n\t// decs    - An array of decorations to be applied to the node or link.\n\t//           This is a combination of the object's decorations with any\n\t//           decorations from the layout config information.\n\tdisplayDecorations(d, objType, trgGrp, decs) {\n\t\tconst that = this;\n\t\tconst decorations = decs || [];\n\t\tconst decGrpClassName = `d3-${objType}-dec-group`;\n\t\tconst decGrpSelector = \".\" + decGrpClassName;\n\t\ttrgGrp.selectChildren(decGrpSelector)\n\t\t\t.data(decorations, (dec) => dec.id)\n\t\t\t.join(\n\t\t\t\t(enter) => this.createDecorations(enter, objType, decGrpClassName)\n\t\t\t)\n\t\t\t.attr(\"transform\", (dec) => this.decUtils.getDecTransform(dec, d, objType))\n\t\t\t.on(\"mousedown\", (d3Event, dec) => (dec.hotspot ? that.callDecoratorCallback(d3Event, d, dec) : null))\n\t\t\t.each((dec, i, elements) => this.updateDecoration(dec, d3.select(elements[i]), objType, d));\n\t}\n\n\tcreateDecorations(enter, objType, decGrpClassName) {\n\t\tconst newDecGroups = enter\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"data-id\", (dec) => this.getId(`${objType}_dec_group`, dec.id)) // Used in tests\n\t\t\t.attr(\"class\", decGrpClassName)\n\t\t\t.call(this.attachDecGroupListeners.bind(this));\n\n\t\treturn newDecGroups;\n\t}\n\n\tupdateDecoration(dec, decSel, objType, d) {\n\t\tthis.updateDecOutlines(dec, decSel, objType, d);\n\t\tthis.updateDecPaths(dec, decSel, objType);\n\t\tthis.updateDecImages(dec, decSel, objType, d);\n\t\tthis.updateDecLabels(dec, decSel, objType, d);\n\t}\n\n\tupdateDecOutlines(dec, decSel, objType, d) {\n\t\tlet outlnSel = decSel.selectChild(\"rect\");\n\n\t\tif (!dec.label && !dec.path && dec.outline !== false) {\n\t\t\toutlnSel = outlnSel.empty() ? decSel.append(\"rect\") : outlnSel;\n\t\t\toutlnSel\n\t\t\t\t.attr(\"class\", this.decUtils.getDecClass(dec, `d3-${objType}-dec-outline`))\n\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t.attr(\"y\", 0)\n\t\t\t\t.attr(\"width\", this.decUtils.getDecWidth(dec, d, objType))\n\t\t\t\t.attr(\"height\", this.decUtils.getDecHeight(dec, d, objType))\n\t\t\t\t.lower(); // Make sure the outline goes below the image\n\t\t} else {\n\t\t\toutlnSel.remove();\n\t\t}\n\t}\n\n\tupdateDecPaths(dec, decSel, objType) {\n\t\tlet pathSel = decSel.selectChild(\"path\");\n\n\t\tif (dec.path) {\n\t\t\tpathSel = pathSel.empty() ? decSel.append(\"path\") : pathSel;\n\t\t\tpathSel\n\t\t\t\t.attr(\"class\", this.decUtils.getDecClass(dec, `d3-${objType}-dec-path`))\n\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t.attr(\"y\", 0)\n\t\t\t\t.attr(\"d\", dec.path);\n\t\t} else {\n\t\t\tpathSel.remove();\n\t\t}\n\t}\n\n\tupdateDecImages(dec, decSel, objType, d) {\n\t\tlet imageSel = decSel.selectChild(\"g\");\n\n\t\tif (dec.image) {\n\t\t\tconst nodeImageType = this.getImageType(dec.image);\n\t\t\timageSel = imageSel.empty() ? decSel.append(\"g\").append(nodeImageType) : imageSel.select(nodeImageType);\n\t\t\timageSel\n\t\t\t\t.attr(\"class\", this.decUtils.getDecClass(dec, `d3-${objType}-dec-image`))\n\t\t\t\t.attr(\"x\", this.decUtils.getDecPadding(dec, d, objType))\n\t\t\t\t.attr(\"y\", this.decUtils.getDecPadding(dec, d, objType))\n\t\t\t\t.attr(\"width\", this.decUtils.getDecWidth(dec, d, objType) - (2 * this.decUtils.getDecPadding(dec, d, objType)))\n\t\t\t\t.attr(\"height\", this.decUtils.getDecHeight(dec, d, objType) - (2 * this.decUtils.getDecPadding(dec, d, objType)))\n\t\t\t\t.each(() => this.setImageContent(imageSel, dec.image));\n\t\t} else {\n\t\t\timageSel.remove();\n\t\t}\n\t}\n\n\tupdateDecLabels(dec, decSel, objType, d) {\n\t\tlet labelSel = decSel.selectChild(\"foreignObject\");\n\n\t\tif (dec.label) {\n\t\t\tif (labelSel.empty()) {\n\t\t\t\tlabelSel = decSel\n\t\t\t\t\t.append(\"foreignObject\")\n\t\t\t\t\t.attr(\"class\", \"d3-foreign-object-dec-label\")\n\t\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t\t.attr(\"y\", 0)\n\t\t\t\t\t.call(this.attachDecLabelListeners.bind(this, d, objType));\n\t\t\t\tlabelSel\n\t\t\t\t\t.append(\"xhtml:div\")\n\t\t\t\t\t.append(\"xhtml:span\")\n\t\t\t\t\t.call(this.attachDecLabelSpanListeners.bind(this, d, objType));\n\t\t\t}\n\t\t\tlabelSel\n\t\t\t\t.attr(\"width\", this.decUtils.getDecLabelWidth(dec, d, objType))\n\t\t\t\t.attr(\"height\", this.decUtils.getDecLabelHeight(dec, d, objType))\n\t\t\t\t.select(\"div\")\n\t\t\t\t.attr(\"class\", this.decUtils.getDecLabelClass(dec, objType))\n\t\t\t\t.select(\"span\")\n\t\t\t\t.html(escapeText(dec.label));\n\t\t} else {\n\t\t\tlabelSel.remove();\n\t\t}\n\t}\n\n\tattachDecLabelListeners(obj, objType, decLabels) {\n\t\tdecLabels\n\t\t\t.on(\"dblclick\", (d3Event, dec) => {\n\t\t\t\tthis.logger.log(\"Decoration Label - double click\");\n\t\t\t\tif (dec.label_editable && this.config.enableEditingActions) {\n\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t\tthis.displayDecLabelTextArea(dec, obj, objType, d3Event.currentTarget.parentNode);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tattachDecLabelSpanListeners(obj, objType, decLabelSpans) {\n\t\tdecLabelSpans\n\t\t\t.on(\"mouseenter\", (d3Event, dec) => {\n\t\t\t\tif (dec.label_editable && this.config.enableEditingActions) {\n\t\t\t\t\tthis.displayDecLabelEditIcon(d3Event.currentTarget, dec, obj, objType);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", (d3Event, dec) => {\n\t\t\t\tif (dec.label_editable && this.config.enableEditingActions) {\n\t\t\t\t\t// Wait half a sec to let the user get the pointer into the edit icon, otherwise it is closed immediately.\n\t\t\t\t\tthis.hideEditIconPending = setTimeout(this.hideEditIcon.bind(this), 500, d3Event.currentTarget, dec);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tattachDecGroupListeners(decGrps) {\n\t\tdecGrps\n\t\t\t.on(\"mouseenter\", (d3Event, dec) => {\n\t\t\t\tif (this.canOpenTip(TIP_TYPE_DEC)) {\n\t\t\t\t\tthis.canvasController.closeTip(); // Ensure any existing tip is removed\n\t\t\t\t\tthis.canvasController.openTip({\n\t\t\t\t\t\tid: this.getId(\"dec_tip\", dec.id),\n\t\t\t\t\t\ttype: TIP_TYPE_DEC,\n\t\t\t\t\t\ttargetObj: d3Event.currentTarget,\n\t\t\t\t\t\tpipelineId: this.activePipeline.id,\n\t\t\t\t\t\tdecoration: dec\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", (d3Event, d) => {\n\t\t\t\tthis.canvasController.closeTip();\n\t\t\t});\n\t}\n\n\taddErrorMarker(d, nodeGrp) {\n\t\tconst errorMarkerSelection = nodeGrp.selectChildren(\".node-error-marker\");\n\n\t\tif (d.messages && d.messages.length > 0) {\n\t\t\tif (errorMarkerSelection.empty()) {\n\t\t\t\tnodeGrp\n\t\t\t\t\t.append(\"svg\")\n\t\t\t\t\t.attr(\"class\", \"node-error-marker\"); // Need to set this so following selection will work\n\t\t\t}\n\n\t\t\tnodeGrp.selectChildren(\".node-error-marker\")\n\t\t\t\t.attr(\"class\", () => \"node-error-marker \" + this.nodeUtils.getErrorMarkerClass(d.messages))\n\t\t\t\t.html(this.nodeUtils.getErrorMarkerIcon(d))\n\t\t\t\t.attr(\"width\", this.nodeUtils.getNodeErrorWidth(d))\n\t\t\t\t.attr(\"height\", this.nodeUtils.getNodeErrorHeight(d))\n\t\t\t\t.attr(\"x\", this.nodeUtils.getNodeErrorPosX(d))\n\t\t\t\t.attr(\"y\", this.nodeUtils.getNodeErrorPosY(d));\n\n\t\t} else {\n\t\t\tif (!errorMarkerSelection.empty()) {\n\t\t\t\terrorMarkerSelection.remove();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetNodeInputPortClassName() {\n\t\tif (this.config.enableAssocLinkCreation) {\n\t\t\treturn \"d3-node-port-input-assoc\";\n\t\t}\n\t\treturn \"d3-node-port-input\";\n\t}\n\n\tgetNodeOutputPortClassName() {\n\t\tif (this.config.enableAssocLinkCreation) {\n\t\t\treturn \"d3-node-port-output-assoc\";\n\t\t}\n\t\treturn \"d3-node-port-output\";\n\t}\n\n\t// Sets the image specified in the node passed in into the DOM image object\n\t// passed in.\n\tsetNodeImageContent(imageObj, node) {\n\t\tconst nodeImage = this.getNodeImage(node);\n\t\tconst imageSel = d3.select(imageObj);\n\t\tthis.setImageContent(imageSel, nodeImage);\n\t}\n\n\t// Sets the image passed in into the D3 image selection passed in. This loads\n\t// svg files as inline SVG while other image files are loaded with href.\n\tsetImageContent(imageSel, image) {\n\t\tif (image !== imageSel.attr(\"data-image\")) {\n\t\t\tconst nodeImageType = this.getImageType(image);\n\t\t\t// Save image field in DOM object to avoid unnecessary image refreshes.\n\t\t\timageSel.attr(\"data-image\", image);\n\t\t\tif (nodeImageType === \"svg\") {\n\t\t\t\timageSel.selectChild(\"svg\").remove();\n\t\t\t\td3.svg(image, { cache: \"force-cache\" }).then((data) => {\n\t\t\t\t\timageSel.node().append(data.documentElement);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\timageSel.attr(\"xlink:href\", image);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Returns the appropriate image from the object (either node or decoration)\n\t// passed in.\n\tgetNodeImage(d) {\n\t\tif (!d.image) {\n\t\t\treturn null;\n\t\t} else if (d.image === USE_DEFAULT_ICON) {\n\t\t\tif (CanvasUtils.isSupernode(d)) {\n\t\t\t\treturn SUPERNODE_ICON;\n\t\t\t}\n\t\t} else if (d.image === USE_DEFAULT_EXT_ICON) {\n\t\t\tif (CanvasUtils.isSupernode(d)) {\n\t\t\t\treturn SUPERNODE_EXT_ICON;\n\t\t\t}\n\t\t}\n\t\treturn d.image;\n\t}\n\n\t// Returns the type of image passed in, either \"svg\" or \"image\". This will\n\t// be used to append an svg or image element to the DOM.\n\tgetImageType(nodeImage) {\n\t\treturn nodeImage && nodeImage.endsWith(\".svg\") ? \"svg\" : \"image\";\n\t}\n\n\tsetNodeStyles(d, type, nodeGrp) {\n\t\tthis.setNodeBodyStyles(d, type, nodeGrp);\n\t\tthis.setNodeSelectionOutlineStyles(d, type, nodeGrp);\n\t\tthis.setNodeImageStyles(d, type, nodeGrp);\n\t\tthis.setNodeLabelStyles(d, type, nodeGrp);\n\t}\n\n\tsetNodeBodyStyles(d, type, nodeGrp) {\n\t\tconst style = this.getNodeBodyStyle(d, type);\n\t\tnodeGrp.selectChildren(\".d3-node-body-outline\").attr(\"style\", style);\n\t}\n\n\tsetNodeSelectionOutlineStyles(d, type, nodeGrp) {\n\t\tconst style = this.getNodeSelectionOutlineStyle(d, type);\n\t\tnodeGrp.selectChildren(\".d3-node-selection-highlight\").attr(\"style\", style);\n\t}\n\n\tsetNodeImageStyles(d, type, nodeGrp) {\n\t\tconst style = this.getNodeImageStyle(d, type);\n\t\tnodeGrp.selectChildren(\".d3-node-image\").attr(\"style\", style);\n\t}\n\n\tsetNodeLabelStyles(d, type, nodeGrp) {\n\t\tconst style = this.getNodeLabelStyle(d, type);\n\t\tnodeGrp.selectChildren(\".d3-node-label\").attr(\"style\", style);\n\t}\n\n\tgetNodeBodyStyle(d, type) {\n\t\tlet style = CanvasUtils.getObjectStyle(d, \"body\", type);\n\t\t// For port-arcs display we reapply the drop shadow if no style is provided\n\t\tif (style === null && d.layout.dropShadow) {\n\t\t\tstyle = `filter:url(${this.getId(\"#node_drop_shadow\")})`;\n\t\t}\n\t\treturn style;\n\t}\n\n\tgetNodeSelectionOutlineStyle(d, type) {\n\t\treturn CanvasUtils.getObjectStyle(d, \"selection_outline\", type);\n\t}\n\n\tgetNodeImageStyle(d, type) {\n\t\treturn CanvasUtils.getObjectStyle(d, \"image\", type);\n\t}\n\n\tgetNodeLabelStyle(d, type) {\n\t\treturn CanvasUtils.getObjectStyle(d, \"label\", type);\n\t}\n\n\tgetNodeGrpStyle(d) {\n\t\treturn !d.style_temp && !d.style && this.canvasInfo.subdueStyle && !this.doesExpandedSupernodeHaveStyledNodes(d)\n\t\t\t? this.canvasInfo.subdueStyle\n\t\t\t: null;\n\t}\n\n\tgetLinkGrpStyle(d) {\n\t\treturn !d.style_temp && !d.style && this.canvasInfo.subdueStyle\n\t\t\t? this.canvasInfo.subdueStyle\n\t\t\t: null;\n\t}\n\n\tdoesExpandedSupernodeHaveStyledNodes(d) {\n\t\tlet expandedSupernodeHaveStyledNodes = false;\n\t\tif (CanvasUtils.isExpandedSupernode(d) && d.subflow_ref && d.subflow_ref.pipeline_id_ref) {\n\t\t\tconst subflow = new SVGCanvasPipeline(d.subflow_ref.pipeline_id_ref, this.canvasInfo);\n\t\t\tconst nodeGrp = subflow.nodes;\n\t\t\tnodeGrp.forEach((node) => {\n\t\t\t\tif (node.style || node.style_temp) {\n\t\t\t\t\texpandedSupernodeHaveStyledNodes = true;\n\t\t\t\t\treturn;\n\t\t\t\t} else if (!expandedSupernodeHaveStyledNodes && CanvasUtils.isExpandedSupernode(node)) {\n\t\t\t\t\texpandedSupernodeHaveStyledNodes = this.doesExpandedSupernodeHaveStyledNodes(node);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn expandedSupernodeHaveStyledNodes;\n\t}\n\n\t// Returns the maximum amount for padding, when zooming to fit the canvas\n\t// objects within a subflow, to allow the connection lines to be displayed\n\t// without them doubling back on themselves.\n\tgetMaxZoomToFitPaddingForConnections() {\n\t\tconst paddingForInputBinding = this.getMaxPaddingForConnectionsFromInputBindingNodes();\n\t\tconst paddingForOutputBinding = this.getMaxPaddingForConnectionsToOutputBindingNodes();\n\t\tconst padding = Math.max(paddingForInputBinding, paddingForOutputBinding);\n\t\treturn padding;\n\t}\n\n\t// Returns the maximum amount for padding, when zooming to fit the canvas\n\t// objects within a subflow, to allow the connection lines (from input binding\n\t// nodes to other sub-flow nodes) to be displayed without them doubling back\n\t// on themselves.\n\tgetMaxPaddingForConnectionsFromInputBindingNodes() {\n\t\tlet maxPadding = 0;\n\t\tconst inputBindingNodes = this.activePipeline.nodes.filter((n) => n.isSupernodeInputBinding);\n\n\t\tinputBindingNodes.forEach((n) => {\n\t\t\tconst nodePadding = CanvasUtils.getNodePaddingToTargetNodes(n, this.activePipeline.nodes,\n\t\t\t\tthis.activePipeline.links, this.canvasLayout.linkType);\n\t\t\tmaxPadding = Math.max(maxPadding, nodePadding);\n\t\t});\n\n\t\treturn maxPadding;\n\t}\n\n\t// Returns the maximum amount for padding, when zooming to fit the canvas\n\t// objects within a subflow, to allow the connection lines (from sub-flow nodes\n\t// to output binding nodes) to be displayed without them doubling back\n\t// on themselves.\n\tgetMaxPaddingForConnectionsToOutputBindingNodes() {\n\t\tlet maxPadding = 0;\n\t\tconst outputBindingNodes = this.activePipeline.nodes.filter((n) => n.isSupernodeOutputBinding);\n\n\t\tthis.activePipeline.nodes.forEach((n) => {\n\t\t\tconst nodePadding = CanvasUtils.getNodePaddingToTargetNodes(n, outputBindingNodes,\n\t\t\t\tthis.activePipeline.links, this.canvasLayout.linkType);\n\t\t\tmaxPadding = Math.max(maxPadding, nodePadding);\n\t\t});\n\n\t\treturn maxPadding;\n\t}\n\n\tgetPortRadius(d) {\n\t\treturn CanvasUtils.isSuperBindingNode(d) ? this.getBindingPortRadius() : d.layout.portRadius;\n\t}\n\n\t// Returns the radius size of the supernode binding ports scaled up by\n\t// the zoom scale amount to give the actual size.\n\tgetBindingPortRadius() {\n\t\treturn this.canvasLayout.supernodeBindingPortRadius / this.zoomTransform.k;\n\t}\n\n\taddDynamicNodeIcons(d, nodeGrp) {\n\t\tif (!this.nodeSizing && !CanvasUtils.isSuperBindingNode(d)) {\n\n\t\t\tconst ellipsisGrp = nodeGrp\n\t\t\t\t.append(\"g\")\n\t\t\t\t.filter(() => d.layout.ellipsisDisplay)\n\t\t\t\t.attr(\"class\", \"d3-node-ellipsis-group\")\n\t\t\t\t.attr(\"transform\", (nd) => this.nodeUtils.getNodeEllipsisTranslate(nd))\n\t\t\t\t.on(\"mousedown\", (d3Event) => {\n\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t\tthis.ellipsisClicked = true;\n\t\t\t\t\tif (!this.config.enableDragWithoutSelect) {\n\t\t\t\t\t\tthis.selectObjectD3Event(d3Event, d);\n\t\t\t\t\t}\n\t\t\t\t\tif (this.canvasController.isContextMenuDisplayed()) {\n\t\t\t\t\t\tthis.canvasController.closeContextMenu();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst rect = ellipsisGrp.node().getBoundingClientRect();\n\t\t\t\t\t\tconst rect2 = this.canvasSVG.node().getBoundingClientRect();\n\t\t\t\t\t\tconst pos = { x: rect.left - rect2.left, y: rect.bottom - rect2.top };\n\t\t\t\t\t\tthis.openContextMenu(d3Event, \"node\", d, null, pos);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tellipsisGrp\n\t\t\t\t.append(\"rect\")\n\t\t\t\t.attr(\"class\", \"d3-node-ellipsis-background\")\n\t\t\t\t.attr(\"width\", (nd) => this.nodeUtils.getNodeEllipsisWidth(nd))\n\t\t\t\t.attr(\"height\", (nd) => this.nodeUtils.getNodeEllipsisHeight(nd))\n\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t.attr(\"y\", 0);\n\n\t\t\tellipsisGrp\n\t\t\t\t.append(\"svg\")\n\t\t\t\t.attr(\"class\", \"d3-node-ellipsis\")\n\t\t\t\t.html(NODE_MENU_ICON)\n\t\t\t\t.attr(\"width\", (nd) => this.nodeUtils.getNodeEllipsisIconWidth(nd))\n\t\t\t\t.attr(\"height\", (nd) => this.nodeUtils.getNodeEllipsisIconHeight(nd))\n\t\t\t\t.attr(\"x\", (nd) => nd.layout.ellipsisHoverAreaPadding)\n\t\t\t\t.attr(\"y\", (nd) => nd.layout.ellipsisHoverAreaPadding);\n\n\n\t\t\t// Add Supernode expansion icon and background for expanded supernodes\n\t\t\tif (CanvasUtils.isExpandedSupernode(d)) {\n\t\t\t\tconst expGrp = nodeGrp\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"transform\", (nd) => this.nodeUtils.getNodeExpansionIconTranslate(nd))\n\t\t\t\t\t.attr(\"class\", \"d3-node-super-expand-icon-group\")\n\t\t\t\t\t.on(\"mousedown\", (d3Event) => {\n\t\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t\t\tconst breadcrumbs = this.getSupernodeBreadcrumbs(d3Event.currentTarget);\n\t\t\t\t\t\tthis.canvasController.displaySubPipelineForBreadcrumbs(breadcrumbs);\n\t\t\t\t\t})\n\t\t\t\t\t.on(\"mouseenter\", function() { // Use function keyword so 'this' pointer references the DOM text object\n\t\t\t\t\t\td3.select(this).attr(\"data-pointer-hover\", \"yes\");\n\t\t\t\t\t})\n\t\t\t\t\t.on(\"mouseleave\", function() { // Use function keyword so 'this' pointer references the DOM text object\n\t\t\t\t\t\td3.select(this).attr(\"data-pointer-hover\", \"no\");\n\t\t\t\t\t});\n\n\t\t\t\texpGrp\n\t\t\t\t\t.append(\"rect\")\n\t\t\t\t\t.attr(\"class\", \"d3-node-super-expand-icon-background\")\n\t\t\t\t\t.attr(\"width\", this.canvasLayout.supernodeExpansionIconWidth)\n\t\t\t\t\t.attr(\"height\", this.canvasLayout.supernodeExpansionIconHeight)\n\t\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t\t.attr(\"y\", 0);\n\n\t\t\t\texpGrp\n\t\t\t\t\t.append(\"svg\")\n\t\t\t\t\t.attr(\"class\", \"d3-node-super-expand-icon\")\n\t\t\t\t\t.html(SUPER_NODE_EXPAND_ICON)\n\t\t\t\t\t.attr(\"width\", this.canvasLayout.supernodeExpansionIconWidth - (2 * this.canvasLayout.supernodeExpansionIconHoverAreaPadding))\n\t\t\t\t\t.attr(\"height\", this.canvasLayout.supernodeExpansionIconHeight - (2 * this.canvasLayout.supernodeExpansionIconHoverAreaPadding))\n\t\t\t\t\t.attr(\"x\", this.canvasLayout.supernodeExpansionIconHoverAreaPadding)\n\t\t\t\t\t.attr(\"y\", this.canvasLayout.supernodeExpansionIconHoverAreaPadding);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Returns an array of breadcrumbs for the DOM element passed in. The DOM\n\t// element is expected to be an element within a node (like the expansion\n\t// icon). The output array will contain one breadcrumb for each nested\n\t// supernode down to the supernode of which the DOM element is a part. So if\n\t// there are three nested supernodes and the DOM element is part of the third\n\t// one, the breadcrumbs array will have three elements.\n\tgetSupernodeBreadcrumbs(domEl) {\n\t\tconst breadcrumbs = [];\n\n\t\tlet nodeGroupEl = domEl.closest(\".d3-node-group\");\n\n\t\twhile (nodeGroupEl) {\n\t\t\tconst svgAreaEl = nodeGroupEl.closest(\".svg-area\");\n\t\t\tconst supernodeDatum = this.getD3DatumFromDomEl(nodeGroupEl);\n\t\t\tconst parentPipelineId = svgAreaEl.getAttribute(\"data-pipeline-id\");\n\n\t\t\tbreadcrumbs.push(\n\t\t\t\tthis.canvasController.createBreadcrumb(supernodeDatum, parentPipelineId)\n\t\t\t);\n\n\t\t\tnodeGroupEl = svgAreaEl.closest(\".d3-node-group\");\n\t\t}\n\n\t\t// Reverse the order, so they appear in the nesting order of the supernodes.\n\t\treturn breadcrumbs.reverse();\n\t}\n\n\t// Returns the datum object (managd by D3) for the DOM element passed in.\n\tgetD3DatumFromDomEl(el) {\n\t\tconst sel = d3.select(el);\n\t\tif (sel) {\n\t\t\treturn sel.datum();\n\t\t}\n\t\treturn null;\n\t}\n\n\tupdatePortRadiusAndPos(nodeObj, node, portObjClassName) {\n\t\tconst nodeGrp = d3.select(nodeObj);\n\t\tnodeGrp.selectAll(\".\" + portObjClassName)\n\t\t\t.attr(\"r\", () => this.getPortRadius(node))\n\t\t\t.attr(\"cx\", (port) => port.cx)\n\t\t\t.attr(\"cy\", (port) => port.cy); // Port position may change for binding nodes with multiple-ports.\n\t}\n\n\tupdatePortArrowPath(nodeObj, portArrowClassName) {\n\t\tconst nodeGrp = d3.select(nodeObj);\n\t\tnodeGrp.selectAll(\".\" + portArrowClassName)\n\t\t\t.attr(\"d\", (port) => this.getPortArrowPath(port))\n\t\t\t.attr(\"transform\", (port) => this.getPortArrowPathTransform(port));\n\t}\n\n\t// Returns true if the port (from a node template) passed in has a max\n\t// cardinaility of zero. If cardinality or cardinality.max is missing the\n\t// max is considered to be non-zero.\n\tisPortMaxCardinalityZero(port) {\n\t\treturn (get(port, \"app_data.ui_data.cardinality.max\", 1) === 0);\n\t}\n\n\tremoveDynamicNodeIcons(d, nodeGrp) {\n\t\tif (d.layout.ellipsisDisplay) {\n\t\t\tnodeGrp.selectChildren(\".d3-node-ellipsis-group\").remove();\n\t\t}\n\t\tnodeGrp.selectChildren(\".d3-node-super-expand-icon-group\").remove();\n\t}\n\n\tcreateSupernodeRenderer(d, supernodeD3Object) {\n\t\tif (d.subflow_ref && d.subflow_ref.pipeline_id_ref) {\n\t\t\tconst superRenderer = new SVGCanvasRenderer(\n\t\t\t\td.subflow_ref.pipeline_id_ref,\n\t\t\t\tthis.canvasDiv,\n\t\t\t\tthis.canvasController,\n\t\t\t\tthis.canvasInfo,\n\t\t\t\tthis.selectionInfo,\n\t\t\t\tthis.breadcrumbs,\n\t\t\t\tthis.nodeLayout,\n\t\t\t\tthis.canvasLayout,\n\t\t\t\tthis.config,\n\t\t\t\t{ id: d.id,\n\t\t\t\t\tpipelineId: this.activePipeline.id,\n\t\t\t\t\trenderer: this, // Only provided for in-place sub-flow\n\t\t\t\t\td3Selection: supernodeD3Object // Only provided for in-place sub-flow\n\t\t\t\t});\n\t\t\treturn superRenderer;\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Returns the renderer for the supernode passed in. With external\n\t// pipeline handling the pipeline referencd by the supernode can change\n\t// over time so we have to make sure the renderer is for the supernode AND\n\t// for the active pipeline.\n\tgetRendererForSupernode(d) {\n\t\treturn this.superRenderers.find((sr) =>\n\t\t\tsr.supernodeInfo.id === d.id && sr.activePipeline.id === d.subflow_ref.pipeline_id_ref);\n\t}\n\n\t// Returns an array containing any renderers that are for the supernode passed\n\t// in but where the supernode does NOT reference the renderer's active pipeline.\n\tgetDiscardedRenderersForSupernode(d) {\n\t\treturn this.superRenderers.filter((sr) =>\n\t\t\tsr.supernodeInfo.id === d.id && sr.activePipeline.id !== d.subflow_ref.pipeline_id_ref);\n\n\t}\n\n\topenContextMenu(d3Event, type, d, port, pos) {\n\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event); // Stop the browser context menu appearing\n\t\tthis.canvasController.contextMenuHandler({\n\t\t\ttype: type,\n\t\t\ttargetObject: type === \"canvas\" ? null : d,\n\t\t\tid: type === \"canvas\" ? null : d.id, // For historical puposes, we pass d.id as well as d as targetObject.\n\t\t\tpipelineId: this.activePipeline.id,\n\t\t\tcmPos: pos\n\t\t\t\t? pos\n\t\t\t\t: this.getMousePos(d3Event, this.canvasDiv.selectAll(\"svg\")), // Get mouse pos relative to top most SVG area even in a subflow.\n\t\t\tmousePos: this.getMousePosSnapToGrid(this.getTransformedMousePos(d3Event)),\n\t\t\tselectedObjectIds: this.activePipeline.getSelectedObjectIds(),\n\t\t\taddBreadcrumbs: (d && d.type === SUPER_NODE) ? this.getSupernodeBreadcrumbs(d3Event.currentTarget) : null,\n\t\t\tport: port,\n\t\t\tzoom: this.zoomTransform.k });\n\t}\n\n\tcloseContextMenuIfOpen() {\n\t\tif (this.canvasController.isContextMenuDisplayed()) {\n\t\t\tthis.canvasController.closeContextMenu();\n\t\t}\n\t}\n\n\tcallDecoratorCallback(d3Event, node, dec) {\n\t\td3Event.stopPropagation();\n\t\tif (this.canvasController.decorationActionHandler) {\n\t\t\tthis.canvasController.decorationActionHandler(node, dec.id, this.activePipeline.id);\n\t\t}\n\t}\n\n\tdrawNewLink(d3Event) {\n\t\tif (this.config.enableEditingActions === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.closeContextMenuIfOpen();\n\n\t\tconst transPos = this.getTransformedMousePos(d3Event);\n\n\t\tif (this.drawingNewLinkData.action === COMMENT_LINK) {\n\t\t\tthis.drawNewCommentLinkForPorts(transPos);\n\t\t} else {\n\t\t\tthis.drawNewNodeLinkForPorts(transPos);\n\t\t}\n\t\t// Switch on an attribute to indicate a new link is being dragged\n\t\t// towards and over a target node.\n\t\tif (this.config.enableHighlightNodeOnNewLinkDrag) {\n\t\t\tthis.setNewLinkOverNode(d3Event);\n\t\t}\n\t}\n\n\tdrawNewNodeLinkForPorts(transPos) {\n\t\tvar that = this;\n\t\tconst linkType = this.config.enableAssocLinkCreation ? ASSOCIATION_LINK : NODE_LINK;\n\n\t\tlet startPos;\n\t\tif (this.canvasLayout.linkType === LINK_TYPE_STRAIGHT) {\n\t\t\tstartPos = this.linkUtils.getNewStraightNodeLinkStartPos(this.drawingNewLinkData.srcNode, transPos);\n\t\t} else {\n\t\t\tstartPos = {\n\t\t\t\tx: this.drawingNewLinkData.startPos.x,\n\t\t\t\ty: this.drawingNewLinkData.startPos.y };\n\t\t}\n\n\t\tthis.drawingNewLinkData.linkArray = [{\n\t\t\t\"x1\": startPos.x,\n\t\t\t\"y1\": startPos.y,\n\t\t\t\"x2\": transPos.x,\n\t\t\t\"y2\": transPos.y,\n\t\t\t\"originX\": startPos.originX,\n\t\t\t\"originY\": startPos.originY,\n\t\t\t\"type\": linkType }];\n\n\t\tif (this.config.enableAssocLinkCreation) {\n\t\t\tthis.drawingNewLinkData.linkArray[0].assocLinkVariation =\n\t\t\t\tthis.getNewLinkAssocVariation(\n\t\t\t\t\tthis.drawingNewLinkData.linkArray[0].x1,\n\t\t\t\t\tthis.drawingNewLinkData.linkArray[0].x2,\n\t\t\t\t\tthis.drawingNewLinkData.portType);\n\t\t}\n\n\t\tconst pathInfo = this.linkUtils.getConnectorPathInfo(\n\t\t\tthis.drawingNewLinkData.linkArray[0], this.drawingNewLinkData.minInitialLine);\n\n\t\tconst connectionLineSel = this.nodesLinksGrp.selectAll(\".d3-new-connection-line\");\n\t\tconst connectionStartSel = this.nodesLinksGrp.selectAll(\".d3-new-connection-start\");\n\t\tconst connectionGuideSel = this.nodesLinksGrp.selectAll(\".d3-new-connection-guide\");\n\n\t\t// For a straight node line, don't draw the new link line when the guide\n\t\t// icon or object is inside the node boundary.\n\t\tif (linkType === NODE_LINK &&\n\t\t\t\tthis.canvasLayout.linkType === LINK_TYPE_STRAIGHT &&\n\t\t\t\tthis.nodeUtils.isPointInNodeBoundary(transPos, this.drawingNewLinkData.srcNode)) {\n\t\t\tthis.removeNewLinkLine();\n\n\t\t} else {\n\t\t\tconnectionLineSel\n\t\t\t\t.data(this.drawingNewLinkData.linkArray)\n\t\t\t\t.enter()\n\t\t\t\t.append(\"path\")\n\t\t\t\t.attr(\"class\", \"d3-new-connection-line\")\n\t\t\t\t.attr(\"linkType\", linkType)\n\t\t\t\t.merge(connectionLineSel)\n\t\t\t\t.attr(\"d\", pathInfo.path)\n\t\t\t\t.attr(\"transform\", pathInfo.transform);\n\t\t}\n\n\t\tif (this.canvasLayout.linkType !== LINK_TYPE_STRAIGHT) {\n\t\t\tconnectionStartSel\n\t\t\t\t.data(this.drawingNewLinkData.linkArray)\n\t\t\t\t.enter()\n\t\t\t\t.append(this.drawingNewLinkData.portObject)\n\t\t\t\t.attr(\"class\", \"d3-new-connection-start\")\n\t\t\t\t.attr(\"linkType\", linkType)\n\t\t\t\t.merge(connectionStartSel)\n\t\t\t\t.each(function(d) {\n\t\t\t\t\t// No need to draw the starting object of the new line if it is an image.\n\t\t\t\t\tif (that.drawingNewLinkData.portObject === PORT_OBJECT_CIRCLE) {\n\t\t\t\t\t\td3.select(this)\n\t\t\t\t\t\t\t.attr(\"cx\", d.x1)\n\t\t\t\t\t\t\t.attr(\"cy\", d.y1)\n\t\t\t\t\t\t\t.attr(\"r\", that.drawingNewLinkData.portRadius);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\n\t\tconnectionGuideSel\n\t\t\t.data(this.drawingNewLinkData.linkArray)\n\t\t\t.enter()\n\t\t\t.append(this.drawingNewLinkData.guideObject)\n\t\t\t.attr(\"class\", \"d3-new-connection-guide\")\n\t\t\t.attr(\"linkType\", linkType)\n\t\t\t.on(\"mouseup\", (d3Event) => {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\tthis.completeNewLink(d3Event);\n\t\t\t})\n\t\t\t.merge(connectionGuideSel)\n\t\t\t.each(function(d) {\n\t\t\t\tif (that.drawingNewLinkData.guideObject === PORT_OBJECT_IMAGE) {\n\t\t\t\t\td3.select(this)\n\t\t\t\t\t\t.attr(\"xlink:href\", that.drawingNewLinkData.guideImage)\n\t\t\t\t\t\t.attr(\"x\", d.x2 - (that.drawingNewLinkData.portWidth / 2))\n\t\t\t\t\t\t.attr(\"y\", d.y2 - (that.drawingNewLinkData.portHeight / 2))\n\t\t\t\t\t\t.attr(\"width\", that.drawingNewLinkData.portWidth)\n\t\t\t\t\t\t.attr(\"height\", that.drawingNewLinkData.portHeight)\n\t\t\t\t\t\t.attr(\"transform\", that.getLinkImageTransform(d));\n\t\t\t\t} else {\n\t\t\t\t\td3.select(this)\n\t\t\t\t\t\t.attr(\"cx\", d.x2)\n\t\t\t\t\t\t.attr(\"cy\", d.y2)\n\t\t\t\t\t\t.attr(\"r\", that.drawingNewLinkData.portRadius);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tgetLinkImageTransform(d) {\n\t\tlet angle = 0;\n\t\tif (this.canvasLayout.linkType === LINK_TYPE_STRAIGHT) {\n\t\t\tconst adjacent = d.x2 - (d.originX || d.x1);\n\t\t\tconst opposite = d.y2 - (d.originY || d.y1);\n\t\t\tif (adjacent === 0 && opposite === 0) {\n\t\t\t\tangle = 0;\n\t\t\t} else {\n\t\t\t\tangle = Math.atan(opposite / adjacent) * (180 / Math.PI);\n\t\t\t\tangle = adjacent >= 0 ? angle : angle + 180;\n\t\t\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM) {\n\t\t\t\t\tangle -= 90;\n\t\t\t\t} else if (this.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\t\t\tangle += 90;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn `rotate(${angle},${d.x2},${d.y2})`;\n\t\t}\n\t\treturn null;\n\t}\n\n\tdrawNewCommentLinkForPorts(transPos) {\n\t\tconst that = this;\n\t\tconst srcComment = this.activePipeline.getComment(this.drawingNewLinkData.srcObjId);\n\t\tconst startPos = this.linkUtils.getNewStraightCommentLinkStartPos(srcComment, transPos);\n\t\tconst linkType = COMMENT_LINK;\n\n\t\tthis.drawingNewLinkData.linkArray = [{\n\t\t\t\"x1\": startPos.x,\n\t\t\t\"y1\": startPos.y,\n\t\t\t\"x2\": transPos.x,\n\t\t\t\"y2\": transPos.y,\n\t\t\t\"type\": linkType }];\n\n\t\tconst connectionLineSel = this.nodesLinksGrp.selectAll(\".d3-new-connection-line\");\n\t\tconst connectionGuideSel = this.nodesLinksGrp.selectAll(\".d3-new-connection-guide\");\n\n\t\tconnectionLineSel\n\t\t\t.data(this.drawingNewLinkData.linkArray)\n\t\t\t.enter()\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"d3-new-connection-line\")\n\t\t\t.attr(\"linkType\", linkType)\n\t\t\t.merge(connectionLineSel)\n\t\t\t.attr(\"d\", (d) => that.linkUtils.getConnectorPathInfo(d).path);\n\n\t\tconnectionGuideSel\n\t\t\t.data(this.drawingNewLinkData.linkArray)\n\t\t\t.enter()\n\t\t\t.append(\"circle\")\n\t\t\t.attr(\"class\", \"d3-new-connection-guide\")\n\t\t\t.attr(\"linkType\", linkType)\n\t\t\t.on(\"mouseup\", (d3Event) => {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\tthis.completeNewLink(d3Event);\n\t\t\t})\n\t\t\t.merge(connectionGuideSel)\n\t\t\t.attr(\"cx\", (d) => d.x2)\n\t\t\t.attr(\"cy\", (d) => d.y2)\n\t\t\t.attr(\"r\", this.canvasLayout.commentPortRadius);\n\n\t\tif (this.canvasLayout.commentLinkArrowHead) {\n\t\t\tconst connectionArrowHeadSel = this.nodesLinksGrp.selectAll(\".d3-new-connection-arrow\");\n\n\t\t\tconnectionArrowHeadSel\n\t\t\t\t.data(this.drawingNewLinkData.linkArray)\n\t\t\t\t.enter()\n\t\t\t\t.append(\"path\")\n\t\t\t\t.attr(\"class\", \"d3-new-connection-arrow\")\n\t\t\t\t.attr(\"linkType\", linkType)\n\t\t\t\t.on(\"mouseup\", (d3Event) => {\n\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\t\t\t\t\tthis.completeNewLink(d3Event);\n\t\t\t\t})\n\t\t\t\t.merge(connectionArrowHeadSel)\n\t\t\t\t.attr(\"d\", (d) => this.getArrowHead(d))\n\t\t\t\t.attr(\"transform\", (d) => this.getArrowHeadTransform(d));\n\t\t}\n\t}\n\n\t// Handles the completion of a new link being drawn from a source node.\n\tcompleteNewLink(d3Event) {\n\t\tif (this.config.enableEditingActions === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.config.enableHighlightUnavailableNodes) {\n\t\t\tthis.unsetUnavailableNodesHighlighting();\n\t\t}\n\t\tvar trgNode = this.getNodeAtMousePos(d3Event);\n\t\tif (trgNode !== null) {\n\t\t\tthis.completeNewLinkOnNode(d3Event, trgNode);\n\t\t} else {\n\t\t\tif (this.config.enableLinkSelection === LINK_SELECTION_DETACHABLE &&\n\t\t\t\t\tthis.drawingNewLinkData.action === NODE_LINK &&\n\t\t\t\t\t!this.config.enableAssocLinkCreation) {\n\t\t\t\tthis.completeNewDetachedLink(d3Event);\n\t\t\t} else {\n\t\t\t\tthis.stopDrawingNewLink();\n\t\t\t}\n\t\t}\n\t}\n\n\t// Handles the completion of a new link when the end is dropped on a node.\n\tcompleteNewLinkOnNode(d3Event, trgNode) {\n\t\t// If we completed a connection remove the new line objects.\n\t\tthis.removeNewLink();\n\n\t\t// Switch 'new link over node' highlighting off\n\t\tif (this.config.enableHighlightNodeOnNewLinkDrag) {\n\t\t\tthis.setNewLinkOverNodeCancel();\n\t\t}\n\n\t\tif (trgNode !== null) {\n\t\t\tconst type = this.drawingNewLinkData.action;\n\t\t\tif (type === NODE_LINK) {\n\t\t\t\tconst srcNode = this.activePipeline.getNode(this.drawingNewLinkData.srcObjId);\n\t\t\t\tconst srcPortId = this.drawingNewLinkData.srcPortId;\n\t\t\t\tconst trgPortId = this.getInputNodePortId(d3Event, trgNode);\n\n\t\t\t\tif (CanvasUtils.isDataConnectionAllowed(srcPortId, trgPortId, srcNode, trgNode, this.activePipeline.links)) {\n\t\t\t\t\tthis.canvasController.editActionHandler({\n\t\t\t\t\t\teditType: \"linkNodes\",\n\t\t\t\t\t\teditSource: \"canvas\",\n\t\t\t\t\t\tnodes: [{ \"id\": this.drawingNewLinkData.srcObjId, \"portId\": this.drawingNewLinkData.srcPortId }],\n\t\t\t\t\t\ttargetNodes: [{ \"id\": trgNode.id, \"portId\": trgPortId }],\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\tlinkType: \"data\", // Added for historical purposes - for WML Canvas support\n\t\t\t\t\t\tpipelineId: this.pipelineId });\n\n\t\t\t\t} else if (this.config.enableLinkReplaceOnNewConnection &&\n\t\t\t\t\t\t\t\t\t\tCanvasUtils.isDataLinkReplacementAllowed(srcPortId, trgPortId, srcNode, trgNode, this.activePipeline.links)) {\n\t\t\t\t\tconst linksToTrgPort = CanvasUtils.getDataLinksConnectedTo(trgPortId, trgNode, this.activePipeline.links);\n\t\t\t\t\t// We only replace a link to a maxed out cardinality port if there\n\t\t\t\t\t// is only one link. i.e. the input port cardinality is 0:1\n\t\t\t\t\tif (linksToTrgPort.length === 1) {\n\t\t\t\t\t\tthis.canvasController.editActionHandler({\n\t\t\t\t\t\t\teditType: \"linkNodesAndReplace\",\n\t\t\t\t\t\t\teditSource: \"canvas\",\n\t\t\t\t\t\t\tnodes: [{ \"id\": this.drawingNewLinkData.srcObjId, \"portId\": this.drawingNewLinkData.srcPortId }],\n\t\t\t\t\t\t\ttargetNodes: [{ \"id\": trgNode.id, \"portId\": trgPortId }],\n\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\tpipelineId: this.pipelineId,\n\t\t\t\t\t\t\treplaceLink: linksToTrgPort[0]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else if (type === ASSOCIATION_LINK) {\n\t\t\t\tconst srcNode = this.activePipeline.getNode(this.drawingNewLinkData.srcObjId);\n\n\t\t\t\tif (CanvasUtils.isAssocConnectionAllowed(srcNode, trgNode, this.activePipeline.links)) {\n\t\t\t\t\tthis.canvasController.editActionHandler({\n\t\t\t\t\t\teditType: \"linkNodes\",\n\t\t\t\t\t\teditSource: \"canvas\",\n\t\t\t\t\t\tnodes: [{ \"id\": this.drawingNewLinkData.srcObjId }],\n\t\t\t\t\t\ttargetNodes: [{ \"id\": trgNode.id }],\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\tpipelineId: this.pipelineId });\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif (CanvasUtils.isCommentLinkConnectionAllowed(this.drawingNewLinkData.srcObjId, trgNode.id, this.activePipeline.links)) {\n\t\t\t\t\tthis.canvasController.editActionHandler({\n\t\t\t\t\t\teditType: \"linkComment\",\n\t\t\t\t\t\teditSource: \"canvas\",\n\t\t\t\t\t\tnodes: [this.drawingNewLinkData.srcObjId],\n\t\t\t\t\t\ttargetNodes: [trgNode.id],\n\t\t\t\t\t\ttype: COMMENT_LINK,\n\t\t\t\t\t\tlinkType: \"comment\", // Added for historical purposes - for WML Canvas support\n\t\t\t\t\t\tpipelineId: this.pipelineId });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.drawingNewLinkData = null;\n\t}\n\n\t// Handles the completion of a new link when the end is dropped away from\n\t// a node (when enableLinkSelection is set to LINK_SELECTION_DETACHABLE)\n\t// which creates a  new detached link.\n\tcompleteNewDetachedLink(d3Event) {\n\t\t// If we completed a connection remove the new line objects.\n\t\tthis.removeNewLink();\n\n\t\t// Switch 'new link over node' highlighting off\n\t\tif (this.config.enableHighlightNodeOnNewLinkDrag) {\n\t\t\tthis.setNewLinkOverNodeCancel();\n\t\t}\n\n\t\tconst endPoint = this.getTransformedMousePos(d3Event);\n\t\tthis.canvasController.editActionHandler({\n\t\t\teditType: \"createDetachedLink\",\n\t\t\teditSource: \"canvas\",\n\t\t\tsrcNodeId: this.drawingNewLinkData.srcObjId,\n\t\t\tsrcNodePortId: this.drawingNewLinkData.srcPortId,\n\t\t\ttrgPos: endPoint,\n\t\t\ttype: NODE_LINK,\n\t\t\tpipelineId: this.pipelineId });\n\n\t\tthis.drawingNewLinkData = null;\n\t}\n\n\tstopDrawingNewLink() {\n\t\t// Switch 'new link over node' highlighting off\n\t\tif (this.config.enableHighlightNodeOnNewLinkDrag) {\n\t\t\tthis.setNewLinkOverNodeCancel();\n\t\t}\n\n\t\tthis.stopDrawingNewLinkForPorts();\n\t\tthis.drawingNewLinkData = null;\n\t}\n\n\tstopDrawingNewLinkForPorts() {\n\t\tconst saveX1 = this.drawingNewLinkData.linkArray[0].x1;\n\t\tconst saveY1 = this.drawingNewLinkData.linkArray[0].y1;\n\t\tconst saveX2 = this.drawingNewLinkData.linkArray[0].x2;\n\t\tconst saveY2 = this.drawingNewLinkData.linkArray[0].y2;\n\n\t\tconst saveNewLinkData = Object.assign({}, this.drawingNewLinkData);\n\n\t\tthis.drawingNewLinkData = null;\n\n\t\t// If we completed a connection successfully just remove the new line\n\t\t// objects.\n\t\tlet newPath = \"\";\n\t\tlet duration = 350;\n\n\t\tif (this.canvasLayout.linkType === LINK_TYPE_CURVE) {\n\t\t\tnewPath = \"M \" + saveX1 + \" \" + saveY1 +\n\t\t\t\t\t\t\t\t\"C \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\" \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\" \" + saveX2 + \" \" + saveY2;\n\n\t\t} else if (this.canvasLayout.linkType === LINK_TYPE_STRAIGHT) {\n\t\t\tif (saveX1 < saveX2) {\n\t\t\t\tduration = 0;\n\t\t\t}\n\t\t\tnewPath = \"M \" + saveX1 + \" \" + saveY1 +\n\t\t\t\t\t\t\t\t\"L \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\" \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\" \" + saveX2 + \" \" + saveY2;\n\n\t\t} else {\n\t\t\tnewPath = \"M \" + saveX1 + \" \" + saveY1 +\n\t\t\t\t\t\t\t\t\"L \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\"Q \" + saveX2 + \" \" + saveY2 + \" \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\"L \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\"Q \" + saveX2 + \" \" + saveY2 + \" \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\"L \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\"Q \" + saveX2 + \" \" + saveY2 + \" \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\"L \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\"Q \" + saveX2 + \" \" + saveY2 + \" \" + saveX2 + \" \" + saveY2 +\n\t\t\t\t\t\t\t\t\"L \" + saveX2 + \" \" + saveY2;\n\t\t}\n\n\t\tthis.nodesLinksGrp.selectAll(\".d3-new-connection-line\")\n\t\t\t.transition()\n\t\t\t.duration(duration)\n\t\t\t.attr(\"d\", newPath)\n\t\t\t.on(\"end\", () => {\n\t\t\t\tthis.nodesLinksGrp.selectAll(\".d3-new-connection-arrow\").remove();\n\n\t\t\t\tthis.nodesLinksGrp.selectAll(\".d3-new-connection-guide\")\n\t\t\t\t\t.transition()\n\t\t\t\t\t.duration(1000)\n\t\t\t\t\t.ease(d3.easeElastic)\n\t\t\t\t\t// The lines below set all attributes for images AND circles even\n\t\t\t\t\t// though some attributes will not be relevant. This is done\n\t\t\t\t\t// because I could not get the .each() method to work here (which\n\t\t\t\t\t// would be necessary to have an if statement based on guide object)\n\t\t\t\t\t.attr(\"x\", saveX1 - (saveNewLinkData.portWidth / 2))\n\t\t\t\t\t.attr(\"y\", saveY1 - (saveNewLinkData.portHeight / 2))\n\t\t\t\t\t.attr(\"cx\", saveX1)\n\t\t\t\t\t.attr(\"cy\", saveY1)\n\t\t\t\t\t.attr(\"transform\", null);\n\t\t\t\tthis.nodesLinksGrp.selectAll(\".d3-new-connection-line\")\n\t\t\t\t\t.transition()\n\t\t\t\t\t.duration(1000)\n\t\t\t\t\t.ease(d3.easeElastic)\n\t\t\t\t\t.attr(\"d\", \"M \" + saveX1 + \" \" + saveY1 +\n\t\t\t\t\t\t\t\t\t\t\t\"L \" + saveX1 + \" \" + saveY1)\n\t\t\t\t\t.on(\"end\", this.removeNewLink.bind(this));\n\t\t\t});\n\t}\n\n\tremoveNewLink() {\n\t\tthis.nodesLinksGrp.selectAll(\".d3-new-connection-line\").remove();\n\t\tthis.nodesLinksGrp.selectAll(\".d3-new-connection-start\").remove();\n\t\tthis.nodesLinksGrp.selectAll(\".d3-new-connection-guide\").remove();\n\t\tthis.nodesLinksGrp.selectAll(\".d3-new-connection-arrow\").remove();\n\t}\n\n\tremoveNewLinkLine() {\n\t\tthis.nodesLinksGrp.selectAll(\".d3-new-connection-line\").remove();\n\t}\n\n\tdragLinkHandle(d3Event) {\n\t\tconst transPos = this.getTransformedMousePos(d3Event);\n\t\tconst link = this.draggingLinkData.link;\n\n\t\tif (this.draggingLinkData.endBeingDragged === \"start\") {\n\t\t\tlink.srcPos = { x_pos: transPos.x, y_pos: transPos.y };\n\t\t\tdelete link.srcNodeId;\n\t\t\tdelete link.srcNodePortId;\n\t\t\tdelete link.srcObj;\n\n\t\t} else {\n\t\t\tlink.trgPos = { x_pos: transPos.x, y_pos: transPos.y };\n\t\t\tdelete link.trgNodeId;\n\t\t\tdelete link.trgNodePortId;\n\t\t\tdelete link.trgNode;\n\t\t}\n\n\t\tthis.displayLinks();\n\n\t\t// Switch on an attribute to indicate a new link is being dragged\n\t\t// towards and over a target node.\n\t\tif (this.config.enableHighlightNodeOnNewLinkDrag) {\n\t\t\tthis.setNewLinkOverNode(d3Event);\n\t\t}\n\t}\n\n\tcompleteDraggedLink(d3Event) {\n\t\tconst newLink = this.getNewLinkOnDrag(d3Event);\n\n\t\tif (newLink) {\n\t\t\tthis.canvasController.editActionHandler({\n\t\t\t\teditType: \"updateLink\",\n\t\t\t\teditSource: \"canvas\",\n\t\t\t\tnewLink: newLink,\n\t\t\t\tpipelineId: this.pipelineId });\n\t\t} else {\n\t\t\tthis.activePipeline.replaceLink(this.draggingLinkData.oldLink);\n\t\t\tthis.displayLinks();\n\t\t}\n\n\t\t// Switch 'new link over node' highlighting off\n\t\tif (this.config.enableHighlightNodeOnNewLinkDrag) {\n\t\t\tthis.setNewLinkOverNodeCancel();\n\t\t}\n\n\t\tthis.unsetUnavailableNodesHighlighting();\n\t\tthis.stopDraggingLink();\n\t}\n\n\t// Returns a new link if one can be created given the current data in the\n\t// this.draggingLinkData object. Returns null if a link cannot be created.\n\tgetNewLinkOnDrag(d3Event, nodeProximity) {\n\t\tconst oldLink = this.draggingLinkData.oldLink;\n\t\tconst newLink = cloneDeep(oldLink);\n\n\t\tif (this.draggingLinkData.endBeingDragged === \"start\") {\n\t\t\tdelete newLink.srcNodeId;\n\t\t\tdelete newLink.srcNodePortId;\n\t\t\tdelete newLink.srcPos;\n\n\t\t\tconst srcNode = nodeProximity\n\t\t\t\t? this.getNodeNearMousePos(d3Event, nodeProximity)\n\t\t\t\t: this.getNodeAtMousePos(d3Event);\n\n\t\t\tif (srcNode) {\n\t\t\t\tnewLink.srcNodeId = srcNode.id;\n\t\t\t\tnewLink.srcNodePortId = nodeProximity\n\t\t\t\t\t? this.getNodePortIdNearMousePos(d3Event, OUTPUT_TYPE, srcNode)\n\t\t\t\t\t: this.getOutputNodePortId(d3Event, srcNode);\n\t\t\t}\telse {\n\t\t\t\tnewLink.srcPos = this.draggingLinkData.link.srcPos;\n\t\t\t}\n\n\t\t} else {\n\t\t\tdelete newLink.trgNodeId;\n\t\t\tdelete newLink.trgNodePortId;\n\t\t\tdelete newLink.trgPos;\n\n\t\t\tconst trgNode = nodeProximity\n\t\t\t\t? this.getNodeNearMousePos(d3Event, nodeProximity)\n\t\t\t\t: this.getNodeAtMousePos(d3Event);\n\n\t\t\tif (trgNode) {\n\t\t\t\tnewLink.trgNodeId = trgNode.id;\n\t\t\t\tnewLink.trgNodePortId = nodeProximity\n\t\t\t\t\t? this.getNodePortIdNearMousePos(d3Event, INPUT_TYPE, trgNode)\n\t\t\t\t\t: this.getInputNodePortId(d3Event, trgNode);\n\t\t\t}\telse {\n\t\t\t\tnewLink.trgPos = this.draggingLinkData.link.trgPos;\n\t\t\t}\n\t\t}\n\n\t\t// If links are not detachable, we cannot create a link if srcPos\n\t\t// or trgPos are set because that would create a detached link unconnected\n\t\t// to either a source node or a target node or both.\n\t\tif (this.config.enableLinkSelection !== LINK_SELECTION_DETACHABLE &&\n\t\t\t\t(newLink.srcPos || newLink.trgPos)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.canExecuteUpdateLinkCommand(newLink, oldLink)) {\n\t\t\treturn newLink;\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Returns true if the update command for a dragged link can be executed.\n\t// It might be prevented from executing if either the course\n\tcanExecuteUpdateLinkCommand(newLink, oldLink) {\n\t\tconst srcNode = this.activePipeline.getNode(newLink.srcNodeId);\n\t\tconst trgNode = this.activePipeline.getNode(newLink.trgNodeId);\n\t\tconst linkSrcChanged = this.hasLinkSrcChanged(newLink, oldLink);\n\t\tconst linkTrgChanged = this.hasLinkTrgChanged(newLink, oldLink);\n\t\tconst links = this.activePipeline.links;\n\t\tlet executeCommand = true;\n\n\t\tif (linkSrcChanged && srcNode &&\n\t\t\t\t!CanvasUtils.isSrcConnectionAllowedWithDetachedLinks(newLink.srcNodePortId, srcNode, links)) {\n\t\t\texecuteCommand = false;\n\t\t}\n\t\tif (linkTrgChanged && trgNode &&\n\t\t\t\t!CanvasUtils.isTrgConnectionAllowedWithDetachedLinks(newLink.trgNodePortId, trgNode, links)) {\n\t\t\texecuteCommand = false;\n\t\t}\n\t\tif (srcNode && trgNode &&\n\t\t\t\t!CanvasUtils.isConnectionAllowedWithDetachedLinks(newLink.srcNodePortId, newLink.trgNodePortId, srcNode, trgNode, links)) {\n\t\t\texecuteCommand = false;\n\t\t}\n\t\treturn executeCommand;\n\t}\n\n\t// Returns true if the source information has changed between\n\t// the two links.\n\thasLinkSrcChanged(newLink, oldLink) {\n\t\tlet linkUpdated = false;\n\n\t\tif (newLink.srcNodeId) {\n\t\t\tif (newLink.srcNodeId !== oldLink.srcNodeId) {\n\t\t\t\tlinkUpdated = true;\n\t\t\t}\n\n\t\t\tif (newLink.srcNodePortId !== oldLink.srcNodePortId) {\n\t\t\t\tlinkUpdated = true;\n\t\t\t}\n\n\t\t}\telse {\n\t\t\tif (oldLink.srcPos) {\n\t\t\t\tif (newLink.srcPos.x_pos !== oldLink.srcPos.x_pos ||\n\t\t\t\t\t\tnewLink.srcPos.y_pos !== oldLink.srcPos.y_pos) {\n\t\t\t\t\tlinkUpdated = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlinkUpdated = true;\n\t\t\t}\n\t\t}\n\t\treturn linkUpdated;\n\t}\n\n\t// Returns true if the target information has changed between\n\t// the two links.\n\thasLinkTrgChanged(newLink, oldLink) {\n\t\tlet linkUpdated = false;\n\n\t\tif (newLink.trgNodeId) {\n\t\t\tif (newLink.trgNodeId !== oldLink.trgNodeId) {\n\t\t\t\tlinkUpdated = true;\n\t\t\t}\n\n\t\t\tif (newLink.trgNodePortId !== oldLink.trgNodePortId) {\n\t\t\t\tlinkUpdated = true;\n\t\t\t}\n\n\t\t}\telse {\n\t\t\tif (oldLink.trgPos) {\n\t\t\t\tif (newLink.trgPos.x_pos !== oldLink.trgPos.x_pos ||\n\t\t\t\t\t\tnewLink.trgPos.y_pos !== oldLink.trgPos.y_pos) {\n\t\t\t\t\tlinkUpdated = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlinkUpdated = true;\n\t\t\t}\n\t\t}\n\t\treturn linkUpdated;\n\t}\n\n\tstopDraggingLink() {\n\t\tthis.draggingLinkData = null;\n\t}\n\n\t// Returns a link, if one can be found, at the position indicated by x and y\n\t// coordinates.\n\tgetLinkAtMousePos(x, y) {\n\t\tconst element = this.getElementWithClassAtPosition(x, y, \"d3-data-link\");\n\t\tconst link = this.getNodeLinkForElement(element);\n\t\treturn link;\n\t}\n\n\t// Returns the node link object from the canvasInfo corresponding to the\n\t// element passed in provided it is a 'path' DOM object. Returns null if\n\t// a link cannot be found.\n\tgetNodeLinkForElement(element) {\n\t\tif (element) {\n\t\t\tconst datum = d3.select(element).datum();\n\t\t\tif (datum) {\n\t\t\t\tvar foundLink = this.activePipeline.getLink(datum.id);\n\t\t\t\tif (foundLink && foundLink.type === NODE_LINK) {\n\t\t\t\t\treturn foundLink;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Switches the link selection area to be wider (when state is true) and\n\t// regular size (when state is false).  The wider width assists detection\n\t// of a node being dragged over the link - for when the 'insert node into link'\n\t// feature is active.\n\tsetDataLinkSelectionAreaWider(state) {\n\t\tthis.nodesLinksGrp.selectAll(\".d3-data-link-selection-area\").classed(\"d3-extra-width\", state);\n\t}\n\n\t// Returns a node, if one can be found, at the position indicated by\n\t// the clientX and clientY coordinates in the d3Event.\n\tgetNodeAtMousePos(d3Event) {\n\t\tconst nodeGrpElement = this.getElementWithClassAtMousePos(d3Event, \"d3-node-group\");\n\t\treturn this.getNodeForElement(nodeGrpElement);\n\t}\n\n\t// Returns an input node port ID for either, the port that is under the mouse\n\t// position described by d3Event or, if the mouse is not over a port, the\n\t// ID of the default port for the node provided.\n\tgetInputNodePortId(d3Event, trgNode) {\n\t\tlet inputPortId = this.getInputNodePortIdAtMousePos(d3Event);\n\t\tif (!inputPortId) {\n\t\t\tinputPortId = CanvasUtils.getDefaultInputPortId(trgNode);\n\t\t}\n\t\treturn inputPortId;\n\t}\n\n\t// Returns a node input port ID, if one can be found, at the position\n\t// indicated by the clientX and clientY coordinates in the d3Event.\n\tgetInputNodePortIdAtMousePos(d3Event) {\n\t\tconst portElement = this.getElementWithClassAtMousePos(d3Event, this.getNodeInputPortClassName());\n\t\treturn this.getNodePortIdForElement(portElement);\n\t}\n\n\t// Returns an output node port ID for either, the port that is under the mouse\n\t// position described by d3Event or, if the mouse is not over a port, the\n\t// ID of the default port for the node provided.\n\tgetOutputNodePortId(d3Event, srcNode) {\n\t\tlet outputPortId = this.getOutputNodePortIdAtMousePos(d3Event);\n\t\tif (!outputPortId) {\n\t\t\toutputPortId = CanvasUtils.getDefaultOutputPortId(srcNode);\n\t\t}\n\t\treturn outputPortId;\n\t}\n\n\t// Returns a node output port ID, if one can be found, at the position\n\t// indicated by the clientX and clientY coordinates in the d3Event.\n\tgetOutputNodePortIdAtMousePos(d3Event) {\n\t\tconst portElement = this.getElementWithClassAtMousePos(d3Event, this.getNodeOutputPortClassName());\n\t\treturn this.getNodePortIdForElement(portElement);\n\t}\n\n\t// Returns a DOM element which either has the classNames passed in or\n\t// has an ancestor with the className passed in, at the position\n\t// indicated by the clientX and clientY coordinates in the d3Event.\n\t// Note: It may not be the top-most element so we have to search through the\n\t// elements array for it.\n\tgetElementWithClassAtMousePos(d3Event, className) {\n\t\tconst posX = d3Event.clientX ? d3Event.clientX : d3Event.sourceEvent.clientX;\n\t\tconst posY = d3Event.clientY ? d3Event.clientY : d3Event.sourceEvent.clientY;\n\t\treturn this.getElementWithClassAtPosition(posX, posY, className);\n\t}\n\n\tgetElementWithClassAtPosition(x, y, className) {\n\t\tconst elements = document.elementsFromPoint(x, y);\n\t\tlet foundElement = null;\n\t\tlet count = 0;\n\t\twhile (!foundElement && count < elements.length) {\n\t\t\tfoundElement = CanvasUtils.getParentElementWithClass(elements[count], className);\n\t\t\tcount++;\n\t\t}\n\t\treturn foundElement;\n\t}\n\n\t// Returns the node link object from the canvasInfo corresponding to the\n\t// element passed in provided it is a 'path' DOM object. Returns null if\n\t// a link cannot be found.\n\tgetNodeForElement(element) {\n\t\tif (element && element.nodeName === \"g\") {\n\t\t\tconst datum = d3.select(element).datum();\n\t\t\tif (datum) {\n\t\t\t\treturn this.activePipeline.getNode(datum.id);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Returns the node port Id corresponding to the lement passed in.\n\tgetNodePortIdForElement(element) {\n\t\tif (element) {\n\t\t\treturn d3.select(element).attr(\"data-port-id\");\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Returns the node that is near the current mouse position. If nodeProximity\n\t// is provided it will be used as additional space beyond the node boundary\n\t// to decide if the node is under the current mouse position.\n\tgetNodeNearMousePos(d3Event, nodeProximity) {\n\t\tvar pos = this.getTransformedMousePos(d3Event);\n\t\tvar node = null;\n\t\tconst prox = nodeProximity || 0;\n\t\tthis.getAllNodeGroupsSelection()\n\t\t\t.each((d) => {\n\t\t\t\tlet portRadius = d.layout.portRadius;\n\t\t\t\tif (CanvasUtils.isSuperBindingNode(d)) {\n\t\t\t\t\tportRadius = this.canvasLayout.supernodeBindingPortRadius / this.zoomTransform.k;\n\t\t\t\t}\n\n\t\t\t\tif (pos.x >= d.x_pos - portRadius - prox && // Target port sticks out by its radius so need to allow for it.\n\t\t\t\t\t\tpos.x <= d.x_pos + d.width + portRadius + prox &&\n\t\t\t\t\t\tpos.y >= d.y_pos - prox &&\n\t\t\t\t\t\tpos.y <= d.y_pos + d.height + prox) {\n\t\t\t\t\tnode = d;\n\t\t\t\t}\n\t\t\t});\n\t\treturn node;\n\t}\n\n\tgetNodePortIdNearMousePos(d3Event, portType, node) {\n\t\tconst pos = this.getTransformedMousePos(d3Event);\n\t\tlet portId = null;\n\t\tlet defaultPortId = null;\n\n\t\tif (node) {\n\t\t\tif (portType === OUTPUT_TYPE) {\n\t\t\t\tconst portObjs = this.getAllNodeGroupsSelection()\n\t\t\t\t\t.selectChildren(\".\" + this.getNodeOutputPortClassName())\n\t\t\t\t\t.selectChildren(\".d3-node-port-output-main\");\n\n\t\t\t\tportId = this.searchForPortNearMouse(\n\t\t\t\t\tnode, pos, portObjs,\n\t\t\t\t\tnode.layout.outputPortObject,\n\t\t\t\t\tnode.width);\n\t\t\t\tdefaultPortId = CanvasUtils.getDefaultOutputPortId(node);\n\n\t\t\t} else {\n\t\t\t\tconst portObjs = this.getAllNodeGroupsSelection()\n\t\t\t\t\t.selectChildren(\".\" + this.getNodeInputPortClassName())\n\t\t\t\t\t.selectChildren(\".d3-node-port-input-main\");\n\n\t\t\t\tportId = this.searchForPortNearMouse(\n\t\t\t\t\tnode, pos, portObjs,\n\t\t\t\t\tnode.layout.inputPortObject,\n\t\t\t\t\t0);\n\t\t\t\tdefaultPortId = CanvasUtils.getDefaultInputPortId(node);\n\t\t\t}\n\t\t}\n\n\t\tif (!portId) {\n\t\t\tportId = defaultPortId;\n\t\t}\n\t\treturn portId;\n\t}\n\n\t// Returns a port ID for the port identified by the position (pos) on the\n\t// node (node) further specified by the other parameters.\n\tsearchForPortNearMouse(node, pos, portObjs, portObjectType, nodeWidthOffset) {\n\t\tlet portId = null;\n\t\tportObjs\n\t\t\t.each((p, i, portGrps) => {\n\t\t\t\tconst portSel = d3.select(portGrps[i]);\n\t\t\t\tif (portObjectType === PORT_OBJECT_IMAGE) {\n\t\t\t\t\tconst xx = node.x_pos + Number(portSel.attr(\"x\"));\n\t\t\t\t\tconst yy = node.y_pos + Number(portSel.attr(\"y\"));\n\t\t\t\t\tconst wd = Number(portSel.attr(\"width\"));\n\t\t\t\t\tconst ht = Number(portSel.attr(\"height\"));\n\t\t\t\t\tif (pos.x >= xx &&\n\t\t\t\t\t\t\tpos.x <= xx + nodeWidthOffset + wd &&\n\t\t\t\t\t\t\tpos.y >= yy &&\n\t\t\t\t\t\t\tpos.y <= yy + ht) {\n\t\t\t\t\t\tportId = portGrps[i].getAttribute(\"data-port-id\");\n\t\t\t\t\t}\n\t\t\t\t} else { // Port must be a circle\n\t\t\t\t\tconst cx = node.x_pos + Number(portSel.attr(\"cx\"));\n\t\t\t\t\tconst cy = node.y_pos + Number(portSel.attr(\"cy\"));\n\t\t\t\t\tif (pos.x >= cx - node.layout.portRadius && // Target port sticks out by its radius so need to allow for it.\n\t\t\t\t\t\t\tpos.x <= cx + node.layout.portRadius &&\n\t\t\t\t\t\t\tpos.y >= cy - node.layout.portRadius &&\n\t\t\t\t\t\t\tpos.y <= cy + node.layout.portRadius) {\n\t\t\t\t\t\tportId = portGrps[i].getAttribute(\"data-port-id\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn portId;\n\t}\n\n\t// Returns a sizing rectangle for nodes and comments. This extends an\n\t// invisible area out beyond the highlight sizing line to improve usability\n\t// when sizing.\n\tgetNodeShapePathSizing(data) {\n\t\treturn this.getRectangleNodeShapePath(data, data.layout.nodeSizingArea);\n\t}\n\n\t// Returns a path string that will draw the selection outline shape of the node.\n\tgetNodeSelectionOutline(data) {\n\t\tif (data.layout.selectionPath && !CanvasUtils.isExpanded(data)) {\n\t\t\tif (typeof data.layout.selectionPath === \"function\") {\n\t\t\t\treturn data.layout.selectionPath(data);\n\t\t\t}\n\t\t\treturn data.layout.selectionPath;\n\n\t\t} else if (data.layout.nodeShape === \"port-arcs\") {\n\t\t\treturn this.getPortArcsNodeShapePath(data); // Port-arc outline does not have a highlight gap\n\n\t\t}\n\t\treturn this.getRectangleNodeShapePath(data, data.layout.nodeHighlightGap);\n\t}\n\n\t// Returns a path string that will draw the body shape of the node.\n\tgetNodeShapePath(data) {\n\t\tif (data.layout.bodyPath && !CanvasUtils.isExpanded(data)) {\n\t\t\tif (typeof data.layout.bodyPath === \"function\") {\n\t\t\t\treturn data.layout.bodyPath(data);\n\t\t\t}\n\n\t\t\treturn data.layout.bodyPath;\n\n\t\t} else if (data.layout.nodeShape === \"port-arcs\") {\n\t\t\treturn this.getPortArcsNodeShapePath(data);\n\n\t\t}\n\t\treturn this.getRectangleNodeShapePath(data);\n\t}\n\n\t// Returns a path that will draw the shape for the rectangle node\n\t// display. This is drawn as a path rather than an SVG rectangle to make the\n\t// calling code more generic.\n\tgetRectangleNodeShapePath(data, highlightGap) {\n\t\tconst gap = highlightGap ? highlightGap : 0;\n\t\tconst x = 0 - gap;\n\t\tconst y = 0 - gap;\n\t\tconst width = data.width + gap;\n\t\tconst height = data.height + gap;\n\n\t\tlet path = \"M \" + x + \" \" + y + \" L \" + width + \" \" + y;\n\t\tpath += \" L \" + width + \" \" + height;\n\t\tpath += \" L \" + x + \" \" + height;\n\t\tpath += \" Z\"; // Draw a straight line back to origin.\n\n\t\treturn path;\n\t}\n\n\t// Returns a path that will draw the outline shape for the 'port-arcs' display\n\t// which shows arcs around each of the node circles.\n\tgetPortArcsNodeShapePath(data) {\n\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM) {\n\t\t\treturn this.getPortArcsNodeShapePathVertical(data, data.inputs, data.inputPortsWidth, data.outputs, data.outputPortsWidth);\n\t\t} else if (this.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\treturn this.getPortArcsNodeShapePathVertical(data, data.outputs, data.outputPortsWidth, data.inputs, data.inputPortsWidth);\n\t\t}\n\n\t\treturn this.getPortArcsNodeShapePathLeftRight(data);\n\t}\n\n\t// Returns a path that will draw the outline shape for the 'port-arcs' display\n\t// which shows arcs around each of the node circles for left to right link direction.\n\tgetPortArcsNodeShapePathLeftRight(data) {\n\t\tlet path = \"M 0 0 L \" + data.width + \" 0 \"; // Draw line across the top of the node\n\n\t\tif (data.outputs && data.outputs.length > 0) {\n\t\t\tlet endPoint = data.layout.portArcOffset;\n\n\t\t\t// Draw straight segment down to ports (if needed)\n\t\t\tif (data.outputPortsHeight < data.height) {\n\t\t\t\tendPoint = data.outputs[0].cy - data.layout.portArcRadius;\n\t\t\t}\n\n\t\t\tpath += \" L \" + data.width + \" \" + endPoint;\n\n\t\t\t// Draw port arcs\n\t\t\tdata.outputs.forEach((port, index) => {\n\t\t\t\tendPoint += (data.layout.portArcRadius * 2);\n\t\t\t\tpath += \" A \" + data.layout.portArcRadius + \" \" + data.layout.portArcRadius + \" 180 0 1 \" + data.width + \" \" + endPoint;\n\t\t\t\tif (index < data.outputs.length - 1) {\n\t\t\t\t\tendPoint += data.layout.portArcSpacing;\n\t\t\t\t\tpath += \" L \" + data.width + \" \" + endPoint;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Draw finishing segment to bottom right corner\n\t\t\tpath += \" L \" + data.width + \" \" + data.height;\n\n\t\t// If no output ports just draw a straight line.\n\t\t} else {\n\t\t\tpath += \" L \" + data.width + \" \" + data.height;\n\t\t}\n\n\t\tpath += \" L 0 \" + data.height; // Draw line across the bottom of the node\n\n\t\tif (data.inputs && data.inputs.length > 0) {\n\t\t\tlet endPoint2 = data.height - data.layout.portArcOffset;\n\n\t\t\tif (data.inputPortsHeight < data.height) {\n\t\t\t\tendPoint2 = data.inputs[data.inputs.length - 1].cy + data.layout.portArcRadius;\n\t\t\t}\n\n\t\t\tpath += \" L 0 \" + endPoint2;\n\n\t\t\tdata.inputs.forEach((port, index) => {\n\t\t\t\tendPoint2 -= (data.layout.portArcRadius * 2);\n\t\t\t\tpath += \" A \" + data.layout.portArcRadius + \" \" + data.layout.portArcRadius + \" 180 0 1 0 \" + endPoint2;\n\t\t\t\tif (index < data.inputs.length - 1) {\n\t\t\t\t\tendPoint2 -= data.layout.portArcSpacing;\n\t\t\t\t\tpath += \" L 0 \" + endPoint2;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpath += \" Z\"; // Draw finishing segment back to origin\n\t\t} else {\n\t\t\tpath += \" Z\"; // If no input ports just draw a straight line.\n\t\t}\n\t\treturn path;\n\t}\n\n\t// Returns a path that will draw the outline shape for the 'port-arcs' display\n\t// which shows arcs around each of the node circles for vertical link directions.\n\tgetPortArcsNodeShapePathVertical(data, topPorts, topPortsWidth, bottomPorts, bottomPortsWidth) {\n\t\tlet path = \"M 0 0 L 0 \" + data.height; // Draw line down the left of the node\n\n\t\tif (bottomPorts && bottomPorts.length > 0) {\n\t\t\tlet endPoint = data.layout.portArcOffset;\n\n\t\t\t// Draw straight segment across to ports (if needed)\n\t\t\tif (bottomPortsWidth < data.width) {\n\t\t\t\tendPoint = bottomPorts[0].cx - data.layout.portArcRadius;\n\t\t\t}\n\n\t\t\tpath += \" L \" + endPoint + \" \" + data.height;\n\n\t\t\t// Draw port arcs\n\t\t\tbottomPorts.forEach((port, index) => {\n\t\t\t\tendPoint += (data.layout.portArcRadius * 2);\n\t\t\t\tpath += \" A \" + data.layout.portArcRadius + \" \" + data.layout.portArcRadius + \" 180 0 0 \" + endPoint + \" \" + data.height;\n\t\t\t\tif (index < bottomPorts.length - 1) {\n\t\t\t\t\tendPoint += data.layout.portArcSpacing;\n\t\t\t\t\tpath += \" L \" + endPoint + \" \" + data.height;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Draw finishing segment to bottom right corner\n\t\t\tpath += \" L \" + data.width + \" \" + data.height;\n\n\t\t// If no output ports just draw a straight line.\n\t\t} else {\n\t\t\tpath += \" L \" + data.width + \" \" + data.height;\n\t\t}\n\n\t\tpath += \" L \" + data.width + \" 0 \"; // Draw line up the right side of the node\n\n\t\tif (topPorts && topPorts.length > 0) {\n\t\t\tlet endPoint2 = data.width - data.layout.portArcOffset;\n\n\t\t\tif (topPortsWidth < data.width) {\n\t\t\t\tendPoint2 = topPorts[topPorts.length - 1].cx + data.layout.portArcRadius;\n\t\t\t}\n\n\t\t\tpath += \" L \" + endPoint2 + \" 0 \";\n\n\t\t\ttopPorts.forEach((port, index) => {\n\t\t\t\tendPoint2 -= (data.layout.portArcRadius * 2);\n\t\t\t\tpath += \" A \" + data.layout.portArcRadius + \" \" + data.layout.portArcRadius + \" 180 0 0 \" + endPoint2 + \" 0 \";\n\t\t\t\tif (index < topPorts.length - 1) {\n\t\t\t\t\tendPoint2 -= data.layout.portArcSpacing;\n\t\t\t\t\tpath += \" L \" + endPoint2 + \" 0 \";\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpath += \" Z\"; // Draw finishing segment back to origin\n\t\t} else {\n\t\t\tpath += \" Z\"; // If no input ports just draw a straight line.\n\t\t}\n\t\treturn path;\n\t}\n\n\t// Sets the port positions on nodes for use when displaying nodes and links\n\tsetPortPositionsAllNodes() {\n\t\tthis.activePipeline.nodes.forEach((node) => {\n\t\t\tthis.setPortPositionsForNode(node);\n\t\t});\n\t}\n\n\tsetPortPositionsForNode(node) {\n\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM) {\n\t\t\tthis.setPortPositionsVertical(node, node.inputs, node.inputPortsWidth, node.layout.inputPortTopPosX, node.layout.inputPortTopPosY);\n\t\t\tthis.setPortPositionsVertical(node, node.outputs, node.outputPortsWidth, node.layout.outputPortBottomPosX, this.getOutputPortBottomPosY(node));\n\t\t} else if (this.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\tthis.setPortPositionsVertical(node, node.inputs, node.inputPortsWidth, node.layout.inputPortBottomPosX, this.getInputPortBottomPosY(node));\n\t\t\tthis.setPortPositionsVertical(node, node.outputs, node.outputPortsWidth, node.layout.outputPortTopPosX, node.layout.outputPortTopPosY);\n\t\t} else {\n\t\t\tthis.setPortPositionsLeftRight(node, node.inputs, node.inputPortsHeight, node.layout.inputPortLeftPosX, node.layout.inputPortLeftPosY);\n\t\t\tthis.setPortPositionsLeftRight(node, node.outputs, node.outputPortsHeight,\n\t\t\t\tthis.nodeUtils.getNodeOutputPortRightPosX(node),\n\t\t\t\tthis.nodeUtils.getNodeOutputPortRightPosY(node),\n\t\t\t\tthis.config.enableSingleOutputPortDisplay);\n\t\t}\n\t}\n\n\tgetOutputPortBottomPosY(node) {\n\t\treturn node.height + node.layout.outputPortBottomPosY;\n\t}\n\n\tgetInputPortBottomPosY(node) {\n\t\treturn node.height + node.layout.inputPortBottomPosY;\n\t}\n\n\tsetPortPositionsVertical(data, ports, portsWidth, xPos, yPos) {\n\t\tif (ports && ports.length > 0) {\n\t\t\tif (data.width <= data.layout.defaultNodeWidth &&\n\t\t\t\t\tports.length === 1) {\n\t\t\t\tports[0].cx = xPos;\n\t\t\t\tports[0].cy = yPos;\n\t\t\t} else {\n\t\t\t\tlet xPosition = 0;\n\n\t\t\t\tif (CanvasUtils.isExpandedSupernode(data)) {\n\t\t\t\t\tconst widthSvgArea = data.width - (2 * this.canvasLayout.supernodeSVGAreaPadding);\n\t\t\t\t\tconst remainingSpace = widthSvgArea - portsWidth;\n\t\t\t\t\txPosition = (2 * this.canvasLayout.supernodeSVGAreaPadding) + (remainingSpace / 2);\n\n\t\t\t\t} else if (portsWidth < data.width) {\n\t\t\t\t\txPosition = (data.width - portsWidth) / 2;\n\t\t\t\t}\n\n\t\t\t\txPosition += data.layout.portArcOffset;\n\n\t\t\t\t// Sub-flow binding node ports need to be spaced by the inverse of the\n\t\t\t\t// zoom amount so that, after zoomToFit on the in-place sub-flow the\n\t\t\t\t// binding node ports line up with those on the supernode. This is only\n\t\t\t\t// necessary with binding nodes with mutiple ports.\n\t\t\t\tlet multiplier = 1;\n\t\t\t\tif (CanvasUtils.isSuperBindingNode(data)) {\n\t\t\t\t\tmultiplier = 1 / this.zoomTransform.k;\n\t\t\t\t}\n\n\t\t\t\tports.forEach((p) => {\n\t\t\t\t\txPosition += (data.layout.portArcRadius * multiplier);\n\t\t\t\t\tp.cx = xPosition;\n\t\t\t\t\tp.cy = yPos;\n\t\t\t\t\txPosition += ((data.layout.portArcRadius + data.layout.portArcSpacing) * multiplier);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPortPositionsLeftRight(data, ports, portsHeight, xPos, yPos, displaySinglePort = false) {\n\t\tif (ports && ports.length > 0) {\n\t\t\tif (data.height <= data.layout.defaultNodeHeight &&\n\t\t\t\t\tports.length === 1) {\n\t\t\t\tports[0].cx = xPos;\n\t\t\t\tports[0].cy = yPos;\n\t\t\t} else {\n\t\t\t\t// If we are only going to display a single port, we can set all the\n\t\t\t\t// port positions to be the same as if there is only one port.\n\t\t\t\tif (displaySinglePort) {\n\t\t\t\t\tthis.setPortPositionsLeftRightSinglePort(data, ports, xPos, yPos);\n\t\t\t\t} else {\n\t\t\t\t\tthis.setPortPositionsLeftRightAllPorts(data, ports, portsHeight, xPos, yPos);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Sets the ports x and y coordinates for regular and expanded supernodes\n\t// when all ports are displayed in a normal manner (as opposed to when a\n\t// single port is displayed).\n\tsetPortPositionsLeftRightAllPorts(data, ports, portsHeight, xPos, yPos) {\n\t\tlet yPosition = 0;\n\n\t\tif (CanvasUtils.isExpandedSupernode(data)) {\n\t\t\tconst heightSvgArea = data.height - this.canvasLayout.supernodeTopAreaHeight - this.canvasLayout.supernodeSVGAreaPadding;\n\t\t\tconst remainingSpace = heightSvgArea - portsHeight;\n\t\t\tyPosition = this.canvasLayout.supernodeTopAreaHeight + this.canvasLayout.supernodeSVGAreaPadding + (remainingSpace / 2);\n\n\t\t} else if (portsHeight < data.height) {\n\t\t\tyPosition = (data.height - portsHeight) / 2;\n\t\t}\n\n\t\tyPosition += data.layout.portArcOffset;\n\n\t\t// Sub-flow binding node ports need to be spaced by the inverse of the\n\t\t// zoom amount so that, after zoomToFit on the in-place sub-flow the\n\t\t// binding node ports line up with those on the supernode. This is only\n\t\t// necessary with binding nodes with mutiple ports.\n\t\tlet multiplier = 1;\n\t\tif (CanvasUtils.isSuperBindingNode(data)) {\n\t\t\tmultiplier = 1 / this.zoomTransform.k;\n\t\t}\n\t\tports.forEach((p) => {\n\t\t\tyPosition += (data.layout.portArcRadius * multiplier);\n\t\t\tp.cx = xPos;\n\t\t\tp.cy = yPosition;\n\t\t\tyPosition += ((data.layout.portArcRadius + data.layout.portArcSpacing) * multiplier);\n\t\t});\n\t}\n\n\t// If only a single port is to be displayed, this methods sets the x and y\n\t// coordinates of all the ports to the same values appropriately for either\n\t// regular nodes or expanded supernodes.\n\tsetPortPositionsLeftRightSinglePort(data, ports, xPos, yPos) {\n\t\tlet yPosition = 0;\n\t\tif (CanvasUtils.isExpandedSupernode(data)) {\n\t\t\tconst heightSvgArea = data.height - this.canvasLayout.supernodeTopAreaHeight - this.canvasLayout.supernodeSVGAreaPadding;\n\t\t\tyPosition = this.canvasLayout.supernodeTopAreaHeight + (heightSvgArea / 2);\n\n\t\t} else {\n\t\t\tyPosition = yPos;\n\t\t}\n\n\t\tports.forEach((p) => {\n\t\t\tp.cx = xPos;\n\t\t\tp.cy = yPosition;\n\t\t});\n\t}\n\n\t// Displays all the comments on the canvas either by creating new comments,\n\t// updating existing comments or removing unwanted comments.\n\tdisplayComments() {\n\t\tthis.logger.logStartTimer(\"displayComments \" + this.getFlags());\n\n\t\tconst selection = this.getAllCommentGroupsSelection();\n\t\tthis.displayCommentsSubset(selection, this.activePipeline.comments);\n\n\t\tthis.logger.logEndTimer(\"displayComments \" + this.getFlags());\n\t}\n\n\tdisplayMovedComments() {\n\t\tthis.logger.logStartTimer(\"displayMovedComments\");\n\n\t\tthis.getAllCommentGroupsSelection()\n\t\t\t.attr(\"transform\", (c) => `translate(${c.x_pos}, ${c.y_pos})`)\n\t\t\t.datum((d) => this.activePipeline.getComment(d.id));\n\n\t\tthis.logger.logEndTimer(\"displayMovedComments\");\n\t}\n\n\tdisplayCommentsSelectionStatus() {\n\t\tthis.logger.logStartTimer(\"displayCommentsSelectionStatus\");\n\n\t\tthis.getAllCommentGroupsSelection()\n\t\t\t.selectChildren(\".d3-comment-selection-highlight\")\n\t\t\t.attr(\"data-selected\", (c) => (this.activePipeline.isSelected(c.id) ? \"yes\" : \"no\"));\n\n\t\tthis.logger.logEndTimer(\"displayCommentsSelectionStatus\");\n\t}\n\n\tdisplaySingleComment(comment) {\n\t\tconst selection = this.getCommentGroupSelectionById(comment.id);\n\t\tthis.displayCommentsSubset(selection, [comment]);\n\t}\n\n\tdisplayCommentsSubset(selection, data) {\n\t\tselection\n\t\t\t.data(data, (c) => c.id)\n\t\t\t.join(\n\t\t\t\t(enter) => this.createComments(enter)\n\t\t\t)\n\t\t\t.attr(\"transform\", (c) => `translate(${c.x_pos}, ${c.y_pos})`)\n\t\t\t.attr(\"class\", (c) => this.getCommentGroupClass(c))\n\t\t\t.call((joinedCommentGrps) => this.updateComments(joinedCommentGrps));\n\t}\n\n\tcreateComments(enter) {\n\t\tconst newCommentGroups = enter\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"data-id\", (c) => this.getId(\"comment_grp\", c.id))\n\t\t\t.call(this.attachCommentGroupListeners.bind(this));\n\n\t\tif (this.config.enableEditingActions) {\n\t\t\tnewCommentGroups\n\t\t\t\t.call(this.drag);\t // Must put drag after mousedown listener so mousedown gets called first.\n\t\t}\n\n\t\t// Comment Sizing Area\n\t\tnewCommentGroups\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"class\", \"d3-comment-sizing\")\n\t\t\t.call(this.attachCommentSizingListeners.bind(this));\n\n\t\t// Comment Selection Highlighting Outline\n\t\tnewCommentGroups\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"class\", \"d3-comment-selection-highlight\");\n\n\t\t// Background Rectangle\n\t\tnewCommentGroups\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"width\", (c) => c.width)\n\t\t\t.attr(\"height\", (c) => c.height)\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", 0)\n\t\t\t.attr(\"class\", \"d3-comment-rect\");\n\n\t\t// Comment Text\n\t\tnewCommentGroups\n\t\t\t.append(\"foreignObject\")\n\t\t\t.attr(\"class\", \"d3-foreign-object-comment-text\")\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", 0)\n\t\t\t.append(\"xhtml:div\") // Provide a namespace when div is inside foreignObject\n\t\t\t.attr(\"class\", \"d3-comment-text\");\n\n\t\treturn newCommentGroups;\n\t}\n\n\tupdateComments(joinedCommentGrps) {\n\t\tjoinedCommentGrps\n\t\t\t.attr(\"transform\", (c) => `translate(${c.x_pos}, ${c.y_pos})`)\n\t\t\t.attr(\"class\", (c) => this.getCommentGroupClass(c));\n\n\t\t// Comment Sizing Area\n\t\tjoinedCommentGrps.selectChildren(\".d3-comment-sizing\")\n\t\t\t.datum((c) => this.activePipeline.getComment(c.id))\n\t\t\t.attr(\"x\", -this.canvasLayout.commentSizingArea)\n\t\t\t.attr(\"y\", -this.canvasLayout.commentSizingArea)\n\t\t\t.attr(\"height\", (c) => c.height + (2 * this.canvasLayout.commentSizingArea))\n\t\t\t.attr(\"width\", (c) => c.width + (2 * this.canvasLayout.commentSizingArea))\n\t\t\t.attr(\"class\", \"d3-comment-sizing\");\n\n\t\t// Comment Selection Highlighting Outline\n\t\tjoinedCommentGrps.selectChildren(\".d3-comment-selection-highlight\")\n\t\t\t.datum((c) => this.activePipeline.getComment(c.id))\n\t\t\t.attr(\"x\", -this.canvasLayout.commentHighlightGap)\n\t\t\t.attr(\"y\", -this.canvasLayout.commentHighlightGap)\n\t\t\t.attr(\"height\", (c) => c.height + (2 * this.canvasLayout.commentHighlightGap))\n\t\t\t.attr(\"width\", (c) => c.width + (2 * this.canvasLayout.commentHighlightGap))\n\t\t\t.attr(\"data-selected\", (c) => (this.activePipeline.isSelected(c.id) ? \"yes\" : \"no\"))\n\t\t\t.attr(\"style\", (d) => this.getNodeSelectionOutlineStyle(d, \"default\"));\n\n\t\t// Comment Body\n\t\tjoinedCommentGrps.selectChildren(\".d3-comment-rect\")\n\t\t\t.datum((c) => this.activePipeline.getComment(c.id))\n\t\t\t.attr(\"height\", (c) => c.height)\n\t\t\t.attr(\"width\", (c) => c.width)\n\t\t\t.attr(\"class\", \"d3-comment-rect\")\n\t\t\t.attr(\"style\", (c) => this.getCommentBodyStyle(c, \"default\"));\n\n\t\t// Comment Text\n\t\tjoinedCommentGrps.selectChildren(\".d3-foreign-object-comment-text\")\n\t\t\t.datum((c) => this.activePipeline.getComment(c.id))\n\t\t\t.attr(\"width\", (c) => c.width)\n\t\t\t.attr(\"height\", (c) => c.height)\n\t\t\t.select(\"div\")\n\t\t\t.attr(\"style\", (c) => this.getNodeLabelStyle(c, \"default\"))\n\t\t\t.html((c) => (\n\t\t\t\tthis.config.enableMarkdownInComments\n\t\t\t\t\t? markdownIt.render(c.content)\n\t\t\t\t\t: escapeText(c.content)));\n\t}\n\n\t// Attaches the appropriate listeners to the comment groups.\n\tattachCommentGroupListeners(commentGrps) {\n\t\tcommentGrps\n\t\t\t.on(\"mouseenter\", (d3Event, d) => {\n\t\t\t\tthis.setCommentStyles(d, \"hover\", d3.select(d3Event.currentTarget));\n\t\t\t\tif (this.config.enableEditingActions && d.id !== this.svgCanvasTextArea.getEditingTextId()) {\n\t\t\t\t\tthis.createCommentPort(d3Event.currentTarget, d);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", (d3Event, d) => {\n\t\t\t\tthis.setCommentStyles(d, \"default\", d3.select(d3Event.currentTarget));\n\t\t\t\tif (this.config.enableEditingActions) {\n\t\t\t\t\tthis.deleteCommentPort(d3Event.currentTarget);\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Use mouse down instead of click because it gets called before drag start.\n\t\t\t.on(\"mousedown\", (d3Event, d) => {\n\t\t\t\tthis.logger.logStartTimer(\"Comment Group - mouse down\");\n\t\t\t\tif (this.svgCanvasTextArea.isEditingText()) {\n\t\t\t\t\tthis.svgCanvasTextArea.completeEditing();\n\t\t\t\t}\n\t\t\t\tif (!this.config.enableDragWithoutSelect) {\n\t\t\t\t\tthis.selectObjectD3Event(d3Event, d);\n\t\t\t\t}\n\t\t\t\tthis.logger.logEndTimer(\"Comment Group - mouse down\");\n\t\t\t})\n\t\t\t.on(\"click\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Comment Group - click\");\n\t\t\t\td3Event.stopPropagation();\n\t\t\t})\n\t\t\t.on(\"dblclick\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Comment Group - double click\");\n\t\t\t\tif (this.config.enableEditingActions) {\n\t\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event);\n\n\t\t\t\t\tthis.deleteCommentPort(d3Event.currentTarget);\n\t\t\t\t\tthis.displayCommentTextArea(d, d3Event.currentTarget);\n\n\t\t\t\t\tthis.canvasController.clickActionHandler({\n\t\t\t\t\t\tclickType: \"DOUBLE_CLICK\",\n\t\t\t\t\t\tobjectType: \"comment\",\n\t\t\t\t\t\tid: d.id,\n\t\t\t\t\t\tselectedObjectIds: this.activePipeline.getSelectedObjectIds(),\n\t\t\t\t\t\tpipelineId: this.activePipeline.id });\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"contextmenu\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Comment Group - context menu\");\n\t\t\t\t// With enableDragWithoutSelect set to true, the object for which the\n\t\t\t\t// context menu is being requested needs to be implicitely selected.\n\t\t\t\tif (this.config.enableDragWithoutSelect) {\n\t\t\t\t\tthis.selectObjectD3Event(d3Event, d);\n\t\t\t\t}\n\t\t\t\tthis.openContextMenu(d3Event, \"comment\", d);\n\t\t\t});\n\t}\n\n\tattachCommentSizingListeners(commentGrps) {\n\t\tcommentGrps\n\t\t\t.on(\"mousedown\", (d3Event, d) => {\n\t\t\t\tthis.commentSizing = true;\n\t\t\t\t// Note - comment resizing and finalization of size is handled by drag functions.\n\t\t\t\tthis.addTempCursorOverlay(this.commentSizingCursor);\n\t\t\t})\n\t\t\t// Use mousemove here rather than mouseenter so the cursor will change\n\t\t\t// if the pointer moves from one area of the node outline to another\n\t\t\t// (eg. from east area to north-east area) without exiting the node outline.\n\t\t\t// A mouseenter is triggered when the sizing operation stops and the\n\t\t\t// pointer leaves the temporary overlay (which is removed) and enters\n\t\t\t// the node outline.\n\t\t\t.on(\"mousemove mouseenter\", (d3Event, d) => {\n\t\t\t\tif (this.config.enableEditingActions && // Only set cursor when we are able to edit comments\n\t\t\t\t\t!this.isRegionSelectOrSizingInProgress()) // Don't switch sizing direction if we are already sizing\n\t\t\t\t{\n\t\t\t\t\tlet cursorType = \"default\";\n\t\t\t\t\tif (!this.isPointerCloseToBodyEdge(d3Event, d)) {\n\t\t\t\t\t\tthis.commentSizingDirection = this.getSizingDirection(d3Event, d, this.canvasLayout.commentCornerResizeArea);\n\t\t\t\t\t\tthis.commentSizingCursor = this.getCursorBasedOnDirection(this.commentSizingDirection);\n\t\t\t\t\t\tcursorType = this.commentSizingCursor;\n\t\t\t\t\t}\n\t\t\t\t\td3.select(d3Event.currentTarget).style(\"cursor\", cursorType);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t// Creates a port object (a grey circle in the top left corner of the\n\t// comment for creating links to nodes) for the comment asscoiated with\n\t// the comment group object passed in.\n\tcreateCommentPort(commentObj, d) {\n\t\tconst commentGrp = d3.select(commentObj);\n\n\t\tcommentGrp\n\t\t\t.append(\"circle\")\n\t\t\t.attr(\"cx\", (com) => com.width / 2)\n\t\t\t.attr(\"cy\", (com) => com.height + this.canvasLayout.commentHighlightGap)\n\t\t\t.attr(\"r\", this.canvasLayout.commentPortRadius)\n\t\t\t.attr(\"class\", \"d3-comment-port-circle\")\n\t\t\t.on(\"mousedown\", (d3Event, cd) => {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(d3Event); // Stops the node drag behavior when clicking on the handle/circle\n\t\t\t\tthis.drawingNewLinkData = {\n\t\t\t\t\tsrcObjId: d.id,\n\t\t\t\t\taction: COMMENT_LINK,\n\t\t\t\t\tstartPos: {\n\t\t\t\t\t\tx: d.x_pos - this.canvasLayout.commentHighlightGap,\n\t\t\t\t\t\ty: d.y_pos - this.canvasLayout.commentHighlightGap\n\t\t\t\t\t},\n\t\t\t\t\tlinkArray: []\n\t\t\t\t};\n\t\t\t\tthis.drawNewLink(d3Event);\n\t\t\t});\n\n\t}\n\n\tdeleteCommentPort(commentObj) {\n\t\td3.select(commentObj)\n\t\t\t.selectChildren(\".d3-comment-port-circle\")\n\t\t\t.remove();\n\t}\n\n\tsetCommentStyles(d, type, comGrp) {\n\t\tthis.setCommentSelectionOutlineStyles(d, type, comGrp);\n\t\tthis.setCommentBodyStyles(d, type, comGrp);\n\t\tthis.setCommentTextStyles(d, type, comGrp);\n\t}\n\n\tsetCommentSelectionOutlineStyles(d, type, comGrp) {\n\t\tconst style = this.getCommentSelectionOutlineStyle(d, type);\n\t\tcomGrp.selectChildren(\".d3-comment-selection-highlight\").attr(\"style\", style);\n\t}\n\n\tsetCommentBodyStyles(d, type, comGrp) {\n\t\tconst style = this.getCommentBodyStyle(d, type);\n\t\tcomGrp.selectChildren(\".d3-comment-rect\").attr(\"style\", style);\n\t}\n\n\tsetCommentTextStyles(d, type, comGrp) {\n\t\tconst style = this.getCommentTextStyle(d, type);\n\t\tcomGrp.selectChildren(\".d3-foreign-object-comment-text\").select(\"div\")\n\t\t\t.attr(\"style\", style);\n\t}\n\n\tgetCommentSelectionOutlineStyle(d, type) {\n\t\treturn CanvasUtils.getObjectStyle(d, \"selection_outline\", type);\n\t}\n\n\tgetCommentBodyStyle(d, type) {\n\t\treturn CanvasUtils.getObjectStyle(d, \"body\", type);\n\t}\n\n\tgetCommentTextStyle(d, type) {\n\t\treturn CanvasUtils.getObjectStyle(d, \"text\", type);\n\t}\n\n\tdisplayCommentTextArea(comment, parentDomObj) {\n\t\tthis.svgCanvasTextArea.displayCommentTextArea(comment, parentDomObj);\n\t}\n\n\tdisplayNodeLabelTextArea(node, parentDomObj) {\n\t\tthis.svgCanvasTextArea.displayNodeLabelTextArea(node, parentDomObj);\n\t}\n\n\tdisplayDecLabelTextArea(dec, obj, objType, parentDomObj) {\n\t\tthis.svgCanvasTextArea.displayDecLabelTextArea(dec, obj, objType, parentDomObj);\n\t}\n\n\t// Adds a rectangle over the top of the canvas which is used to display a\n\t// temporary pointer cursor style (like the crosshair while doing a region\n\t// select operation). This allows the same cursor to be displayed even when\n\t// the pointer is moved over the top of objects that have their own cursor\n\t// styles set in the CSS because the style for the overlay rectangle overrides\n\t// any cursor styles of the underlying objects.\n\taddTempCursorOverlay(cursorStyle) {\n\t\tif (this.dispUtils.isDisplayingFullPage()) {\n\t\t\tif (this.canvasDiv.selectAll(\".d3-temp-cursor-overlay\").size() > 0) {\n\t\t\t\tthis.removeTempCursorOverlay();\n\t\t\t}\n\n\t\t\tthis.canvasSVG\n\t\t\t\t.append(\"rect\")\n\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t.attr(\"y\", 0)\n\t\t\t\t.attr(\"width\", \"100%\")\n\t\t\t\t.attr(\"height\", \"100%\")\n\t\t\t\t.attr(\"data-pipeline-id\", this.activePipeline.id)\n\t\t\t\t.attr(\"class\", \"d3-temp-cursor-overlay\")\n\t\t\t\t.attr(\"pointer-events\", \"all\")\n\t\t\t\t.style(\"cursor\", cursorStyle);\n\t\t}\n\t}\n\n\t// Removes the temporary cursor overlay.\n\tremoveTempCursorOverlay() {\n\t\tif (this.dispUtils.isDisplayingFullPage()) {\n\t\t\tthis.canvasDiv.selectAll(\".d3-temp-cursor-overlay\").remove();\n\t\t}\n\t}\n\n\t// Returns true if this renderer or any of its ancestors are currently in the\n\t// process of selecting a region or sizing a node or comment.\n\tisRegionSelectOrSizingInProgress() {\n\t\tif (this.regionSelect || this.nodeSizing || this.commentSizing) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this.supernodeInfo.renderer) {\n\t\t\tif (this.supernodeInfo.renderer.isRegionSelectOrSizingInProgress()) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t// This method allows us to avoid a strange behavior which only appears in the\n\t// Chrome browser. That is, when the mouse pointer is inside the\n\t// node/comment selection highlight area but is close to either the\n\t// right or bottom side of the node/comment body, any mousedown events will go\n\t// to the body instead of the highlight area. We use this method to detect\n\t// this situation and use the result to decide whether to display the sizing\n\t// cursor or not.\n\tisPointerCloseToBodyEdge(d3Event, d) {\n\t\tconst pos = this.getTransformedMousePos(d3Event);\n\t\tconst rightEdge = d.x_pos + d.width;\n\t\tconst bottomEdge = d.y_pos + d.height;\n\n\t\t// Is the pointer within 1 pixel of the right edge of the node or comment\n\t\tconst rightEdgeState =\n\t\t\tpos.x >= rightEdge && pos.x <= rightEdge + 1 &&\n\t\t\tpos.y >= 0 && pos.y <= bottomEdge;\n\n\t\t// Is the pointer within 1 pixel of the bottom edge of the node or comment\n\t\tconst bottomEdgeState =\n\t\t\tpos.y >= bottomEdge && pos.y <= bottomEdge + 1 &&\n\t\t\tpos.x >= 0 && pos.x <= rightEdge;\n\n\t\treturn rightEdgeState || bottomEdgeState;\n\t}\n\n\t// Returns the comment or supernode sizing direction (i.e. one of n, s, e, w, nw, ne,\n\t// sw or se) based on the current mouse position and the position and\n\t// dimensions of the comment or node outline.\n\tgetSizingDirection(d3Event, d, cornerResizeArea) {\n\t\tvar xPart = \"\";\n\t\tvar yPart = \"\";\n\n\t\tconst transPos = this.getTransformedMousePos(d3Event);\n\t\tif (transPos.x < d.x_pos + cornerResizeArea) {\n\t\t\txPart = \"w\";\n\t\t} else if (transPos.x > d.x_pos + d.width - cornerResizeArea) {\n\t\t\txPart = \"e\";\n\t\t}\n\t\tif (transPos.y < d.y_pos + cornerResizeArea) {\n\t\t\tyPart = \"n\";\n\t\t} else if (transPos.y > d.y_pos + d.height - cornerResizeArea) {\n\t\t\tyPart = \"s\";\n\t\t}\n\n\t\treturn yPart + xPart;\n\t}\n\n\t// Returns a cursor type based on the currect comment sizing direction.\n\t// Possible values are: ns-resize, ew-resize, nwse-resize or nesw-resize.\n\tgetCursorBasedOnDirection(direction) {\n\t\tvar cursorType;\n\t\tswitch (direction) {\n\t\tcase \"n\":\n\t\tcase \"s\":\n\t\t\tcursorType = \"ns-resize\";\n\t\t\tbreak;\n\t\tcase \"e\":\n\t\tcase \"w\":\n\t\t\tcursorType = \"ew-resize\";\n\t\t\tbreak;\n\t\tcase \"nw\":\n\t\tcase \"se\":\n\t\t\tcursorType = \"nwse-resize\";\n\t\t\tbreak;\n\t\tcase \"ne\":\n\t\tcase \"sw\":\n\t\t\tcursorType = \"nesw-resize\";\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tcursorType = \"\";\n\t\t}\n\n\t\treturn cursorType;\n\t}\n\n\t// Returns the minimum allowed height for the node passed in. For supernodes\n\t// this means combining the bigger of the space for the inputs and output ports\n\t// with some space for the top of the display frame and the padding at the\n\t// bottom of the frame. Then the bigger of that height versus the default\n\t// supernode minimum height is retunred.\n\tgetMinHeight(node) {\n\t\tif (CanvasUtils.isSupernode(node)) {\n\t\t\tconst minHt = Math.max(node.inputPortsHeight, node.outputPortsHeight) +\n\t\t\t\tthis.canvasLayout.supernodeTopAreaHeight + this.canvasLayout.supernodeSVGAreaPadding;\n\t\t\treturn Math.max(this.canvasLayout.supernodeMinHeight, minHt);\n\t\t}\n\t\treturn node.layout.defaultNodeHeight;\n\t}\n\n\t// Returns the minimum allowed width for the node passed in.\n\tgetMinWidth(node) {\n\t\tif (CanvasUtils.isSupernode(node)) {\n\t\t\treturn this.canvasLayout.supernodeMinWidth;\n\t\t}\n\t\treturn node.layout.defaultNodeWidth;\n\t}\n\n\t// Sets the size and position of the node in the canvasInfo.nodes\n\t// array based on the position of the pointer during the resize action\n\t// then redraws the nodes and links (the link positions may move based\n\t// on the node size change).\n\tresizeNode(d3Event, resizeObj) {\n\t\tconst oldSupernode = Object.assign({}, resizeObj);\n\t\tconst minHeight = this.getMinHeight(resizeObj);\n\t\tconst minWidth = this.getMinWidth(resizeObj);\n\n\t\tconst delta = this.resizeObject(d3Event, resizeObj,\n\t\t\tthis.nodeSizingDirection, minWidth, minHeight);\n\n\t\tif (delta && (delta.x_pos !== 0 || delta.y_pos !== 0 || delta.width !== 0 || delta.height !== 0)) {\n\t\t\tif (CanvasUtils.isSupernode(resizeObj) &&\n\t\t\t\t\tthis.config.enableMoveNodesOnSupernodeResize) {\n\t\t\t\tconst objectsInfo = CanvasUtils.moveSurroundingObjects(\n\t\t\t\t\toldSupernode,\n\t\t\t\t\tthis.activePipeline.getNodesAndComments(),\n\t\t\t\t\tthis.nodeSizingDirection,\n\t\t\t\t\tresizeObj.width,\n\t\t\t\t\tresizeObj.height,\n\t\t\t\t\ttrue // Pass true to indicate that object positions should be updated.\n\t\t\t\t);\n\n\t\t\t\tconst linksInfo = CanvasUtils.moveSurroundingDetachedLinks(\n\t\t\t\t\toldSupernode,\n\t\t\t\t\tthis.activePipeline.links,\n\t\t\t\t\tthis.nodeSizingDirection,\n\t\t\t\t\tresizeObj.width,\n\t\t\t\t\tresizeObj.height,\n\t\t\t\t\ttrue // Pass true to indicate that link positions should be updated.\n\t\t\t\t);\n\n\t\t\t\t// Overwrite the object and link info with any new info.\n\t\t\t\tthis.nodeSizingObjectsInfo = Object.assign(this.nodeSizingObjectsInfo, objectsInfo);\n\t\t\t\tthis.nodeSizingDetLinksInfo = Object.assign(this.nodeSizingDetLinksInfo, linksInfo);\n\t\t\t}\n\n\t\t\tthis.logger.logStartTimer(\"displayObjects\");\n\n\t\t\tthis.displayMovedComments();\n\t\t\tthis.displayMovedNodes();\n\t\t\tthis.displaySingleNode(resizeObj);\n\t\t\tthis.displayMovedLinks();\n\t\t\tthis.displayCanvasAccoutrements();\n\n\t\t\tif (CanvasUtils.isSupernode(resizeObj)) {\n\t\t\t\tif (this.dispUtils.isDisplayingSubFlow()) {\n\t\t\t\t\tthis.displayBindingNodesToFitSVG();\n\t\t\t\t}\n\t\t\t\tthis.superRenderers.forEach((renderer) => renderer.displaySVGToFitSupernode());\n\t\t\t}\n\t\t\tthis.logger.logEndTimer(\"displayObjects\");\n\t\t}\n\t}\n\n\t// Sets the size and position of the comment in the canvasInfo.comments\n\t// array based on the position of the pointer during the resize action\n\t// then redraws the comment and links (the link positions may move based\n\t// on the comment size change).\n\tresizeComment(d3Event, resizeObj) {\n\t\tthis.resizeObject(d3Event, resizeObj, this.commentSizingDirection, 20, 20);\n\t\tthis.displaySingleComment(resizeObj);\n\t\tthis.displayMovedLinks();\n\t\tthis.displayCanvasAccoutrements();\n\t}\n\n\t// Sets the size and position of the object in the canvasInfo\n\t// array based on the position of the pointer during the resize action.\n\tresizeObject(d3Event, canvasObj, direction, minWidth, minHeight) {\n\t\tlet incrementX = 0;\n\t\tlet incrementY = 0;\n\t\tlet incrementWidth = 0;\n\t\tlet incrementHeight = 0;\n\n\t\tif (direction.indexOf(\"e\") > -1) {\n\t\t\tincrementWidth += d3Event.dx;\n\t\t}\n\t\tif (direction.indexOf(\"s\") > -1) {\n\t\t\tincrementHeight += d3Event.dy;\n\t\t}\n\t\tif (direction.indexOf(\"n\") > -1) {\n\t\t\tincrementY += d3Event.dy;\n\t\t\tincrementHeight -= d3Event.dy;\n\t\t}\n\t\tif (direction.indexOf(\"w\") > -1) {\n\t\t\tincrementX += d3Event.dx;\n\t\t\tincrementWidth -= d3Event.dx;\n\t\t}\n\n\t\tlet xPos = 0;\n\t\tlet yPos = 0;\n\t\tlet width = 0;\n\t\tlet height = 0;\n\n\t\tif (this.config.enableSnapToGridType === SNAP_TO_GRID_DURING) {\n\t\t\t// Calculate where the object being resized would be and its size given\n\t\t\t// current increments.\n\t\t\tthis.notSnappedXPos += incrementX;\n\t\t\tthis.notSnappedYPos += incrementY;\n\t\t\tthis.notSnappedWidth += incrementWidth;\n\t\t\tthis.notSnappedHeight += incrementHeight;\n\n\t\t\txPos = CanvasUtils.snapToGrid(this.notSnappedXPos, this.canvasLayout.snapToGridXPx);\n\t\t\tyPos = CanvasUtils.snapToGrid(this.notSnappedYPos, this.canvasLayout.snapToGridYPx);\n\t\t\twidth = CanvasUtils.snapToGrid(this.notSnappedWidth, this.canvasLayout.snapToGridXPx);\n\t\t\theight = CanvasUtils.snapToGrid(this.notSnappedHeight, this.canvasLayout.snapToGridYPx);\n\n\t\t\twidth = Math.max(width, minWidth);\n\t\t\theight = Math.max(height, minHeight);\n\n\t\t} else {\n\t\t\txPos = canvasObj.x_pos + incrementX;\n\t\t\tyPos = canvasObj.y_pos + incrementY;\n\t\t\twidth = canvasObj.width + incrementWidth;\n\t\t\theight = canvasObj.height + incrementHeight;\n\t\t}\n\n\t\t// Don't allow the object area to shrink below the min width and height.\n\t\t// For comment sizing, errors may occur especially if the width becomes\n\t\t// less that one character's width. For node sizing we want at least some\n\t\t// area to display the sub-flow.\n\t\tif (width < minWidth || height < minHeight) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst delta = {\n\t\t\twidth: width - canvasObj.width,\n\t\t\theight: height - canvasObj.height,\n\t\t\tx_pos: xPos - canvasObj.x_pos,\n\t\t\ty_pos: yPos - canvasObj.y_pos\n\t\t};\n\n\t\tcanvasObj.x_pos = xPos;\n\t\tcanvasObj.y_pos = yPos;\n\t\tcanvasObj.width = width;\n\t\tcanvasObj.height = height;\n\n\t\treturn delta;\n\t}\n\n\t// Finalises the sizing of a node by calling editActionHandler\n\t// with an editNode action.\n\tendNodeSizing(node) {\n\t\tlet resizeObj = node;\n\t\tif (this.config.enableSnapToGridType === SNAP_TO_GRID_AFTER) {\n\t\t\tresizeObj = this.snapToGridObject(resizeObj);\n\t\t\tresizeObj = this.restrictNodeSizingToMinimums(resizeObj);\n\t\t}\n\n\t\t// If the dimensions or position has changed, issue the \"resizeObjects\" command.\n\t\t// Note: x_pos or y_pos might change on resize if the node is sized\n\t\t// upwards or to the left.\n\t\tif (this.resizeObjInitialInfo.x_pos !== resizeObj.x_pos ||\n\t\t\t\tthis.resizeObjInitialInfo.y_pos !== resizeObj.y_pos ||\n\t\t\t\tthis.resizeObjInitialInfo.width !== resizeObj.width ||\n\t\t\t\tthis.resizeObjInitialInfo.height !== resizeObj.height) {\n\t\t\t// Add the dimensions of the object being resized to the array of object infos.\n\t\t\tthis.nodeSizingObjectsInfo[resizeObj.id] = {\n\t\t\t\twidth: resizeObj.width,\n\t\t\t\theight: resizeObj.height,\n\t\t\t\tx_pos: resizeObj.x_pos,\n\t\t\t\ty_pos: resizeObj.y_pos\n\t\t\t};\n\n\t\t\t// If the node has been resized set the resize properties appropriately.\n\t\t\t// We use some padding because sometimes, when a node is sized back to its\n\t\t\t// original dimensions, it isn't retunred to EXACTLY its default width/height.\n\t\t\tif (resizeObj.height > resizeObj.layout.defaultNodeHeight + 2 ||\n\t\t\t\t\tresizeObj.width > resizeObj.layout.defaultNodeWidth + 2) {\n\t\t\t\tthis.nodeSizingObjectsInfo[resizeObj.id].isResized = true;\n\t\t\t\tthis.nodeSizingObjectsInfo[resizeObj.id].resizeWidth = resizeObj.width;\n\t\t\t\tthis.nodeSizingObjectsInfo[resizeObj.id].resizeHeight = resizeObj.height;\n\t\t\t}\n\n\t\t\tthis.canvasController.editActionHandler({\n\t\t\t\teditType: \"resizeObjects\",\n\t\t\t\teditSource: \"canvas\",\n\t\t\t\tobjectsInfo: this.nodeSizingObjectsInfo,\n\t\t\t\tdetachedLinksInfo: this.nodeSizingDetLinksInfo,\n\t\t\t\tpipelineId: this.pipelineId\n\t\t\t});\n\t\t}\n\t\tthis.nodeSizing = false;\n\t\tthis.nodeSizingObjectsInfo = {};\n\t\tthis.nodeSizingDetLinksInfo = {};\n\t}\n\n\t// Finalises the sizing of a comment by calling editActionHandler\n\t// with an editComment action.\n\tendCommentSizing(comment) {\n\t\tlet resizeObj = comment;\n\t\tif (this.config.enableSnapToGridType === SNAP_TO_GRID_AFTER) {\n\t\t\tresizeObj = this.snapToGridObject(resizeObj);\n\t\t}\n\n\t\t// If the dimensions or position has changed, issue the command.\n\t\t// Note: x_pos or y_pos might change on resize if the node is sized\n\t\t// upwards or to the left.\n\t\tif (this.resizeObjInitialInfo.x_pos !== resizeObj.x_pos ||\n\t\t\t\tthis.resizeObjInitialInfo.y_pos !== resizeObj.y_pos ||\n\t\t\t\tthis.resizeObjInitialInfo.width !== resizeObj.width ||\n\t\t\t\tthis.resizeObjInitialInfo.height !== resizeObj.height) {\n\t\t\tconst commentSizingObjectsInfo = [];\n\t\t\tcommentSizingObjectsInfo[resizeObj.id] = {\n\t\t\t\twidth: resizeObj.width,\n\t\t\t\theight: resizeObj.height,\n\t\t\t\tx_pos: resizeObj.x_pos,\n\t\t\t\ty_pos: resizeObj.y_pos\n\t\t\t};\n\n\t\t\tconst data = {\n\t\t\t\teditType: \"resizeObjects\",\n\t\t\t\teditSource: \"canvas\",\n\t\t\t\tobjectsInfo: commentSizingObjectsInfo,\n\t\t\t\tdetachedLinksInfo: {}, // Comments cannot have detached links\n\t\t\t\tpipelineId: this.pipelineId\n\t\t\t};\n\t\t\tthis.canvasController.editActionHandler(data);\n\t\t}\n\t\tthis.commentSizing = false;\n\t}\n\n\t// Ensure the snap-to-grid does not make the width or height smaller than\n\t// the minimums allowed.\n\trestrictNodeSizingToMinimums(resizeObj) {\n\t\tconst minHeight = this.getMinHeight(resizeObj);\n\t\tconst minWidth = this.getMinWidth(resizeObj);\n\t\tresizeObj.width = Math.max(resizeObj.width, minWidth);\n\t\tresizeObj.height = Math.max(resizeObj.height, minHeight);\n\t\treturn resizeObj;\n\t}\n\n\t// Displays all the links on the canvas either by creating new links,\n\t// updating existing links or removing unwanted links.\n\tdisplayLinks() {\n\t\tthis.logger.logStartTimer(\"displayLinks\");\n\n\t\tconst linksArray = this.buildLinksArray();\n\t\tconst selection = this.getAllLinkGroupsSelection();\n\t\tthis.displayLinksSubset(selection, linksArray);\n\n\t\tthis.logger.logEndTimer(\"displayLinks\");\n\t}\n\n\tdisplayLinksSelectionStatus() {\n\t\tthis.logger.logStartTimer(\"displayLinksSelectionStatus\");\n\n\t\tif (this.config.enableLinkSelection !== LINK_SELECTION_NONE) {\n\t\t\tthis.getAllLinkGroupsSelection()\n\t\t\t\t.attr(\"data-selected\", (d) => (this.activePipeline.isSelected(d.id) ? true : null));\n\t\t}\n\n\t\tthis.logger.logEndTimer(\"displayLinksSelectionStatus\");\n\t}\n\n\tdisplayMovedLinks() {\n\t\tthis.logger.logStartTimer(\"displayMovedLinks\");\n\n\t\tconst linksArray = this.buildLinksArray();\n\t\tconst movedLinks = linksArray.filter((l) => l.coordsUpdated);\n\n\t\tmovedLinks.forEach((l) => {\n\t\t\tthis.displaySingleLink(l);\n\t\t});\n\n\t\tthis.logger.logEndTimer(\"displayMovedLinks\");\n\t}\n\n\tdisplaySingleLink(link) {\n\t\tconst selection = this.getLinkGroupSelectionById(link.id);\n\t\tthis.displayLinksSubset(selection, [link]);\n\t}\n\n\tdisplayLinksSubset(selection, linksArray) {\n\t\tselection\n\t\t\t.data(linksArray, (link) => link.id)\n\t\t\t.join(\n\t\t\t\t(enter) => this.createLinks(enter)\n\t\t\t)\n\t\t\t.attr(\"class\", (d) => this.getLinkGroupClass(d))\n\t\t\t.attr(\"style\", (d) => this.getLinkGrpStyle(d))\n\t\t\t.attr(\"data-selected\", (d) => (this.activePipeline.isSelected(d.id) ? true : null))\n\t\t\t.call((joinedLinkGrps) => {\n\t\t\t\tthis.updateLinks(joinedLinkGrps, linksArray);\n\t\t\t});\n\t}\n\n\t// Creates all newly created links specified in the enter selection.\n\tcreateLinks(enter) {\n\t\t// Add groups for links\n\t\tconst newLinkGrps = enter.append(\"g\")\n\t\t\t.attr(\"data-id\", (d) => this.getId(\"link_grp\", d.id))\n\t\t\t.call(this.attachLinkGroupListeners.bind(this));\n\n\t\t// Add selection area for link line\n\t\tnewLinkGrps\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", (d) => this.getLinkSelectionAreaClass(d));\n\n\t\t// Add displayed link line\n\t\tnewLinkGrps\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"d3-link-line\");\n\n\t\t// Add displayed link line arrow heads\n\t\tnewLinkGrps\n\t\t\t.filter((d) => (d.type === NODE_LINK && this.canvasLayout.dataLinkArrowHead) ||\n\t\t\t\t\t\t\t\t\t\t\t(d.type === COMMENT_LINK && this.canvasLayout.commentLinkArrowHead) ||\n\t\t\t\t\t\t\t\t\t\t\t(d.type === NODE_LINK && this.canvasLayout.linkType === LINK_TYPE_STRAIGHT))\n\t\t\t.append(\"path\")\n\t\t\t.attr(\"class\", \"d3-link-line-arrow-head\");\n\n\t\t// Add a group to store decorations. Adding this here ensures the decorations\n\t\t// are always under the link handles whose group is added next.\n\t\tnewLinkGrps\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"d3-link-decorations-group\");\n\n\t\t// Add a group to store link handles, if needed.\n\t\tif (this.config.enableLinkSelection === LINK_SELECTION_HANDLES ||\n\t\t\t\tthis.config.enableLinkSelection === LINK_SELECTION_DETACHABLE) {\n\t\t\tnewLinkGrps\n\t\t\t\t.append(\"g\")\n\t\t\t\t.attr(\"class\", \"d3-link-handles-group\")\n\t\t\t\t.each((d, i, linkGrps) => {\n\t\t\t\t\tif (d.type === NODE_LINK) {\n\t\t\t\t\t\t// Since there are always just two handles we create the here.\n\t\t\t\t\t\tthis.createNewHandles(d3.select(linkGrps[i]));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\n\t\treturn newLinkGrps;\n\t}\n\n\t// Updates all the link groups (and descendant objects) in the joinedLinkGrps\n\t// selection object. The selection object will contain newly created links\n\t// as well as existing links.\n\tupdateLinks(joinedLinkGrps, lineArray) {\n\t\t// Update link selection area\n\t\tjoinedLinkGrps\n\t\t\t.selectAll(\".d3-link-selection-area\")\n\t\t\t.datum((d) => this.activePipeline.getLink(d.id))\n\t\t\t.attr(\"d\", (d) => d.pathInfo.path);\n\n\t\t// Update link line\n\t\tjoinedLinkGrps\n\t\t\t.selectAll(\".d3-link-line\")\n\t\t\t.datum((d) => this.activePipeline.getLink(d.id))\n\t\t\t.attr(\"d\", (d) => d.pathInfo.path)\n\t\t\t.attr(\"class\", \"d3-link-line\")\n\t\t\t.attr(\"style\", (d) => CanvasUtils.getObjectStyle(d, \"line\", \"default\"));\n\n\t\t// Update link line arrow head\n\t\tjoinedLinkGrps\n\t\t\t.filter((d) => (d.type === NODE_LINK && this.canvasLayout.dataLinkArrowHead) ||\n\t\t\t\t\t\t\t\t\t\t\t(d.type === COMMENT_LINK && this.canvasLayout.commentLinkArrowHead) ||\n\t\t\t\t\t\t\t\t\t\t\t(d.type === NODE_LINK && this.canvasLayout.linkType === LINK_TYPE_STRAIGHT))\n\t\t\t.selectAll(\".d3-link-line-arrow-head\")\n\t\t\t.datum((d) => this.activePipeline.getLink(d.id))\n\t\t\t.attr(\"d\", (d) => this.getArrowHead(d))\n\t\t\t.attr(\"transform\", (d) => this.getArrowHeadTransform(d))\n\t\t\t.attr(\"class\", \"d3-link-line-arrow-head\")\n\t\t\t.attr(\"style\", (d) => CanvasUtils.getObjectStyle(d, \"line\", \"default\"));\n\n\t\t// Update decorations on the node-node or association links.\n\t\tjoinedLinkGrps.each((d, i, linkGrps) => {\n\t\t\tif (d.type === NODE_LINK || d.type === ASSOCIATION_LINK) {\n\t\t\t\tconst linkGrp = d3.select(linkGrps[i]).selectAll(\".d3-link-decorations-group\");\n\t\t\t\tthis.displayDecorations(d, DEC_LINK, linkGrp, d.decorations);\n\t\t\t}\n\t\t});\n\n\t\t// Add link line handles at start and end of line, if required\n\t\tif (this.config.enableLinkSelection === LINK_SELECTION_HANDLES ||\n\t\t\t\tthis.config.enableLinkSelection === LINK_SELECTION_DETACHABLE) {\n\t\t\tjoinedLinkGrps.each((d, i, linkGrps) => {\n\t\t\t\tif (d.type === NODE_LINK) {\n\t\t\t\t\t// We only need to update handles since they were created in the create link step\n\t\t\t\t\tthis.updateHandles(d3.select(linkGrps[i]).selectAll(\".d3-link-handles-group\"), lineArray);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (!this.dragging) {\n\t\t\tthis.setDisplayOrder(joinedLinkGrps);\n\t\t}\n\t}\n\n\tattachLinkGroupListeners(linkGrps) {\n\t\tlinkGrps\n\t\t\t.on(\"mousedown\", (d3Event, d, index, links) => {\n\t\t\t\tthis.logger.log(\"Link Group - mouse down\");\n\t\t\t\tif (this.svgCanvasTextArea.isEditingText()) {\n\t\t\t\t\tthis.svgCanvasTextArea.completeEditing();\n\t\t\t\t}\n\t\t\t\tif (this.config.enableLinkSelection !== LINK_SELECTION_NONE) {\n\t\t\t\t\tthis.selectObjectD3Event(d3Event, d);\n\t\t\t\t}\n\t\t\t\td3Event.stopPropagation();\n\t\t\t})\n\t\t\t.on(\"mouseup\", () => {\n\t\t\t\tthis.logger.log(\"Link Group - mouse up\");\n\t\t\t})\n\t\t\t.on(\"click\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Link Group - click\");\n\t\t\t\td3Event.stopPropagation();\n\t\t\t})\n\t\t\t.on(\"contextmenu\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Link Group - context menu\");\n\t\t\t\tif (this.config.enableLinkSelection !== LINK_SELECTION_NONE) {\n\t\t\t\t\tthis.selectObjectD3Event(d3Event, d);\n\t\t\t\t}\n\t\t\t\tthis.openContextMenu(d3Event, \"link\", d);\n\t\t\t})\n\t\t\t.on(\"mouseenter\", (d3Event, link) => {\n\t\t\t\tconst targetObj = d3Event.currentTarget;\n\n\t\t\t\tif (this.config.enableLinkSelection === LINK_SELECTION_HANDLES ||\n\t\t\t\t\t\tthis.config.enableLinkSelection === LINK_SELECTION_DETACHABLE) {\n\t\t\t\t\tthis.raiseLinkToTop(targetObj);\n\t\t\t\t}\n\t\t\t\tthis.setLinkLineStyles(targetObj, link, \"hover\");\n\n\t\t\t\tif (this.canOpenTip(TIP_TYPE_LINK) &&\n\t\t\t\t\t\t!this.draggingLinkData) {\n\t\t\t\t\tthis.canvasController.openTip({\n\t\t\t\t\t\tid: this.getId(\"link_tip\", link.id),\n\t\t\t\t\t\ttype: TIP_TYPE_LINK,\n\t\t\t\t\t\ttargetObj: targetObj,\n\t\t\t\t\t\tmousePos: { x: d3Event.clientX, y: d3Event.clientY },\n\t\t\t\t\t\tpipelineId: this.activePipeline.id,\n\t\t\t\t\t\tlink: link\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"mouseleave\", (d3Event, link) => {\n\t\t\t\tconst targetObj = d3Event.currentTarget;\n\n\t\t\t\tif (!targetObj.getAttribute(\"data-selected\")) {\n\t\t\t\t\tthis.lowerLinkToBottom(targetObj);\n\t\t\t\t}\n\t\t\t\tthis.setLinkLineStyles(targetObj, link, \"default\");\n\t\t\t\tthis.canvasController.closeTip();\n\t\t\t});\n\t}\n\n\t// Creates a new start handle and a new end handle for the link groups\n\t// passed in.\n\tcreateNewHandles(handlesGrp) {\n\t\tconst startHandle = handlesGrp\n\t\t\t.append(this.canvasLayout.linkStartHandleObject)\n\t\t\t.attr(\"class\", (d) => \"d3-link-handle-start\")\n\t\t\t// Use mouse down instead of click because it gets called before drag start.\n\t\t\t.on(\"mousedown\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Link start handle - mouse down\");\n\t\t\t\tif (!this.config.enableDragWithoutSelect) {\n\t\t\t\t\tthis.selectObjectD3Event(d3Event, d);\n\t\t\t\t}\n\t\t\t\tthis.logger.log(\"Link end handle - finished mouse down\");\n\t\t\t});\n\n\t\tif (this.config.enableEditingActions) {\n\t\t\tstartHandle.call(this.dragSelectionHandle);\n\t\t}\n\n\t\tconst endHandle = handlesGrp\n\t\t\t.append(this.canvasLayout.linkEndHandleObject)\n\t\t\t.attr(\"class\", (d) => \"d3-link-handle-end\")\n\t\t\t// Use mouse down instead of click because it gets called before drag start.\n\t\t\t.on(\"mousedown\", (d3Event, d) => {\n\t\t\t\tthis.logger.log(\"Link end handle - mouse down\");\n\t\t\t\tif (!this.config.enableDragWithoutSelect) {\n\t\t\t\t\tthis.selectObjectD3Event(d3Event, d);\n\t\t\t\t}\n\t\t\t\tthis.logger.log(\"Link end handle - finished mouse down\");\n\t\t\t});\n\n\t\tif (this.config.enableEditingActions) {\n\t\t\tendHandle.call(this.dragSelectionHandle);\n\t\t}\n\t}\n\n\t// Updates the start and end link handles for the handle groups passed in.\n\tupdateHandles(handlesGrp, lineArray) {\n\t\thandlesGrp\n\t\t\t.selectAll(\".d3-link-handle-start\")\n\t\t\t.datum((d) => this.activePipeline.getLink(d.id))\n\t\t\t.each((datum, index, linkHandles) => {\n\t\t\t\tconst obj = d3.select(linkHandles[index]);\n\t\t\t\tif (this.canvasLayout.linkStartHandleObject === \"image\") {\n\t\t\t\t\tobj\n\t\t\t\t\t\t.attr(\"xlink:href\", this.canvasLayout.linkStartHandleImage)\n\t\t\t\t\t\t.attr(\"x\", (d) => d.x1 - (this.canvasLayout.linkStartHandleWidth / 2))\n\t\t\t\t\t\t.attr(\"y\", (d) => d.y1 - (this.canvasLayout.linkStartHandleHeight / 2))\n\t\t\t\t\t\t.attr(\"width\", this.canvasLayout.linkStartHandleWidth)\n\t\t\t\t\t\t.attr(\"height\", this.canvasLayout.linkStartHandleHeight);\n\n\t\t\t\t} else if (this.canvasLayout.linkStartHandleObject === \"circle\") {\n\t\t\t\t\tobj\n\t\t\t\t\t\t.attr(\"r\", this.canvasLayout.linkStartHandleRadius)\n\t\t\t\t\t\t.attr(\"cx\", (d) => d.x1)\n\t\t\t\t\t\t.attr(\"cy\", (d) => d.y1);\n\t\t\t\t}\n\t\t\t});\n\n\t\thandlesGrp\n\t\t\t.selectAll(\".d3-link-handle-end\")\n\t\t\t.datum((d) => this.activePipeline.getLink(d.id))\n\t\t\t.each((datum, index, linkHandles) => {\n\t\t\t\tconst obj = d3.select(linkHandles[index]);\n\t\t\t\tif (this.canvasLayout.linkEndHandleObject === \"image\") {\n\t\t\t\t\tobj\n\t\t\t\t\t\t.attr(\"xlink:href\", this.canvasLayout.linkEndHandleImage)\n\t\t\t\t\t\t.attr(\"x\", (d) => d.x2 - (this.canvasLayout.linkEndHandleWidth / 2))\n\t\t\t\t\t\t.attr(\"y\", (d) => d.y2 - (this.canvasLayout.linkEndHandleHeight / 2))\n\t\t\t\t\t\t.attr(\"width\", this.canvasLayout.linkEndHandleWidth)\n\t\t\t\t\t\t.attr(\"height\", this.canvasLayout.linkEndHandleHeight)\n\t\t\t\t\t\t.attr(\"transform\", (d) => this.getLinkImageTransform(d));\n\n\t\t\t\t} else if (this.canvasLayout.linkEndHandleObject === \"circle\") {\n\t\t\t\t\tobj\n\t\t\t\t\t\t.attr(\"r\", this.canvasLayout.linkEndHandleRadius)\n\t\t\t\t\t\t.attr(\"cx\", (d) => d.x2)\n\t\t\t\t\t\t.attr(\"cy\", (d) => d.y2);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t// Sets the custom inline styles on the link object passed in.\n\tsetLinkLineStyles(linkObj, link, type) {\n\t\tconst style = CanvasUtils.getObjectStyle(link, \"line\", type);\n\t\tconst linkSel = d3.select(linkObj);\n\t\tlinkSel.select(\".d3-link-line\").attr(\"style\", style);\n\t\tlinkSel.select(\".d3-link-line-arrow-head\").attr(\"style\", style);\n\t}\n\n\t// Returns the class string to be appled to the link selection area.\n\tgetLinkSelectionAreaClass(d) {\n\t\tlet typeClass = \"\";\n\t\tif (d.type === ASSOCIATION_LINK) {\n\t\t\ttypeClass = \"d3-association-link-selection-area\";\n\t\t} else if (d.type === COMMENT_LINK) {\n\t\t\ttypeClass = \"d3-comment-link-selection-area\";\n\t\t} else {\n\t\t\ttypeClass = \"d3-data-link-selection-area\";\n\t\t}\n\n\t\treturn \"d3-link-selection-area \" + typeClass;\n\t}\n\n\t// Returns the class string to be appled to the link group object.\n\tgetLinkGroupClass(d) {\n\t\treturn \"d3-link-group \" + this.getLinkTypeClass(d) + \" \" + this.getLinkCustomClass(d);\n\t}\n\n\t// Returns the custom class string for the link object passed in.\n\tgetLinkCustomClass(d) {\n\t\t// If the link has a classname, that isn't the current or historic default,\n\t\t// use it!\n\t\tif (d.class_name &&\n\t\t\t\td.class_name !== \"canvas-data-link\" &&\n\t\t\t\td.class_name !== \"canvas-object-link\" &&\n\t\t\t\td.class_name !== \"canvas-comment-link\" &&\n\t\t\t\td.class_name !== \"d3-data-link\" &&\n\t\t\t\td.class_name !== \"d3-association-link\" &&\n\t\t\t\td.class_name !== \"d3-object-link\" &&\n\t\t\t\td.class_name !== \"d3-comment-link\") {\n\t\t\treturn d.class_name;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\t// Returns the class string for the type of link object passed in.\n\tgetLinkTypeClass(d) {\n\t\tif (d.type === ASSOCIATION_LINK) {\n\t\t\tif (this.config.enableAssocLinkType === ASSOC_RIGHT_SIDE_CURVE) {\n\t\t\t\treturn \"d3-association-link\";\n\t\t\t}\n\t\t\treturn \"d3-object-link\";\n\t\t} else if (d.type === COMMENT_LINK) {\n\t\t\treturn \"d3-comment-link\";\n\t\t}\n\t\treturn \"d3-data-link\";\n\t}\n\n\t// Returns the class string to be appled to the comment group object.\n\tgetCommentGroupClass(d) {\n\t\tlet customClass = \"\";\n\t\t// If the comment has a classname that isn't the default use it!\n\t\tif (d.class_name &&\n\t\t\t\td.class_name !== \"canvas-comment\" &&\n\t\t\t\td.class_name !== \"d3-comment-rect\") {\n\t\t\tcustomClass = \" \" + d.class_name;\n\t\t}\n\n\t\t// Set class to enable mouse cursor to be set appropriately.\n\t\tconst draggableClass = this.config.enableEditingActions\n\t\t\t? \" d3-draggable\"\n\t\t\t: \" d3-non-draggable\";\n\n\t\t// If the class name provided IS the default, or there is no classname,\n\t\t// return the class name.\n\t\treturn \"d3-comment-group\" + draggableClass + customClass;\n\t}\n\n\t// Returns the class string to be appled to the node group object.\n\tgetNodeGroupClass(d) {\n\t\tlet customClass = \" \" + d.layout.className || \"\";\n\n\t\t// If the node has a classname that isn't the default use it!\n\t\tif (d.class_name &&\n\t\t\t\td.class_name !== \"canvas-node\" &&\n\t\t\t\td.class_name !== \"d3-node-body\" &&\n\t\t\t\td.class_name !== \"d3-node-body-outline\") {\n\t\t\tcustomClass = \" \" + d.class_name;\n\t\t}\n\n\t\tconst supernodeClass = CanvasUtils.isExpandedSupernode(d)\n\t\t\t? \" d3-node-supernode-expanded\"\n\t\t\t: \"\";\n\n\t\t// Set class to enable mouse cursor to be set appropriately.\n\t\tconst draggableClass = this.config.enableEditingActions\n\t\t\t? \" d3-draggable\"\n\t\t\t: \" d3-non-draggable\";\n\n\t\tconst resizeClass = d.isResized // this.isNodeResized(d)\n\t\t\t? \" d3-resized\"\n\t\t\t: \"\";\n\n\t\treturn \"d3-node-group\" + supernodeClass + resizeClass + draggableClass + customClass;\n\t}\n\n\t// Pushes the links to be below nodes within the nodesLinksGrp group.\n\tsetDisplayOrder(linkGroup) {\n\t\t// Force those links without decorations to be behind those with decorations\n\t\t// in case the links overlap we don't want the decorations to be overwritten.\n\t\tlinkGroup.filter((lnk) => this.hasOneDecorationOrMore(lnk)).lower();\n\t\tlinkGroup.filter((lnk) => !this.hasOneDecorationOrMore(lnk)).lower();\n\n\t\tif (this.config.enableLinkSelection === LINK_SELECTION_HANDLES ||\n\t\t\t\tthis.config.enableLinkSelection === LINK_SELECTION_DETACHABLE) {\n\t\t\tthis.raiseSelectedLinksToTop();\n\t\t}\n\t}\n\n\t// Raises the node above other nodes and objects (on the mouse entering\n\t// the node). This is necessary for apps that have ports that protrude from\n\t// the side of the node and where those nodes may be positioned close to each\n\t// other so it makes the ports appear on top of any adjacent node. We don't\n\t// raise the nodes for various conditions:\n\t// * We are currently drawing a new link\n\t// * We are dragging some object(s) around\n\t// * There are one or more selected links\n\t// * We are editing text\n\traiseNodeToTop(nodeGrp) {\n\t\tif (this.drawingNewLinkData === null && !this.dragging && this.activePipeline.getSelectedLinksCount() === 0 && !this.isEditingText()) {\n\t\t\tnodeGrp.raise();\n\t\t}\n\t}\n\n\t// Moves any selected links to the top of the display order. This is necessary\n\t// when selection handles are being displayed on selected links because the\n\t// handles may be in the same positions as port circles on the nodes.\n\traiseSelectedLinksToTop() {\n\t\tthis.nodesLinksGrp\n\t\t\t.selectAll(\".d3-link-group[data-selected]\")\n\t\t\t.raise();\n\t}\n\n\traiseLinkToTop(obj) {\n\t\td3.select(obj)\n\t\t\t.raise();\n\t}\n\n\tlowerLinkToBottom(obj) {\n\t\td3.select(obj)\n\t\t\t.lower();\n\t}\n\n\t// Returns true if the link passed in has one or more decorations.\n\thasOneDecorationOrMore(link) {\n\t\treturn link.decorations && link.decorations.length > 0;\n\t}\n\n\tisLinkBeingDragged(link) {\n\t\treturn this.draggingLinkData && this.draggingLinkData.link.id === link.id;\n\t}\n\n\tbuildLinksArray() {\n\t\tlet linksArray = [];\n\n\t\tif (this.canvasLayout.linkType === LINK_TYPE_STRAIGHT) {\n\t\t\tthis.updateLinksForNodes();\n\t\t}\n\n\t\tthis.activePipeline.links.forEach((link) => {\n\t\t\tlet linkObj = null;\n\n\t\t\tif (((this.config.enableLinkSelection === LINK_SELECTION_HANDLES && this.isLinkBeingDragged(link)) ||\n\t\t\t\t\t\tthis.config.enableLinkSelection === LINK_SELECTION_DETACHABLE) &&\n\t\t\t\t\t(!link.srcObj || !link.trgNode)) {\n\t\t\t\tlinkObj = this.getDetachedLineObj(link);\n\n\t\t\t} else {\n\t\t\t\tlinkObj = this.getAttachedLineObj(link);\n\t\t\t}\n\t\t\tif (linkObj) {\n\t\t\t\tlinksArray.push(linkObj);\n\t\t\t}\n\t\t});\n\n\t\t// Adjust the minInitialLineForElbow property for links when displaying\n\t\t// the Elbow line type. This prevents overlapping at the links' first elbow.\n\t\tif (this.canvasLayout.linkType === LINK_TYPE_ELBOW) {\n\t\t\tlinksArray = this.addMinInitialLineForElbow(linksArray);\n\t\t}\n\n\t\t// Add connection path info to the links.\n\t\tlinksArray = this.linkUtils.addConnectionPaths(linksArray);\n\n\t\treturn linksArray;\n\t}\n\n\tgetAttachedLineObj(link) {\n\t\tconst srcObj = link.srcObj;\n\t\tconst trgNode = link.trgNode;\n\n\t\tif (!srcObj) {\n\t\t\tthis.logger.error(\n\t\t\t\t\"Common Canvas error trying to draw a link. A link was specified for source ID '\" + link.srcNodeId +\n\t\t\t\t\"' in the Canvas data that does not have a valid source node/comment.\");\n\t\t}\n\n\t\tif (!trgNode) {\n\t\t\tthis.logger.error(\n\t\t\t\t\"Common Canvas error trying to draw a link. A link was specified for target ID '\" + link.trgNodeId +\n\t\t\t\t\"' in the Canvas data that does not have a valid target node.\");\n\t\t}\n\n\t\t// Only proceed if we have a source and a target node/comment and the\n\t\t// conditions are right for displaying the link.\n\t\tif (srcObj && trgNode && this.shouldDisplayLink(srcObj, trgNode, link.type)) {\n\t\t\tconst srcPortId = this.getSourcePortId(link, srcObj);\n\t\t\tconst trgPortId = this.getTargetPortId(link, trgNode);\n\t\t\tconst assocLinkVariation =\n\t\t\t\tlink.type === ASSOCIATION_LINK && this.config.enableAssocLinkType === ASSOC_RIGHT_SIDE_CURVE\n\t\t\t\t\t? this.getAssocLinkVariation(srcObj, trgNode)\n\t\t\t\t\t: null;\n\t\t\tconst coords = this.linkUtils.getLinkCoords(link, srcObj, srcPortId, trgNode, trgPortId, assocLinkVariation);\n\n\t\t\tlink.coordsUpdated =\n\t\t\t\tlink.x1 !== coords.x1 ||\n\t\t\t\tlink.y1 !== coords.y1 ||\n\t\t\t\tlink.x2 !== coords.x2 ||\n\t\t\t\tlink.y2 !== coords.y2;\n\n\t\t\tlink.assocLinkVariation = assocLinkVariation;\n\t\t\tlink.srcPortId = srcPortId;\n\t\t\tlink.trgPortId = trgPortId;\n\t\t\tlink.x1 = coords.x1;\n\t\t\tlink.y1 = coords.y1;\n\t\t\tlink.x2 = coords.x2;\n\t\t\tlink.y2 = coords.y2;\n\t\t\tlink.originX = coords.originX;\n\t\t\tlink.originY = coords.originY;\n\t\t\treturn link;\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Returns a line object describing the detached (or semi-detached) link\n\t// passed in. This will only ever be called when either srcNode OR trgNode\n\t// are null (indicating a semi-detached link) or when both are null indicating\n\t// a fully-detached link.\n\tgetDetachedLineObj(link) {\n\t\tconst srcObj = link.srcObj;\n\t\tconst trgNode = link.trgNode;\n\n\t\tlet srcPortId = null;\n\t\tlet trgPortId = null;\n\t\tconst coords = {};\n\n\t\tif (!srcObj) {\n\t\t\tcoords.x1 = link.srcPos.x_pos;\n\t\t\tcoords.y1 = link.srcPos.y_pos;\n\n\t\t} else {\n\t\t\tif (this.canvasLayout.linkType === LINK_TYPE_STRAIGHT) {\n\t\t\t\tconst endPos = { x: link.trgPos.x_pos, y: link.trgPos.y_pos };\n\t\t\t\tconst startPos = this.linkUtils.getNewStraightNodeLinkStartPos(srcObj, endPos, link.srcOriginInfo);\n\t\t\t\tcoords.x1 = startPos.x;\n\t\t\t\tcoords.y1 = startPos.y;\n\t\t\t\tcoords.originX = startPos.originX;\n\t\t\t\tcoords.originY = startPos.originY;\n\n\t\t\t} else {\n\t\t\t\tsrcPortId = this.getSourcePortId(link, srcObj);\n\t\t\t\tconst port = this.getOutputPort(srcObj, srcPortId);\n\t\t\t\tif (port) {\n\t\t\t\t\tcoords.x1 = srcObj.x_pos + port.cx;\n\t\t\t\t\tcoords.y1 = srcObj.y_pos + port.cy;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!trgNode) {\n\t\t\tcoords.x2 = link.trgPos.x_pos;\n\t\t\tcoords.y2 = link.trgPos.y_pos;\n\n\t\t} else {\n\t\t\tif (this.canvasLayout.linkType === LINK_TYPE_STRAIGHT) {\n\t\t\t\tconst endPos = { x: link.srcPos.x_pos, y: link.srcPos.y_pos };\n\t\t\t\tconst startPos = this.linkUtils.getNewStraightNodeLinkStartPos(trgNode, endPos, link.trgOriginInfo);\n\t\t\t\tcoords.x2 = startPos.x;\n\t\t\t\tcoords.y2 = startPos.y;\n\n\t\t\t} else {\n\t\t\t\ttrgPortId = this.getTargetPortId(link, trgNode);\n\t\t\t\tconst port = this.getInputPort(trgNode, trgPortId);\n\t\t\t\tif (port) {\n\t\t\t\t\tcoords.x2 = trgNode.x_pos + port.cx;\n\t\t\t\t\tcoords.y2 = trgNode.y_pos + port.cy;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlink.coordsUpdated =\n\t\t\tlink.x1 !== coords.x1 ||\n\t\t\tlink.y1 !== coords.y1 ||\n\t\t\tlink.x2 !== coords.x2 ||\n\t\t\tlink.y2 !== coords.y2;\n\n\t\tlink.srcPortId = srcPortId;\n\t\tlink.trgPortId = trgPortId;\n\t\tlink.x1 = coords.x1;\n\t\tlink.y1 = coords.y1;\n\t\tlink.x2 = coords.x2;\n\t\tlink.y2 = coords.y2;\n\t\tlink.originX = coords.originX;\n\t\tlink.originY = coords.originY;\n\n\t\treturn link;\n\t}\n\n\tgetOutputPort(srcNode, srcPortId) {\n\t\tif (srcNode && srcNode.outputs) {\n\t\t\treturn srcNode.outputs.find((p) => p.id === srcPortId);\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetInputPort(trgNode, trgPortId) {\n\t\tif (trgNode && trgNode.inputs) {\n\t\t\treturn trgNode.inputs.find((p) => p.id === trgPortId);\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Returns a source port Id if one exists in the link, otherwise defaults\n\t// to the first available port on the source node.\n\tgetSourcePortId(link, srcNode) {\n\t\tvar srcPortId;\n\t\tif (link.srcNodePortId) {\n\t\t\tsrcPortId = link.srcNodePortId;\n\t\t} else if (srcNode.outputs && srcNode.outputs.length > 0) {\n\t\t\tsrcPortId = srcNode.outputs[0].id;\n\t\t} else {\n\t\t\tsrcPortId = null;\n\t\t}\n\t\treturn srcPortId;\n\t}\n\n\t// Returns a target port Id if one exists in the link, otherwise defaults\n\t// to the first available port on the target node.\n\tgetTargetPortId(link, trgNode) {\n\t\tvar trgPortId;\n\t\tif (link.trgNodePortId) {\n\t\t\ttrgPortId = link.trgNodePortId;\n\t\t} else if (trgNode.inputs && trgNode.inputs.length > 0) {\n\t\t\ttrgPortId = trgNode.inputs[0].id;\n\t\t} else {\n\t\t\ttrgPortId = null;\n\t\t}\n\t\treturn trgPortId;\n\t}\n\n\t// Returns true if a link should be displayed and false if not. The link\n\t// should not be displayed if the displayLinkOnOverlap flag is false and the\n\t// nodes are overlapping.\n\tshouldDisplayLink(srcNode, trgNode, linkType) {\n\t\tif (this.canvasLayout.displayLinkOnOverlap === false) {\n\t\t\treturn !this.areLinkedObjectsOverlapping(srcNode, trgNode, linkType);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t// Returns true if the linked objects overlap. srcObj can be either a comment\n\t// or node while trgNode is always a node.\n\tareLinkedObjectsOverlapping(srcObj, trgNode, linkType) {\n\t\tconst srcHighlightGap = linkType === COMMENT_LINK ? this.canvasLayout.commentHighlightGap : srcObj.layout.nodeHighlightGap;\n\t\tconst trgHighlightGap = trgNode.layout.nodeHighlightGap;\n\n\t\tconst srcLeft = srcObj.x_pos - srcHighlightGap;\n\t\tconst srcRight = srcObj.x_pos + srcObj.width + srcHighlightGap;\n\t\tconst trgLeft = trgNode.x_pos - trgHighlightGap;\n\t\tconst trgRight = trgNode.x_pos + trgNode.width + trgHighlightGap;\n\n\t\tconst srcTop = srcObj.y_pos - srcHighlightGap;\n\t\tconst srcBottom = srcObj.y_pos + srcObj.height + srcHighlightGap;\n\t\tconst trgTop = trgNode.y_pos - trgHighlightGap;\n\t\tconst trgBottom = trgNode.y_pos + trgNode.height + trgHighlightGap;\n\n\t\tif (srcRight >= trgLeft && trgRight >= srcLeft &&\n\t\t\t\tsrcBottom >= trgTop && trgBottom >= srcTop) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// Returns an array of links where the minInitialLineForElbow property is\n\t// set and incremented so that elbow links that emanate from a source node\n\t// do not overlap when the first elbow bend occurs. To do this it\n\t// loops through the current nodes and for each node that has multiple\n\t// output ports:\n\t// 1. Gets the link objects associated with those ports.\n\t// 2. Sorts those link objects based on the vertical separation from\n\t//    the source to the target.\n\t// 3. Applies ever increasing minInitialLineForElbow values to the link\n\t//    objects based on their sort order.\n\t// The result is that the elbow links, emantating from the ports of the node,\n\t//  do not overlap.\n\taddMinInitialLineForElbow(links) {\n\t\tthis.activePipeline.nodes.forEach((node) => {\n\t\t\tif (node.outputs && node.outputs.length > 1) {\n\t\t\t\tconst nodeLinks = this.getNodeOutputLinks(node, links);\n\t\t\t\tconst sortedNodeLinks = this.sortNodeOutputLinks(nodeLinks);\n\t\t\t\tthis.applyMinInitialLine(node, sortedNodeLinks);\n\t\t\t}\n\t\t});\n\t\treturn links;\n\t}\n\n\t// Returns an array of links where each link emanates from the\n\t// output ports of the source node passed in.\n\tgetNodeOutputLinks(srcNode, links) {\n\t\tconst outArray = [];\n\t\tlinks.forEach((link) => {\n\t\t\tif (link.srcObj && link.srcObj.id === srcNode.id) {\n\t\t\t\toutArray.push(link);\n\t\t\t}\n\t\t});\n\t\treturn outArray;\n\t}\n\n\t// Returns the input array of link objects sorted by the differences\n\t// between the absolute distance from the source port position to the\n\t// target port position. This means the lines connecting source node ports\n\t// to target node ports over the furthest distance (in the y direction with\n\t// Left -> Right linkDirection) will be sorted first and the lines connecting\n\t// source to target ports over the shortest y direction distance will be sorted last.\n\tsortNodeOutputLinks(nodeLinks) {\n\t\treturn nodeLinks.sort((nodeLineData1, nodeLineData2) => {\n\t\t\tlet first;\n\t\t\tlet second;\n\t\t\tif (this.canvasLayout.linkDirection === LINK_DIR_LEFT_RIGHT) {\n\t\t\t\tfirst = Math.abs(nodeLineData1.y1 - nodeLineData1.y2);\n\t\t\t\tsecond = Math.abs(nodeLineData2.y1 - nodeLineData2.y2);\n\t\t\t} else {\n\t\t\t\tfirst = Math.abs(nodeLineData1.x1 - nodeLineData1.x2);\n\t\t\t\tsecond = Math.abs(nodeLineData2.x1 - nodeLineData2.x2);\n\t\t\t}\n\t\t\tif (first === second) {\n\t\t\t\tif (this.canvasLayout.linkDirection === LINK_DIR_LEFT_RIGHT) {\n\t\t\t\t\treturn (nodeLineData1.y1 < nodeLineData1.y2) ? 1 : -1; // Tie breaker\n\t\t\t\t}\n\t\t\t\treturn (nodeLineData1.x1 < nodeLineData1.x2) ? 1 : -1; // Tie breaker\n\n\t\t\t} else if (first < second) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn -1;\n\t\t});\n\t}\n\n\t// Loops through the link objects associated with the output ports of\n\t// the node passed in and applies an ever increasing minInitialLineForElbow\n\t// value to each one. This means that, because the link objects are sorted by\n\t// vertical separation, the line with greatest vertical separation will get\n\t// the smallest minInitialLineForElbow and the line with the smallest vertical\n\t// separation will get the biggest minInitialLineForElbow.\n\tapplyMinInitialLine(node, sortedNodeLinks) {\n\t\tlet runningInitialLine = node.layout.minInitialLine;\n\t\tsortedNodeLinks.forEach((lineData) => {\n\t\t\tlineData.minInitialLineForElbow = runningInitialLine;\n\t\t\trunningInitialLine += lineData.srcObj.layout.minInitialLineIncrement;\n\t\t});\n\t}\n\n\t// Updates the data links for all the nodes with two optional fields\n\t// (called srcOriginInfo and trgOriginInfo) based on the location of the\n\t// nodes the links go from and to. The info in these fields is used to\n\t// calculate the starting and ending position of straight line links.\n\t// This ensures that input and output links that go in a certain direction\n\t// (NORTH, SOUTH, EAST or WEST) are grouped together so they can be\n\t// separated out when straight lines are drawn between nodes.\n\tupdateLinksForNodes() {\n\t\tthis.activePipeline.nodes.forEach((n) => this.updateLinksForNode(n));\n\t}\n\n\t// Updates the links going into and out of the node passed in with up to\n\t// two new fields (called srcOriginInfo and trgOriginInfo).\n\tupdateLinksForNode(node) {\n\t\tconst linksInfo = {};\n\t\tlinksInfo.n = [];\n\t\tlinksInfo.s = [];\n\t\tlinksInfo.e = [];\n\t\tlinksInfo.w = [];\n\n\t\t// Update the linksInfo arrays for each direction: n, s, e and w.\n\t\tthis.activePipeline.links.forEach((link) => {\n\t\t\tif (link.type === NODE_LINK) {\n\t\t\t\tif (link.trgNode && link.trgNode.id === node.id) {\n\t\t\t\t\tif (link.srcObj) {\n\t\t\t\t\t\tconst dir = this.getDirAdjusted(link.trgNode, link.srcObj);\n\t\t\t\t\t\tlinksInfo[dir].push({ type: \"in\", endNode: link.srcObj, link });\n\n\t\t\t\t\t} else if (link.srcPos) {\n\t\t\t\t\t\tconst dir = this.getDirToEndPos(link.trgNode, link.srcPos.x_pos, link.srcPos.y_pos);\n\t\t\t\t\t\tlinksInfo[dir].push({ type: \"in\", x: link.srcPos.x_pos, y: link.srcPos.y_pos, link });\n\t\t\t\t\t}\n\n\t\t\t\t} else if (link.srcObj && link.srcObj.id === node.id) {\n\t\t\t\t\tif (link.trgNode) {\n\t\t\t\t\t\tconst dir = this.getDirAdjusted(link.srcObj, link.trgNode);\n\t\t\t\t\t\tlinksInfo[dir].push({ type: \"out\", endNode: link.trgNode, link });\n\n\t\t\t\t\t} else if (link.trgPos) {\n\t\t\t\t\t\tconst dir = this.getDirToEndPos(link.srcObj, link.trgPos.x_pos, link.trgPos.y_pos);\n\t\t\t\t\t\tlinksInfo[dir].push({ type: \"out\", x: link.trgPos.x_pos, y: link.trgPos.y_pos, link });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tlinksInfo.n = this.sortLinksInfo(linksInfo.n, NORTH);\n\t\tlinksInfo.s = this.sortLinksInfo(linksInfo.s, SOUTH);\n\t\tlinksInfo.e = this.sortLinksInfo(linksInfo.e, EAST);\n\t\tlinksInfo.w = this.sortLinksInfo(linksInfo.w, WEST);\n\n\t\tthis.updateLinksInfo(linksInfo.n, NORTH);\n\t\tthis.updateLinksInfo(linksInfo.s, SOUTH);\n\t\tthis.updateLinksInfo(linksInfo.e, EAST);\n\t\tthis.updateLinksInfo(linksInfo.w, WEST);\n\t}\n\n\t// Returns the direction of a link from the start node to the end node\n\t// as either NORTH, SOUTH, EAST or WEST. Some direction combinations\n\t// have to be overriden to prevent link lines overlapping.\n\tgetDirAdjusted(startNode, endNode) {\n\t\tlet dir = this.getDirToNode(startNode, endNode);\n\n\t\t// When start -> end is SOUTH and end -> start is WEST the returned direction\n\t\t// becomes EAST instead of SOUTH to prevent link lines overlapping.\n\t\tif (dir === SOUTH) {\n\t\t\tconst dir2 = this.getDirToNode(endNode, startNode);\n\t\t\tif (dir2 === WEST) {\n\t\t\t\tdir = EAST;\n\t\t\t}\n\n\t\t// When start -> end is NORTH and end -> start is EAST the returned direction\n\t\t// becomes WEST instead of NORTH to prevent link lines overlapping.\n\t\t} else if (dir === NORTH) {\n\t\t\tconst dir2 = this.getDirToNode(endNode, startNode);\n\t\t\tif (dir2 === EAST) {\n\t\t\t\tdir = WEST;\n\t\t\t}\n\t\t}\n\t\treturn dir;\n\t}\n\n\t// Returns the direction (NORTH, SOUTH, EAST or WEST) from the start node\n\t// to the end node.\n\tgetDirToNode(startNode, endNode) {\n\t\tconst endX = this.nodeUtils.getNodeCenterPosX(endNode);\n\t\tconst endY = this.nodeUtils.getNodeCenterPosY(endNode);\n\t\treturn this.getDirToEndPos(startNode, endX, endY);\n\t}\n\n\t// Returns the direction (NORTH, SOUTH, EAST or WEST) from the start node\n\t// to the end position endX, endY.\n\tgetDirToEndPos(startNode, endX, endY) {\n\t\tconst originX = this.nodeUtils.getNodeCenterPosX(startNode);\n\t\tconst originY = this.nodeUtils.getNodeCenterPosY(startNode);\n\n\t\tconst x = startNode.x_pos;\n\t\tconst y = startNode.y_pos;\n\t\tconst w = startNode.width;\n\t\tconst h = startNode.height;\n\n\t\treturn CanvasUtils.getDir(x, y, w, h, originX, originY, endX, endY);\n\t}\n\n\t// Returns the linksDirArray passed in with the linkInfo objects in the\n\t// array ordered by the position of the end of each link line, depending on\n\t// the direction (dir) of the lines. This is achieved by spliting the links\n\t// into groups where links in the same group go to/from the same node.\n\tsortLinksInfo(linksDirArrayIn, dir) {\n\t\tlet linksDirArray = linksDirArrayIn;\n\t\tif (linksDirArray.length > 1) {\n\t\t\tconst groups = this.getLinkInfoGroups(linksDirArray);\n\n\t\t\tforOwn(groups, (group) => {\n\t\t\t\tgroup.forEach((li, i) => {\n\t\t\t\t\tconst node = li.endNode;\n\t\t\t\t\tconst parts = group.length + 1;\n\n\t\t\t\t\tif (dir === NORTH || dir === SOUTH) {\n\t\t\t\t\t\tli.x = node.x_pos + ((node.width / parts) * (i + 1));\n\t\t\t\t\t\tli.y = this.nodeUtils.getNodeCenterPosY(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tli.x = this.nodeUtils.getNodeCenterPosX(node);\n\t\t\t\t\t\tli.y = node.y_pos + ((node.height / parts) * (i + 1));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// For NORTH and SOUTH links we sort linksDirArray by the x coordinate\n\t\t\t// of the end of each link. For EAST and WEST we sort by the y\n\t\t\t// coordinate.\n\t\t\tif (dir === NORTH || dir === SOUTH) {\n\t\t\t\tlinksDirArray = linksDirArray.sort((a, b) => (a.x > b.x ? 1 : -1));\n\t\t\t} else {\n\t\t\t\tlinksDirArray = linksDirArray.sort((a, b) => (a.y > b.y ? 1 : -1));\n\t\t\t}\n\t\t}\n\t\treturn linksDirArray;\n\t}\n\n\t// Returns a 'groups' object where each field is index by a node ID and\n\t// contains an array of linkInfo objects that go to/from the node.\n\tgetLinkInfoGroups(linksDirArray) {\n\t\tconst groups = {};\n\t\tlinksDirArray.forEach((li) => {\n\t\t\t// Only create groups for attached links.\n\t\t\tif (li.endNode) {\n\t\t\t\tif (!groups[li.endNode.id]) {\n\t\t\t\t\tgroups[li.endNode.id] = [];\n\t\t\t\t}\n\t\t\t\tgroups[li.endNode.id].push(li);\n\t\t\t}\n\t\t});\n\t\treturn groups;\n\t}\n\n\t// Updates the link objects referenced by the linkInfo objects in the\n\t// linksDirArray with info to specify the link direction (n, s, e or w),\n\t// plus the index and number of connections. This is used when\n\t// drawing straight lines to/from nodes to spread out the lines.\n\tupdateLinksInfo(linksDirArray, dir) {\n\t\tlinksDirArray.forEach((li, i) => {\n\t\t\tif (li.type === \"out\") {\n\t\t\t\tli.link.srcOriginInfo = {\n\t\t\t\t\tdir: dir,\n\t\t\t\t\tidx: i,\n\t\t\t\t\tlen: linksDirArray.length\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tli.link.trgOriginInfo = {\n\t\t\t\t\tdir: dir,\n\t\t\t\t\tidx: i,\n\t\t\t\t\tlen: linksDirArray.length\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t}\n\n\t// Returns a variation of association link to draw when a new link is being\n\t// drawn outwards from a port. startX is the beginning point of the line\n\t// at the port. endX is the position where the mouse is currently positioned.\n\tgetNewLinkAssocVariation(startX, endX, portType) {\n\t\tif (portType === \"input\" && startX > endX) {\n\t\t\treturn ASSOC_VAR_CURVE_LEFT;\n\n\t\t} else if (portType === \"output\" && startX < endX) {\n\t\t\treturn ASSOC_VAR_CURVE_RIGHT;\n\t\t}\n\t\treturn ASSOC_VAR_DOUBLE_BACK_RIGHT;\n\t}\n\n\t// Returns a variation of association link to draw between a source node and a\n\t// target node based on their relative positions.\n\tgetAssocLinkVariation(srcNode, trgNode) {\n\t\tconst gap = srcNode.layout.minInitialLine;\n\t\tif (trgNode.x_pos >= srcNode.x_pos + srcNode.width + gap) {\n\t\t\treturn ASSOC_VAR_CURVE_RIGHT;\n\n\t\t} else if (srcNode.x_pos >= trgNode.x_pos + trgNode.width + gap) {\n\t\t\treturn ASSOC_VAR_CURVE_LEFT;\n\n\t\t// TODO - If we decide to optionally also support doubleBackLeft for\n\t\t// association links at some point uncomment this code.\n\t\t// } else if (trgNode.x_pos + (trgNode.width / 2) >= srcNode.x_pos + (srcNode.width / 2)) {\n\t\t// \treturn DOUBLE_BACK_LEFT;\n\t\t}\n\t\treturn ASSOC_VAR_DOUBLE_BACK_RIGHT;\n\t}\n\n\t// Returns path for arrow head displayed within an input port circle. It is\n\t// draw so the tip is 2px in front of the origin 0,0 so it appears nicely in\n\t// the port circle.\n\tgetPortArrowPath(port) {\n\t\treturn \"M -2 3 L 2 0 -2 -3\";\n\t}\n\n\t// Returns the transform to position and, if ncessecary, rotate the port\n\t// circle arrow.\n\tgetPortArrowPathTransform(port) {\n\t\tconst angle = this.getAngleBasedOnLinkDirection();\n\t\treturn `translate(${port.cx}, ${port.cy}) rotate(${angle})`;\n\t}\n\n\t// Returns an SVG path to draw the arrow head.\n\tgetArrowHead(d) {\n\t\tif (d.type === COMMENT_LINK) {\n\t\t\tif (typeof this.canvasLayout.commentLinkArrowHead === \"string\") {\n\t\t\t\treturn this.canvasLayout.commentLinkArrowHead;\n\t\t\t}\n\t\t\treturn \"M -8 3 L 0 0 -8 -3\";\n\t\t}\n\t\tif (typeof this.canvasLayout.dataLinkArrowHead === \"string\") {\n\t\t\treturn this.canvasLayout.dataLinkArrowHead;\n\t\t}\n\t\treturn \"M -6 6 L 0 0 -6 -6\";\n\t}\n\n\t// Returns a transform for an arrow head at the end of a link line.\n\t// If the linkType is Elbow, it makes sure the arrow head is either\n\t// horizontal for left-right or vertical for top-bottom/bottom-top link\n\t// directions, because the end of elbow lines are always at the same angle as\n\t// the elbow lines. Otherwise it returns an angle so the arrow head is\n\t// relevant to the slope of the straight link being drawn.\n\t// TODO -- This doesn't handle \"Curve\" link types very well (in fact for\n\t// curves it returns the same as for \"Straight\" links) becauset it is very\n\t// difficult to write an algorithm that gives the correct angle for a\n\t// \"Curve\" link to make it look presentable. I know, I tried!\n\tgetArrowHeadTransform(d) {\n\t\tconst angle =\n\t\t\tthis.canvasLayout.linkType === LINK_TYPE_ELBOW\n\t\t\t\t? this.getAngleBasedOnLinkDirection()\n\t\t\t\t: Math.atan2((d.y2 - d.y1), (d.x2 - d.x1)) * (180 / Math.PI);\n\n\t\treturn `translate(${d.x2}, ${d.y2}) rotate(${angle})`;\n\t}\n\n\t// Returns the angle for the arrow head when perpndicular arrows are in\n\t// us such as when a the link type is \"Elbow\" or when we are displaying an\n\t// arrow head inside a port circle.\n\tgetAngleBasedOnLinkDirection() {\n\t\tif (this.canvasLayout.linkDirection === LINK_DIR_TOP_BOTTOM) {\n\t\t\treturn NINETY_DEGREES;\n\n\t\t} else if (this.canvasLayout.linkDirection === LINK_DIR_BOTTOM_TOP) {\n\t\t\treturn -NINETY_DEGREES;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tcanOpenTip(tipType) {\n\t\treturn this.canvasController.isTipEnabled(tipType) &&\n\t\t\t!this.regionSelect && !this.dragging &&\n\t\t\t!this.commentSizing && !this.nodeSizing && !this.drawingNewLinkData;\n\t}\n\n\t// Return the x,y coordinates of the svg group relative to the window's viewport\n\t// This is used when a new comment is created from the toolbar to make sure the\n\t// new comment always appears in the view port.\n\tgetDefaultCommentOffset() {\n\t\tlet xPos = this.canvasLayout.addCommentOffsetX;\n\t\tlet yPos = this.canvasLayout.addCommentOffsetY;\n\n\t\tif (this.zoomTransform) {\n\t\t\txPos = this.zoomTransform.x / this.zoomTransform.k;\n\t\t\tyPos = this.zoomTransform.y / this.zoomTransform.k;\n\n\t\t\t// The window's viewport is in the opposite direction of zoomTransform\n\t\t\txPos = -xPos + this.canvasLayout.addCommentOffsetX;\n\t\t\tyPos = -yPos + this.canvasLayout.addCommentOffsetY;\n\t\t}\n\n\t\tif (this.config.enableSnapToGridType === SNAP_TO_GRID_DURING ||\n\t\t\t\tthis.config.enableSnapToGridType === SNAP_TO_GRID_AFTER) {\n\t\t\treturn this.snapToGridPosition({ x: xPos, y: yPos });\n\t\t}\n\t\treturn { x: xPos, y: yPos };\n\t}\n\n\t// Returns a string that explains which flags are set to true.\n\tgetFlags() {\n\t\tlet str = \"Flags:\";\n\t\tif (this.dragging) {\n\t\t\tstr += \" dragging = true\";\n\t\t}\n\t\tif (this.nodeSizing) {\n\t\t\tstr += \" nodeSizing = true\";\n\t\t}\n\t\tif (this.commentSizing) {\n\t\t\tstr += \" commentSizing = true\";\n\t\t}\n\t\tif (this.regionSelect) {\n\t\t\tstr += \" regionSelect = true\";\n\t\t}\n\t\tif (str === \"Flags:\") {\n\t\t\tstr += \" None\";\n\t\t}\n\t\treturn str;\n\t}\n}\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n// Import just the D3 modules that are needed.\nimport * as d3 from \"d3-selection\";\nimport { cloneDeep } from \"lodash\";\nimport SVGCanvasRenderer from \"./svg-canvas-renderer.js\";\nimport ConfigUtils from \"../object-model/config-utils.js\";\nimport Logger from \"../logging/canvas-logger.js\";\n\nexport default class SVGCanvasD3 {\n\n\tconstructor(canvasInfoId, canvasDivSelector, canvasController) {\n\t\tthis.logger = new Logger([\"SVGCanvasD3\", \"FlowId\", canvasInfoId]);\n\t\tthis.logger.logStartTimer(\"constructor\");\n\t\tthis.canvasController = canvasController;\n\t\tthis.canvasDiv = d3.select(canvasDivSelector);\n\t\tthis.logger.logEndTimer(\"constructor\", true);\n\t}\n\n\tsetCanvasInfo(canvasInfo, selectionInfo, breadcrumbs, nodeLayout, canvasLayout, config) {\n\t\tthis.logger = new Logger([\"SVGCanvasD3\", \"FlowId\", canvasInfo.id]);\n\t\tif (!this.config ||\n\t\t\t\t!this.renderer ||\n\t\t\t\t!this.canvasInfo ||\n\t\t\t\tcanvasInfo.id !== this.canvasInfo.id ||\n\t\t\t\t(this.renderer && this.renderer.pipelineId !== this.canvasController.getCurrentBreadcrumb().pipelineId) ||\n\t\t\t\t!ConfigUtils.compareCanvasConfigs(this.config, config)) {\n\t\t\tthis.logger.logStartTimer(\"initializing\");\n\n\t\t\tthis.canvasInfo = this.cloneCanvasInfo(canvasInfo);\n\t\t\tthis.config = this.cloneConfig(config);\n\n\t\t\tif (this.renderer) {\n\t\t\t\tthis.renderer.clearCanvas();\n\t\t\t\tthis.renderer = null;\n\t\t\t}\n\n\t\t\tconst currentBreadcrumb = this.canvasController.getCurrentBreadcrumb();\n\t\t\tthis.renderer = new SVGCanvasRenderer(\n\t\t\t\tcurrentBreadcrumb.pipelineId,\n\t\t\t\tthis.canvasDiv,\n\t\t\t\tthis.canvasController,\n\t\t\t\tthis.canvasInfo,\n\t\t\t\tselectionInfo,\n\t\t\t\tbreadcrumbs,\n\t\t\t\tnodeLayout,\n\t\t\t\tcanvasLayout,\n\t\t\t\tconfig,\n\t\t\t\t{ id: currentBreadcrumb.supernodeId, // Will be null for primary pipeline\n\t\t\t\t\tpipelineId: currentBreadcrumb.supernodeParentPipelineId // Will be null for primary pipeline\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.logger.logEndTimer(\"initializing\", true);\n\n\t\t} else {\n\t\t\tthis.logger.logStartTimer(\"set canvas info\");\n\n\t\t\tthis.canvasInfo = this.cloneCanvasInfo(canvasInfo);\n\t\t\tthis.renderer.setCanvasInfoRenderer(this.canvasInfo, selectionInfo, breadcrumbs, nodeLayout, canvasLayout);\n\n\t\t\tthis.logger.logEndTimer(\"set canvas info\", true);\n\t\t}\n\t}\n\n\tsetSelectionInfo(selectionInfo) {\n\t\tif (this.renderer) {\n\t\t\tthis.renderer.setSelectionInfo(selectionInfo);\n\t\t}\n\t}\n\n\t// Returns a copy of the config object. This is necessary so that comparisons\n\t// with new config objects that are provided reveal differences. This will\n\t// not clone the contents of emptyCanvasContent, dropZoneCanvasContent nor\n\t// enableNodeLayout.\n\tcloneConfig(config) {\n\t\treturn Object.assign({}, config);\n\t}\n\n\t// Returns a clone of the canvas info passed in.\n\tcloneCanvasInfo(canvasInfo) {\n\t\treturn cloneDeep(canvasInfo);\n\t}\n\n\tisEditingText() {\n\t\treturn this.renderer.isEditingText();\n\t}\n\n\tisDragging() {\n\t\treturn this.renderer.isDragging();\n\t}\n\n\tconvertPageCoordsToSnappedCanvasCoords(pos) {\n\t\tlet positon = this.renderer.convertPageCoordsToCanvasCoords(pos.x, pos.y);\n\t\tpositon = this.renderer.getMousePosSnapToGrid(positon);\n\t\treturn positon;\n\t}\n\n\tnodeTemplateDragStart(nodeTemplate) {\n\t\tthis.renderer.nodeTemplateDragStart(nodeTemplate);\n\t}\n\n\tnodeTemplateDragOver(nodeTemplate, x, y) {\n\t\tthis.renderer.nodeTemplateDragOver(nodeTemplate, x, y);\n\t}\n\n\tnodeTemplateDragEnd(nodeTemplate) {\n\t\tthis.renderer.nodeTemplateDragEnd(nodeTemplate);\n\t}\n\n\tnodeTemplateDropped(nodeTemplate, x, y) {\n\t\tthis.renderer.nodeTemplateDropped(nodeTemplate, x, y);\n\t}\n\n\texternalObjectDropped(dropData, x, y) {\n\t\tthis.renderer.externalObjectDropped(dropData, x, y);\n\t}\n\n\tzoomTo(zoomObject) {\n\t\tthis.renderer.zoomTo(zoomObject);\n\t}\n\n\ttranslateBy(x, y, animateTime) {\n\t\tthis.renderer.translateBy(x, y, animateTime);\n\t}\n\n\tzoomIn() {\n\t\tthis.renderer.zoomIn();\n\t}\n\n\tzoomOut() {\n\t\tthis.renderer.zoomOut();\n\t}\n\n\tzoomToFit() {\n\t\tthis.renderer.zoomToFit();\n\t}\n\n\tisZoomedToMax() {\n\t\treturn this.renderer ? this.renderer.isZoomedToMax() : false;\n\t}\n\n\tisZoomedToMin() {\n\t\treturn this.renderer ? this.renderer.isZoomedToMin() : false;\n\t}\n\n\tgetZoomToReveal(objectIds, xPos, yPos) {\n\t\treturn this.renderer ? this.renderer.getZoomToReveal(objectIds, xPos, yPos) : null;\n\t}\n\n\tgetZoom() {\n\t\treturn this.renderer ? this.renderer.getZoom() : null;\n\t}\n\n\tsetNodeLabelEditingMode(nodeId, pipelineId) {\n\t\tthis.renderer.setNodeLabelEditingMode(nodeId, pipelineId);\n\t}\n\n\tsetNodeDecorationLabelEditingMode(decId, nodeId, pipelineId) {\n\t\tthis.renderer.setNodeDecorationLabelEditingMode(decId, nodeId, pipelineId);\n\t}\n\n\tsetLinkDecorationLabelEditingMode(decId, linkId, pipelineId) {\n\t\tthis.renderer.setLinkDecorationLabelEditingMode(decId, linkId, pipelineId);\n\t}\n\n\trefreshOnSizeChange() {\n\t\tif (this.renderer) {\n\t\t\tthis.renderer.refreshOnSizeChange();\n\t\t}\n\t}\n\n\tgetDefaultCommentOffset() {\n\t\treturn this.renderer.getDefaultCommentOffset();\n\t}\n\n\tgetTransformedViewportDimensions() {\n\t\treturn this.renderer.getTransformedViewportDimensions();\n\t}\n\n\tgetGhostNode(nodeTemplate) {\n\t\treturn this.renderer.getGhostNode(nodeTemplate);\n\t}\n\n\tsetSpaceKeyPressed(state) {\n\t\tthis.renderer.setSpaceKeyPressed(state);\n\t}\n\n\tisSpaceKeyPressed() {\n\t\treturn this.renderer.isSpaceKeyPressed();\n\t}\n}\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint no-shadow: [\"error\", { \"allow\": [\"Node\", \"Comment\"] }] */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport ReactResizeDetector from \"react-resize-detector\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport defaultMessages from \"../../locales/common-canvas/locales/en.json\";\nimport CommonCanvasContextMenu from \"./cc-context-menu.jsx\";\nimport CommonCanvasTextToolbar from \"./cc-text-toolbar.jsx\";\nimport CommonCanvasStateTag from \"./cc-state-tag.jsx\";\nimport CanvasUtils from \"./common-canvas-utils.js\";\nimport { FlowData16 } from \"@carbon/icons-react\";\nimport { DND_DATA_TEXT, STATE_TAG_LOCKED, STATE_TAG_READ_ONLY } from \"./constants/canvas-constants\";\n\nimport Logger from \"../logging/canvas-logger.js\";\nimport SVGCanvasD3 from \"./svg-canvas-d3.js\";\n\nconst BACKSPACE_KEY = 8;\nconst DELETE_KEY = 46;\nconst SPACE_KEY = 32;\nconst A_KEY = 65;\nconst C_KEY = 67;\nconst P_KEY = 80;\nconst V_KEY = 86;\nconst X_KEY = 88;\nconst Y_KEY = 89;\nconst Z_KEY = 90;\n\n// TODO - Implement nudge behavior for moving nodes and comments\n// const LEFT_ARROW_KEY = 37;\n// const UP_ARROW_KEY = 38;\n// const RIGHT_ARROW_KEY = 39;\n// const DOWN_ARROW_KEY = 40;\n\nclass CanvasContents extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tisDropZoneDisplayed: false\n\t\t};\n\n\t\tthis.logger = new Logger(\"CC-Contents\");\n\n\t\tthis.mainCanvasDivId = \"canvas-div-\" + this.props.canvasController.getInstanceId();\n\t\tthis.svgCanvasDivId = \"d3-svg-canvas-div-\" + this.props.canvasController.getInstanceId();\n\t\tthis.svgCanvasDivSelector = \"#\" + this.svgCanvasDivId;\n\n\t\t// Used to track the drag position of a node from the palette. The dragOver\n\t\t// event is continually fired, even when the mouse pointer is not moving,\n\t\t// so this lets us eliminate unnecessary events being passed to the renderer.\n\t\tthis.dragX = null;\n\t\tthis.dragY = null;\n\n\t\t// Record whether we added the event listeners or not.\n\t\tthis.eventListenersAdded = false;\n\n\t\t// Keeps track of mouse position to enable us to paste at mouse position\n\t\t// using keyboard.\n\t\tthis.mousePos = { x: 0, y: 0 };\n\n\t\tthis.drop = this.drop.bind(this);\n\t\tthis.focusOnCanvas = this.focusOnCanvas.bind(this);\n\t\tthis.setIsDropZoneDisplayed = this.setIsDropZoneDisplayed.bind(this);\n\t\tthis.dragOver = this.dragOver.bind(this);\n\t\tthis.dragEnter = this.dragEnter.bind(this);\n\t\tthis.dragLeave = this.dragLeave.bind(this);\n\t\tthis.refreshOnSizeChange = this.refreshOnSizeChange.bind(this);\n\t\tthis.getLabel = this.getLabel.bind(this);\n\n\t\tthis.onCut = this.onCut.bind(this);\n\t\tthis.onCopy = this.onCopy.bind(this);\n\t\tthis.onPaste = this.onPaste.bind(this);\n\t\tthis.onKeyDown = this.onKeyDown.bind(this);\n\t\tthis.onKeyUp = this.onKeyUp.bind(this);\n\t\tthis.onMouseMove = this.onMouseMove.bind(this);\n\n\t\t// Variables to handle strange HTML drag and drop behaviors. That is, pairs\n\t\t// of dragEnter/dragLeave events are fired as an external object is\n\t\t// dragged around over the top of the 'drop zone' canvas.\n\t\tthis.first = false;\n\t\tthis.second = false;\n\n\t\t// The host application may set one or more callback functions to execute their own\n\t\t// code after an update has been performed caused by a redux update.\n\t\tthis.afterUpdateCallbacks = [];\n\n\t\t// Register ourself with the canvas controller so it can call this class\n\t\t// when necessary, and also call the SVGCanvasD3 object.\n\t\tprops.canvasController.setCanvasContents(this);\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.logger.log(\"componentDidMount\");\n\t\tthis.svgCanvasD3 =\n\t\t\tnew SVGCanvasD3(this.props.canvasInfo.id,\n\t\t\t\tthis.svgCanvasDivSelector,\n\t\t\t\tthis.props.canvasController);\n\t\tthis.setCanvasInfo();\n\n\t\tif (this.props.canvasConfig.enableBrowserEditMenu) {\n\t\t\tthis.addEventListeners();\n\t\t}\n\t\tthis.focusOnCanvas();\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tthis.logger.log(\"componentDidUpdate\");\n\t\tif (this.svgCanvasD3 && !this.isDropZoneDisplayed()) {\n\t\t\tif (prevProps.canvasInfo !== this.props.canvasInfo ||\n\t\t\t\t\tprevProps.canvasConfig !== this.props.canvasConfig ||\n\t\t\t\t\tprevProps.breadcrumbs !== this.props.breadcrumbs) {\n\t\t\t\tthis.setCanvasInfo();\n\t\t\t\t// Run the afterUpdateCallbacks.\n\t\t\t\tthis.afterUpdate();\n\n\t\t\t// If the only change is selectionInfo, we can call the special method\n\t\t\t// setSelectionInfo, which will only update the selection highlighting.\n\t\t\t} else if (prevProps.selectionInfo !== this.props.selectionInfo) {\n\t\t\t\tthis.svgCanvasD3.setSelectionInfo(this.props.selectionInfo);\n\t\t\t}\n\t\t}\n\n\t\t// Manage the event browsers in case this config property changes.\n\t\tif (this.props.canvasConfig.enableBrowserEditMenu) {\n\t\t\tthis.addEventListeners();\n\t\t} else {\n\t\t\tthis.removeEventListeners();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.removeEventListeners();\n\t}\n\n\tonCut(evt) {\n\t\tif (evt.currentTarget.activeElement.id === this.svgCanvasDivId &&\n\t\t\t\tthis.props.canvasConfig.enableEditingActions) {\n\t\t\tevt.preventDefault();\n\t\t\tthis.props.canvasController.cutToClipboard();\n\t\t}\n\t}\n\n\tonCopy(evt) {\n\t\tif (evt.currentTarget.activeElement.id === this.svgCanvasDivId &&\n\t\t\t\tthis.props.canvasConfig.enableEditingActions) {\n\t\t\tevt.preventDefault();\n\t\t\tthis.props.canvasController.copyToClipboard();\n\t\t}\n\t}\n\n\tonPaste(evt) {\n\t\tif (evt.currentTarget.activeElement.id === this.svgCanvasDivId &&\n\t\t\t\tthis.props.canvasConfig.enableEditingActions) {\n\t\t\tevt.preventDefault();\n\t\t\tthis.props.canvasController.pasteFromClipboard();\n\t\t}\n\t}\n\n\tonKeyDown(evt) {\n\t\t// Make sure no tip is displayed, because having one displayed\n\t\t// will interfere with drawing of the canvas as the result of any\n\t\t// keyboard action.\n\t\tthis.props.canvasController.closeTip();\n\t\tconst actions = this.props.canvasController.getKeyboardConfig().actions;\n\t\t// We don't handle key presses when:\n\t\t// 1. We are editng text, because the text area needs to receive key\n\t\t//    presses for undo, redo, delete etc.\n\t\t// 2. Dragging objects\n\t\tif (this.svgCanvasD3.isEditingText() ||\n\t\t\t\tthis.svgCanvasD3.isDragging()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// These actions alter the canvas objects so we need to check\n\t\t// this.config.enableEditingActions before calling them.\n\t\tif (this.props.canvasConfig.enableEditingActions) {\n\t\t\tif ((evt.keyCode === BACKSPACE_KEY || evt.keyCode === DELETE_KEY) && actions.delete) {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt); // Some browsers interpret Delete as 'Back to previous page'. So prevent that.\n\t\t\t\tthis.props.canvasController.keyboardActionHandler(\"deleteSelectedObjects\");\n\n\t\t\t} else if (CanvasUtils.isCmndCtrlPressed(evt) &&\n\t\t\t\t\t!evt.shiftKey && evt.keyCode === Z_KEY && actions.undo) {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt);\n\t\t\t\tthis.props.canvasController.keyboardActionHandler(\"undo\");\n\n\t\t\t} else if (CanvasUtils.isCmndCtrlPressed(evt) &&\n\t\t\t\t\t((evt.shiftKey && evt.keyCode === Z_KEY) || evt.keyCode === Y_KEY && actions.redo)) {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt);\n\t\t\t\tthis.props.canvasController.keyboardActionHandler(\"redo\");\n\n\t\t\t} else if (CanvasUtils.isCmndCtrlPressed(evt) && evt.keyCode === C_KEY && actions.copyToClipboard) {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt);\n\t\t\t\tthis.props.canvasController.keyboardActionHandler(\"copy\");\n\n\t\t\t} else if (CanvasUtils.isCmndCtrlPressed(evt) && evt.keyCode === X_KEY && actions.cutToClipboard) {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt);\n\t\t\t\tthis.props.canvasController.keyboardActionHandler(\"cut\");\n\n\t\t\t} else if (CanvasUtils.isCmndCtrlPressed(evt) && evt.keyCode === V_KEY && actions.pasteFromClipboard) {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt);\n\t\t\t\tif (this.mousePos) {\n\t\t\t\t\tconst mousePos = this.svgCanvasD3.convertPageCoordsToSnappedCanvasCoords(this.mousePos);\n\t\t\t\t\tthis.props.canvasController.keyboardActionHandler(\"paste\", mousePos);\n\t\t\t\t} else {\n\t\t\t\t\tthis.props.canvasController.keyboardActionHandler(\"paste\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// These last three keyboard actions do not alter the canvas objects so we\n\t\t// do not need to check this.config.enableEditingActions before calling them.\n\t\tif (CanvasUtils.isCmndCtrlPressed(evt) && evt.keyCode === A_KEY && actions.selectAll) {\n\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt);\n\t\t\tthis.props.canvasController.keyboardActionHandler(\"selectAll\");\n\n\t\t} else if (evt.keyCode === SPACE_KEY) {\n\t\t\tif (!this.svgCanvasD3.isSpaceKeyPressed()) {\n\t\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt);\n\t\t\t\tthis.svgCanvasD3.setSpaceKeyPressed(true);\n\t\t\t}\n\n\t\t} else if (CanvasUtils.isCmndCtrlPressed(evt) && evt.shiftKey && evt.altKey && evt.keyCode === P_KEY) {\n\t\t\tCanvasUtils.stopPropagationAndPreventDefault(evt);\n\t\t\tLogger.switchLoggingState(); // Switch the logging on and off\n\t\t}\n\t}\n\n\tonKeyUp() {\n\t\tthis.svgCanvasD3.setSpaceKeyPressed(false);\n\t}\n\n\t// Records in mousePos the mouse pointer position when the pointer is inside\n\t// the boundaries of the canvas or sets the mousePos to null. This position\n\t// info can be used with keyboard operations.\n\tonMouseMove(e) {\n\t\tif (e.target &&\n\t\t\te.target.className &&\n\t\t\t(\n\t\t\t\te.target.className.baseVal === \"svg-area\" ||\n\t\t\t\te.target.className.baseVal === \"d3-svg-background\"\n\t\t\t)) {\n\t\t\tthis.mousePos = {\n\t\t\t\tx: e.clientX,\n\t\t\t\ty: e.clientY\n\t\t\t};\n\t\t} else {\n\t\t\tthis.mousePos = null;\n\t\t}\n\t}\n\n\tsetCanvasInfo() {\n\t\t// TODO - Eventually move nodeLayout and canvasLayout into redux and then\n\t\t// pass them into this.svgCanvasD3() as props.\n\t\tconst nodeLayout = this.props.canvasController.objectModel.getNodeLayout();\n\t\tconst canvasLayout = this.props.canvasController.objectModel.getCanvasLayout();\n\t\tthis.svgCanvasD3.setCanvasInfo(\n\t\t\tthis.props.canvasInfo,\n\t\t\tthis.props.selectionInfo,\n\t\t\tthis.props.breadcrumbs,\n\t\t\tnodeLayout,\n\t\t\tcanvasLayout,\n\t\t\tthis.props.canvasConfig\n\t\t);\n\t}\n\n\tgetLabel(labelId) {\n\t\treturn this.props.intl.formatMessage({ id: labelId, defaultMessage: defaultMessages[labelId] });\n\t}\n\n\tgetDNDJson(event) {\n\t\ttry {\n\t\t\treturn JSON.parse(event.dataTransfer.getData(DND_DATA_TEXT));\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(\"The dragged object's data does not conform to the expected internal format: \" + e);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetSVGCanvasD3() {\n\t\treturn this.svgCanvasD3;\n\t}\n\n\tgetStateTag() {\n\t\tlet stateTag = null;\n\n\t\tif (this.props.canvasConfig.enableStateTag === STATE_TAG_READ_ONLY ||\n\t\t\t\tthis.props.canvasConfig.enableStateTag === STATE_TAG_LOCKED) {\n\t\t\tstateTag = (\n\t\t\t\t<CommonCanvasStateTag\n\t\t\t\t\tstateTagType={this.props.canvasConfig.enableStateTag}\n\t\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t\treturn stateTag;\n\t}\n\n\tgetEmptyCanvas() {\n\t\tlet emptyCanvas = null;\n\t\tif (this.props.canvasController.isPrimaryPipelineEmpty()) {\n\t\t\tif (this.props.canvasConfig.emptyCanvasContent) {\n\t\t\t\temptyCanvas = (\n\t\t\t\t\t<div className=\"empty-canvas\">\n\t\t\t\t\t\t{this.props.canvasConfig.emptyCanvasContent}\n\t\t\t\t\t</div>);\n\t\t\t} else {\n\t\t\t\temptyCanvas = (\n\t\t\t\t\t<div className=\"empty-canvas\">\n\t\t\t\t\t\t<div className=\"empty-canvas-image\"><FlowData16 /></div>\n\t\t\t\t\t\t<span className=\"empty-canvas-text1\">{this.getLabel(\"canvas.flowIsEmpty\")}</span>\n\t\t\t\t\t\t<span className=\"empty-canvas-text2\">{this.getLabel(\"canvas.addNodeToStart\")}</span>\n\t\t\t\t\t</div>);\n\t\t\t}\n\t\t}\n\t\treturn emptyCanvas;\n\t}\n\n\tgetContextMenu() {\n\t\treturn (\n\t\t\t<CommonCanvasContextMenu\n\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t\tcontainingDivId={this.mainCanvasDivId}\n\t\t\t/>);\n\t}\n\n\tgetTextToolbar() {\n\t\treturn (\n\t\t\t<CommonCanvasTextToolbar\n\t\t\t\tcanvasController={this.props.canvasController}\n\t\t\t/>);\n\t}\n\n\tgetDropZone() {\n\t\tlet dropZoneCanvas = null;\n\t\tif (this.isDropZoneDisplayed()) {\n\t\t\tif (this.props.canvasConfig.dropZoneCanvasContent) {\n\t\t\t\tdropZoneCanvas = this.props.canvasConfig.dropZoneCanvasContent;\n\t\t\t} else {\n\t\t\t\tdropZoneCanvas = (\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div className=\"dropzone-canvas\" />\n\t\t\t\t\t\t<div className=\"dropzone-canvas-rect\" />\n\t\t\t\t\t</div>);\n\t\t\t}\n\t\t}\n\t\treturn dropZoneCanvas;\n\t}\n\n\tgetSVGCanvasDiv() {\n\t\t// Set tabindex to -1 so the focus (see componentDidMount above) can go to\n\t\t// the div (which allows keyboard events to go there) and using -1 means\n\t\t// the user cannot tab to the div. Keyboard events are handled in svg-canvas-d3.js.\n\t\t// https://stackoverflow.com/questions/32911355/whats-the-tabindex-1-in-bootstrap-for\n\t\treturn (<div tabIndex=\"-1\" className=\"d3-svg-canvas-div\" id={this.svgCanvasDivId} onKeyDown={this.onKeyDown} onKeyUp={this.onKeyUp} />);\n\t}\n\n\tsetIsDropZoneDisplayed(isDropZoneDisplayed) {\n\t\tif (isDropZoneDisplayed !== this.state.isDropZoneDisplayed) {\n\t\t\tthis.setState({ isDropZoneDisplayed: isDropZoneDisplayed });\n\t\t}\n\t}\n\n\tisDropZoneDisplayed() {\n\t\treturn this.props.canvasConfig.enableDropZoneOnExternalDrag && this.state.isDropZoneDisplayed;\n\t}\n\n\tisDataTypeBeingDraggedFile(event) {\n\t\tif (event.dataTransfer && Array.isArray(event.dataTransfer.types)) {\n\t\t\treturn event.dataTransfer.types.includes(\"Files\");\n\t\t}\n\t\treturn false;\n\t}\n\n\tafterUpdate() {\n\t\tthis.afterUpdateCallbacks.forEach((callback) => callback());\n\t}\n\n\taddAfterUpdateCallback(callback) {\n\t\tconst pos = this.afterUpdateCallbacks.findIndex((cb) => cb === callback);\n\t\tif (pos === -1) {\n\t\t\tthis.afterUpdateCallbacks.push(callback);\n\t\t}\n\t}\n\n\tremoveAfterUpdateCallback(callback) {\n\t\tconst pos = this.afterUpdateCallbacks.findIndex((cb) => cb === callback);\n\t\tif (pos > -1) {\n\t\t\tthis.afterUpdateCallbacks.splice(pos, 1);\n\t\t}\n\t}\n\n\taddEventListeners() {\n\t\tif (!this.eventListenersAdded) {\n\t\t\tdocument.addEventListener(\"cut\", this.onCut, true);\n\t\t\tdocument.addEventListener(\"copy\", this.onCopy, true);\n\t\t\tdocument.addEventListener(\"paste\", this.onPaste, true);\n\t\t\tdocument.addEventListener(\"mousemove\", this.onMouseMove, true);\n\t\t\tthis.eventListenersAdded = true;\n\t\t}\n\t}\n\n\tremoveEventListeners() {\n\t\tif (this.eventListenersAdded) {\n\t\t\tdocument.removeEventListener(\"cut\", this.onCut, true);\n\t\t\tdocument.removeEventListener(\"copy\", this.onCopy, true);\n\t\t\tdocument.removeEventListener(\"paste\", this.onPaste, true);\n\t\t\tdocument.removeEventListener(\"mousemove\", this.onMouseMove, true);\n\t\t\tthis.eventListenersAdded = false;\n\t\t}\n\t}\n\n\tdrop(event) {\n\t\tevent.preventDefault();\n\t\tthis.setIsDropZoneDisplayed(false);\n\n\t\tthis.first = false;\n\t\tthis.second = false;\n\n\t\tif (!this.props.canvasConfig.enableEditingActions) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst nodeTemplate = this.props.canvasController.getDragNodeTemplate();\n\t\tif (nodeTemplate) {\n\t\t\tthis.svgCanvasD3.nodeTemplateDropped(nodeTemplate, event.clientX, event.clientY);\n\t\t\tthis.props.canvasController.nodeTemplateDragEnd();\n\n\t\t} else {\n\t\t\tlet dropData = this.getDNDJson(event);\n\t\t\t// If no drop data is found (which complies with the calling protocol\n\t\t\t// described in the wiki) we just pass through the dataTransfer data and\n\t\t\t// set an appropriate operation.\n\t\t\tif (!dropData) {\n\t\t\t\tdropData = {\n\t\t\t\t\toperation: \"addToCanvas\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tdataTransfer: event.dataTransfer,\n\t\t\t\t\t\teditType: \"createFromExternalObject\"\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.svgCanvasD3.externalObjectDropped(dropData, event.clientX, event.clientY);\n\t\t}\n\t}\n\n\tdragOver(event) {\n\t\t// Drag over is continually fired so only pass on the event when the mouse\n\t\t// cursor moves a reasonable distance.\n\t\tif (Math.abs(this.dragX - event.clientX) > 5 || Math.abs(this.dragY - event.clientY) > 5) {\n\t\t\tthis.dragX = event.clientX;\n\t\t\tthis.dragY = event.clientY;\n\t\t\tconst nodeTemplate = this.props.canvasController.getDragNodeTemplate();\n\t\t\tif (nodeTemplate) {\n\t\t\t\tthis.svgCanvasD3.nodeTemplateDragOver(nodeTemplate, event.clientX, event.clientY);\n\t\t\t}\n\t\t}\n\t}\n\n\tdragEnter(event) {\n\t\tthis.dragX = null;\n\t\tthis.dragY = null;\n\t\tif (this.isDataTypeBeingDraggedFile(event)) {\n\t\t\tif (this.first) {\n\t\t\t\tthis.second = true;\n\t\t\t} else {\n\t\t\t\tthis.first = true;\n\t\t\t\tthis.setIsDropZoneDisplayed(true);\n\t\t\t}\n\t\t}\n\t\tevent.preventDefault();\n\t}\n\n\tdragLeave(event) {\n\t\tif (this.isDataTypeBeingDraggedFile(event)) {\n\t\t\tif (this.second) {\n\t\t\t\tthis.second = false;\n\t\t\t} else if (this.first) {\n\t\t\t\tthis.first = false;\n\t\t\t}\n\n\t\t\tif (!this.first && !this.second) {\n\t\t\t\tthis.setIsDropZoneDisplayed(false);\n\t\t\t}\n\t\t}\n\t\tevent.preventDefault();\n\t}\n\n\tfocusOnCanvas() {\n\t\tif (document.getElementById(this.svgCanvasDivId)) {\n\t\t\tdocument.getElementById(this.svgCanvasDivId).focus(); // Set focus on div so keybord events go there.\n\t\t}\n\t}\n\n\t// Re-renders the diagram canvas when the canvas size changes. This refresh\n\t// is needed because the output binding ports of sub-flows displayed full-page\n\t// need to be rerendered as the canvas size changes. The canvas size might\n\t// change when the right side panel is opened or the browser is resized.\n\trefreshOnSizeChange() {\n\t\tif (this.svgCanvasD3) {\n\t\t\tthis.svgCanvasD3.refreshOnSizeChange();\n\t\t}\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tconst stateTag = this.getStateTag();\n\t\tconst emptyCanvas = this.getEmptyCanvas();\n\t\tconst contextMenu = this.getContextMenu();\n\t\tconst textToolbar = this.getTextToolbar();\n\t\tconst dropZoneCanvas = this.getDropZone();\n\t\tconst svgCanvasDiv = this.getSVGCanvasDiv();\n\n\t\tconst mainClassName = this.props.canvasConfig.enableRightFlyoutUnderToolbar\n\t\t\t? \"common-canvas-main\"\n\t\t\t: null;\n\n\t\tlet dropDivClassName = this.props.canvasConfig.enableRightFlyoutUnderToolbar\n\t\t\t? \"common-canvas-drop-div-under-toolbar\"\n\t\t\t: \"common-canvas-drop-div\";\n\n\t\tdropDivClassName = this.props.canvasConfig.enableToolbarLayout === \"None\"\n\t\t\t? dropDivClassName + \" common-canvas-toolbar-none\"\n\t\t\t: dropDivClassName;\n\n\t\tdropDivClassName = this.props.bottomPanelIsOpen\n\t\t\t? dropDivClassName + \" common-canvas-bottom-panel-is-open\"\n\t\t\t: dropDivClassName;\n\n\t\treturn (\n\t\t\t<main aria-label={this.getLabel(\"canvas.label\")} role=\"main\" className={mainClassName}>\n\t\t\t\t<ReactResizeDetector handleWidth handleHeight onResize={this.refreshOnSizeChange}>\n\t\t\t\t\t<div\n\t\t\t\t\t\tid={this.mainCanvasDivId}\n\t\t\t\t\t\tclassName={dropDivClassName}\n\t\t\t\t\t\tonDrop={this.drop}\n\t\t\t\t\t\tonDragOver={this.dragOver}\n\t\t\t\t\t\tonDragEnter={this.dragEnter}\n\t\t\t\t\t\tonDragLeave={this.dragLeave}\n\t\t\t\t\t>\n\t\t\t\t\t\t{emptyCanvas}\n\t\t\t\t\t\t{svgCanvasDiv}\n\t\t\t\t\t\t{contextMenu}\n\t\t\t\t\t\t{textToolbar}\n\t\t\t\t\t\t{dropZoneCanvas}\n\t\t\t\t\t\t{stateTag}\n\t\t\t\t\t</div>\n\t\t\t\t</ReactResizeDetector>\n\t\t\t</main>\n\t\t);\n\t}\n}\n\nCanvasContents.propTypes = {\n\t// Provided by CommonCanvas\n\tintl: PropTypes.object.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\n\t// Provided by Redux\n\tcanvasConfig: PropTypes.object.isRequired,\n\tcanvasInfo: PropTypes.object,\n\tbottomPanelIsOpen: PropTypes.bool,\n\tselectionInfo: PropTypes.object,\n\tbreadcrumbs: PropTypes.array\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tcanvasInfo: state.canvasinfo,\n\tcanvasConfig: state.canvasconfig,\n\tbottomPanelIsOpen: state.bottompanel.isOpen,\n\tselectionInfo: state.selectioninfo,\n\tbreadcrumbs: state.breadcrumbs\n});\n\nexport default connect(mapStateToProps)(injectIntl(CanvasContents));\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport defaultMessages from \"../../locales/common-canvas/locales/en.json\";\nimport defaultToolbarMessages from \"../../locales/toolbar/locales/en.json\";\nimport Toolbar from \"../toolbar/toolbar.jsx\";\nimport Logger from \"../logging/canvas-logger.js\";\nimport { ERROR, WARNING, SUCCESS, INFO, PALETTE_LAYOUT_NONE,\n\tNOTIFICATION_ICON_CLASS, TOOLBAR_TOGGLE_NOTIFICATION_PANEL, TOOLBAR_LAYOUT_TOP }\n\tfrom \"../common-canvas/constants/canvas-constants\";\n\nclass CommonCanvasToolbar extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.getLabel = this.getLabel.bind(this);\n\t\tthis.toolbarActionHandler = this.toolbarActionHandler.bind(this);\n\t\tthis.logger = new Logger(\"CC-Toolbar\");\n\t}\n\n\tgetLabel(labelId, substituteObj) {\n\t\tconst defaultMessage = defaultMessages[labelId] ? defaultMessages[labelId] : defaultToolbarMessages[labelId];\n\t\treturn this.props.intl.formatMessage({ id: labelId, defaultMessage: defaultMessage }, substituteObj);\n\t}\n\n\t// Returns the default toolbar which is shown if the user does not specify\n\t// a toolbar config.\n\tgetDefaultToolbar() {\n\t\treturn {\n\t\t\tleftBar: [\n\t\t\t\t{ action: \"undo\", label: this.getLabel(\"canvas.undo\"), enable: true },\n\t\t\t\t{ action: \"redo\", label: this.getLabel(\"canvas.redo\"), enable: true },\n\t\t\t\t{ action: \"cut\", label: this.getLabel(\"edit.cutSelection\"), enable: true },\n\t\t\t\t{ action: \"copy\", label: this.getLabel(\"edit.copySelection\"), enable: true },\n\t\t\t\t{ action: \"paste\", label: this.getLabel(\"edit.pasteSelection\"), enable: true },\n\t\t\t\t{ action: \"createAutoComment\", label: this.getLabel(\"canvas.addComment\"), enable: true },\n\t\t\t\t{ action: \"deleteSelectedObjects\", label: this.getLabel(\"canvas.deleteObject\"), enable: true }\n\t\t\t],\n\t\t\trightBar: [\n\t\t\t\t{ action: \"zoomIn\", label: this.getLabel(\"toolbar.zoomIn\"), enable: true },\n\t\t\t\t{ action: \"zoomOut\", label: this.getLabel(\"toolbar.zoomOut\"), enable: true },\n\t\t\t\t{ action: \"zoomToFit\", label: this.getLabel(\"toolbar.zoomToFit\"), enable: true }\n\t\t\t]\n\t\t};\n\t}\n\n\t// Returns a toolbar config for the toolbar the way it was initially supported.\n\t// That is, with an array of 'leftBar' items passed in to the toolbar config\n\t// and a fixed set of 'rightBar' items.\n\tgetConvertedLegacyToolbar(leftBarItems) {\n\t\treturn {\n\t\t\tleftBar: leftBarItems,\n\t\t\trightBar: this.getDefaultRightBar()\n\t\t};\n\t}\n\n\tgetDefaultRightBar() {\n\t\treturn [\n\t\t\t{ action: \"zoomIn\", label: this.getLabel(\"toolbar.zoomIn\"), enable: true },\n\t\t\t{ action: \"zoomOut\", label: this.getLabel(\"toolbar.zoomOut\"), enable: true },\n\t\t\t{ action: \"zoomToFit\", label: this.getLabel(\"toolbar.zoomToFit\"), enable: true }\n\t\t];\n\t}\n\n\tgetNotificationClassName() {\n\t\tconst maxMessageType = this.props.canvasController.getNotificationMessagesMaxType();\n\t\tlet className = NOTIFICATION_ICON_CLASS;\n\n\t\t// notification color indicator will show the highest severity status\n\t\tif (maxMessageType === ERROR) {\n\t\t\tclassName += \" error\";\n\t\t} else if (maxMessageType === WARNING) {\n\t\t\tclassName += \" warning\";\n\t\t} else if (maxMessageType === SUCCESS) {\n\t\t\tclassName += \" success\";\n\t\t} else if (maxMessageType === INFO) {\n\t\t\tclassName += \" info\";\n\t\t}\n\t\treturn className;\n\t}\n\n\tgenerateToolbarConfig() {\n\t\tlet config = this.copyConfig();\n\n\t\tif (config) {\n\t\t\tif (Array.isArray(config)) {\n\t\t\t\tconfig = this.getConvertedLegacyToolbar(config);\n\t\t\t} else if (typeof config.rightBar === \"undefined\") {\n\t\t\t\tconfig.rightBar = this.getDefaultRightBar();\n\t\t\t}\n\n\t\t} else {\n\t\t\tconfig = this.getDefaultToolbar();\n\t\t}\n\n\t\tconfig = Object.assign({}, config,\n\t\t\t{ leftBar: this.optionallyAddPaletteTool(config.leftBar || []) },\n\t\t\t{ rightBar: this.optionallyAddNotificationTool(config.rightBar || []) }\n\t\t);\n\n\t\treturn config;\n\t}\n\n\t// Copy the props config because we will alter its contents and we don't want to\n\t// alter a props variable since that would alter the parent variable.\n\tcopyConfig() {\n\t\tif (!this.props.config) {\n\t\t\treturn null;\n\t\t}\n\t\tif (Array.isArray(this.props.config)) {\n\t\t\treturn [...this.props.config];\n\t\t}\n\n\t\tconst config = {};\n\t\tif (this.props.config.overrideAutoEnableDisable) {\n\t\t\tconfig.overrideAutoEnableDisable = true;\n\t\t}\n\t\tif (this.props.config && this.props.config.leftBar) {\n\t\t\tconfig.leftBar = [...this.props.config.leftBar];\n\t\t}\n\t\tif (this.props.config && this.props.config.rightBar) {\n\t\t\tconfig.rightBar = [...this.props.config.rightBar];\n\t\t}\n\t\treturn config;\n\t}\n\n\ttoolbarActionHandler(action) {\n\t\tthis.props.canvasController.toolbarActionHandler(action);\n\t}\n\n\toptionallyAddPaletteTool(leftBar) {\n\t\tlet paletteLabel = this.getLabel(\"toolbar.palette\");\n\n\t\t// If the leftBar contains and old palette action and if followed by a\n\t\t// divider remove them.\n\t\tlet newLeftBar = leftBar;\n\t\tif (leftBar && leftBar.length > 0 && leftBar[0].action === \"palette\") {\n\t\t\t// Use the existing palette label if one was provided.\n\t\t\tpaletteLabel = leftBar[0].label ? leftBar[0].label : paletteLabel;\n\t\t\tnewLeftBar = leftBar.slice(1);\n\t\t\tif (leftBar.length > 1 && leftBar[1].divider) {\n\t\t\t\tnewLeftBar = leftBar.slice(2);\n\t\t\t}\n\t\t}\n\n\t\t// Add the new togglePalette icon if the palette is enabled.\n\t\tif (this.props.isPaletteEnabled) {\n\t\t\tconst paletteTools = [\n\t\t\t\t{ action: \"togglePalette\",\n\t\t\t\t\tlabel: paletteLabel,\n\t\t\t\t\tenable: true,\n\t\t\t\t\ticonTypeOverride: this.props.isPaletteOpen ? \"paletteClose\" : \"paletteOpen\"\n\t\t\t\t},\n\t\t\t\t{ divider: true }\n\t\t\t];\n\t\t\treturn paletteTools.concat(newLeftBar);\n\t\t}\n\t\treturn newLeftBar;\n\t}\n\n\toptionallyAddNotificationTool(rightBar) {\n\t\tif (this.props.notificationConfig &&\n\t\t\ttypeof this.props.notificationConfig.action !== \"undefined\" &&\n\t\t\ttypeof this.props.notificationConfig.enable !== \"undefined\") {\n\t\t\tconst notificationCount = this.props.notificationMessages.length;\n\t\t\tconst notificationTools = [\n\t\t\t\t{ divider: true },\n\t\t\t\t{ action: TOOLBAR_TOGGLE_NOTIFICATION_PANEL,\n\t\t\t\t\tlabel: this.props.notificationConfig.label,\n\t\t\t\t\tenable: true,\n\t\t\t\t\tisSelected: this.props.isNotificationOpen,\n\t\t\t\t\tclassName: this.getNotificationClassName(),\n\t\t\t\t\ttextContent: (notificationCount > 9) ? \"9+\" : notificationCount.toString()\n\t\t\t\t}\n\t\t\t];\n\t\t\treturn rightBar.concat(notificationTools);\n\t\t}\n\t\treturn rightBar;\n\t}\n\n\tconfigureToolbarButtonsState(toolbarConfig) {\n\t\t// We only set toolbar state with the internal object model. With the\n\t\t// external object model the host app must set toolbar state through the\n\t\t// toolbar config params.\n\t\tif (!this.props.enableInternalObjectModel ||\n\t\t\t\ttoolbarConfig.overrideAutoEnableDisable) {\n\t\t\treturn toolbarConfig;\n\t\t}\n\n\t\tif (typeof toolbarConfig !== \"undefined\") {\n\t\t\tconst editingAllowed = this.props.enableEditingActions;\n\t\t\tthis.applyToolState(\"undo\", toolbarConfig, editingAllowed && this.props.canUndo);\n\t\t\tthis.applyToolState(\"redo\", toolbarConfig, editingAllowed && this.props.canRedo);\n\t\t\tthis.applyToolState(\"cut\", toolbarConfig, editingAllowed && this.props.canCutCopy);\n\t\t\tthis.applyToolState(\"copy\", toolbarConfig, editingAllowed && this.props.canCutCopy);\n\t\t\tthis.applyToolState(\"paste\", toolbarConfig, editingAllowed && this.props.canPaste);\n\t\t\tthis.applyToolState(\"deleteSelectedObjects\", toolbarConfig, editingAllowed && this.props.canDelete);\n\t\t\tthis.applyToolState(\"createAutoComment\", toolbarConfig, editingAllowed);\n\t\t\tthis.applyToolState(\"arrangeHorizontally\", toolbarConfig, editingAllowed);\n\t\t\tthis.applyToolState(\"arrangeVertically\", toolbarConfig, editingAllowed);\n\t\t\t// editingAllowed = false doesn't stop zoom capability\n\t\t\tthis.applyToolState(\"zoomIn\", toolbarConfig, this.props.canZoomIn);\n\t\t\tthis.applyToolState(\"zoomOut\", toolbarConfig, this.props.canZoomOut);\n\t\t\tthis.applyToolState(\"zoomToFit\", toolbarConfig, this.props.canZoomToFit);\n\t\t}\n\t\treturn toolbarConfig;\n\t}\n\n\taddUndoRedoCommandLabels(toolbarConfig) {\n\t\tconst undoLabel = this.props.undoLabel;\n\t\tconst redoLabel = this.props.redoLabel;\n\n\t\tif (undoLabel) {\n\t\t\tconst undoTool = this.findTool(\"undo\", toolbarConfig);\n\t\t\tif (undoTool) {\n\t\t\t\tundoTool.label = this.getLabel(\"canvas.undoCommand\", { undo_command: undoLabel });\n\t\t\t}\n\t\t}\n\t\tif (redoLabel) {\n\t\t\tconst redoTool = this.findTool(\"redo\", toolbarConfig);\n\t\t\tif (redoTool) {\n\t\t\t\tredoTool.label = this.getLabel(\"canvas.redoCommand\", { redo_command: redoLabel });\n\t\t\t}\n\t\t}\n\t\treturn toolbarConfig;\n\t}\n\n\tapplyToolState(action, toolbarConfig, state) {\n\t\tconst tool = this.findTool(action, toolbarConfig);\n\t\tif (tool) {\n\t\t\ttool.enable = state;\n\t\t} else {\n\t\t\tthis.logger.log(\"Toolbar tool \" + action + \" could not be found to set state to \" + state);\n\t\t}\n\t}\n\n\tfindTool(action, toolbarConfig) {\n\t\tlet tool = {};\n\t\tif (toolbarConfig.leftBar) {\n\t\t\ttool = toolbarConfig.leftBar.find((o) => o.action === action);\n\t\t}\n\t\tif (!tool && toolbarConfig.rightBar) {\n\t\t\ttool = toolbarConfig.rightBar.find((o) => o.action === action);\n\t\t}\n\t\treturn tool;\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tlet toolbarConfig = this.generateToolbarConfig();\n\t\ttoolbarConfig = this.configureToolbarButtonsState(toolbarConfig);\n\t\ttoolbarConfig = this.addUndoRedoCommandLabels(toolbarConfig);\n\t\tlet canvasToolbar = null;\n\n\t\tif (this.props.enableToolbarLayout === TOOLBAR_LAYOUT_TOP) {\n\t\t\tcanvasToolbar = (\n\t\t\t\t<div aria-label={this.getLabel(\"toolbar.label\")} role=\"navigation\">\n\t\t\t\t\t<Toolbar\n\t\t\t\t\t\tconfig={toolbarConfig}\n\t\t\t\t\t\tinstanceId={this.props.canvasController.getInstanceId()}\n\t\t\t\t\t\ttoolbarActionHandler={this.toolbarActionHandler}\n\t\t\t\t\t\tadditionalText={{ overflowMenuLabel: this.getLabel(\"toolbar.overflowMenu\") }}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\treturn canvasToolbar;\n\t}\n}\n\nCommonCanvasToolbar.propTypes = {\n\t// Provided by CommonCanvas\n\tintl: PropTypes.object.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\n\t// Provided by redux\n\tenableToolbarLayout: PropTypes.string.isRequired,\n\tconfig: PropTypes.oneOfType([\n\t\tPropTypes.array.isRequired,\n\t\tPropTypes.object.isRequired\n\t]),\n\tisPaletteEnabled: PropTypes.bool,\n\tisPaletteOpen: PropTypes.bool,\n\tisNotificationOpen: PropTypes.bool,\n\tnotificationMessages: PropTypes.array,\n\tnotificationConfig: PropTypes.object,\n\tenableInternalObjectModel: PropTypes.bool,\n\tenableEditingActions: PropTypes.bool,\n\tcanUndo: PropTypes.bool,\n\tcanRedo: PropTypes.bool,\n\tcanCutCopy: PropTypes.bool,\n\tcanPaste: PropTypes.bool,\n\tcanDelete: PropTypes.bool,\n\tcanZoomIn: PropTypes.bool,\n\tcanZoomOut: PropTypes.bool,\n\tcanZoomToFit: PropTypes.bool,\n\tundoLabel: PropTypes.string,\n\tredoLabel: PropTypes.string\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tenableToolbarLayout: state.canvasconfig.enableToolbarLayout,\n\tconfig: state.canvastoolbar.config,\n\tisPaletteEnabled: state.canvasconfig.enablePaletteLayout !== PALETTE_LAYOUT_NONE,\n\tisPaletteOpen: state.palette.isOpen,\n\tisNotificationOpen: state.notificationpanel.isOpen,\n\tnotificationConfig: state.notificationpanel.config,\n\tnotificationMessages: state.notifications,\n\tenableInternalObjectModel: state.canvasconfig.enableInternalObjectModel,\n\tenableEditingActions: state.canvasconfig.enableEditingActions,\n\tcanUndo: ownProps.canvasController.canUndo(),\n\tcanRedo: ownProps.canvasController.canRedo(),\n\tcanCutCopy: ownProps.canvasController.canCutCopy(),\n\tcanPaste: ownProps.canvasController.canPaste(),\n\tcanDelete: ownProps.canvasController.canDelete(),\n\tcanZoomIn: ownProps.canvasController.canZoomIn(),\n\tcanZoomOut: ownProps.canvasController.canZoomOut(),\n\tcanZoomToFit: ownProps.canvasController.canZoomToFit(),\n\tundoLabel: ownProps.canvasController.getUndoLabel(),\n\tredoLabel: ownProps.canvasController.getRedoLabel()\n});\n\nexport default connect(mapStateToProps)(injectIntl(CommonCanvasToolbar));\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport Logger from \"../logging/canvas-logger.js\";\n\nclass CommonCanvasRightFlyout extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.logger = new Logger(\"CC-RightFlyout\");\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tlet rightFlyout = (<div className=\"right-flyout-panel\" />);\n\n\t\tif (this.props.content && this.props.isOpen) {\n\t\t\tconst rfClass = this.props.enableRightFlyoutUnderToolbar\n\t\t\t\t? \"right-flyout-panel under-toolbar\"\n\t\t\t\t: \"right-flyout-panel\";\n\t\t\trightFlyout = (\n\t\t\t\t<div className={rfClass}>\n\t\t\t\t\t{this.props.content}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\treturn rightFlyout;\n\t}\n}\n\nCommonCanvasRightFlyout.propTypes = {\n\t// Provided by Redux\n\tisOpen: PropTypes.bool,\n\tcontent: PropTypes.object,\n\tenableRightFlyoutUnderToolbar: PropTypes.bool\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tisOpen: state.rightflyout.isOpen,\n\tcontent: state.rightflyout.content,\n\tenableRightFlyoutUnderToolbar: state.canvasconfig.enableRightFlyoutUnderToolbar\n});\n\nexport default connect(mapStateToProps)(CommonCanvasRightFlyout);\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { connect } from \"react-redux\";\nimport Logger from \"../logging/canvas-logger.js\";\n\nconst MARGIN_TOP = 100;\nconst MIN_HEIGHT = 75;\n\nclass CanvasBottomPanel extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.logger = new Logger(\"CC-Bottom-Panel\");\n\n\t\tthis.onMouseUp = this.onMouseUp.bind(this);\n\t\tthis.onMouseDown = this.onMouseDown.bind(this);\n\t\tthis.onMouseMoveY = this.onMouseMoveY.bind(this);\n\t}\n\n\tonMouseDown(e) {\n\t\tif (e.button === 0) {\n\t\t\tdocument.addEventListener(\"mousemove\", this.onMouseMoveY, true);\n\t\t\tdocument.addEventListener(\"mouseup\", this.onMouseUp, true);\n\t\t\tthis.posY = e.clientY;\n\t\t\t// Prevent panel contents being dragged in the test harness (which can\n\t\t\t// happen even though draggable is false for the contents!)\n\t\t\te.preventDefault();\n\t\t}\n\t}\n\n\tonMouseUp(e) {\n\t\tdocument.removeEventListener(\"mousemove\", this.onMouseMoveY, true);\n\t\tdocument.removeEventListener(\"mouseup\", this.onMouseUp, true);\n\t}\n\n\tonMouseMoveY(e) {\n\t\tif (e.clientY) {\n\t\t\tconst diff = e.clientY - this.posY;\n\t\t\tconst ht = this.props.panelHeight - diff;\n\t\t\tthis.props.canvasController.setBottomPanelHeight(this.limitHeight(ht));\n\t\t\tthis.posY = e.clientY;\n\t\t}\n\t}\n\n\t// Returns a new height for the bottom panel limited by the need to enforce\n\t// a minimum and maximum height.\n\tlimitHeight(ht) {\n\t\tconst canvasContainer = document.getElementById(this.props.containingDivId);\n\t\tlet height = ht;\n\n\t\t// canvasContainer may not be available in some test situations\n\t\tif (canvasContainer) {\n\t\t\tconst canvasHeight = canvasContainer.getBoundingClientRect().height;\n\t\t\tconst maxHeight = canvasHeight - MARGIN_TOP;\n\t\t\theight = Math.min(Math.max(height, MIN_HEIGHT), maxHeight);\n\t\t}\n\t\treturn height;\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\t\tlet bottomPanel = null;\n\n\t\tif (this.props.bottomPanelIsOpen) {\n\t\t\tconst heightPx = this.limitHeight(this.props.panelHeight) + \"px\";\n\n\t\t\tbottomPanel = (\n\t\t\t\t<div className=\"bottom-panel\" style={{ height: heightPx }} >\n\t\t\t\t\t<div className=\"bottom-panel-drag\" onMouseDown={this.onMouseDown} />\n\t\t\t\t\t<div className=\"bottom-panel-contents\">\n\t\t\t\t\t\t{this.props.bottomPanelContent}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\treturn bottomPanel;\n\t}\n}\n\nCanvasBottomPanel.propTypes = {\n\t// Provided by CommonCanvas\n\tcanvasController: PropTypes.object,\n\tcontainingDivId: PropTypes.string,\n\n\t// Provided by Redux\n\tbottomPanelIsOpen: PropTypes.bool,\n\tbottomPanelContent: PropTypes.object,\n\tpanelHeight: PropTypes.number\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tbottomPanelIsOpen: state.bottompanel.isOpen,\n\tbottomPanelContent: state.bottompanel.content,\n\tpanelHeight: state.bottompanel.panelHeight\n});\nexport default connect(mapStateToProps)(CanvasBottomPanel);\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { connect } from \"react-redux\";\nimport Icon from \"./../icons/icon.jsx\";\nimport { Button } from \"carbon-components-react\";\nimport { Close16 } from \"@carbon/icons-react\";\nimport Logger from \"../logging/canvas-logger.js\";\nimport { DEFAULT_NOTIFICATION_HEADER, NOTIFICATION_ICON_CLASS } from \"./../common-canvas/constants/canvas-constants.js\";\n\n\nclass NotificationPanel extends React.Component {\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\n\t\tif (nextProps.messages !== prevState.messages) {\n\t\t\treturn ({ messages: nextProps.messages });\n\t\t}\n\t\treturn ({});\n\t}\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {};\n\t\tthis.logger = new Logger(\"NotificationPanel\");\n\t\tthis.handleNotificationPanelClickOutside = this.handleNotificationPanelClickOutside.bind(this);\n\t\tthis.closeNotificationPanel = this.closeNotificationPanel.bind(this);\n\t}\n\n\tcomponentDidMount() {\n\t\tdocument.addEventListener(\"click\", this.handleNotificationPanelClickOutside, true);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tdocument.removeEventListener(\"click\", this.handleNotificationPanelClickOutside, true);\n\t}\n\n\tgetNotifications() {\n\t\tconst notifications = [];\n\t\tif (!this.props.messages) {\n\t\t\treturn notifications;\n\t\t}\n\t\tfor (let index = 0; index < this.props.messages.length; index++) {\n\t\t\tconst message = this.props.messages[index];\n\t\t\tconst className = message.callback ? \" clickable \" : \"\";\n\t\t\tconst iconType = message.type;\n\t\t\tconst type = (<div className=\"notification-message-type\">\n\t\t\t\t<Icon type={iconType} className={`notification-message-icon-${iconType}`} />\n\t\t\t</div>);\n\n\t\t\tconst title = message.title\n\t\t\t\t? (<div className=\"notification-message-title\">\n\t\t\t\t\t{message.title}\n\t\t\t\t</div>)\n\t\t\t\t: null;\n\n\t\t\tconst subtitle = message.subtitle\n\t\t\t\t? (<div className = \"notification-message-subtitle\">\n\t\t\t\t\t{message.subtitle}\n\t\t\t\t\t<hr />\n\t\t\t\t</div>)\n\t\t\t\t: null;\n\n\t\t\tconst closeMessage = message.closeMessage\n\t\t\t\t? (<div className = \"notification-message-close\" onClick={this.deleteNotification.bind(this, message.id)}>\n\t\t\t\t\t{message.closeMessage}\n\t\t\t\t</div>)\n\t\t\t\t: null;\n\n\t\t\tconst timestamp = message.timestamp\n\t\t\t\t? (<div className=\"notification-message-timestamp\">\n\t\t\t\t\t<div className=\"notification-message-timestamp-icon\">\n\t\t\t\t\t\t<Icon type=\"time\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"notification-message-string\">\n\t\t\t\t\t\t{message.timestamp}\n\t\t\t\t\t</div>\n\t\t\t\t</div>)\n\t\t\t\t: null;\n\n\t\t\tnotifications.push(<div className=\"notifications-button-container\" key={index + \"-\" + message.id} >\n\t\t\t\t<div\n\t\t\t\t\tclassName={\"notifications \" + className + message.type}\n\t\t\t\t\tonClick={this.notificationCallback.bind(this, message.id, message.callback)}\n\t\t\t\t>\n\t\t\t\t\t{type}\n\t\t\t\t\t<div className=\"notification-message-details\">\n\t\t\t\t\t\t{title}\n\t\t\t\t\t\t{subtitle}\n\t\t\t\t\t\t<div className=\"notification-message-content\">\n\t\t\t\t\t\t\t{message.content}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{timestamp}\n\t\t\t\t\t\t{closeMessage}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>);\n\t\t}\n\n\t\treturn notifications;\n\t}\n\n\thandleNotificationPanelClickOutside(e) {\n\t\tif (this.props.isNotificationOpen &&\n\t\t\t\tthis.props.notificationConfig &&\n\t\t\t\t!this.props.notificationConfig.keepOpen) {\n\t\t\tconst notificationIcon = document.getElementsByClassName(NOTIFICATION_ICON_CLASS)[0];\n\t\t\tconst notificationHeader = document.getElementsByClassName(\"notification-panel-header\")[0];\n\t\t\tconst notificationMessages = document.getElementsByClassName(\"notification-panel-messages-container\")[0];\n\n\t\t\tif (notificationIcon && !notificationIcon.contains(e.target) &&\n\t\t\t\t\tnotificationHeader && !notificationHeader.contains(e.target) &&\n\t\t\t\t\tnotificationMessages && !notificationMessages.contains(e.target)) {\n\t\t\t\tthis.props.canvasController.toolbarActionHandler(\"closeNotificationPanel\");\n\t\t\t\te.stopPropagation(); // Prevent D3 canvas code from clearing the selections.\n\t\t\t}\n\t\t}\n\t}\n\n\tnotificationCallback(id, messageCallback) {\n\t\tif (messageCallback) {\n\t\t\tmessageCallback(id);\n\t\t}\n\t}\n\n\tdeleteNotification(id) {\n\t\tthis.props.canvasController.deleteNotificationMessages(id);\n\t}\n\n\tclearNotificationMessages() {\n\t\tthis.props.canvasController.clearNotificationMessages();\n\t\tif (typeof this.props.notificationConfig.clearAllCallback === \"function\") {\n\t\t\tthis.props.notificationConfig.clearAllCallback();\n\t\t}\n\t}\n\n\tcloseNotificationPanel() {\n\t\tthis.props.canvasController.toolbarActionHandler(\"closeNotificationPanel\");\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tif (!this.props.notificationConfig) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst notificationPanelClassName = this.props.isNotificationOpen ? \"\" : \"panel-hidden\";\n\t\tconst notificationHeader = this.props.notificationConfig && this.props.notificationConfig.notificationHeader\n\t\t\t? this.props.notificationConfig.notificationHeader\n\t\t\t: DEFAULT_NOTIFICATION_HEADER;\n\n\t\tconst notificationSubtitle = this.props.notificationConfig && this.props.notificationConfig.notificationSubtitle\n\t\t\t? (<div className=\"notification-panel-subtitle\">\n\t\t\t\t{this.props.notificationConfig.notificationSubtitle}\n\t\t\t</div>)\n\t\t\t: null;\n\n\t\tconst notificationPanelMessages = this.props.messages.length > 0\n\t\t\t? this.getNotifications()\n\t\t\t: (<div className=\"notification-panel-empty-message-container\">\n\t\t\t\t<div className=\"notification-panel-empty-message\">\n\t\t\t\t\t{this.props.notificationConfig && this.props.notificationConfig.emptyMessage ? this.props.notificationConfig.emptyMessage : null}\n\t\t\t\t</div>\n\t\t\t</div>);\n\n\t\tconst clearAll = this.props.notificationConfig && this.props.notificationConfig.clearAllMessage\n\t\t\t? (<div className=\"notification-panel-clear-all-container\">\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"notification-panel-clear-all\"\n\t\t\t\t\tonClick={this.clearNotificationMessages.bind(this)}\n\t\t\t\t\tkind=\"ghost\"\n\t\t\t\t\tsize=\"small\"\n\t\t\t\t\tdisabled={this.props.messages.length === 0}\n\t\t\t\t>\n\t\t\t\t\t{this.props.notificationConfig.clearAllMessage}\n\t\t\t\t</Button>\n\t\t\t</div>)\n\t\t\t: null;\n\n\t\tconst secondaryButton = this.props.notificationConfig &&\n\t\t\tthis.props.notificationConfig.secondaryButtonLabel &&\n\t\t\tthis.props.notificationConfig.secondaryButtonCallback\n\t\t\t? (<div className=\"notification-panel-secondary-button-container\">\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"notification-panel-secondary-button\"\n\t\t\t\t\tonClick={this.props.notificationConfig.secondaryButtonCallback.bind(this)}\n\t\t\t\t\tkind=\"ghost\"\n\t\t\t\t\tsize=\"small\"\n\t\t\t\t\tdisabled={this.props.secondaryButtonDisabled}\n\t\t\t\t>\n\t\t\t\t\t{this.props.notificationConfig.secondaryButtonLabel}\n\t\t\t\t</Button>\n\t\t\t</div>)\n\t\t\t: null;\n\n\t\treturn (<div className={\"notification-panel-container \" + notificationPanelClassName} >\n\t\t\t<div className=\"notification-panel\">\n\t\t\t\t<div className=\"notification-panel-header-container\">\n\t\t\t\t\t<div className=\"notification-panel-header\">\n\t\t\t\t\t\t{notificationHeader}\n\t\t\t\t\t\t<Close16 className=\"notification-panel-close-icon\" onClick={this.closeNotificationPanel} />\n\t\t\t\t\t</div>\n\t\t\t\t\t{notificationSubtitle}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"notification-panel-messages-container\">\n\t\t\t\t\t<div className=\"notification-panel-messages\">\n\t\t\t\t\t\t{notificationPanelMessages}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"notification-panel-button-container\">\n\t\t\t\t\t\t{clearAll}\n\t\t\t\t\t\t{secondaryButton}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>);\n\t}\n}\n\nNotificationPanel.propTypes = {\n\t// Provided by CommonCanvas\n\tcanvasController: PropTypes.object,\n\n\t// Provided by Redux\n\tnotificationConfig: PropTypes.shape({\n\t\tnotificationHeader: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object\n\t\t]),\n\t\tnotificationSubtitle: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object\n\t\t]),\n\t\temptyMessage: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object\n\t\t]),\n\t\tclearAllMessage: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object\n\t\t]),\n\t\tclearAllCallback: PropTypes.func,\n\t\tkeepOpen: PropTypes.bool,\n\t\tsecondaryButtonLabel: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object\n\t\t]),\n\t\tsecondaryButtonCallback: PropTypes.func,\n\t\tsecondaryButtonDisabled: PropTypes.bool\n\t}),\n\tsecondaryButtonDisabled: PropTypes.bool,\n\tisNotificationOpen: PropTypes.bool,\n\tmessages: PropTypes.array\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tnotificationConfig: state.notificationpanel.config,\n\tsecondaryButtonDisabled: state.notificationpanel.config ? state.notificationpanel.config.secondaryButtonDisabled : false,\n\tisNotificationOpen: state.notificationpanel.isOpen,\n\tmessages: state.notifications\n});\n\nexport default connect(mapStateToProps)(NotificationPanel);\n","/*\n * Copyright 2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport CanvasContents from \"./cc-contents.jsx\";\nimport CommonCanvasToolbar from \"./cc-toolbar.jsx\";\nimport CommonCanvasRightFlyout from \"./cc-right-flyout.jsx\";\nimport CanvasBottomPanel from \"./cc-bottom-panel.jsx\";\nimport NotificationPanel from \"../notification-panel/notification-panel.jsx\";\nimport Logger from \"../logging/canvas-logger.js\";\n\nclass CommonCanvasCentralItems extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.logger = new Logger(\"CC-CentralItems\");\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tconst rightFlyout = (<CommonCanvasRightFlyout />);\n\t\tconst canvasToolbar = (<CommonCanvasToolbar canvasController={this.props.canvasController} />);\n\t\tconst notificationPanel = (<NotificationPanel canvasController={this.props.canvasController} />);\n\t\tconst canvasContents = (<CanvasContents canvasController={this.props.canvasController} />);\n\t\tconst bottomPanel = (<CanvasBottomPanel canvasController={this.props.canvasController} containingDivId={this.props.containingDivId} />);\n\n\t\tlet centralItems = null;\n\t\tif (this.props.enableRightFlyoutUnderToolbar) {\n\t\t\tcentralItems = (\n\t\t\t\t<div className=\"common-canvas-right-side-items-under-toolbar\">\n\t\t\t\t\t{canvasToolbar}\n\t\t\t\t\t<div id={this.props.containingDivId} className=\"common-canvas-items-container-under-toolbar\">\n\t\t\t\t\t\t<div className=\"common-canvas-with-bottom-panel\">\n\t\t\t\t\t\t\t{canvasContents}\n\t\t\t\t\t\t\t{bottomPanel}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t{rightFlyout}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{notificationPanel}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\n\t\t} else {\n\t\t\tcentralItems = (\n\t\t\t\t<div className=\"common-canvas-right-side-items\">\n\t\t\t\t\t<div id={this.props.containingDivId} className=\"common-canvas-items-container\">\n\t\t\t\t\t\t{canvasToolbar}\n\t\t\t\t\t\t{canvasContents}\n\t\t\t\t\t\t{bottomPanel}\n\t\t\t\t\t\t{notificationPanel}\n\t\t\t\t\t</div>\n\t\t\t\t\t{rightFlyout}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\treturn centralItems;\n\t}\n}\n\nCommonCanvasCentralItems.propTypes = {\n\t// Provided by CommonCanvas\n\tcanvasController: PropTypes.object.isRequired,\n\tcontainingDivId: PropTypes.string.isRequired,\n\n\t// Provided by Redux\n\tenableRightFlyoutUnderToolbar: PropTypes.bool\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n\tenableRightFlyoutUnderToolbar: state.canvasconfig.enableRightFlyoutUnderToolbar\n});\n\nexport default connect(mapStateToProps)(CommonCanvasCentralItems);\n","/*\n * Copyright 2017-2022 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Provider } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport PropTypes from \"prop-types\";\nimport Palette from \"../palette/palette.jsx\";\nimport CommonCanvasTooltip from \"./cc-tooltip.jsx\";\nimport CommonCanvasCentralItems from \"./cc-central-items.jsx\";\nimport Logger from \"../logging/canvas-logger.js\";\n\n\nclass CommonCanvas extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.logger = new Logger([\"CommonCanvas\"]);\n\t\tthis.logger.log(\"constructor\");\n\n\t\tthis.initializeController = this.initializeController.bind(this);\n\t\tthis.containingDivId = \"common-canvas-items-container-\" + props.canvasController.getInstanceId();\n\n\t\tprops.canvasController.setIntl(props.intl);\n\t\tthis.initializeController(props);\n\t}\n\n\tcomponentDidUpdate() {\n\t\tthis.logger.log(\"componentDidUpdate\");\n\t\tthis.initializeController(this.props);\n\t}\n\n\t// Prevent the default behavior (which is to show a plus-sign pointer) as\n\t// an object is being dragged over the common canvas components.\n\t// Note: this is overriden by the canvas area itself to allow external objects\n\t// to be dragged over it.\n\tonDragOver(evt) {\n\t\tevt.preventDefault();\n\t}\n\n\t// Prevent an object being dropped on the common canvas causing a file\n\t// download event (which is the default!). Note: this is overriden by the\n\t// canvas area itself to allow external objects to be dropped on it.\n\tonDrop(evt) {\n\t\tevt.preventDefault();\n\t}\n\n\tinitializeController(props) {\n\t\tthis.logger.logStartTimer(\"initializeController\");\n\t\tprops.canvasController.setCanvasConfig(props.config);\n\t\tprops.canvasController.setContextMenuConfig(props.contextMenuConfig);\n\t\tprops.canvasController.setKeyboardConfig(props.keyboardConfig);\n\t\tprops.canvasController.setToolbarConfig(props.toolbarConfig);\n\t\tprops.canvasController.setNotificationPanelConfig(props.notificationConfig);\n\t\tprops.canvasController.setRightFlyoutConfig(\n\t\t\t{ content: props.rightFlyoutContent, isOpen: props.showRightFlyout });\n\t\tprops.canvasController.setBottomPanelConfig(\n\t\t\t{ content: props.bottomPanelContent, isOpen: props.showBottomPanel });\n\n\t\tprops.canvasController.setHandlers({\n\t\t\tcontextMenuHandler: props.contextMenuHandler,\n\t\t\tbeforeEditActionHandler: props.beforeEditActionHandler,\n\t\t\teditActionHandler: props.editActionHandler,\n\t\t\tclickActionHandler: props.clickActionHandler,\n\t\t\tdecorationActionHandler: props.decorationActionHandler,\n\t\t\ttipHandler: props.tipHandler,\n\t\t\tlayoutHandler: props.layoutHandler,\n\t\t\tidGeneratorHandler: props.idGeneratorHandler,\n\t\t\tselectionChangeHandler: props.selectionChangeHandler,\n\t\t\tactionLabelHandler: props.actionLabelHandler\n\t\t});\n\t\tthis.logger.logEndTimer(\"initializeController\");\n\t}\n\n\tgenerateClass() {\n\t\tlet className = \"common-canvas\";\n\n\t\tclassName += (\n\t\t\t!this.isEditingAllowed()\n\t\t\t\t? \" config-editing-actions-false\"\n\t\t\t\t: \"\");\n\n\t\tclassName += (\n\t\t\tthis.props.config && this.props.config.enableParentClass\n\t\t\t\t? \" \" + this.props.config.enableParentClass\n\t\t\t\t: \"\");\n\n\t\treturn className;\n\t}\n\n\tisEditingAllowed() {\n\t\treturn this.props.config &&\n\t\t\t(typeof this.props.config.enableEditingActions === \"undefined\" ||\n\t\t\t\tthis.props.config.enableEditingActions === true);\n\t}\n\n\trender() {\n\t\tthis.logger.log(\"render\");\n\n\t\tconst tip = (<CommonCanvasTooltip canvasController={this.props.canvasController} />);\n\t\tconst palette = (<Palette canvasController={this.props.canvasController} containingDivId={this.containingDivId} />);\n\t\tconst centralItems = (<CommonCanvasCentralItems canvasController={this.props.canvasController} containingDivId={this.containingDivId} />);\n\n\t\tconst className = this.generateClass() + \" fix\";\n\n\t\treturn (\n\t\t\t<Provider store={this.props.canvasController.getStore()}>\n\t\t\t\t<div className={className} onDragOver={this.onDragOver} onDrop={this.onDrop}>\n\t\t\t\t\t{palette}\n\t\t\t\t\t{centralItems}\n\t\t\t\t\t{tip}\n\t\t\t\t</div>\n\t\t\t</Provider>\n\t\t);\n\t}\n}\n\nCommonCanvas.propTypes = {\n\tintl: PropTypes.object.isRequired,\n\tcanvasController: PropTypes.object.isRequired,\n\tconfig: PropTypes.object,\n\ttoolbarConfig: PropTypes.oneOfType([\n\t\tPropTypes.array,\n\t\tPropTypes.object\n\t]),\n\tnotificationConfig: PropTypes.object,\n\tcontextMenuConfig: PropTypes.object,\n\tkeyboardConfig: PropTypes.object,\n\tcontextMenuHandler: PropTypes.func,\n\tbeforeEditActionHandler: PropTypes.func,\n\teditActionHandler: PropTypes.func,\n\tclickActionHandler: PropTypes.func,\n\tdecorationActionHandler: PropTypes.func,\n\ttipHandler: PropTypes.func,\n\tlayoutHandler: PropTypes.func,\n\tidGeneratorHandler: PropTypes.func,\n\tselectionChangeHandler: PropTypes.func,\n\tactionLabelHandler: PropTypes.func,\n\trightFlyoutContent: PropTypes.object,\n\tshowRightFlyout: PropTypes.bool,\n\tbottomPanelContent: PropTypes.object,\n\tshowBottomPanel: PropTypes.bool\n};\n\nexport default injectIntl(CommonCanvas);\n"],"names":["_React$Component","_inherits","PaletteDialogTopbarThreeWayIcon","_super","_createSuper","props","_this","_classCallCheck","call","state","hover","iconClicked","bind","_assertThisInitialized","mouseEnter","mouseLeave","mouseDown","_createClass","key","value","this","iconClickedMethod","setState","mouseDownEvent","stopPropagation","icon","selectedIconName","isSelected","hoverIconName","deselectedIconName","React","createElement","draggable","className","src","onClick","onMouseEnter","onMouseLeave","onMouseDown","Component","PaletteDialogTopbar","doubleClick","close","gridViewSelected","listViewSelected","mouseDownMethod","doubleClickEvent","windowMaximizeMethod","closeEvent","canvasController","closePalette","showGridMethod","onDoubleClick","showGrid","PaletteDialogContentCategory","categorySelected","catSelEvent","categorySelectedMethod","style","selectedCategory","category","label","id","PaletteDialogContentCategories","catDivs","idx","categories","length","push","PaletteDialogContentGridNode","ghostData","onDragStart","onDragEnd","onMouseOver","closeTip","getGhostNode","nodeTemplate","ev","nodeTemplateDragStart","dataTransfer","setData","DND_DATA_TEXT","setDragImage","element","centerX","centerY","nodeTemplateDragEnd","createAutoNode","buttons","empty_text","app_data","ui_data","openTip","op","type","TIP_TYPE_PALETTE_ITEM","targetObj","currentTarget","_has","image","USE_DEFAULT_ICON","SUPERNODE_ICON","USE_DEFAULT_EXT_ICON","SUPERNODE_EXT_ICON","endsWith","SVG","alt","isEditingEnabled","txtClassName","node_types","Icon","CANVAS_CARBON_ICONS","WARNING_UNFILLED","PaletteDialogContentGrid","gridNodes","nodeTypes","width","PaletteContentListItem","showFullDescription","showShortDescription","onKeyPress","nodeTypeInfo","nodeType","e","code","keyCode","isDisplaySearchResult","getHighlightedText","occurrenceInfo","catLabelOccurrences","labelText","nodeLabelOccurrences","desc","description","nodeDescOccurrences","isLongDescription","_this$getAbbreviatedD","getAbbreviatedDescription","abbrDesc","occurrences","elements","less","intl","formatMessage","defaultMessage","defaultMessages","more","displayLen","substring","firstOccurrenceStart","start","remainder","offset","map","occ","end","textToHighlight","highlightedElements","index","text","forEach","i","itemText","_get","palette_image","isPaletteOpen","getHighlightedLabel","ranking","isShowRanking","mainDivClass","categoryLabel","getHighlightedCategoryLabel","getHighlightedDesc","nodeLabel","tabIndex","role","injectIntl","PaletteContentList","contentItems","nodeTypeInfos","itemKey","PaletteDialogContent","getUniqueCategories","getSelectedCategory","out","indexOf","target","firstChild","data","cats","paletteJSON","nt","content","ref","nextProps","prevState","PaletteDialog","xPos","yPos","mouseDownOnTopBar","mouseDownOnPalette","mouseMove","mouseUp","windowResize","windowMaximize","getPaletteDiv","resizePalette","movePalette","setResizingCursors","setSizingHoverEdge","snapToWidth","snapToHeight","removePx","dragging","dragOffsetY","dragOffsetX","verticalSizingAction","verticalSizingHover","horizontalSizingAction","hoizontalSizingHover","savedWidth","savedLeft","savedHeight","savedTop","hoverZoneSize","totalHoverZoneSize","adjustedWidth","adjustedHeight","adjustedScrollBarWidth","isMaximized","paletteNodes","hackPaletteOffset","hackPaletteTopOffset","window","addEventListener","removeEventListener","canvasDiv","eventClientY","clientY","offsetTop","offsetHeight","eventClientX","clientX","offsetLeft","offsetWidth","refs","palette","classOrId","property","firstChar","charAt","remaining","elem","document","getElementById","getElementsByClassName","getComputedStyle","getPropertyValue","paletteDiv","horizontalSizingHover","cursor","newHeight","newContentHeight","getStyleProperty","contentDiv","childNodes","height","newWidth","scrollDiv","clientHeight","scrollHeight","oldHeight","setContentDivHeight","parentDivId","newLeft","newTop","left","top","styleDimension","parseInt","minWidth","minHeight","getAdjustedMousePositionLeft","getAdjustedMousePositionRight","getAdjustedMousePositionTop","getAdjustedMousePositionBottom","gridNodeWidth","Math","round","gridHeight","displayValue","showPalette","display","root","require$$0","isObject","now","Date","toNumber","require$$2","nativeMax","max","nativeMin","min","debounce_1","func","wait","options","lastArgs","lastThis","maxWait","result","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","TypeError","invokeFunc","time","args","thisArg","undefined","apply","shouldInvoke","timeSinceLastCall","timerExpired","trailingEdge","setTimeout","timeWaiting","remainingWait","debounced","isInvoking","arguments","leadingEdge","clearTimeout","cancel","flush","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","minLen","_arrayLikeToArray","n","Object","prototype","toString","slice","constructor","name","from","test","_unsupportedIterableToArray","F","s","done","_e","f","err","normalCompletion","didErr","step","next","_e2","arr","len","arr2","getFilteredNodeTypeInfosByCategory","filterStrings","filteredNodeTypeInfos","_step","_iterator","getOccurrences","_getCategoryLabelInfo","catLabel","toLowerCase","_wordOccurrences","wordOccurrences","hitCounts","catLabelHitCounts","getCategoryLabelInfo","_getNodeLabelInfo","_wordOccurrences2","nodeLabelHitCounts","getNodeLabelInfo","_getNodeDescInfo","_wordOccurrences3","nodeDescHitCounts","getNodeDescInfo","descHitCounts","filterStringsLength","multiStringHits","calcRanking","mainString","newOccurrences","searchString","count","wordOccurrencesByString","addOccurrences","newOcc","handled","outOccurrences","concat","sort","occ1","occ2","joinOccurrences","PaletteFlyoutContentCategory","isOpen","TIP_TYPE_PALETTE_CATEGORY","substr","loading_text","titleLoadingObj","InlineLoading","onSuccess","status","successDelay","AccordionItem","title","_this2","titleObj","getTitleObj","getContent","onHeadingClick","_ref","itemImage","getItemImage","getItemText","getDisplayLabel","_this3","getInlineLoadingRenderCategory","getRenderCategory","PaletteFlyoutContentSearch","searchOnClick","handleSearchStringChange","evt","openPalette","placeHolder","Search","placeholder","onChange","size","PaletteFlyoutContentFilteredList","noResultsFound","adjustSearch","isNodeTypeInfosArrayTruncated","resultsRestricted","getNoResultsDiv","getContentListDiv","logger","Logger","PaletteFlyoutContent","selectedCategoryIds","setSearchString","setSearchStringThrottled","_debounce","contentDivs","Accordion","logStartTimer","split","filter","kw","_toConsumableArray","e1","e2","getFilteredNodeTypeInfos","logEndTimer","ss","catSelId","selCatIds","isCategorySelected","catId","categoryId","some","cId","getFilteredContentDivs","getContentDivs","contentCategories","contentSearch","PaletteFlyout","enableNarrowPalette","Palette","log","enablePaletteLayout","PALETTE_LAYOUT_FLYOUT","PALETTE_LAYOUT_MODAL","containingDivId","connect","ownProps","canvasconfig","enableEditingActions","CommonCanvasTooltip","handleClick","direction","customContent","TIP_TYPE_NODE","getObjectModel","hasErrorMessage","node","ERROR","hasWarningMessage","WARNING","getPaletteNode","nodeTypeLabel","TIP_TYPE_PORT","_isEmpty","port","TIP_TYPE_DEC","decoration","tooltip","TIP_TYPE_LINK","TIP_TYPE_STATE_TAG","stateTagText","Tooltip","tip","mousePos","includes","CommonCanvasContextMenu","contextMenu","contextMenuDef","ContextMenuWrapper","contextMenuActionHandler","contextMenuPos","getContextMenuPos","closeContextMenu","contextmenu","menuDef","CommonCanvasTextToolbar","getLabel","labelId","substituteObj","defaultToolbarMessages","shortcutSuffix","shortcutSuffix2","osKey","CanvasUtils","isMacintosh","shortCut","shortCut2","headerLabel","getJsxLabel","boldLabel","italicsLabel","strikethroughLabel","codeLabel","linkLabel","quoteLabel","numberedListLabel","bulletedListLabel","leftBar","action","jsx","OverflowMenu","iconDescription","renderIcon","TextScale32","OverflowMenuItem","actionHandler","d","divider","enable","iconEnabled","TextBold32","TextItalic32","TextStrikethrough32","Code32","Link32","TextIndentMore32","ListNumbered32","ListBulleted32","textToolbar","pos_x","pos_y","onBlur","blurHandler","Toolbar","config","getTextToolbar","instanceId","getInstanceId","toolbarActionHandler","tooltipDirection","texttoolbar","CommonCanvasStateTag","tipText","stateTagType","STATE_TAG_LOCKED","STATE_TAG_READ_ONLY","stateTag","getStateTag","Locked16","EditOff16","xhtml","svg","xlink","xml","xmlns","prefix","namespaces","hasOwnProperty","space","local","creatorInherit","ownerDocument","uri","namespaceURI","documentElement","createElementNS","creatorFixed","fullname","namespace","none","selector","querySelector","array","x","empty","querySelectorAll","matches","childMatcher","find","childFirst","firstElementChild","children","update","EnterNode","parent","datum","_next","_parent","__data__","bindIndex","group","enter","exit","groupLength","dataLength","bindKey","keyValue","nodeByKeyValue","Map","keyValues","has","set","get","delete","arraylike","ascending","a","b","NaN","attrRemove","removeAttribute","attrRemoveNS","removeAttributeNS","attrConstant","setAttribute","attrConstantNS","setAttributeNS","attrFunction","v","attrFunctionNS","defaultView","styleRemove","removeProperty","styleConstant","priority","setProperty","styleFunction","styleValue","propertyRemove","propertyConstant","propertyFunction","classArray","string","trim","classList","ClassList","_node","_names","getAttribute","classedAdd","names","list","add","classedRemove","remove","classedTrue","classedFalse","classedFunction","textRemove","textContent","textConstant","textFunction","htmlRemove","innerHTML","htmlConstant","htmlFunction","raise","nextSibling","parentNode","appendChild","lower","previousSibling","insertBefore","constantNull","removeChild","selection_cloneShallow","clone","cloneNode","selection_cloneDeep","onRemove","typename","on","__on","j","m","listener","onAdd","event","contextListener","dispatchEvent","params","CustomEvent","createEvent","initEvent","bubbles","cancelable","detail","dispatchConstant","dispatchFunction","child","join","splice","contains","Selection","groups","parents","_groups","_parents","selection","select","subgroups","subnode","subgroup","selectAll","arrayAll","selectorAll","selectChild","match","childFind","selectChildren","childrenFilter","matcher","enterGroup","updateGroup","previous","i0","i1","_enter","_exit","sparse","onenter","onupdate","onexit","append","merge","order","context","groups0","groups1","m0","m1","merges","group0","group1","compareDocumentPosition","compare","compareNode","sortgroups","sortgroup","callback","nodes","each","attr","getAttributeNS","classed","html","create","creator","insert","before","deep","t","typenames","parseTypenames","dispatch","nextId","Local","_","sourceEvent","ownerSVGElement","createSVGPoint","point","y","matrixTransform","getScreenCTM","inverse","getBoundingClientRect","rect","clientLeft","clientTop","pageX","pageY","events","touches","pointer","baseForOwn","castFunction","require$$1","forOwn_1","object","iteratee","_basePropertyOf","escapeHtmlChar","reUnescapedHtml","reHasUnescapedHtml","RegExp","source","_escape","replace","noop","Error","Dispatch","c","types","T","copy","that","nonpassive","passive","nonpassivecapture","capture","nopropagation","stopImmediatePropagation","preventDefault","view","noevent","__noselect","MozUserSelect","yesdrag","noclick","DragEvent","subject","identifier","active","dx","dy","defineProperties","enumerable","configurable","defaultFilter","ctrlKey","button","defaultContainer","defaultSubject","defaultTouchable","navigator","maxTouchPoints","mousedownx","mousedowny","mousemoving","touchending","container","touchable","gestures","listeners","clickDistance2","drag","mousedowned","touchstarted","touchmoved","touchended","gesture","beforestart","mousemoved","mouseupped","nodrag","mouse","changedTouches","touch","p","p0","constant","clickDistance","sqrt","quadInOut","cubicInOut","polyIn","custom","pow","exponent","polyOut","polyInOut","pi","PI","halfPi","sinInOut","cos","tpmt","expInOut","circleInOut","b1","b2","b3","b4","b5","b6","b7","b8","b9","b0","bounceOut","overshoot","backIn","backOut","backInOut","tau","elasticIn","asin","sin","amplitude","period","elasticOut","elasticInOut","responseBlob","response","ok","statusText","blob","responseArrayBuffer","arrayBuffer","EOL","EOF","QUOTE","NEWLINE","RETURN","objectConverter","columns","Function","JSON","stringify","inferColumns","rows","columnSet","row","column","pad","formatDate","date","year","hours","getUTCHours","minutes","getUTCMinutes","seconds","getUTCSeconds","milliseconds","getUTCMilliseconds","isNaN","getUTCFullYear","getUTCMonth","getUTCDate","delimiter","reFormat","DELIMITER","charCodeAt","parseRows","N","I","eof","eol","token","preformatBody","formatValue","formatRow","parse","convert","customConverter","format","formatBody","formatRows","csvParse","dsv","tsvParse","responseText","input","init","fetch","then","dsvParse","csv","tsv","responseJson","json","parser","DOMParser","parseFromString","dsvFormat","Promise","resolve","reject","Image","onerror","onload","factory","extend","definition","Color","darker","brighter","reI","reN","reP","reHex","reRgbInteger","reRgbPercent","reRgbaInteger","reRgbaPercent","reHslPercent","reHslaPercent","named","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","color_formatHex","rgb","formatHex","color_formatRgb","formatRgb","color","l","exec","rgbn","Rgb","rgba","hsla","r","g","opacity","rgb_formatHex","hex","rgb_formatRgb","clampa","clampi","h","Hsl","hslConvert","clamph","clampt","hsl2rgb","m2","define","channels","assign","displayable","formatHex8","formatHsl","k","clamp","gamma","nogamma","exponential","linear","rgbGamma","colorRgb","reA","reB","am","bm","bs","bi","lastIndex","q","number","one","zero","svgNode","degrees","identity","translateX","translateY","rotate","skewX","scaleX","scaleY","atan2","atan","interpolateTransform","pxComma","pxParen","degParen","pop","xa","ya","xb","yb","translate","scale","interpolateTransformCss","DOMMatrix","WebKitCSSMatrix","isIdentity","decompose","interpolateTransformSvg","transform","baseVal","consolidate","matrix","cosh","exp","taskHead","taskTail","zoomRho","rho","rho2","rho4","zoom","p1","S","ux0","uy0","w0","ux1","uy1","w1","d2","d1","r0","r1","coshr0","u","sinh","duration","SQRT2","_1","_2","frame","timeout","interval","pokeDelay","clockLast","clockNow","clockSkew","clock","performance","setFrame","requestAnimationFrame","clearNow","Timer","_call","_time","timer","delay","restart","wake","timerFlush","t0","t2","t1","Infinity","sleep","nap","poke","clearInterval","setInterval","elapsed","stop","emptyOn","emptyTween","CREATED","SCHEDULED","STARTING","STARTED","RUNNING","ENDING","ENDED","timing","schedules","__transition","self","tween","schedule","tick","ease","tweenRemove","tween0","tween1","tweenFunction","tweenValue","transition","_id","interpolateNumber","interpolateRgb","interpolateString","interpolate","value1","string00","interpolate0","string1","string0","string10","attrTweenNS","attrInterpolateNS","_value","attrTween","attrInterpolate","delayFunction","delayConstant","durationFunction","durationConstant","Transition","_name","newId","selection_prototype","inherit","id0","id1","on0","on1","sit","every","onFunction","styleTween","styleNull","listener0","styleMaybeRemove","styleInterpolate","textTween","textInterpolate","removeFunction","easeConstant","easeVarying","interrupt","defaultTiming","easeCubicInOut","ZoomEvent","Transform","applyX","applyY","invert","location","invertX","invertY","rescaleX","domain","range","rescaleY","__zoom","defaultExtent","SVGElement","hasAttribute","viewBox","clientWidth","defaultTransform","defaultWheelDelta","deltaY","deltaMode","defaultConstrain","extent","translateExtent","dx0","dx1","dy0","dy1","touchstarting","touchfirst","constrain","wheelDelta","scaleExtent","interpolateZoom","touchDelay","wheelDelay","tapDistance","trackpad","preventBackGesture","wheeled","dblclicked","gesturestart","gesturechange","gestureend","centroid","w","clean","__zooming","Gesture","taps","_len","_key","wheel","safariPinchZoom","wheelTransX","wheelTransY","deltaX","_len2","_key2","moved","x0","y0","dragEnable","dragDisable","_len3","_key3","k1","shiftKey","_len4","_key4","started","touch0","touch1","_len5","_key5","l0","l1","dp","dl","_len6","_key6","hypot","collection","scaleBy","scaleTo","translateBy","translateTo","emit","SvgCanvasDisplay","isSubflow","pipelineId","breadcrumbs","isDisplayingCurrentPipeline","displayState","SvgCanvasNodes","canvasLayout","pos","x_pos","y_pos","isExpandedSupernode","getMessageLabelClass","messages","lineTypeClass","layout","labelSingleLine","justificationClass","labelAlign","iconPath","getMessageLevel","NODE_ERROR_ICON","NODE_WARNING_ICON","messageLevel","message","labelClass","supernodeImagePosX","supernodeImageWidth","getElementPosX","imagePosX","imagePosition","imageWidth","supernodeImagePosY","supernodeImageHeight","getElementPosY","imagePosY","imageHeight","supernodeLabelPosX","labelPosX","labelPosition","labelWidth","supernodeLabelPosY","labelPosY","supernodeErrorPosX","supernodeLabelHeight","labelHeight","spanObj","zoomScale","fullLabelOnHover","getNodeLabelEditIconPosX","getNodeLabelEditIconPosY","getNodeLabelHoverWidth","getNodeLabelWidth","posX","getNodeLabelHoverPosX","getNodeLabelPosX","spanWidth","halfLabelWidth","xOffsetFromStart","getNodeLabelPosY","calcHeight","TEXT_AREA_BORDER_ADJUSTMENT","getNodeLabelHeight","getNodeEllipsisPosX","getNodeEllipsisPosY","supernodeEllipsisWidth","ellipsisWidth","supernodeEllipsisHeight","ellipsisHeight","getNodeEllipsisWidth","ellipsisHoverAreaPadding","getNodeEllipsisHeight","supernodeEllipsisPosX","ellipsisPosX","ellipsisPosition","supernodeEllipsisPosY","ellipsisPosY","supernodeExpansionIconPosX","supernodeExpansionIconPosY","errorXPos","errorPosition","supernodeErrorPosY","errorYPos","supernodeErrorWidth","errorWidth","supernodeErrorHeight","errorHeight","inputPortLeftPosX","inputPortLeftPosition","inputPortLeftPosY","outputPortRightPosX","outputPortRightPosition","outputPortRightPosY","xOffset","position","Number","yOffset","startsWith","nodeId","ports","subflow_node_ref","cx","supernodeSVGAreaPadding","cy","SvgCanvasUtilsComments","com","CLOCKWISE","ANTI_CLOCKWISE","ONE_EIGHTY_DEGREES_IN_RADIANS","SvgCanvasLinks","nodeUtils","commentUtils","srcComment","endPos","getOuterCoord","linkGap","getCommentCenterPosX","getCommentCenterPosY","originInfo","originX","originY","drawNodeLinkLineFromTo","isExpanded","_this$getCenterOffset","getCenterOffset","getNodeCenterPosX","getNodeCenterPosY","getNodeImageCenterPosX","getNodeImageCenterPosY","links","link","coordsUpdated","pathInfo","getConnectorPathInfo","drawingNewLinkMinInitialLine","minInitialLine","getMinInitialLine","abs","x1","x2","y1","y2","getStraightPath","NODE_LINK","linkType","LINK_TYPE_CURVE","LINK_TYPE_ELBOW","getPortLinkPath","ASSOCIATION_LINK","enableAssocLinkType","ASSOC_RIGHT_SIDE_CURVE","getAssociationCurvePath","COMMENT_LINK","minInitialLineForElbow","srcObj","srcPortId","trgNode","trgPortId","assocLinkVariation","LINK_TYPE_STRAIGHT","getNodeLinkCoordsForStraightLine","getNodeLinkCoordsForPorts","getAssociationCurveLinkCoords","getCommentLinkCoords","srcNode","srcCenterX","srcCenterY","trgCenterX","trgCenterY","srcOriginInfo","_this$getCenterOffset2","trgOriginInfo","_this$getCenterOffset3","startPos","parts","dir","NORTH","SOUTH","EAST","WEST","srcX","srcY","trgX","trgY","linkDirection","LINK_DIR_TOP_BOTTOM","outputPortBottomPosX","outputPortBottomPosY","inputPortTopPosX","inputPortTopPosY","LINK_DIR_BOTTOM_TOP","outputs","srcPort","inputs","trgPort","ASSOC_VAR_CURVE_RIGHT","ASSOC_VAR_CURVE_LEFT","ASSOC_VAR_DOUBLE_BACK_LEFT","drawCommentLinkLineTo","topSrc","topTrg","bottomSrc","bottomTrg","newData","rotateData90Degrees","getElbowPathInfo","getCurvePathInfo","rotateElements90Degrees","centerPoint","rotatePoint90Degrees","path","createPath","xDiff","wrapAroundNodePadding","corner1X","corner1Y","corner2X","corner2Y","x3","y3","yDiff","midY","calculateMidY","offsetForStraightLine","offsetForFirstCorner","corner4X","corner4Y","corner4aX","corner4aY","corner4bX","corner4bY","corner5X","corner5Y","corner6X","corner6Y","elbowYOffset","minFinalLine","elbowSize","elbowXOffset","extraSegments","corner2Ya","corner2Yb","maxBottom","srcBottomInc","trgBottomInc","minTop","wrapAroundSpacing","antiClockwise","newPoint1","newPoint2","newPoint","el","angle","getCurveLeftPath","getDoubleBackLeft","ASSOC_VAR_DOUBLE_BACK_RIGHT","getDoubleBackRight","getCurveRightPath","getCurveOutPath","getDoubleBack","calcCenterPoint","c1","c2","c3","c4","SvgCanvasDecs","decorations","nd","dec","objType","label_single_line","label_align","getDecClass","getDecPosX","getDecPosY","DEC_LINK","getLinkDecPosX","getNodeDecPosX","decoratorLeftX","decoratorCenterX","decoratorRightX","sourcePoint","targetPoint","distance","getDecWidth","getLinkDecPosY","getNodeDecPosY","decoratorTopY","decoratorMiddleY","decoratorBottomY","obj","outline","linkDecoratorPadding","decoratorPadding","linkDecoratorWidth","decoratorWidth","linkDecoratorHeight","decoratorHeight","inClassName","class_name","getDecLabelEditIconPosX","getDecLabelEditIconPosY","getDecLabelWidth","linkDecoratorLabelWidth","decoratorLabelWidth","linkDecoratorLabelHeight","decoratorLabelHeight","getDecLabelHeight","unescapeHtmlChar","reEscapedHtml","reHasEscapedHtml","_unescape","inStart","inEnd","mdObj","findFirstSpace","findLastSpace","allWhiteSpace","findFirstNonSpace","findLastNonSpace","processHeaderCommand","processWrapCommand","processCodeCommand","processLinkCommand","processMultiLineCommand","processReturnCommand","spacePos","lastIndexOf","newLinePos","newStart","newEnd","findPrecedingNewLine","findSuceedingNewLine","startText","selectedText","endText","newText","tempText","hashCount","getHashCount","firstSpace","headerSyntax","getHeaderSyntax","chars","charsCount","processTripleBackTicks","isMultiLineMarkdown","removeMultiLineMarkdown","addMultiLineMarkdown","line","isMultiLineItem","getPrefixNumber","firstText","lines","newLine","removeListPrefix","getListPrefix","suffixText","preStart","sucEnd","originalStart","originalEnd","isCursorAtBeginningOfLine","insertMultiLineItem","newEndText","renumberEndText","char","startIndex","_this4","finished","renumberLine","d3","d3Selection","SvgCanvasTextArea","dispUtils","decUtils","activePipeline","displayCommentsCallback","displayLinksCallback","getCommentToolbarPosCallback","editingText","editingTextId","addingTextToTextArea","textAreaHeight","parentDomObj","editingTextData","singleLine","maxCharacters","allowReturnKey","textCanBeEmpty","keyboardInputCallback","enableMarkdownInComments","commentKeyboardHandler","autoSizeCallback","autoSizeComment","saveTextChangesCallback","saveCommentChanges","closeTextAreaCallback","closeCommentTextArea","displayTextArea","isDisplayingFullPage","openTextToolbar","markdownActionHandler","blurInTextToolbar","d3Event","getMarkdownAction","stopPropagationAndPreventDefault","relatedTarget","getParentElementWithClass","completeEditing","isCmndCtrlPressed","commentEntryElement","selectionStart","selectionEnd","SvgCanvasMarkdown","processMarkdownAction","addTextToTextArea","focus","execCommand","setSelectionRange","textArea","foreignObject","getComment","comment","editType","editSource","editActionHandler","closeTextToolbar","displayDiv","displayDivStyle","labelMaxCharacters","labelAllowReturnKey","getNodeLabelTextAreaPosX","getNodeLabelTextAreaPosY","getNodeLabelTextAreaWidth","getNodeLabelTextAreaHeight","getNodeLabelTextAreaClass","autoSizeMultiLineLabel","saveNodeLabelChanges","closeEntryTextArea","taData","label_max_characters","label_allow_return_key","getDecLabelTextAreaPosX","getDecLabelTextAreaPosY","getDecLabelTextAreaWidth","getDecLabelTextAreaHeight","getDecLabelTextAreaClass","objId","saveDecLabelChanges","decId","textContentSaved","saveAndCloseTextArea","textAreaEscKeyPressed","closeTextArea","textAreaAllowedKeys","newValue","SVGCanvasPipeline","canvasInfo","selectionInfo","initialize","selections","pipeline","getPipeline","comments","mappedNodes","getMappedArray","mappedComments","mappedLinks","preProcessPipeline","gap","getCanvasDimensions","getNode","nodeIds","nId","isSupernode","containsOnlyBindingNodes","isSuperBindingNode","commentId","commentIds","linkId","linkIds","lId","getLink","oldLink","findIndex","pipelines","setAllPortsDisconnected","srcNodeId","trgNodeId","setOutputPortConnected","srcNodePortId","setInputPortConnected","trgNodePortId","inp","isConnected","inPortId","portId","getDefaultInputPortId","outPortId","getDefaultOutputPortId","reduce","_this5","objs","getSelectedNodes","getSelectedObjectIds","_this6","_this7","getSelectedLinks","srcPos","trgPos","d3Drag","d3Ease","d3Fetch","d3Zoom","markdownIt","require","linkify","typographer","OUTPUT_TYPE","SVGCanvasRenderer","nodeLayout","supernodeInfo","superRenderers","SvgCanvasComments","linkUtils","svgCanvasTextArea","displayComments","displayLinks","getCommentToolbarPos","setDisplayState","getDisplayStateMsg","initializeZoomVariables","minScaleExtent","maxScaleExtent","commentSizing","commentSizingDirection","nodeSizing","nodeSizingDirection","nodeSizingObjectsInfo","nodeSizingDetLinksInfo","resizeObjInitialInfo","notSnappedXPos","notSnappedYPos","notSnappedWidth","notSnappedHeight","dragRunningX","dragRunningY","dragObjects","dragStartX","dragStartY","dragOverLink","dragOverDetachedLinks","dragPointerOffsetInNode","dragNewLinkOverNode","existingNodeInsertableIntoLink","existingNodeAttachableToDetachedLinks","spaceKeyPressed","zoomingAction","contextMenuClosedOnZoom","textEditingClosedOnZoom","regionSelect","zoomStartPoint","startX","startY","regionStartTransformX","regionStartTransformY","drawingNewLinkData","dragStart","dragMove","dragEnd","draggingLinkData","dragSelectionHandle","dragStartLinkHandle","dragMoveLinkHandle","dragEndLinkHandle","enableInteractionType","INTERACTION_TRACKPAD","zoomStart","zoomAction","zoomEnd","initializeGhostDiv","canvasSVG","createCanvasSVG","canvasGrp","createCanvasGroup","canvasUnderlay","createCanvasUnderlay","commentsGrp","nodesLinksGrp","boundingRectsGrp","createBoundingRectanglesGrp","resetCanvasSVGBehaviors","displayCanvas","restoreZoom","isDisplayingSubFlowFullPage","alwaysDisplayBackToParentFlow","addBackToParentFlowArrow","getSavedZoom","zoomToFit","isDisplayingSubFlowInPlace","resetCanvasCursor","INTERACTION_CARBON","isSpaceKeyPressed","zoomTransform","zoomIdentity","cleanUpSuperRenderers","displayCommentsSelectionStatus","displayNodesSelectionStatus","displayLinksSelectionStatus","renderer","setSelectionInfo","newSuperRenderers","getSupernodes","supernode","ren","getRendererForSupernode","getDiscardedRenderersForSupernode","dr","displayBindingNodesToFitSVG","enableBoundingRectangles","displayBoundingRectangles","enablePositionNodeOnRightFlyoutOpen","isRightFlyoutOpen","posInfo","selNodeIds","getSelectedNodeIds","getZoomToReveal","zoomTo","displayNodes","displaySVGToFitSupernode","displayPortsForSubFlowFullPage","displayCanvasAccoutrements","enableCanvasUnderlay","isDisplayingPrimaryFlowFullPage","setCanvasUnderlaySize","setPortPositionsForNode","getParentSupernodeDatum","dims","getParentSupernodeSVGDimensions","background","setPortPositionsAllNodes","moveSuperBindingNodes","displayMovedNodes","displayMovedLinks","supernodeTopAreaHeight","transformedSVGRect","getTransformedViewportDimensions","supernodeDatum","svgWid","isSupernodeInputBinding","getSupernodePortXOffset","isSupernodeOutputBinding","topAreaHeight","svgHt","getSupernodePortYOffset","svgRect","getViewportDimensions","getTransformedRect","canv","getCanvasDimensionsAdjustedForScale","canvWithPadding","getZoomToFitPadding","grp","sr","isEditingText","superRen","isCollapsedSupernode","enableResizableNodes","nodeGrpSelector","getSelectorForId","linkGrpSelector","comId","nodeSel","getNodeGroupSelectionById","linkSel","getLinkGroupSelectionById","suffix","suffix2","getId","transPos","enableSnapToGridType","SNAP_TO_GRID_DURING","SNAP_TO_GRID_AFTER","snapToGridPosition","inResizeObj","resizeObj","snapToGrid","snapToGridXPx","snapToGridYPx","transformPos","getMousePos","svgSel","transPad","getGhostDivSel","ghost","getGhostDimensions","convertNodeTemplate","is_expanded","expanded_width","expanded_height","isResized","resizeWidth","resizeHeight","nodeImage","getNodeImage","nodeImageType","getImageType","ghostDivSel","ghostAreaWidth","ghostGrp","setNodeImageContent","getNodeImagePosX","getNodeImagePosY","getNodeImageWidth","getNodeImageHeight","fObject","fObjectDiv","getNodeLabelClass","labelSpanWidth","nodeLabelWidth","labelDisplayLength","labelDiff","browserZoom","getBrowserZoom","devicePixelRatio","userAgent","outerWidth","innerWidth","defaultNodeWidth","defaultNodeHeight","isNodeTemplateInsertableIntoLink","setDataLinkSelectionAreaWider","getLinkAtMousePos","isLinkFullyAttached","setInsertNodeIntoLinkHighlighting","isNodeTemplateAttachableToDetachedLinks","convertPageCoordsToCanvasCoords","ghostArea","template","getAttachableLinksForNodeAtPos","setDetachedLinkHighlighting","unsetInsertNodeIntoLinkHighlighting","setNodeDragOverLinkHighlighting","unsetDetachedLinkHighlighting","nodeNearMouse","getNodeNearMousePos","nodeProximity","isConnectionAllowedToNearbyNode","setNewLinkOverNodeHighlighting","isDataConnectionAllowed","isAssocConnectionAllowed","srcObjId","isCommentLinkConnectionAllowed","getNewLinkOnDrag","transformMousePosForNode","createNodeFromTemplateOnLinkAt","createNodeFromTemplateAttachLinks","createNodeFromTemplateAt","dropData","createDroppedExternalObject","getMousePosSnapToGrid","enableInsertNodeDroppedOnLink","hasInputAndOutputPorts","isPortMaxCardinalityZero","isNode","isNodeDefaultPortsCardinalityAtMax","enableLinkSelection","LINK_SELECTION_DETACHABLE","nodeHasInputs","nodeHasOutputs","attachableLinks","isPosInArea","ghostAreaPadding","nodeOverSrcPos","nodeOverTrgPos","getDetachedLinksToUpdate","oldLinks","factor","newMaxExtent","newFactor","setMaxZoomExtent","_this8","parentObject","enableZoomIntoSubFlows","defs","createDropShadow","_this9","isEmptyOrBindingsOnly","drawNewLink","dragLinkHandle","CONTEXT_MENU_BUTTON","completeNewLink","completeDraggedLink","clickActionHandler","clickType","objectType","selectedObjectIds","openContextMenu","isDragActivated","canvasObj","_this10","displayPreviousPipeline","LEFT_ARROW_ICON","dropShadowFilter","feMerge","labelEditable","nodeDomObj","displayNodeLabelTextArea","setNodeLabelEditingMode","label_editable","nodeDecDomObj","getNodeDecSelectionById","displayDecLabelTextArea","setLinkDecorationLabelEditingMode","linkDecDomObj","getLinkDecSelectionById","newZoom","enablePanIntoViewOnOpen","initialPanX","initialPanY","zoomCanvasInvokeZoomBehavior","newZoomTransform","animateTime","isFinite","padding","canvasDimensions","viewPortDimensions","xRatio","yRatio","newScale","zoomToFitPadding","isDisplayingSubFlow","newPadding","getMaxZoomToFitPaddingForConnections","supernodeBindingPortRadius","zoomObject","z","getZoomTransform","objectIDs","getNodes","getComments","getLinks","convertCanvasDimensionsAdjustedForScaleWithPadding","xPosInt","yPosInt","right","bottom","viewportDimensions","_this11","isContextMenuDisplayed","shouldDoRegionSelect","addingCursorOverlay","addTempCursorOverlay","getTransformedMousePos","previousD3Event","zoomCanvasDimensions","commentHighlightGap","drawRegionSelector","zoomCanvasBackground","zoomCommentToolbar","stopDrawingNewLink","stopDraggingLink","zoomChanged","zoomEndRegionSelect","zoomSave","zoomClick","removeTempCursorOverlay","INTERACTION_MOUSE","incTransform","getTransformIncrement","zoomConstrainRegular","clearSelections","removeRegionSelector","_this$getRegionDimens","getRegionDimensions","region","selectInRegion","LINK_SELECTION_NONE","enableLinkType","setSelections","getEditingTextId","moveTextToolbar","unTransformPos","commentToolbarPosX","commentToolbarPosY","xInc","yInc","newTransform","viewPort","rightOffsetLimit","leftOffsetLimit","bottomOffsetLimit","topOffsetLimit","_this$getRegionDimens2","selectedObjects","getSelectedNodesAndComments","enableDragWithoutSelect","closeContextMenuIfOpen","initializeResizeVariables","dragObjectsStart","resizeComment","resizeNode","dragObjectsAction","endCommentSizing","endNodeSizing","dragObjectsEnd","getDragObjects","isExistingNodeInsertableIntoLink","setNodeTranslucentState","isExistingNodeAttachableToDetachedLinks","increment","stgPos","snapToGridDraggedNode","displayMovedComments","selectObjectSourceEvent","dragFinalOffset","offsetX","offsetY","detachedLinks","getSelectedDetachedLinks","unsetNodeTranslucentState","draggingLinkHandle","handleSelection","_cloneDeep","lineInfo","linkGrpSelection","endBeingDragged","enableHighlightUnavailableNodes","lnk","setUnavailableTargetNodesHighlighting","setUnavailableSourceNodesHighlighting","objPosX","objPosY","objPos","getFlags","sel","getAllNodeGroupsSelection","displayNodesSubset","_this12","nodeGroupSel","nodeGrps","updatePortRadiusAndPos","updatePortArrowPath","_this13","_this14","createNodes","getNodeGroupClass","getNodeGrpStyle","joinedNodeGrps","updateNodes","_this15","newNodeGroups","attachNodeGroupListeners","shouldDisplayNodeSizingArea","attachNodeSizingListeners","imageDisplay","getNodeImageClass","attachNodeLabelListeners","attachNodeLabelSpanListeners","_this16","getNodeShapePathSizing","getNodeSelectionOutline","getNodeSelectionOutlineStyle","getNodeShapePath","getNodeBodyStyle","getNodeImageStyle","getNodeLabelStyle","getNodeEllipsisTranslate","getNodeExpansionIconTranslate","grps","nodeGrp","displayPorts","displaySupernodeContents","addErrorMarker","getCombinedDecorations","displayDecorations","DEC_NODE","supernodeD3Object","setCanvasInfoRenderer","createSupernodeRenderer","hideCanvas","inputPortDisplay","displayInputPorts","outputPortDisplay","displayOutputPorts","_this17","inSelector","getNodeInputPortClassName","createInputPorts","joinedInputPortGrps","updateInputPorts","inputPortGroups","attachInputPortListeners","inputPortObject","enableAssocLinkCreation","_this18","inputPorts","PORT_OBJECT_IMAGE","inputPortImage","inputPortWidth","inputPortHeight","getPortRadius","getPortArrowPath","getPortArrowPathTransform","_this19","outSelector","getNodeOutputPortClassName","enableSingleOutputPortDisplay","createOutputPorts","joinedOutputPortGrps","updateOutputPorts","outputPortGroups","attachOutputPortListeners","outputPortObject","joinedOutputPortGroups","_this20","outputPorts","outputPortImage","outputPortWidth","outputPortHeight","_this21","raiseNodeToTop","setNodeStyles","addDynamicNodeIcons","canOpenTip","removeDynamicNodeIcons","selectObjectD3Event","_this22","isNodeResizable","nodeSizingCursor","isRegionSelectOrSizingInProgress","cursorType","isPointerCloseToBodyEdge","getSizingDirection","nodeCornerResizeArea","getCursorBasedOnDirection","nodeLabels","_this23","labelSel","enableDisplayFullLabelOnHover","spanSel","getNodeLabelHoverHeight","nodeLabelSpans","_this24","displayNodeLabelEditIcon","hideEditIconPending","hideEditIcon","_this25","portType","portObject","portImage","portWidth","portHeight","portRadius","guideObject","inputPortGuideObject","guideImage","inputPortGuideImage","linkArray","_this26","isSrcCardinalityAtMax","outputPortGuideObject","outputPortGuideImage","isTrgNodeAvailable","isSrcNodeAvailable","_this27","nodeObj","parentElement","nodeGrpSel","getNodeLabelEditIconTranslate","displayEditIcon","_this28","decObj","decGrpSel","getDecLabelEditIconTranslate","grpSel","editIconGrpSel","mouseOverLabelEditIcon","EDIT_ICON","EDIT_ICON_X_OFFSET","EDIT_ICON_Y_OFFSET","selectObject","d3EventType","isShiftKeyPressed","objectTypeName","getObjectTypeName","ellipsisClicked","trgGrp","decs","_this29","decGrpClassName","decGrpSelector","createDecorations","getDecTransform","hotspot","callDecoratorCallback","updateDecoration","_this30","attachDecGroupListeners","decSel","updateDecOutlines","updateDecPaths","updateDecImages","updateDecLabels","outlnSel","getDecHeight","pathSel","_this31","imageSel","getDecPadding","setImageContent","attachDecLabelListeners","attachDecLabelSpanListeners","getDecLabelClass","decLabels","_this32","decLabelSpans","_this33","displayDecLabelEditIcon","decGrps","_this34","_this35","errorMarkerSelection","getErrorMarkerClass","getErrorMarkerIcon","getNodeErrorWidth","getNodeErrorHeight","getNodeErrorPosX","getNodeErrorPosY","imageObj","cache","setNodeBodyStyles","setNodeSelectionOutlineStyles","setNodeImageStyles","setNodeLabelStyles","getObjectStyle","dropShadow","style_temp","subdueStyle","doesExpandedSupernodeHaveStyledNodes","_this36","expandedSupernodeHaveStyledNodes","subflow_ref","pipeline_id_ref","paddingForInputBinding","getMaxPaddingForConnectionsFromInputBindingNodes","paddingForOutputBinding","getMaxPaddingForConnectionsToOutputBindingNodes","_this37","maxPadding","nodePadding","getNodePaddingToTargetNodes","_this38","outputBindingNodes","getBindingPortRadius","_this39","ellipsisGrp","ellipsisDisplay","rect2","NODE_MENU_ICON","getNodeEllipsisIconWidth","getNodeEllipsisIconHeight","expGrp","getSupernodeBreadcrumbs","displaySubPipelineForBreadcrumbs","supernodeExpansionIconWidth","supernodeExpansionIconHeight","SUPER_NODE_EXPAND_ICON","supernodeExpansionIconHoverAreaPadding","domEl","nodeGroupEl","closest","svgAreaEl","getD3DatumFromDomEl","parentPipelineId","createBreadcrumb","reverse","portObjClassName","_this40","portArrowClassName","_this41","contextMenuHandler","targetObject","cmPos","addBreadcrumbs","SUPER_NODE","decorationActionHandler","drawNewCommentLinkForPorts","drawNewNodeLinkForPorts","enableHighlightNodeOnNewLinkDrag","setNewLinkOverNode","_this42","getNewStraightNodeLinkStartPos","getNewLinkAssocVariation","connectionLineSel","connectionStartSel","connectionGuideSel","isPointInNodeBoundary","removeNewLinkLine","PORT_OBJECT_CIRCLE","getLinkImageTransform","adjacent","opposite","_this43","getNewStraightCommentLinkStartPos","commentPortRadius","commentLinkArrowHead","connectionArrowHeadSel","getArrowHead","getArrowHeadTransform","unsetUnavailableNodesHighlighting","getNodeAtMousePos","completeNewLinkOnNode","completeNewDetachedLink","removeNewLink","setNewLinkOverNodeCancel","getInputNodePortId","targetNodes","enableLinkReplaceOnNewConnection","isDataLinkReplacementAllowed","linksToTrgPort","getDataLinksConnectedTo","replaceLink","endPoint","stopDrawingNewLinkForPorts","_this44","saveX1","saveY1","saveX2","saveY2","saveNewLinkData","newPath","easeElastic","newLink","getNodePortIdNearMousePos","getOutputNodePortId","canExecuteUpdateLinkCommand","linkSrcChanged","hasLinkSrcChanged","linkTrgChanged","hasLinkTrgChanged","executeCommand","isSrcConnectionAllowedWithDetachedLinks","isTrgConnectionAllowedWithDetachedLinks","isConnectionAllowedWithDetachedLinks","linkUpdated","getElementWithClassAtPosition","getNodeLinkForElement","foundLink","nodeGrpElement","getElementWithClassAtMousePos","getNodeForElement","inputPortId","getInputNodePortIdAtMousePos","portElement","getNodePortIdForElement","outputPortId","getOutputNodePortIdAtMousePos","posY","elementsFromPoint","foundElement","nodeName","_this45","prox","defaultPortId","portObjs","searchForPortNearMouse","portObjectType","nodeWidthOffset","portGrps","portSel","xx","yy","wd","ht","getRectangleNodeShapePath","nodeSizingArea","selectionPath","nodeShape","getPortArcsNodeShapePath","nodeHighlightGap","bodyPath","highlightGap","getPortArcsNodeShapePathVertical","inputPortsWidth","outputPortsWidth","getPortArcsNodeShapePathLeftRight","portArcOffset","outputPortsHeight","portArcRadius","portArcSpacing","endPoint2","inputPortsHeight","topPorts","topPortsWidth","bottomPorts","bottomPortsWidth","_this46","setPortPositionsVertical","getOutputPortBottomPosY","inputPortBottomPosX","getInputPortBottomPosY","outputPortTopPosX","outputPortTopPosY","setPortPositionsLeftRight","getNodeOutputPortRightPosX","getNodeOutputPortRightPosY","inputPortBottomPosY","portsWidth","xPosition","remainingSpace","multiplier","portsHeight","displaySinglePort","setPortPositionsLeftRightSinglePort","setPortPositionsLeftRightAllPorts","yPosition","heightSvgArea","getAllCommentGroupsSelection","displayCommentsSubset","_this47","_this48","getCommentGroupSelectionById","_this49","createComments","getCommentGroupClass","joinedCommentGrps","updateComments","_this50","newCommentGroups","attachCommentGroupListeners","attachCommentSizingListeners","_this51","commentSizingArea","getCommentBodyStyle","render","commentGrps","_this52","setCommentStyles","createCommentPort","deleteCommentPort","displayCommentTextArea","_this53","commentSizingCursor","commentCornerResizeArea","commentObj","_this54","cd","comGrp","setCommentSelectionOutlineStyles","setCommentBodyStyles","setCommentTextStyles","getCommentSelectionOutlineStyle","getCommentTextStyle","cursorStyle","rightEdge","bottomEdge","rightEdgeState","bottomEdgeState","cornerResizeArea","xPart","yPart","minHt","supernodeMinHeight","supernodeMinWidth","oldSupernode","getMinHeight","getMinWidth","delta","resizeObject","enableMoveNodesOnSupernodeResize","objectsInfo","moveSurroundingObjects","getNodesAndComments","linksInfo","moveSurroundingDetachedLinks","displaySingleNode","displaySingleComment","incrementX","incrementY","incrementWidth","incrementHeight","snapToGridObject","restrictNodeSizingToMinimums","detachedLinksInfo","commentSizingObjectsInfo","linksArray","buildLinksArray","getAllLinkGroupsSelection","displayLinksSubset","_this55","_this56","displaySingleLink","_this57","createLinks","getLinkGroupClass","getLinkGrpStyle","joinedLinkGrps","updateLinks","_this58","newLinkGrps","attachLinkGroupListeners","getLinkSelectionAreaClass","dataLinkArrowHead","LINK_SELECTION_HANDLES","linkGrps","createNewHandles","lineArray","_this59","linkGrp","updateHandles","setDisplayOrder","_this60","raiseLinkToTop","setLinkLineStyles","lowerLinkToBottom","handlesGrp","_this61","startHandle","linkStartHandleObject","endHandle","linkEndHandleObject","_this62","linkHandles","linkStartHandleImage","linkStartHandleWidth","linkStartHandleHeight","linkStartHandleRadius","linkEndHandleImage","linkEndHandleWidth","linkEndHandleHeight","linkEndHandleRadius","linkObj","getLinkTypeClass","getLinkCustomClass","customClass","supernodeClass","draggableClass","linkGroup","_this63","hasOneDecorationOrMore","raiseSelectedLinksToTop","getSelectedLinksCount","_this64","updateLinksForNodes","isLinkBeingDragged","getAttachedLineObj","getDetachedLineObj","addMinInitialLineForElbow","addConnectionPaths","error","shouldDisplayLink","getSourcePortId","getTargetPortId","getAssocLinkVariation","coords","getLinkCoords","getOutputPort","getInputPort","displayLinkOnOverlap","areLinkedObjectsOverlapping","srcHighlightGap","trgHighlightGap","srcLeft","srcRight","trgLeft","trgRight","srcTop","srcBottom","trgTop","trgBottom","_this65","nodeLinks","getNodeOutputLinks","sortedNodeLinks","sortNodeOutputLinks","applyMinInitialLine","outArray","_this66","nodeLineData1","nodeLineData2","first","second","LINK_DIR_LEFT_RIGHT","runningInitialLine","lineData","minInitialLineIncrement","_this67","updateLinksForNode","_this68","getDirAdjusted","endNode","getDirToEndPos","sortLinksInfo","updateLinksInfo","startNode","getDirToNode","endX","endY","getDir","linksDirArrayIn","_this69","linksDirArray","getLinkInfoGroups","_forOwn","li","getAngleBasedOnLinkDirection","tipType","isTipEnabled","addCommentOffsetX","addCommentOffsetY","str","SVGCanvasD3","canvasInfoId","canvasDivSelector","getCurrentBreadcrumb","ConfigUtils","compareCanvasConfigs","cloneCanvasInfo","cloneConfig","clearCanvas","currentBreadcrumb","supernodeId","supernodeParentPipelineId","isDragging","positon","nodeTemplateDragOver","nodeTemplateDropped","externalObjectDropped","zoomIn","zoomOut","isZoomedToMax","isZoomedToMin","objectIds","getZoom","setNodeDecorationLabelEditingMode","refreshOnSizeChange","getDefaultCommentOffset","setSpaceKeyPressed","CanvasContents","isDropZoneDisplayed","mainCanvasDivId","svgCanvasDivId","svgCanvasDivSelector","dragX","dragY","eventListenersAdded","drop","focusOnCanvas","setIsDropZoneDisplayed","dragOver","dragEnter","dragLeave","onCut","onCopy","onPaste","onKeyDown","onKeyUp","onMouseMove","afterUpdateCallbacks","setCanvasContents","svgCanvasD3","setCanvasInfo","canvasConfig","enableBrowserEditMenu","addEventListeners","prevProps","afterUpdate","removeEventListeners","activeElement","cutToClipboard","copyToClipboard","pasteFromClipboard","actions","getKeyboardConfig","undo","keyboardActionHandler","redo","convertPageCoordsToSnappedCanvasCoords","altKey","switchLoggingState","objectModel","getNodeLayout","getCanvasLayout","getData","warn","enableStateTag","emptyCanvas","isPrimaryPipelineEmpty","emptyCanvasContent","FlowData16","dropZoneCanvas","dropZoneCanvasContent","enableDropZoneOnExternalDrag","cb","getDragNodeTemplate","getDNDJson","operation","isDataTypeBeingDraggedFile","getEmptyCanvas","getContextMenu","getDropZone","svgCanvasDiv","getSVGCanvasDiv","mainClassName","enableRightFlyoutUnderToolbar","dropDivClassName","enableToolbarLayout","bottomPanelIsOpen","ReactResizeDetector","handleWidth","handleHeight","onResize","onDrop","onDragOver","onDragEnter","onDragLeave","canvasinfo","bottompanel","selectioninfo","CommonCanvasToolbar","rightBar","leftBarItems","getDefaultRightBar","maxMessageType","getNotificationMessagesMaxType","NOTIFICATION_ICON_CLASS","SUCCESS","INFO","copyConfig","getConvertedLegacyToolbar","getDefaultToolbar","optionallyAddPaletteTool","optionallyAddNotificationTool","overrideAutoEnableDisable","paletteLabel","newLeftBar","isPaletteEnabled","iconTypeOverride","notificationConfig","notificationCount","notificationMessages","notificationTools","TOOLBAR_TOGGLE_NOTIFICATION_PANEL","isNotificationOpen","getNotificationClassName","toolbarConfig","enableInternalObjectModel","editingAllowed","applyToolState","canUndo","canRedo","canCutCopy","canPaste","canDelete","canZoomIn","canZoomOut","canZoomToFit","undoLabel","redoLabel","undoTool","findTool","undo_command","redoTool","redo_command","tool","generateToolbarConfig","configureToolbarButtonsState","addUndoRedoCommandLabels","canvasToolbar","TOOLBAR_LAYOUT_TOP","additionalText","overflowMenuLabel","canvastoolbar","PALETTE_LAYOUT_NONE","notificationpanel","notifications","getUndoLabel","getRedoLabel","CommonCanvasRightFlyout","rightFlyout","rfClass","rightflyout","CanvasBottomPanel","onMouseUp","onMouseMoveY","diff","panelHeight","setBottomPanelHeight","limitHeight","canvasContainer","maxHeight","bottomPanel","heightPx","bottomPanelContent","NotificationPanel","handleNotificationPanelClickOutside","closeNotificationPanel","iconType","subtitle","closeMessage","deleteNotification","timestamp","notificationCallback","keepOpen","notificationIcon","notificationHeader","messageCallback","deleteNotificationMessages","clearNotificationMessages","clearAllCallback","notificationPanelClassName","DEFAULT_NOTIFICATION_HEADER","notificationSubtitle","notificationPanelMessages","getNotifications","emptyMessage","clearAll","clearAllMessage","Button","kind","disabled","secondaryButton","secondaryButtonLabel","secondaryButtonCallback","secondaryButtonDisabled","Close16","CommonCanvasCentralItems","notificationPanel","canvasContents","CommonCanvas","initializeController","setIntl","setCanvasConfig","setContextMenuConfig","contextMenuConfig","setKeyboardConfig","keyboardConfig","setToolbarConfig","setNotificationPanelConfig","setRightFlyoutConfig","rightFlyoutContent","showRightFlyout","setBottomPanelConfig","showBottomPanel","setHandlers","beforeEditActionHandler","tipHandler","layoutHandler","idGeneratorHandler","selectionChangeHandler","actionLabelHandler","isEditingAllowed","enableParentClass","centralItems","generateClass","Provider","store","getStore"],"mappings":"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"}